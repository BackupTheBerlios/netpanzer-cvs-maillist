<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Netpanzer-cvs] r1268 - in trunk/netpanzer:	pics/backgrounds/menus/buttons/default	pics/backgrounds/menus/menu src/NetPanzer/Interfaces	src/NetPanzer/Views src/NetPanzer/Views/Components	src/NetPanzer/Views/Game src/NetPanzer/Views/MainMenu	src/NetPanzer/Views/MainMenu/Multi
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/netpanzer-cvs/2011-October/index.html" >
   <LINK REL="made" HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1268%20-%20in%20trunk/netpanzer%3A%0A%09pics/backgrounds/menus/buttons/default%0A%09pics/backgrounds/menus/menu%20src/NetPanzer/Interfaces%0A%09src/NetPanzer/Views%20src/NetPanzer/Views/Components%0A%09src/NetPanzer/Views/Game%20src/NetPanzer/Views/MainMenu%0A%09src/NetPanzer/Views/MainMenu/Multi&In-Reply-To=%3C20111025143851.C43664813FD%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000293.html">
   <LINK REL="Next"  HREF="000295.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Netpanzer-cvs] r1268 - in trunk/netpanzer:	pics/backgrounds/menus/buttons/default	pics/backgrounds/menus/menu src/NetPanzer/Interfaces	src/NetPanzer/Views src/NetPanzer/Views/Components	src/NetPanzer/Views/Game src/NetPanzer/Views/MainMenu	src/NetPanzer/Views/MainMenu/Multi</H1>
    <B>wile64 at mail.berlios.de</B> 
    <A HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1268%20-%20in%20trunk/netpanzer%3A%0A%09pics/backgrounds/menus/buttons/default%0A%09pics/backgrounds/menus/menu%20src/NetPanzer/Interfaces%0A%09src/NetPanzer/Views%20src/NetPanzer/Views/Components%0A%09src/NetPanzer/Views/Game%20src/NetPanzer/Views/MainMenu%0A%09src/NetPanzer/Views/MainMenu/Multi&In-Reply-To=%3C20111025143851.C43664813FD%40sheep.berlios.de%3E"
       TITLE="[Netpanzer-cvs] r1268 - in trunk/netpanzer:	pics/backgrounds/menus/buttons/default	pics/backgrounds/menus/menu src/NetPanzer/Interfaces	src/NetPanzer/Views src/NetPanzer/Views/Components	src/NetPanzer/Views/Game src/NetPanzer/Views/MainMenu	src/NetPanzer/Views/MainMenu/Multi">wile64 at mail.berlios.de
       </A><BR>
    <I>Tue Oct 25 16:38:51 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000293.html">[Netpanzer-cvs] r1267 - in trunk/netpanzer/src/NetPanzer: Bot	Classes Classes/Network Interfaces Objectives	Views/Components Views/Game
</A></li>
        <LI>Next message: <A HREF="000295.html">[Netpanzer-cvs] r1269 - in trunk/netpanzer/src: Lib/2D Lib/Util	NetPanzer/Views/Components NetPanzer/Views/MainMenu	NetPanzer/Views/MainMenu/Multi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#294">[ date ]</a>
              <a href="thread.html#294">[ thread ]</a>
              <a href="subject.html#294">[ subject ]</a>
              <a href="author.html#294">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: wile64
Date: 2011-10-25 16:38:51 +0200 (Tue, 25 Oct 2011)
New Revision: 1268

Added:
   trunk/netpanzer/pics/backgrounds/menus/buttons/default/button.bmp
   trunk/netpanzer/pics/backgrounds/menus/buttons/default/button1.bmp
   trunk/netpanzer/pics/backgrounds/menus/buttons/default/button2.bmp
Removed:
   trunk/netpanzer/pics/backgrounds/menus/buttons/default/pak/
   trunk/netpanzer/pics/backgrounds/menus/menu/loadingMB.bmp
Modified:
   trunk/netpanzer/pics/backgrounds/menus/menu/defaultMB.bmp
   trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Button.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Button.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Component.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/View.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/cButton.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.hpp
   trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.hpp
   trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.hpp
   trunk/netpanzer/src/NetPanzer/Views/GameViewGlobals.cpp
   trunk/netpanzer/src/NetPanzer/Views/GameViewGlobals.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/JoinView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/JoinView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.hpp
Log:
Remove menu Palette, only one palette now.

Added: trunk/netpanzer/pics/backgrounds/menus/buttons/default/button.bmp
===================================================================
(Binary files differ)


Property changes on: trunk/netpanzer/pics/backgrounds/menus/buttons/default/button.bmp
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: trunk/netpanzer/pics/backgrounds/menus/buttons/default/button1.bmp
===================================================================
(Binary files differ)


Property changes on: trunk/netpanzer/pics/backgrounds/menus/buttons/default/button1.bmp
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: trunk/netpanzer/pics/backgrounds/menus/buttons/default/button2.bmp
===================================================================
(Binary files differ)


Property changes on: trunk/netpanzer/pics/backgrounds/menus/buttons/default/button2.bmp
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Modified: trunk/netpanzer/pics/backgrounds/menus/menu/defaultMB.bmp
===================================================================
(Binary files differ)

Deleted: trunk/netpanzer/pics/backgrounds/menus/menu/loadingMB.bmp
===================================================================
(Binary files differ)

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -189,7 +189,6 @@
 
     Desktop::add(new LoadingView());
 
-    GameManager::loadPalette(&quot;netpmenu&quot;);
 
     Desktop::add(new MapSelectionView());
     Desktop::add(new MainMenuView());

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Button.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Button.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Button.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -18,22 +18,36 @@
 
 
 #include &quot;Views/Components/Button.hpp&quot;
+#include &quot;Views/Components/View.hpp&quot;
 #include &quot;Util/Log.hpp&quot;
 
 #include &quot;MouseEvent.hpp&quot;
 
+Button::Button(const std::string &amp;cname)
+        : Component(&quot;Button.&quot; + cname)
+{
+    setTextColors(Color::white, Color::red, Color::yellow);
+    position.zero();
+    label.clear();
+    bstate = BNORMAL;
+    memset(borders, 0, sizeof(borders));
+    extraBorder = 0;
+    dirty = true;
+}
 
 // render
 void
 Button::render()
 {
-    if ( bimage.getNumFrames() == 1 ) {
-        bimage.blt(surface, extraBorder, extraBorder);
+    surface.fill(0);
+    if ( bimage.getNumFrames() == 1 )
+    {
+        bimage.bltTrans(surface, extraBorder, extraBorder);
     }
     else if ( bimage.getNumFrames() == 3 )
     {
         bimage.setFrame(bstate);
-        bimage.blt(surface, extraBorder, extraBorder);
+        bimage.bltTrans(surface, extraBorder, extraBorder);
     }
     else
     {
@@ -44,35 +58,89 @@
     {
         surface.drawButtonBorder(borders[bstate][0], borders[bstate][1]);
     }
-    
+   
     if ( label.length() )
     {
         Surface text;
-        text.renderText( label.c_str(), textColor, 0);
+        text.renderText( label.c_str(), textColors[bstate], 0);
         // blit centered and transparent
         text.bltTrans(surface, (surface.getWidth()/2) - (text.getWidth()/2),
                       (surface.getHeight()/2) - (text.getHeight()/2));        
     }
-    
+   
     dirty = false;
 }
 
 // actionPerformed
 //---------------------------------------------------------------------------
-void Button::actionPerformed(const mMouseEvent &amp;me)
+void
+Button::actionPerformed(const mMouseEvent &amp;me)
 {
     if (me.getID() == mMouseEvent::MOUSE_EVENT_ENTERED
-                || me.getID() == mMouseEvent::MOUSE_EVENT_RELEASED) {
+                || me.getID() == mMouseEvent::MOUSE_EVENT_RELEASED)
+    {
         bstate = BOVER;
-        textColor = Color::red;
         dirty = true; // draw text in red
-    } else if (me.getID() == mMouseEvent::MOUSE_EVENT_EXITED) {
+    }
+    else if (me.getID() == mMouseEvent::MOUSE_EVENT_EXITED)
+    {
         bstate = BNORMAL;
-        textColor = Color::white;
         dirty = true; // draw defaults;
-    } else if (me.getID() == mMouseEvent::MOUSE_EVENT_PRESSED) {
+    }
+    else if (me.getID() == mMouseEvent::MOUSE_EVENT_PRESSED)
+    {
         bstate = BPRESSED;
-        textColor = Color::yellow;
         dirty = true;
     }
+    else if (me.getID() == mMouseEvent::MOUSE_EVENT_CLICKED)
+    {
+        ((View *)parent)-&gt;onComponentClicked(this);
+    }
 } // end Button::actionPerformed
+
+Button *
+Button::createTextButton(   std::string cname,
+                            std::string label,
+                            iXY loc,
+                            int bwidth)
+{
+    Button * b = new Button(cname);
+    b-&gt;setLabel(label);
+    b-&gt;setLocation(loc);
+    b-&gt;setTextButtonSize(bwidth);
+    b-&gt;setNormalBorder();
+    return b;
+}
+
+Button *
+Button::createSpecialButton( std::string cname,
+                             std::string label,
+                             iXY loc)
+{
+    Surface bnormal;
+    bnormal.loadBMP(&quot;pics/backgrounds/menus/buttons/default/button.bmp&quot;);
+    
+    Surface bhover;
+    bhover.loadBMP(&quot;pics/backgrounds/menus/buttons/default/button1.bmp&quot;);
+    
+    Surface bclick;
+    bclick.loadBMP(&quot;pics/backgrounds/menus/buttons/default/button2.bmp&quot;);
+    
+    Surface spbutton(bnormal.getWidth(), bnormal.getHeight(), 3);
+
+    spbutton.setFrame(0);
+    bnormal.blt(spbutton,0,0);
+    spbutton.setFrame(1);
+    bhover.blt(spbutton,0,0);
+    spbutton.setFrame(2);
+    bclick.blt(spbutton,0,0);
+    spbutton.setFrame(0);
+
+    Button *b = new Button(cname);
+    b-&gt;setImage(spbutton);
+    b-&gt;setLabel(label);
+    b-&gt;setLocation(loc);
+    b-&gt;setTextColors(Color::yellow, Color::white, Color::white);
+
+    return b;
+}
\ No newline at end of file

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Button.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Button.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Button.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -37,59 +37,65 @@
     int extraBorder;
 protected:
     std::string label;
-        
+       
     PIX borders[3][2];
-    PIX textColor;
-    
+    PIX textColors[3];
+   
     Surface bimage;
-    
+   
     void render();
     ButtonState bstate;
-    
+   
     void resetState()
     {
         bstate = BNORMAL;
-        textColor = Color::white;
         dirty = true;
     }
 
 public:
-    Button(const std::string &amp;cname) : Component(cname)
+
+    Button(const std::string &amp;cname);
+
+    virtual ~Button() {}
+
+    static Button * createTextButton(   std::string cname,
+                                        std::string label,
+                                        iXY loc,
+                                        int bwidth);
+
+    static Button * createSpecialButton(std::string cname,
+                                        std::string label,
+                                        iXY loc);
+
+    void setTextColors( PIX normal, PIX over, PIX pressed)
     {
-        position.zero();
-        label.clear();
-        bstate = BNORMAL;
-        textColor = Color::white;
-        memset(borders, 0, sizeof(borders));
-        extraBorder = 0;
+        textColors[BNORMAL] = normal;
+        textColors[BOVER] = over;
+        textColors[BPRESSED] = pressed;
     }
 
-    virtual ~Button()
-    {}
-
     void setLabel(const std::string&amp; l)
     {
         label = l;
         dirty = true;
     }
-    
+   
     void setImage(const Surface &amp;s)
     {
         if ( s.getNumFrames() ) {
             bimage.copy(s);
             setSize(bimage.getWidth(), bimage.getHeight());
-        } else {
-            bimage.free();
         }
         dirty = true;
     }
     void clearImage()
     {
-        bimage.free();
+//        bimage.freeFrames();
     }
-    
+   
     void setUnitSelectionBorder()
     {
+        setExtraBorder();
         borders[0][0] = Color::darkGray;
         borders[0][1] = Color::darkGray;
         borders[1][0] = Color::red;
@@ -98,9 +104,10 @@
         borders[2][1] = Color::darkGray;
         dirty = true;
     }
-    
+   
     void setNormalBorder()
     {
+        setExtraBorder();
         borders[0][0] = topLeftBorderColor;
         borders[0][1] = bottomRightBorderColor;
         borders[1][0] = topLeftBorderColor;
@@ -110,27 +117,49 @@
         dirty=true;
     }
 
+    void setRedGreenBorder()
+    {
+        setExtraBorder();
+        borders[0][0] = 0;
+        borders[0][1] = 0;
+        borders[1][0] = Color::red;
+        borders[1][1] = Color::darkRed;
+        borders[2][0] = Color::green;
+        borders[2][1] = Color::darkGreen;
+    }
+
     void clearBorder()
     {
         memset(borders, 0, sizeof(borders));
         dirty = true;
     }
-    
+   
     void setSize(int x, int y)
     {
         Component::setSize(x+(extraBorder*2), y+(extraBorder*2));
     }
-    
+
+    void setTextButtonSize(int xsize)
+    {
+        Component::setSize(xsize+(extraBorder*2), Surface::getFontHeight() + 4 + (extraBorder*2));
+    }
+   
     void setExtraBorder()
     {
-        extraBorder = 1;
-        setSize( size.x, size.y);
+        if ( !extraBorder )
+        {
+            extraBorder = 1;
+            setSize( size.x, size.y);
+        }
     }
-    
+   
     void clearExtraBorder()
     {
-        extraBorder = 0;
-        setSize( size.x, size.y);
+        if ( extraBorder )
+        {
+            extraBorder = 0;
+            setSize( size.x, size.y);
+        }
     }
 
     const std::string&amp; getLabel() const
@@ -142,3 +171,4 @@
 }; // end Button
 
 #endif // end __Button_hpp__
+  
\ No newline at end of file

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Component.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Component.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Component.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -116,7 +116,8 @@
     void setLocation(int x, int y);
     void setLocation(const iXY &amp;p) { setLocation(p.x, p.y); }
     void setName(const std::string&amp; name) { Component::componentName = name; }
-
+    std::string getName() { return componentName; }
+    
     virtual void draw(Surface &amp;dest)
     {
         iRect bounds;
@@ -125,7 +126,7 @@
         if ( dirty )
             render();
         
-        surface.blt(dest, bounds.min.x, bounds.min.y);
+        surface.bltTrans(dest, bounds.min.x, bounds.min.y);
     }
     
     virtual void render() = 0;

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/View.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/View.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/View.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -81,6 +81,7 @@
     {
         return prevHighlightedButton;
     }
+    virtual void onComponentClicked(Component *c) { (void)c; }
 
 protected:
     virtual void     actionPerformed(mMouseEvent )
@@ -148,6 +149,7 @@
 
     // cButton Functions.
     void addButtonPackedSurface(const iXY &amp;pos, PackedSurface &amp;source, const char *toolTip, ITEM_FUNC leftClickFunc);
+    void addButtonSurface(const iXY &amp;pos, std::string cname, const char *toolTip, ITEM_FUNC leftClickFunc);
     void addButtonCenterText(const iXY &amp;pos, const int &amp;xSize, const char *nName, const char *nToolTip, ITEM_FUNC nLeftClickFunc);
     /*!FIXME!*/ void drawDefinedButtons   (Surface &amp;clientArea);
     void drawHighlightedButton(Surface &amp;clientArea);

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/cButton.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/cButton.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/cButton.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -31,7 +31,7 @@
     for (unsigned int i = 0; i &lt; tempTopSurface.getNumFrames(); i++) {
         tempTopSurface.setFrame(i);
         tempTopSurface.fill(0);
-        source.setFrame(i);
+        source.setFrame(i);
         source.blt(tempTopSurface, 0, 0);
     }
 

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -19,6 +19,7 @@
 
 #include &quot;AreYouSureExitView.hpp&quot;
 #include &quot;Views/Components/Desktop.hpp&quot;
+#include &quot;Views/Components/Button.hpp&quot;
 #include &quot;2D/Palette.hpp&quot;
 #include &quot;Classes/ScreenSurface.hpp&quot;
 #include &quot;Interfaces/GameManager.hpp&quot;
@@ -63,15 +64,9 @@
 
     int x = (getClientRect().getSize().x - (141 * 2 + 20)) / 2;
     int y = screen-&gt;getHeight()/2 + 30;
-    addSpecialButton(	iXY(x, y),
-                      &quot;YES&quot;,
-                      bYES);
-
+    add( Button::createSpecialButton( &quot;YES&quot;, &quot;YES&quot;, iXY(x, y)) );
     x += 141 + 10;
-    addSpecialButton(	iXY(x, y),
-                      &quot;NO&quot;,
-                      bNO);
-
+    add( Button::createSpecialButton( &quot;NO&quot;, &quot;NO&quot;, iXY(x, y)) );
 } // end AreYouSureExitView::init
 
 // doDraw
@@ -96,3 +91,16 @@
     Desktop::setActiveView(this);
 
 } // end AreYouSureExitView::doActivate
+
+void AreYouSureExitView::onComponentClicked(Component* c)
+{
+    string cname = c-&gt;getName();
+    if ( !cname.compare(&quot;Button.YES&quot;) )
+    {
+        bYES();
+    }
+    else if ( !cname.compare(&quot;Button.NO&quot;) )
+    {
+        bNO();
+    }
+}
\ No newline at end of file

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -32,6 +32,7 @@
 
     virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
     virtual void doActivate();
+    void onComponentClicked(Component* c);
 }; // end AreYouSureExitView
 
 #endif // end __AreYouSureExitView_hpp__

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -1,16 +1,16 @@
 /*
 Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
+
 This program is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version.
- 
+
 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.
- 
+
 You should have received a copy of the GNU General Public License
 along with this program; if not, write to the Free Software
 Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
@@ -19,6 +19,7 @@
 
 #include &quot;AreYouSureResignView.hpp&quot;
 #include &quot;Views/Components/Desktop.hpp&quot;
+#include &quot;Views/Components/Button.hpp&quot;
 #include &quot;Interfaces/GameManager.hpp&quot;
 #include &quot;Particles/ParticleSystem2D.hpp&quot;
 #include &quot;Particles/Particle2D.hpp&quot;
@@ -39,7 +40,7 @@
         GameManager::exitNetPanzer();
         return;
     }
-    
+
     GameManager::drawTextCenteredOnScreen(&quot;Loading Main View...&quot;, Color::white);
     sprintf(MenuTemplateView::currentMultiView, &quot;GetSessionView&quot;);
 
@@ -53,7 +54,7 @@
 
     GameManager::drawTextCenteredOnScreen(&quot;Loading Main View...&quot;, Color::white);
 
-    GameManager::loadPalette(&quot;netpmenu&quot;);
+//    GameManager::loadPalette(&quot;netpmenu&quot;);
 
     // Must remove the gameView first so that the initButtons detects that
     // and loads the correct buttons.
@@ -133,15 +134,9 @@
 
     int x = (getClientRect().getSize().x - (141 * 2 + 20)) / 2;
     int y = getClientRect().getSize().y/2 + 30;
-    addSpecialButton(	iXY(x, y),
-                      &quot;YES&quot;,
-                      bYES);
-
+    add( Button::createSpecialButton( &quot;YES&quot;, &quot;YES&quot;, iXY(x, y)) );
     x += 141 + 10;
-    addSpecialButton(	iXY(x, y),
-                      &quot;NO&quot;,
-                      bNO);
-
+    add( Button::createSpecialButton( &quot;NO&quot;, &quot;NO&quot;, iXY(x, y)) );
 } // end AreYouSureResignView::init
 
 // doDraw
@@ -166,3 +161,15 @@
     Desktop::setActiveView(this);
 } // end AreYouSureResignView::doActivate
 
+void AreYouSureResignView::onComponentClicked(Component* c)
+{
+    string cname = c-&gt;getName();
+    if ( !cname.compare(&quot;Button.YES&quot;) )
+    {
+        bYES();
+    }
+    else if ( !cname.compare(&quot;Button.NO&quot;) )
+    {
+        bNO();
+    }
+}

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -32,6 +32,7 @@
 
     virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
     virtual void doActivate();
+    void onComponentClicked(Component* c);
 }; // end AreYouSureResignView
 
 #endif // end __AreYouSureResignView_hpp__

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -39,7 +39,7 @@
         GameManager::exitNetPanzer();
         return;
     }
-    
+
     GameManager::drawTextCenteredOnScreen(&quot;Loading Main View...&quot;, Color::white);
     sprintf(MenuTemplateView::currentMultiView, &quot;GetSessionView&quot;);
 
@@ -53,7 +53,7 @@
 
     GameManager::drawTextCenteredOnScreen(&quot;Loading Main View...&quot;, Color::white);
 
-    GameManager::loadPalette(&quot;netpmenu&quot;);
+//    GameManager::loadPalette(&quot;netpmenu&quot;);
 
     // Must remove the gameView first so that the initButtons detects that
     // and loads the correct buttons.

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -37,7 +37,7 @@
     setSearchName(&quot;LoadingView&quot;);
     setTitle(&quot;Loading Progress&quot;);
     setSubTitle(&quot;&quot;);
-    
+
     setAllowResize(false);
     setAllowMove(false);
     setDisplayStatusBar(false);
@@ -54,16 +54,18 @@
 void
 LoadingView::doDraw(Surface &amp;viewArea, Surface &amp;clientArea)
 {
-    if ( Palette::getName() != &quot;netpmenu&quot; )
-    {
-        GameManager::loadPalette(&quot;netpmenu&quot;);
-    }
-    
+//    if ( Palette::getName() != &quot;netpmenu&quot; )
+//    {
+//        GameManager::loadPalette(&quot;netpmenu&quot;);
+//    }
+
     if (dirty)
         render();
-    
-    screen-&gt;fill(Color::black);
+
+    //screen-&gt;fill(Color::black);
     backgroundSurface.blt(clientArea, 0, 0);
+    clientArea.FillRoundRect(iRect(165, 40, 635, 225), 10, Color::black);
+    clientArea.RoundRect(iRect(165, 40, 635, 225), 10, Color::yellow);
     surface.blt(clientArea, 172, 45);
 
     View::doDraw(viewArea, clientArea);
@@ -73,12 +75,12 @@
 LoadingView::render()
 {
     dirty=false;
-    
+
     surface.fill(Color::black);
-    
+
     int ypos = surface.getHeight() - Surface::getFontHeight();
     int fontHeight = Surface::getFontHeight();
-    
+
     list&lt;string&gt;::reverse_iterator i = lines.rbegin();
     while ( i != lines.rend() &amp;&amp; ypos &gt; -fontHeight )
     {
@@ -91,7 +93,7 @@
 void
 LoadingView::doActivate()
 {
-    backgroundSurface.loadBMP(&quot;pics/backgrounds/menus/menu/loadingMB.bmp&quot;);
+    backgroundSurface.loadBMP(&quot;pics/backgrounds/menus/menu/defaultMB.bmp&quot;);
     surface.create(455, 175, 1);
     dirty=true;
 }

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -1,16 +1,16 @@
 /*
 Copyright (C) 2003 Ivo Danihelka &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">ivo at danihelka.net</A>&gt;
- 
+
 This program is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version.
- 
+
 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.
- 
+
 You should have received a copy of the GNU General Public License
 along with this program; if not, write to the Free Software
 Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
@@ -45,7 +45,7 @@
         lines.push_back(text);
         dirty=true;
     }
-    
+
     static void append(const string text)
     {
         LOGGER.info(&quot;Loading: %s&quot;, text.c_str());
@@ -56,12 +56,12 @@
         lines.push_back(text);
         dirty=true;
     }
-    
+
     LoadingView()
     {
         init();
     }
-    
+
     static void loadFinish()
     {
         Desktop::setVisibilityAllWindows(false);
@@ -84,36 +84,36 @@
 
     static void loadError()
     {
-        GameManager::loadPalette(&quot;netpmenu&quot;);
+//        GameManager::loadPalette(&quot;netpmenu&quot;);
         Desktop::setVisibilityAllWindows(false);
         Desktop::setVisibility(&quot;MainView&quot;, true);
 
     }
-    
+
     static void show()
     {
         Desktop::setVisibilityAllWindows(false);
         Desktop::setVisibility(&quot;LoadingView&quot;, true);
     }
-    
+
     static void hide()
     {
         Desktop::setVisibility(&quot;LoadingView&quot;, false);
     }
 
     virtual ~LoadingView() {}
-    
+
     virtual void init();
     virtual void doActivate();
     virtual void doDeactivate();
-    
+
     void doDraw(Surface &amp;viewArea, Surface &amp;clientArea);
     void render();
-    
+
 private:
     static list&lt;string&gt; lines;
     static bool dirty;
-    
+
     Surface backgroundSurface;
     Surface surface;
 };

Modified: trunk/netpanzer/src/NetPanzer/Views/GameViewGlobals.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/GameViewGlobals.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/GameViewGlobals.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -53,6 +53,7 @@
 iXY resignPos = joinPos;
 
 iRect bodyTextRect(145, 110, 760, 510);
+iRect MenuRect(138, 99, 775, 566);
 
 bool gDrawGameHelp          = false;
 

Modified: trunk/netpanzer/src/NetPanzer/Views/GameViewGlobals.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/GameViewGlobals.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/GameViewGlobals.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -60,6 +60,7 @@
 
 // This is the text area in the menus.
 extern iRect bodyTextRect;
+extern iRect MenuRect;
 
 // These are the possible background colors for the menus.
 enum

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -24,6 +24,7 @@
 #include &quot;Interfaces/GameManager.hpp&quot;
 #include &quot;System/Sound.hpp&quot;
 #include &quot;Views/Components/ViewGlobals.hpp&quot;
+#include &quot;Views/Components/Button.hpp&quot;
 #include &quot;Particles/RadarPingParticle2D.hpp&quot;
 #include &quot;Classes/ScreenSurface.hpp&quot;
 #include &quot;Particles/Particle2D.hpp&quot;
@@ -130,7 +131,7 @@
 
 // MenuTemplateView
 //---------------------------------------------------------------------------
-MenuTemplateView::MenuTemplateView() : SpecialButtonView()
+MenuTemplateView::MenuTemplateView() : RMouseHackView()
 {
     setSearchName(&quot;MenuTemplateView&quot;);
     setTitle(&quot;MenuTemplate&quot;);
@@ -156,30 +157,12 @@
 // initPreGameOptionButtons
 void MenuTemplateView::initPreGameOptionButtons()
 {
-    addSpecialButton(	mainPos,
-                      &quot;Main&quot;,
-                      bMain);
-
-    addSpecialButton(	joinPos,
-                      &quot;Join&quot;,
-                      bJoin);
-
-    addSpecialButton(	hostPos,
-                      &quot;Host&quot;,
-                      bHost);
-
-    addSpecialButton(	optionsPos,
-                      &quot;Options&quot;,
-                      bOptions);
-
-    addSpecialButton(	helpPos,
-                      &quot;Help&quot;,
-                      bHelp);
-
-    addSpecialButton( exitPos,
-                      &quot;Exit netPanzer&quot;,
-                      bExit);
-
+    add( Button::createSpecialButton( &quot;MAIN&quot;, &quot;Main&quot;, mainPos) );
+    add( Button::createSpecialButton( &quot;JOIN&quot;, &quot;Join&quot;, joinPos) );
+    add( Button::createSpecialButton( &quot;HOST&quot;, &quot;Host&quot;, hostPos) );
+    add( Button::createSpecialButton( &quot;OPTIONS&quot;, &quot;Options&quot;, optionsPos) );
+    add( Button::createSpecialButton( &quot;HELP&quot;, &quot;Help&quot;, helpPos) );
+    add( Button::createSpecialButton( &quot;EXITNP&quot;, &quot;Exit netPanzer&quot;, exitPos) );
 } // end MenuTemplateView::initPreGameOptionButtons
 
 // initInGameOptionButtons
@@ -187,15 +170,13 @@
 void MenuTemplateView::initInGameOptionButtons()
 {
     if(!gameconfig-&gt;quickConnect) {
-        addSpecialButton(resignPos, &quot;Resign&quot;, bResign);
-        addSpecialButton(exitPos, &quot;Exit netPanzer&quot;, bExitNetPanzer);
+        add( Button::createSpecialButton( &quot;RESIGN&quot;, &quot;Resign&quot;, resignPos) );
+        add( Button::createSpecialButton( &quot;EXITNETNP&quot;, &quot;Exit netPanzer&quot;, exitPos) );
     } else {
-        addSpecialButton(exitPos, &quot;Resign&quot;, bResign);
+        add( Button::createSpecialButton( &quot;RESIGN&quot;, &quot;Resign&quot;, exitPos) );
     }
 
-    addSpecialButton( returnToGamePos,
-                      &quot;Close Options&quot;,
-                      bCloseOptions);
+    add( Button::createSpecialButton( &quot;CLOSEOPT&quot;, &quot;Close Options&quot;, returnToGamePos) );
 } // end MenuTemplateView::initInGameOptionButtons
 
 // initButtons
@@ -217,20 +198,18 @@
     if (Desktop::getVisible(&quot;GameView&quot;)) {
 	// When ingame, tint the game into gray
         clientArea.bltLookup(getClientRect(), Palette::darkGray256.getColorArray());
+        clientArea.RoundRect(MenuRect, 10, Color::yellow);
         clientArea.drawWindowsBorder();
 
-    } else {
-	// When in mainmenu, make background dark and draw menu image
-        if(screen-&gt;getWidth() &gt; 640 ||
-           screen-&gt;getHeight() &gt; 480)
-            screen-&gt;fill(Color::black);
-        
+    } else {        
         // Set the following to get does exist.
         if (backgroundSurface.getNumFrames() &gt; 0) {
             backgroundSurface.blt(viewArea, 0, 0);
         } else {
             throw Exception(&quot;Where is the background surface?&quot;);
         }
+        clientArea.BltRoundRect(MenuRect, 10, Palette::darkGray256.getColorArray());
+        clientArea.RoundRect(MenuRect, 10, Color::yellow);
 
         //titlePackedSurface.blt(clientArea, bodyTextRect.min.x, 390);
         titlePackedSurface.bltBlend(clientArea, bodyTextRect.min.x, bodyTextRect.max.y, Palette::colorTable6040);
@@ -254,8 +233,6 @@
     loadBackgroundSurface();
     loadTitleSurface();
     loadNetPanzerLogo();
-
-    SpecialButtonView::doActivate();
 } // end doActivate
 
 // loadBackgroundSurface
@@ -309,3 +286,51 @@
 {
 } // end MenuTemplateView::processEvents
 
+void MenuTemplateView::onComponentClicked(Component* c)
+{
+    string cname = c-&gt;getName();
+    if ( !cname.compare(&quot;Button.MAIN&quot;) )
+    {
+        bMain();
+    }
+    else if ( !cname.compare(&quot;Button.JOIN&quot;) )
+    {
+        bJoin();
+    }
+    else if ( !cname.compare(&quot;Button.HOST&quot;) )
+    {
+        bHost();
+    }
+    else if ( !cname.compare(&quot;Button.OPTIONS&quot;) )
+    {
+        bOptions();
+    }
+    else if ( !cname.compare(&quot;Button.HELP&quot;) )
+    {
+        bHelp();
+    }
+    else if ( !cname.compare(&quot;Button.EXITNP&quot;) )
+    {
+        bExit();
+    }
+    else if ( !cname.compare(&quot;Button.EXITNETNP&quot;) )
+    {
+        bExitNetPanzer();
+    }
+    else if ( !cname.compare(&quot;Button.RESIGN&quot;) )
+    {
+        bResign();
+    }
+    else if ( !cname.compare(&quot;Button.CLOSEOPT&quot;) )
+    {
+        bCloseOptions();
+    }
+    else if ( !cname.compare(&quot;Button.EXITNETNP&quot;) )
+    {
+        bExitNetPanzer();
+    }
+    else if ( !cname.compare(&quot;Button.EXITNETNP&quot;) )
+    {
+        bExitNetPanzer();
+    }
+}
\ No newline at end of file

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -25,7 +25,7 @@
 #include &quot;Types/iXY.hpp&quot;
 
 //--------------------------------------------------------------------------
-class MenuTemplateView : public SpecialButtonView
+class MenuTemplateView : public RMouseHackView
 {
 protected:
     static  void loadNetPanzerLogo();
@@ -40,6 +40,7 @@
     float titleFlashTimeHalf; // Time it takes for a half flash.
 
     typedef void (*ITEM_FUNC)(void);
+    void onComponentClicked(Component *c);
 
 public:
     MenuTemplateView();

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -19,6 +19,7 @@
 
 #include &quot;GetSessionView.hpp&quot;
 #include &quot;Views/Components/Desktop.hpp&quot;
+#include &quot;Views/Components/Button.hpp&quot;
 #include &quot;Interfaces/GameConfig.hpp&quot;
 #include &quot;Interfaces/GameManager.hpp&quot;
 #include &quot;Interfaces/MouseInterface.hpp&quot;
@@ -89,25 +90,10 @@
     setTitle(&quot;Select Session&quot;);
     setSubTitle(&quot;&quot;);
 
-    // Join.
-    addSpecialButton(	joinPos,
-                      &quot;Join&quot;,
-                      bJoin);
-
-    // Host.
-    addSpecialButton(	hostPos,
-                      &quot;Host&quot;,
-                      bHost);
-
-    // Next.
-    addSpecialButton(	nextPos,
-                      &quot;Next&quot;,
-                      bNext);
-
-    // Back.
-    addSpecialButton(	backPos,
-                      &quot;Back&quot;,
-                      bBack);
+    add( Button::createSpecialButton( &quot;JOIN&quot;, &quot;Join&quot;, joinPos) );
+    add( Button::createSpecialButton( &quot;HOST&quot;, &quot;Host&quot;, hostPos) );
+    add( Button::createSpecialButton( &quot;NEXT&quot;, &quot;Next&quot;, nextPos) );
+    add( Button::createSpecialButton( &quot;BACK&quot;, &quot;Back&quot;, backPos) );
 } // end GetSessionView::GetSessionView
 
 // doDraw
@@ -204,3 +190,24 @@
     }
 
 } // end GetSessionView::loadTitleSurface
+
+void GetSessionView::onComponentClicked(Component* c)
+{
+    string cname = c-&gt;getName();
+    if ( !cname.compare(&quot;Button.JOIN&quot;) )
+    {
+        bJoin();
+    }
+    else if ( !cname.compare(&quot;Button.HOST&quot;) )
+    {
+        bHost();
+    }
+    else if ( !cname.compare(&quot;Button.NEXT&quot;) )
+    {
+        bNext();
+    }
+    else if ( !cname.compare(&quot;Button.BACK&quot;) )
+    {
+        bBack();
+    }
+}
\ No newline at end of file

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -41,6 +41,7 @@
 
     virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
     virtual void doActivate();
+    void onComponentClicked(Component* c);
 }; // end GetSessionView
 
 #endif // end __GetSessionView_hpp__

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -21,6 +21,7 @@
 #include &lt;sstream&gt;
 #include &quot;HostJoinTemplateView.hpp&quot;
 #include &quot;Views/Components/Desktop.hpp&quot;
+#include &quot;Views/Components/Button.hpp&quot;
 #include &quot;HostJoinTemplateView.hpp&quot;
 #include &quot;Interfaces/GameConfig.hpp&quot;
 #include &quot;Interfaces/PlayerGameManager.hpp&quot;
@@ -51,7 +52,7 @@
 // Button functions.
 /////////////////////////////////////////////////////////////////////////////
 
-static void bNext()
+static void bPlay()
 {
     if ((const std::string&amp;) gameconfig-&gt;playername == &quot;&quot;)
         return;
@@ -93,16 +94,7 @@
     setSearchName(&quot;HostJoinTemplateView&quot;);
     setTitle(&quot;&quot;);
     setSubTitle(&quot;&quot;);
-
-    // Back.
-//    addSpecialButton(	backPos,
-//                      &quot;Back&quot;,
-//                      bBack);
-
-    addSpecialButton(   nextPos,
-                      &quot;Join&quot;,
-                      bNext);
-
+    add( Button::createSpecialButton( &quot;PLAY&quot;, &quot;Play&quot;, nextPos) );
 } // end HostJoinTemplateView constructor
 
 // doDraw
@@ -111,7 +103,7 @@
 {
     MenuTemplateView::doDraw(viewArea, clientArea);
 
-    View::doDraw(viewArea, clientArea);
+    //View::doDraw(viewArea, clientArea);
 } // end doDraw
 
 // doActivate
@@ -128,3 +120,17 @@
 void HostJoinTemplateView::loadBackgroundSurface()
 {
 } // end HostJoinTemplateView::loadBackgroundSurface
+
+void HostJoinTemplateView::onComponentClicked(Component* c)
+{
+    string cname = c-&gt;getName();
+    if ( !cname.compare(&quot;Button.PLAY&quot;) )
+    {
+        bPlay();
+    }
+    else
+    {
+        MenuTemplateView::onComponentClicked(c);
+    }
+
+}
\ No newline at end of file

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -43,6 +43,7 @@
 
     virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
     virtual void doActivate();
+    void onComponentClicked(Component* c);
 }; // end HostJoinTemplateView
 
 #endif // end __HostJoinTemplateView_hpp__

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostView.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostView.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -20,7 +20,6 @@
 #include &quot;HostView.hpp&quot;
 #include &quot;Interfaces/GameConfig.hpp&quot;
 #include &quot;Views/GameViewGlobals.hpp&quot;
-#include &quot;Particles/ParticleSystemGlobals.hpp&quot;
 #include &quot;HostOptionsView.hpp&quot;
 
 /////////////////////////////////////////////////////////////////////////////
@@ -119,7 +118,7 @@
     	sprintf(strBuf, &quot;%3d&quot;, gameconfig-&gt;GetNumberPlayers());
     	clientArea.bltString(x + 125, y, strBuf, Color::white);
     */
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 
 } // end HostView::doDraw
 

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/JoinView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/JoinView.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/JoinView.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -18,10 +18,7 @@
 
 
 #include &quot;JoinView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Interfaces/GameConfig.hpp&quot;
-#include &quot;Interfaces/GameManager.hpp&quot;
-#include &quot;Interfaces/GameManager.hpp&quot;
 #include &quot;Views/GameViewGlobals.hpp&quot;
 
 // JoinView
@@ -42,16 +39,7 @@
 
 // doDeactivate
 //---------------------------------------------------------------------------
-void JoinView::doDeactivate()
-{
-    if (strcmp(MenuTemplateView::currentMultiView, searchName) != 0 ||
-            strcmp(MenuTemplateView::currentView, searchName) != 0) {
-        MenuTemplateView::doDeactivate();
-        Desktop::setVisibility(&quot;GetSessionJoinView&quot;, false);
-    }
 
-} // end JoinView::doDeactivate
-
 // loadTitleSurface
 //---------------------------------------------------------------------------
 void JoinView::loadTitleSurface()

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/JoinView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/JoinView.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/JoinView.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -33,7 +33,6 @@
     JoinView();
 
     virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
-    virtual void doDeactivate();
 }; // end JoinView
 
 #endif // end __JoinView_hpp__

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -19,6 +19,7 @@
 
 #include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
 #include &quot;Views/Components/Desktop.hpp&quot;
+#include &quot;Views/Components/Button.hpp&quot;
 #include &quot;Views/GameViewGlobals.hpp&quot;
 
 static void bInterface()
@@ -89,14 +90,10 @@
 
     MenuTemplateView::initButtons();
 
-    addSpecialButton( soundPos,     &quot;Sound&quot;,     bSound);
-    addSpecialButton( interfacePos, &quot;Interface&quot;, bInterface);
-    addSpecialButton( visualsPos,   &quot;Visuals&quot;,   bVisuals);
+    add( Button::createSpecialButton( &quot;SOUND&quot;, &quot;Sound&quot;, soundPos) );
+    add( Button::createSpecialButton( &quot;INTERFACE&quot;, &quot;Interface&quot;, interfacePos) );
+    add( Button::createSpecialButton( &quot;VISUALS&quot;, &quot;Visuals&quot;, visualsPos) );
 
-#if 0 // XXX
-    addSpecialButton( controlsPos,  &quot;Controls&quot;,  bControls);
-#endif
-
 } // end OptionsTemplateView::initButtons
 
 // doDraw
@@ -121,3 +118,24 @@
     doLoadTitleSurface(&quot;optionsTitle&quot;);
 
 } // end ControlsView::loadTitleSurface
+
+void OptionsTemplateView::onComponentClicked(Component* c)
+{
+    string cname = c-&gt;getName();
+    if ( !cname.compare(&quot;Button.SOUND&quot;) )
+    {
+        bSound();
+    }
+    else if ( !cname.compare(&quot;Button.INTERFACE&quot;) )
+    {
+        bInterface();
+    }
+    else if ( !cname.compare(&quot;Button.VISUALS&quot;) )
+    {
+        bVisuals();
+    }
+    else
+    {
+        MenuTemplateView::onComponentClicked(c);
+    }
+}
\ No newline at end of file

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.hpp	2011-10-25 13:03:36 UTC (rev 1267)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.hpp	2011-10-25 14:38:51 UTC (rev 1268)
@@ -34,6 +34,7 @@
 
     virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
     virtual void initButtons();
+    void onComponentClicked(Component* c);
 }; // end OptionsTemplateView
 
 #endif // end __OptionsTemplateView_hpp__


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000293.html">[Netpanzer-cvs] r1267 - in trunk/netpanzer/src/NetPanzer: Bot	Classes Classes/Network Interfaces Objectives	Views/Components Views/Game
</A></li>
	<LI>Next message: <A HREF="000295.html">[Netpanzer-cvs] r1269 - in trunk/netpanzer/src: Lib/2D Lib/Util	NetPanzer/Views/Components NetPanzer/Views/MainMenu	NetPanzer/Views/MainMenu/Multi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#294">[ date ]</a>
              <a href="thread.html#294">[ thread ]</a>
              <a href="subject.html#294">[ subject ]</a>
              <a href="author.html#294">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">More information about the Netpanzer-cvs
mailing list</a><br>
</body></html>
