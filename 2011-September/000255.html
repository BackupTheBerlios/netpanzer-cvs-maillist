<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Netpanzer-cvs] r1229 - in branches: . krom/pics/cursors	krom/scripts krom/src/Lib/2D krom/src/Lib/Util	krom/src/NetPanzer krom/src/NetPanzer/Classes/Network	krom/src/NetPanzer/Core krom/src/NetPanzer/Input	krom/src/NetPanzer/Interfaces krom/src/NetPanzer/Network	krom/src/NetPanzer/Particles krom/src/NetPanzer/Views/Components	krom/src/NetPanzer/Views/Game krom/src/NetPanzer/Views/MainMenu	krom/src/NetPanzer/Views/MainMenu/Multi	krom/src/NetPanzer/Views/MainMenu/Options
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/netpanzer-cvs/2011-September/index.html" >
   <LINK REL="made" HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1229%20-%20in%20branches%3A%20.%20krom/pics/cursors%0A%09krom/scripts%20krom/src/Lib/2D%20krom/src/Lib/Util%0A%09krom/src/NetPanzer%20krom/src/NetPanzer/Classes/Network%0A%09krom/src/NetPanzer/Core%20krom/src/NetPanzer/Input%0A%09krom/src/NetPanzer/Interfaces%20krom/src/NetPanzer/Network%0A%09krom/src/NetPanzer/Particles%20krom/src/NetPanzer/Views/Components%0A%09krom/src/NetPanzer/Views/Game%20krom/src/NetPanzer/Views/MainMenu%0A%09krom/src/NetPanzer/Views/MainMenu/Multi%0A%09krom/src/NetPanzer/Views/MainMenu/Options&In-Reply-To=%3C20110906150318.D7B94481227%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000256.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Netpanzer-cvs] r1229 - in branches: . krom/pics/cursors	krom/scripts krom/src/Lib/2D krom/src/Lib/Util	krom/src/NetPanzer krom/src/NetPanzer/Classes/Network	krom/src/NetPanzer/Core krom/src/NetPanzer/Input	krom/src/NetPanzer/Interfaces krom/src/NetPanzer/Network	krom/src/NetPanzer/Particles krom/src/NetPanzer/Views/Components	krom/src/NetPanzer/Views/Game krom/src/NetPanzer/Views/MainMenu	krom/src/NetPanzer/Views/MainMenu/Multi	krom/src/NetPanzer/Views/MainMenu/Options</H1>
    <B>kromxp at mail.berlios.de</B> 
    <A HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1229%20-%20in%20branches%3A%20.%20krom/pics/cursors%0A%09krom/scripts%20krom/src/Lib/2D%20krom/src/Lib/Util%0A%09krom/src/NetPanzer%20krom/src/NetPanzer/Classes/Network%0A%09krom/src/NetPanzer/Core%20krom/src/NetPanzer/Input%0A%09krom/src/NetPanzer/Interfaces%20krom/src/NetPanzer/Network%0A%09krom/src/NetPanzer/Particles%20krom/src/NetPanzer/Views/Components%0A%09krom/src/NetPanzer/Views/Game%20krom/src/NetPanzer/Views/MainMenu%0A%09krom/src/NetPanzer/Views/MainMenu/Multi%0A%09krom/src/NetPanzer/Views/MainMenu/Options&In-Reply-To=%3C20110906150318.D7B94481227%40sheep.berlios.de%3E"
       TITLE="[Netpanzer-cvs] r1229 - in branches: . krom/pics/cursors	krom/scripts krom/src/Lib/2D krom/src/Lib/Util	krom/src/NetPanzer krom/src/NetPanzer/Classes/Network	krom/src/NetPanzer/Core krom/src/NetPanzer/Input	krom/src/NetPanzer/Interfaces krom/src/NetPanzer/Network	krom/src/NetPanzer/Particles krom/src/NetPanzer/Views/Components	krom/src/NetPanzer/Views/Game krom/src/NetPanzer/Views/MainMenu	krom/src/NetPanzer/Views/MainMenu/Multi	krom/src/NetPanzer/Views/MainMenu/Options">kromxp at mail.berlios.de
       </A><BR>
    <I>Tue Sep  6 17:03:18 CEST 2011</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000256.html">[Netpanzer-cvs] r1230 - trunk/netpanzer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#255">[ date ]</a>
              <a href="thread.html#255">[ thread ]</a>
              <a href="subject.html#255">[ subject ]</a>
              <a href="author.html#255">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: kromxp
Date: 2011-09-06 17:03:18 +0200 (Tue, 06 Sep 2011)
New Revision: 1229

Added:
   branches/krom/
   branches/krom/src/Lib/Util/MinSignal.hpp
   branches/krom/src/NetPanzer/Input/
   branches/krom/src/NetPanzer/Input/Action.hpp
   branches/krom/src/NetPanzer/Input/InputManager.cpp
   branches/krom/src/NetPanzer/Input/InputManager.hpp
   branches/krom/src/NetPanzer/Input/InputMapper.hpp
   branches/krom/src/NetPanzer/Views/Components/InputField.cpp
   branches/krom/src/NetPanzer/Views/Components/InputField.hpp
   branches/krom/src/NetPanzer/Views/Components/Slider.cpp
   branches/krom/src/NetPanzer/Views/Components/Slider.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/HostView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/HostView.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/JoinView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/JoinView.hpp
Removed:
   branches/krom/src/NetPanzer/Views/Components/ScrollBar.cpp
   branches/krom/src/NetPanzer/Views/Components/ScrollBar.hpp
   branches/krom/src/NetPanzer/Views/Components/StateChangedCallback.hpp
   branches/krom/src/NetPanzer/Views/Components/cButton.cpp
   branches/krom/src/NetPanzer/Views/Components/cButton.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/JoinView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/JoinView.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitSelectionView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitSelectionView.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/SkirmishView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/SkirmishView.hpp
Modified:
   branches/krom/pics/cursors/default.bmp
   branches/krom/scripts/initialize.lua
   branches/krom/src/Lib/2D/PackedSurface.hpp
   branches/krom/src/Lib/2D/Surface.cpp
   branches/krom/src/NetPanzer/Classes/Network/NetMessageDecoder.cpp
   branches/krom/src/NetPanzer/Classes/Network/NetPacketDebugger.cpp
   branches/krom/src/NetPanzer/Core/CoreTypes.hpp
   branches/krom/src/NetPanzer/Interfaces/GameManager.cpp
   branches/krom/src/NetPanzer/Interfaces/MouseInterface.cpp
   branches/krom/src/NetPanzer/Interfaces/MouseInterface.hpp
   branches/krom/src/NetPanzer/Interfaces/PlayerGameManager.cpp
   branches/krom/src/NetPanzer/Interfaces/PlayerGameManager.hpp
   branches/krom/src/NetPanzer/Network/ProxyServer.cpp
   branches/krom/src/NetPanzer/Particles/ParticleTweakView.cpp
   branches/krom/src/NetPanzer/Views/Components/Button.cpp
   branches/krom/src/NetPanzer/Views/Components/Button.hpp
   branches/krom/src/NetPanzer/Views/Components/CheckBox.cpp
   branches/krom/src/NetPanzer/Views/Components/CheckBox.hpp
   branches/krom/src/NetPanzer/Views/Components/Choice.cpp
   branches/krom/src/NetPanzer/Views/Components/Choice.hpp
   branches/krom/src/NetPanzer/Views/Components/Component.cpp
   branches/krom/src/NetPanzer/Views/Components/Component.hpp
   branches/krom/src/NetPanzer/Views/Components/Desktop.cpp
   branches/krom/src/NetPanzer/Views/Components/Desktop.hpp
   branches/krom/src/NetPanzer/Views/Components/InfoBar.hpp
   branches/krom/src/NetPanzer/Views/Components/Label.hpp
   branches/krom/src/NetPanzer/Views/Components/MiniMap.cpp
   branches/krom/src/NetPanzer/Views/Components/MiniMap.hpp
   branches/krom/src/NetPanzer/Views/Components/View.cpp
   branches/krom/src/NetPanzer/Views/Components/View.hpp
   branches/krom/src/NetPanzer/Views/Game/AreYouSureExitView.cpp
   branches/krom/src/NetPanzer/Views/Game/AreYouSureExitView.hpp
   branches/krom/src/NetPanzer/Views/Game/AreYouSureResignView.cpp
   branches/krom/src/NetPanzer/Views/Game/CodeStatsView.cpp
   branches/krom/src/NetPanzer/Views/Game/DisconectedView.cpp
   branches/krom/src/NetPanzer/Views/Game/GameView.cpp
   branches/krom/src/NetPanzer/Views/Game/HelpScrollView.cpp
   branches/krom/src/NetPanzer/Views/Game/HelpScrollView.hpp
   branches/krom/src/NetPanzer/Views/Game/LibView.cpp
   branches/krom/src/NetPanzer/Views/Game/LoadingView.cpp
   branches/krom/src/NetPanzer/Views/Game/LoadingView.hpp
   branches/krom/src/NetPanzer/Views/Game/MiniMapView.cpp
   branches/krom/src/NetPanzer/Views/Game/RankView.cpp
   branches/krom/src/NetPanzer/Views/Game/RankView.hpp
   branches/krom/src/NetPanzer/Views/Game/ResignView.cpp
   branches/krom/src/NetPanzer/Views/Game/VehicleSelectionView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/MainMenuView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/MainMenuView.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/HostView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/ServerListView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Multi/ServerListView.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/Options/SoundView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Options/SoundView.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/Options/VisualsView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/Options/VisualsView.hpp
   branches/krom/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp
   branches/krom/src/NetPanzer/Views/MainMenu/SpecialButtonView.cpp
Log:
Created 'krom' branch with his current changes for the UI

Modified: branches/krom/pics/cursors/default.bmp
===================================================================
(Binary files differ)

Modified: branches/krom/scripts/initialize.lua
===================================================================
--- trunk/netpanzer/scripts/initialize.lua	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/scripts/initialize.lua	2011-09-06 15:03:18 UTC (rev 1229)
@@ -17,9 +17,9 @@
         return
     end    
     
-	for key,value in pairs(t) do
+    for key,value in pairs(t) do
         local keytext
-	    local valuetext
+        local valuetext
     
         if type(key) == 'number' then
             if extra then
@@ -33,11 +33,11 @@
             end
         end
         
-	    if type(value) == 'table' then
-	        if keytext then
-	            dump_table(result, value, (lin or &quot;&quot;) .. keytext)
+        if type(value) == 'table' then
+            if keytext then
+                dump_table(result, value, (lin or &quot;&quot;) .. keytext)
             end
-	    elseif type(value) == 'string' then
+        elseif type(value) == 'string' then
             valuetext = '&quot;' .. string.gsub(value,'&quot;','\\&quot;') .. '&quot;'
         elseif type(value) ~= 'function' then
             valuetext = tostring(value)
@@ -46,7 +46,7 @@
         if keytext and valuetext then
             table.insert(result, lin .. keytext .. &quot; = &quot; .. valuetext)
         end
-	end
+    end
 end
 
 gconcat = table.concat;

Modified: branches/krom/src/Lib/2D/PackedSurface.hpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/PackedSurface.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/Lib/2D/PackedSurface.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -171,6 +171,8 @@
     //void setTo(const PackedSurface &amp;source, iRect bounds);
     void setTo(const PackedSurface &amp;source);
 
+    void copyFrom(const PackedSurface &amp;source);
+
 protected:
     void reset();
 

Modified: branches/krom/src/Lib/2D/Surface.cpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/Surface.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/Lib/2D/Surface.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1388,13 +1388,15 @@
 //---------------------------------------------------------------------------
 void Surface::bltString(int x, int y, const char * str, const Uint8 &amp;color)
 {
-    for (int index = 0; str[index] != 0; index++) {
-        // Don't attempt blank spaces.
-        if (str[index] == 32) {
-            continue;
+    unsigned int x_pos = x;
+    for (int index = 0; str[index] != 0 &amp;&amp; x_pos &lt; getWidth(); index++)
+    {
+        if (str[index] != 32)
+        {
+            bltChar8x8( x_pos, y, str[index], color);
         }
 
-        bltChar8x8(x + (index &lt;&lt; 3), y, str[index], color);
+        x_pos += 8; //getFontHeight();
     }
 } // end Surface::bltString
 

Added: branches/krom/src/Lib/Util/MinSignal.hpp
===================================================================
--- branches/krom/src/Lib/Util/MinSignal.hpp	                        (rev 0)
+++ branches/krom/src/Lib/Util/MinSignal.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,49 @@
+#ifndef MINSIGNAL_HPP
+#define MINSIGNAL_HPP
+
+
+class DUMMYCLASS;
+
+struct MinSignalData
+{
+    DUMMYCLASS * object;
+    void (DUMMYCLASS::*method)();
+};
+
+class MinSignal
+{
+private:
+    MinSignalData listener;
+public:
+    MinSignal()
+    {
+        listener.object = 0;
+    }
+
+    ~MinSignal()
+    {}
+
+    template&lt;class T&gt;
+    void connect( T *obj, void(T::*met)() )
+    {
+        this-&gt;listener.object = (DUMMYCLASS*)obj;
+        this-&gt;listener.method = (void (DUMMYCLASS::*)())met;
+    }
+
+    void operator()()
+    {
+        if ( this-&gt;listener.object )
+        {
+            this-&gt;raise();
+        }
+    }
+
+    void raise()
+    {
+        (this-&gt;listener.object-&gt;*(this-&gt;listener).method)();
+    }
+
+};
+
+
+#endif // MINSIGNAL_HPP

Modified: branches/krom/src/NetPanzer/Classes/Network/NetMessageDecoder.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageDecoder.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Classes/Network/NetMessageDecoder.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -54,7 +54,7 @@
     }
 
     Uint16* mlen = (Uint16*)(decode_message.data + offset);
-    int msg_len = ltoh16(*mlen);
+    unsigned int msg_len = ltoh16(*mlen);
 
     if( msg_len &gt; size - sizeof(NetMessage) - offset)
     {

Modified: branches/krom/src/NetPanzer/Classes/Network/NetPacketDebugger.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetPacketDebugger.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Classes/Network/NetPacketDebugger.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -104,7 +104,7 @@
 
     log-&gt;flags(std::ios::hex);
     log-&gt;fill('0');
-    Uint8* data = (Uint8 *) message;
+//    Uint8* data = (Uint8 *) message;
 //    for (size_t i=sizeof(NetMessage); i&lt;message-&gt;getSize(); ++i) {
 //        if ((i%4) == 0)
 //            *log &lt;&lt; &quot; &quot;;
@@ -118,10 +118,10 @@
 void NetPacketDebugger::logMultiMessage(std::ostream&amp; log,
         const NetMessage* message)
 {
-    MultiMessage* mmessage = (MultiMessage*) message;
+//    MultiMessage* mmessage = (MultiMessage*) message;
     
     log &lt;&lt; &quot;multimessage:\n&quot;;
-    size_t index = 0;
+//    size_t index = 0;
 //    for(int i=0; i&lt;mmessage-&gt;message_count; i++) {
 //        if(index + mmessage-&gt;getHeaderSize() &gt;= message-&gt;getSize()) {
 //            log &lt;&lt; &quot;****Incorrect multi message!!!\n&quot;;

Modified: branches/krom/src/NetPanzer/Core/CoreTypes.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Core/CoreTypes.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Core/CoreTypes.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -39,6 +39,10 @@
 
 typedef Uint16 UnitID;
 
+typedef Uint8 ColorType;
+
+#define NoColor 255
+
 typedef Uint8 FlagID;
 #define FLAG_WIDTH 20
 #define FLAG_HEIGHT 14

Added: branches/krom/src/NetPanzer/Input/Action.hpp
===================================================================
--- branches/krom/src/NetPanzer/Input/Action.hpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Input/Action.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,42 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ */
+
+#ifndef ACTION_HPP
+#define ACTION_HPP
+
+#include &lt;string&gt;
+
+class Action
+{
+public:
+    Action(const std::string&amp; name) : name(name) {}
+    ~Action() {}
+
+    bool isActive() const { return active; }
+    void activate() { active = true; }
+    void deactivate() { active = false; }
+
+    const std::string&amp; getName() const { return name; }
+
+private:
+    std::string name;
+    bool        active;
+};
+
+#endif // ACTION_HPP

Added: branches/krom/src/NetPanzer/Input/InputManager.cpp
===================================================================
--- branches/krom/src/NetPanzer/Input/InputManager.cpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Input/InputManager.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,81 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ */
+
+#include &quot;InputManager.hpp&quot;
+#include &quot;Action.hpp&quot;
+
+#include &lt;string&gt;
+#include &lt;map&gt;
+
+#define MAX_BUTTONS (512)
+
+typedef std::map&lt;std::string, Action *&gt; ActionMap;
+
+static bool * buttons_state = 0;
+static ActionMap all_actions = 0;
+
+void InputManager::initialize()
+{
+    buttons_state = new bool[MAX_BUTTONS];
+    for ( int n = MAX_BUTTONS; n; )
+    {
+        buttons_state[--n] = false;
+    }
+
+    all_actions = new ActionMap();
+
+}
+
+void InputManager::deinitialize()
+{
+    if ( buttons_state )
+    {
+        delete[] buttons_state;
+        buttons_state = 0;
+    }
+
+    if ( all_actions )
+    {
+        ActionMap::iterator iter = all_actions-&gt;begin();
+        while ( iter != all_actions-&gt;end() )
+        {
+            delete iter-&gt;second;
+            iter++;
+        }
+        delete all_actions;
+        all_actions = 0;
+    }
+}
+
+void InputManager::setButtonPress(int button)
+{
+    if ( button &lt; MAX_BUTTONS )
+    {
+        buttons_state[button] = true;
+    }
+}
+
+void InputManager::setButtonRelease(int button)
+{
+    if ( button &lt; MAX_BUTTONS )
+    {
+        buttons_state[button] = false;
+    }
+
+}

Added: branches/krom/src/NetPanzer/Input/InputManager.hpp
===================================================================
--- branches/krom/src/NetPanzer/Input/InputManager.hpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Input/InputManager.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,39 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ */
+
+#ifndef INPUTMANAGER_HPP
+#define INPUTMANAGER_HPP
+
+class Action;
+
+class InputManager
+{
+public:
+    static void initialize();
+    static void deinitialize();
+
+    static bool addAction( Action * action);
+    static const Action* getAction(const std::string&amp; name);
+
+    static void setButtonPress(int button);
+    static void setButtonRelease(int button);
+
+};
+
+#endif // INPUTMANAGER_HPP

Added: branches/krom/src/NetPanzer/Input/InputMapper.hpp
===================================================================
--- branches/krom/src/NetPanzer/Input/InputMapper.hpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Input/InputMapper.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,32 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ */
+
+#ifndef INPUTMAPPER_HPP
+#define INPUTMAPPER_HPP
+
+class InputMapper
+{
+public:
+    InputMapper();
+    ~InputMapper(){}
+
+
+};
+
+#endif // INPUTMAPPER_HPP

Modified: branches/krom/src/NetPanzer/Interfaces/GameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Interfaces/GameManager.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -68,14 +68,10 @@
 #include &quot;Views/MainMenu/MainMenuView.hpp&quot;
 #include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
 #include &quot;Views/MainMenu/OrderingView.hpp&quot;
-#include &quot;Views/MainMenu/SkirmishView.hpp&quot;
 #include &quot;Views/MainMenu/HelpView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/JoinView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/HostView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/GetSessionView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/UnitSelectionView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/FlagSelectionView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/UnitColorView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/HostOptionsView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/MapSelectionView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/PlayerNameView.hpp&quot;
@@ -383,7 +379,7 @@
         = (const SystemViewControl*) message;
 
     if ( view_control-&gt;action_flags &amp; _view_control_flag_close_all ) {
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
         Desktop::setVisibility(&quot;GameView&quot;, true);
     }
 

Modified: branches/krom/src/NetPanzer/Interfaces/MouseInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/MouseInterface.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Interfaces/MouseInterface.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -40,6 +40,8 @@
 int MouseInterface::clickcount;
 int MouseInterface::releasecount;
 
+bool MouseInterface::isGrabMode;
+
 void MouseInterface::initialize()
 {
     const char* cursorpath = &quot;pics/cursors/&quot;;
@@ -65,6 +67,7 @@
     clicktimer.setTimeOut(150);
     clickcount = 0;
     releasecount = 0;
+    isGrabMode = false;
 }
 
 void MouseInterface::shutdown()
@@ -78,6 +81,14 @@
 void
 MouseInterface::onMouseButtonDown(SDL_MouseButtonEvent *e)
 {
+    LOGGER.info(&quot;Mouse press %d&quot;, e-&gt;button);
+//    if ( ! button_mask )
+//    {
+//        SDL_WM_GrabInput(SDL_GRAB_ON);
+//    }
+
+    button_mask |= SDL_BUTTON(e-&gt;button);
+
     if ( ! clickcount )
     {
         clicktimer.reset();
@@ -86,7 +97,6 @@
     clickcount++;
     
     MouseEvent event;
-    button_mask |= SDL_BUTTON(e-&gt;button);
     event.button = e-&gt;button;
     event.event = MouseEvent::EVENT_DOWN;
     event.pos.x = e-&gt;x;
@@ -97,13 +107,21 @@
 void
 MouseInterface::onMouseButtonUp(SDL_MouseButtonEvent *e)
 {
+    LOGGER.info(&quot;Mouse release %d&quot;, e-&gt;button);
+    button_mask &amp;= ~(SDL_BUTTON(e-&gt;button));
+
+//    if ( ! button_mask )
+//    {
+//        SDL_WM_GrabInput(SDL_GRAB_OFF);
+//    }
+
     if ( clickcount )
     {
         releasecount++;
     }
     
     MouseEvent event;
-    button_mask &amp;= ~(SDL_BUTTON(e-&gt;button));
+
     event.button = e-&gt;button;
     event.event = MouseEvent::EVENT_UP;
     event.pos.x = e-&gt;x;
@@ -131,3 +149,38 @@
         releasecount=0;
     }
 }
+
+void
+MouseInterface::onMouseMoved(SDL_MouseMotionEvent* e)
+{
+//    LOGGER.info(&quot;Mouse moved: %d, %d&quot;, e-&gt;x, e-&gt;y);
+    mouse_pos.x = e-&gt;x;
+    mouse_pos.y = e-&gt;y;
+//    if ( isGrabMode &amp;&amp; e-&gt;x == mouse_pos.x &amp;&amp; e-&gt;y == mouse_pos.y )
+//    {
+//        return; // this is the move to previous position;
+//    }
+
+//    MouseEvent event;
+//    event.event = MouseEvent::EVENT_MOVE;
+//    event.button = e-&gt;state;
+//    event.relpos.x = e-&gt;xrel;
+//    event.relpos.y = e-&gt;yrel;
+
+//    if ( ! isGrabMode )
+//    {
+//        mouse_pos.x = e-&gt;x;
+//        mouse_pos.y = e-&gt;y;
+//        event.pos.x = e-&gt;x;
+//        event.pos.y = e-&gt;y;
+//    }
+//    else
+//    {
+//        event.pos.x = mouse_pos.x;
+//        event.pos.y = mouse_pos.y;
+//        SDL_WarpMouse(mouse_pos.x, mouse_pos.y);
+//    }
+
+//    event_queue.push_back(event);
+}
+

Modified: branches/krom/src/NetPanzer/Interfaces/MouseInterface.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/MouseInterface.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Interfaces/MouseInterface.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -31,11 +31,13 @@
 public:
     enum {
         EVENT_DOWN = SDL_MOUSEBUTTONDOWN,
-        EVENT_UP = SDL_MOUSEBUTTONUP
+        EVENT_UP = SDL_MOUSEBUTTONUP,
+        EVENT_MOVE = SDL_MOUSEMOTION
     };
     unsigned char button;
     unsigned char event;
     iXY pos;
+    iXY relpos;
 };
 
 typedef std::deque&lt;MouseEvent&gt; MouseEventQueue;
@@ -53,12 +55,20 @@
     typedef std::map&lt;std::string,Surface*&gt; cursors_t;
     static cursors_t cursors;
 
+    static bool isGrabMode;
+
 protected:
     static iXY mouse_pos;
 
     static unsigned char button_mask;
 
 public:
+    static void setGrabMode(bool wantGrab)
+    {
+        isGrabMode = wantGrab;
+    }
+
+
     enum {
         left_button   = SDL_BUTTON_LEFT,
         middle_button = SDL_BUTTON_MIDDLE,
@@ -106,11 +116,7 @@
     static void manageClickTimer();
 
     static void setCursor(const char* cursorname);
-    static inline void onMouseMoved(SDL_MouseMotionEvent *e)
-    {
-        mouse_pos.x = e-&gt;x;
-        mouse_pos.y = e-&gt;y;
-    }
+    static void onMouseMoved(SDL_MouseMotionEvent *e);
     
     static inline iXY getMousePosition()   { return mouse_pos; }
     

Modified: branches/krom/src/NetPanzer/Interfaces/PlayerGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -60,16 +60,14 @@
 #include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/ViewGlobals.hpp&quot;
 #include &quot;Views/MainMenu/MainMenuView.hpp&quot;
+#include &quot;Views/MainMenu/JoinView.hpp&quot;
+#include &quot;Views/MainMenu/HostView.hpp&quot;
 #include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
 #include &quot;Views/MainMenu/OrderingView.hpp&quot;
-#include &quot;Views/MainMenu/SkirmishView.hpp&quot;
 #include &quot;Views/MainMenu/HelpView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/JoinView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/HostView.hpp&quot;
+//#include &quot;Views/MainMenu/Multi/HostView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/GetSessionView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/UnitSelectionView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/FlagSelectionView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/UnitColorView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/HostOptionsView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/MapSelectionView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/PlayerNameView.hpp&quot;
@@ -117,9 +115,6 @@
 PlayerGameManager::PlayerGameManager()
     : sdlVideo(0), heartbeat(0), infosocket(0)
 {
-    //fontManager.loadFont(&quot;fixed10&quot;, &quot;fonts/fixed10.pcf&quot;, 10);
-
-    showNewPanel = false;
 }
 
 //-----------------------------------------------------------------
@@ -172,7 +167,7 @@
 //-----------------------------------------------------------------
 void PlayerGameManager::initializeWindowSubSystem()
 {
-    GameManager::loadPalette(&quot;netp&quot;);
+/*    GameManager::loadPalette(&quot;netp&quot;);
 
     Desktop::add(new GameView());
     Desktop::add(new RankView());
@@ -183,12 +178,15 @@
     Desktop::add(new HelpScrollView());
 
     Desktop::add(new LoadingView());
-
+*/
     GameManager::loadPalette(&quot;netpmenu&quot;);
 
-    Desktop::add(new MapSelectionView());
+
     Desktop::add(new MainMenuView());
     Desktop::add(new JoinView());
+    Desktop::add(new XHostView());
+/*
+    Desktop::add(new MapSelectionView());
     Desktop::add(new HostView());
     Desktop::add(new GetSessionView());
     Desktop::add(new OptionsTemplateView());
@@ -208,9 +206,11 @@
 
     Desktop::add(new IPAddressView());
     Desktop::add(new ServerListView());
-
-    Desktop::setVisibilityAllWindows(false);
+*/
+    Desktop::hideAllWindows();
     Desktop::setVisibility(&quot;MainView&quot;, true);
+//    Desktop::setVisibility(&quot;XJoinView&quot;, true);
+    Desktop::setVisibility(&quot;XHostView&quot;, true);
 
     Desktop::checkResolution(iXY(640,480), iXY(screen-&gt;getWidth(),screen-&gt;getHeight()));
     Desktop::checkViewPositions(iXY(screen-&gt;getWidth(),screen-&gt;getHeight()));
@@ -460,17 +460,6 @@
 //-----------------------------------------------------------------
 void PlayerGameManager::processSystemKeys()
 {
-    if (Desktop::getVisible(&quot;GameView&quot;)) {
-        if (KeyboardInterface::getKeyPressed( SDLK_F12 )){
-            showNewPanel = !showNewPanel;
-        }
-        
-        if (KeyboardInterface::getKeyPressed( SDLK_F5 )) {
-            //  DEBUG VIEW
-            Desktop::toggleVisibility( &quot;LibView&quot; );
-        }
-    }
-
     if ( KeyboardInterface::getKeyState(SDLK_F9) )
     {
         Screen-&gt;doScreenshoot();
@@ -484,87 +473,96 @@
         }
     } // ** LFT_ALT or RGT_ALT pressed
 
-    if (Desktop::getView(&quot;GameView&quot;)-&gt;getVisible()) {
-        if (KeyboardInterface::getKeyPressed(SDLK_m)) {
-            Desktop::toggleVisibility( &quot;MiniMapView&quot; );
+    if (Desktop::getVisible(&quot;GameView&quot;))
+    {
+        if (KeyboardInterface::getKeyPressed( SDLK_F5 )) {
+            //  DEBUG VIEW
+            Desktop::toggleVisibility( &quot;LibView&quot; );
         }
-        if (KeyboardInterface::getKeyPressed(SDLK_TAB) ) {
-            Desktop::toggleVisibility( &quot;RankView&quot; );
-        }
-        if (KeyboardInterface::getKeyPressed(SDLK_F3)) {
-            Desktop::toggleVisibility( &quot;DesktopView&quot; );
-        }
-        if (KeyboardInterface::getKeyPressed(SDLK_F4)) {
-            Desktop::toggleVisibility( &quot;CodeStatsView&quot; );
-        }
-        if (KeyboardInterface::getKeyPressed(SDLK_F1)) {
-            Desktop::toggleVisibility( &quot;HelpScrollView&quot; );
-        }
+        if (Desktop::getView(&quot;GameView&quot;)-&gt;getVisible())
+        {
+            if (KeyboardInterface::getKeyPressed(SDLK_m)) {
+                Desktop::toggleVisibility( &quot;MiniMapView&quot; );
+            }
+            if (KeyboardInterface::getKeyPressed(SDLK_TAB) ) {
+                Desktop::toggleVisibility( &quot;RankView&quot; );
+            }
+            if (KeyboardInterface::getKeyPressed(SDLK_F3)) {
+                Desktop::toggleVisibility( &quot;DesktopView&quot; );
+            }
+            if (KeyboardInterface::getKeyPressed(SDLK_F4)) {
+                Desktop::toggleVisibility( &quot;CodeStatsView&quot; );
+            }
+            if (KeyboardInterface::getKeyPressed(SDLK_F1)) {
+                Desktop::toggleVisibility( &quot;HelpScrollView&quot; );
+            }
 
-        if (KeyboardInterface::getKeyPressed(SDLK_ESCAPE)) {
-            if (Desktop::getView(&quot;GameView&quot;)-&gt;getVisible())
+            if (KeyboardInterface::getKeyPressed(SDLK_ESCAPE))
             {
-                if (!Desktop::getView(&quot;OptionsView&quot;)-&gt;getVisible() &amp;&amp;
-                        !Desktop::getView(&quot;SoundView&quot;)-&gt;getVisible() &amp;&amp;
-                        !Desktop::getView(&quot;ControlsView&quot;)-&gt;getVisible() &amp;&amp;
-                        !Desktop::getView(&quot;InterfaceView&quot;)-&gt;getVisible() &amp;&amp;
-                        !Desktop::getView(&quot;VisualsView&quot;)-&gt;getVisible())
+                if (Desktop::getView(&quot;GameView&quot;)-&gt;getVisible())
                 {
-                    
-                    View *v = Desktop::getView(&quot;OptionsView&quot;);
-                    assert(v != 0);
-                    ((OptionsTemplateView *)v)-&gt;initButtons();
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
+                    if (!Desktop::getView(&quot;OptionsView&quot;)-&gt;getVisible() &amp;&amp;
+                            !Desktop::getView(&quot;SoundView&quot;)-&gt;getVisible() &amp;&amp;
+                            !Desktop::getView(&quot;ControlsView&quot;)-&gt;getVisible() &amp;&amp;
+                            !Desktop::getView(&quot;InterfaceView&quot;)-&gt;getVisible() &amp;&amp;
+                            !Desktop::getView(&quot;VisualsView&quot;)-&gt;getVisible())
+                    {
 
-                    v = Desktop::getView(&quot;SoundView&quot;);
-                    assert(v != 0);
-                    ((SoundView *)v)-&gt;initButtons();
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
+                        View *v = Desktop::getView(&quot;OptionsView&quot;);
+                        assert(v != 0);
+                        ((OptionsTemplateView *)v)-&gt;initButtons();
+                        ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
 
-                    v = Desktop::getView(&quot;ControlsView&quot;);
-                    assert(v != 0);
-                    ((ControlsView *)v)-&gt;initButtons();
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
+                        v = Desktop::getView(&quot;SoundView&quot;);
+                        assert(v != 0);
+                        ((SoundView *)v)-&gt;initButtons();
+                        ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
 
-                    v = Desktop::getView(&quot;VisualsView&quot;);
-                    assert(v != 0);
-                    ((VisualsView *)v)-&gt;initButtons();
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
+                        v = Desktop::getView(&quot;ControlsView&quot;);
+                        assert(v != 0);
+                        ((ControlsView *)v)-&gt;initButtons();
+                        ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
 
-                    v = Desktop::getView(&quot;InterfaceView&quot;);
-                    assert(v != 0);
-                    ((InterfaceView *)v)-&gt;initButtons();
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
+                        v = Desktop::getView(&quot;VisualsView&quot;);
+                        assert(v != 0);
+                        ((VisualsView *)v)-&gt;initButtons();
+                        ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
 
-                    Desktop::setVisibility(&quot;OptionsView&quot;, true);
-                    Desktop::setActiveView(&quot;OptionsView&quot;);
-                }
-                else
-                {
-                    View *v = Desktop::getView(&quot;OptionsView&quot;);
-                    assert(v != 0);
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(true);
-                    ((OptionsTemplateView *)v)-&gt;setVisible(false);
+                        v = Desktop::getView(&quot;InterfaceView&quot;);
+                        assert(v != 0);
+                        ((InterfaceView *)v)-&gt;initButtons();
+                        ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
 
-                    v = Desktop::getView(&quot;InterfaceView&quot;);
-                    assert(v != 0);
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(true);
-                    ((OptionsTemplateView *)v)-&gt;setVisible(false);
+                        Desktop::setVisibility(&quot;OptionsView&quot;, true);
+                        Desktop::setActiveView(&quot;OptionsView&quot;);
+                    }
+                    else
+                    {
+                        View *v = Desktop::getView(&quot;OptionsView&quot;);
+                        assert(v != 0);
+                        ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(true);
+                        ((OptionsTemplateView *)v)-&gt;setVisible(false);
 
-                    v = Desktop::getView(&quot;VisualsView&quot;);
-                    assert(v != 0);
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(true);
-                    ((OptionsTemplateView *)v)-&gt;setVisible(false);
+                        v = Desktop::getView(&quot;InterfaceView&quot;);
+                        assert(v != 0);
+                        ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(true);
+                        ((OptionsTemplateView *)v)-&gt;setVisible(false);
 
-                    v = Desktop::getView(&quot;SoundView&quot;);
-                    assert(v != 0);
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(true);
-                    ((OptionsTemplateView *)v)-&gt;setVisible(false);
+                        v = Desktop::getView(&quot;VisualsView&quot;);
+                        assert(v != 0);
+                        ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(true);
+                        ((OptionsTemplateView *)v)-&gt;setVisible(false);
 
-                    v = Desktop::getView(&quot;ControlsView&quot;);
-                    assert(v != 0);
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(true);
-                    ((OptionsTemplateView *)v)-&gt;setVisible(false);
+                        v = Desktop::getView(&quot;SoundView&quot;);
+                        assert(v != 0);
+                        ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(true);
+                        ((OptionsTemplateView *)v)-&gt;setVisible(false);
+
+                        v = Desktop::getView(&quot;ControlsView&quot;);
+                        assert(v != 0);
+                        ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(true);
+                        ((OptionsTemplateView *)v)-&gt;setVisible(false);
+                    }
                 }
             }
         }

Modified: branches/krom/src/NetPanzer/Interfaces/PlayerGameManager.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Interfaces/PlayerGameManager.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -55,10 +55,8 @@
     void quitGame();
 
 private:
-    //Panels::TestPanel * testpanel;
     //UI::FontManager fontManager;
     SDLVideo* sdlVideo;
-    bool showNewPanel;
 
     Heartbeat * heartbeat;
     InfoSocket * infosocket;

Modified: branches/krom/src/NetPanzer/Network/ProxyServer.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Network/ProxyServer.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Network/ProxyServer.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -76,7 +76,7 @@
     char *b=buf;
     int line=0;
     while(1) {
-        char ch;
+        char ch = 0;
         //XXX
         //if(socket.recv(&amp;ch, 1)!=1)
             //break;

Modified: branches/krom/src/NetPanzer/Particles/ParticleTweakView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Particles/ParticleTweakView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Particles/ParticleTweakView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -40,5 +40,5 @@
 {
     viewArea.fill(Color::black);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 } // end ParticleTweakView::doDraw

Modified: branches/krom/src/NetPanzer/Views/Components/Button.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Button.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/Button.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -22,39 +22,37 @@
 
 #include &quot;MouseEvent.hpp&quot;
 
-
-// render
 void
-Button::render()
+Button::draw(Surface &amp;dest)
 {
-    if ( bimage.getNumFrames() == 1 ) {
-        bimage.blt(surface, extraBorder, extraBorder);
+    iRect r;
+    getBounds(r);
+
+    if ( bimage.getFrameCount() == 1 ) {
+        bimage.blt(dest, position.x + extraBorder, position.y + extraBorder);
     }
-    else if ( bimage.getNumFrames() == 3 )
+    else if ( bimage.getFrameCount() == 3 )
     {
         bimage.setFrame(bstate);
-        bimage.blt(surface, extraBorder, extraBorder);
+        bimage.blt(dest, position.x + extraBorder, position.y + extraBorder);
     }
     else
     {
-        surface.fill(componentBodyColor);        
+        dest.fillRect(r, componentBodyColor);
     }
 
     if ( borders[bstate][0]|extraBorder ) // only 1 | (binary or)
     {
-        surface.drawButtonBorder(borders[bstate][0], borders[bstate][1]);
+        dest.drawButtonBorder(r, borders[bstate][0], borders[bstate][1]);
     }
     
     if ( label.length() )
     {
-        Surface text;
-        text.renderText( label.c_str(), textColor, 0);
-        // blit centered and transparent
-        text.bltTrans(surface, (surface.getWidth()/2) - (text.getWidth()/2),
-                      (surface.getHeight()/2) - (text.getHeight()/2));        
+        // XXX 4 is half the height of text
+        dest.bltString( position.x + (r.getSizeX()/2) - (Surface::getTextLength(label.c_str())/2),
+                        position.y + (r.getSizeY()/2) - 4,
+                        label.c_str(), textColor);
     }
-    
-    dirty = false;
 }
 
 // actionPerformed
@@ -64,15 +62,13 @@
     if (me.getID() == mMouseEvent::MOUSE_EVENT_ENTERED
                 || me.getID() == mMouseEvent::MOUSE_EVENT_RELEASED) {
         bstate = BOVER;
-        textColor = Color::red;
-        dirty = true; // draw text in red
+        textColor = Color::yellow;
     } else if (me.getID() == mMouseEvent::MOUSE_EVENT_EXITED) {
         bstate = BNORMAL;
         textColor = Color::white;
-        dirty = true; // draw defaults;
     } else if (me.getID() == mMouseEvent::MOUSE_EVENT_PRESSED) {
         bstate = BPRESSED;
-        textColor = Color::yellow;
-        dirty = true;
+        textColor = Color::red;
+        clicked();
     }
 } // end Button::actionPerformed

Modified: branches/krom/src/NetPanzer/Views/Components/Button.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Button.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/Button.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -19,9 +19,13 @@
 #ifndef __Button_hpp__
 #define __Button_hpp__
 
+#include &lt;string&gt;
+
 #include &quot;Component.hpp&quot;
 #include &quot;2D/Color.hpp&quot;
+#include &quot;2D/PackedSurface.hpp&quot;
 #include &quot;ViewGlobals.hpp&quot;
+#include &quot;Util/MinSignal.hpp&quot;
 
 typedef enum
 {
@@ -41,20 +45,19 @@
     PIX borders[3][2];
     PIX textColor;
     
-    Surface bimage;
+    PackedSurface bimage;
     
-    void render();
+    virtual void draw(Surface &amp;dest);
     ButtonState bstate;
     
     void resetState()
     {
         bstate = BNORMAL;
         textColor = Color::white;
-        dirty = true;
     }
 
 public:
-    Button(const std::string &amp;cname) : Component(cname)
+    Button() : Component()
     {
         position.zero();
         label.clear();
@@ -67,22 +70,39 @@
     virtual ~Button()
     {}
 
+    MinSignal clicked;
+
     void setLabel(const std::string&amp; l)
     {
         label = l;
-        dirty = true;
     }
     
     void setImage(const Surface &amp;s)
     {
-        if ( s.getNumFrames() ) {
-            bimage.copy(s);
+        if ( s.getNumFrames() )
+        {
+            bimage.pack(s);
             setSize(bimage.getWidth(), bimage.getHeight());
-        } else {
+        }
+        else
+        {
             bimage.free();
         }
-        dirty = true;
     }
+
+    void loadPackedImage(const std::string&amp; filename)
+    {
+        bimage.load(filename);
+        if ( bimage.getFrameCount() )
+        {
+            setSize(bimage.getWidth(), bimage.getHeight());
+        }
+        else
+        {
+            bimage.free();
+        }
+    }
+
     void clearImage()
     {
         bimage.free();
@@ -96,7 +116,6 @@
         borders[1][1] = Color::red;
         borders[2][0] = Color::darkGray;
         borders[2][1] = Color::darkGray;
-        dirty = true;
     }
     
     void setNormalBorder()
@@ -107,13 +126,11 @@
         borders[1][1] = bottomRightBorderColor;
         borders[2][0] = bottomRightBorderColor;
         borders[2][1] = topLeftBorderColor;
-        dirty=true;
     }
 
     void clearBorder()
     {
         memset(borders, 0, sizeof(borders));
-        dirty = true;
     }
     
     void setSize(int x, int y)

Modified: branches/krom/src/NetPanzer/Views/Components/CheckBox.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/CheckBox.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/CheckBox.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -19,24 +19,47 @@
 
 #include &quot;Views/Components/CheckBox.hpp&quot;
 #include &quot;MouseEvent.hpp&quot;
-#include &quot;Views/Components/StateChangedCallback.hpp&quot;
 
 void
-CheckBox::render()
+CheckBox::draw(Surface &amp;dest)
 {
-    surface.fill(Color::black);
-    Surface text;
-    text.renderText( label.c_str(), textColor, 0);
-    surface.drawRect( iRect(0,0,12,12), Color::gray96);
-    surface.drawRect( iRect(1,1,13,13), Color::white);
-    surface.drawRect( iRect(1,1,12,12), Color::black);
+    iRect r;
+    getBounds(r);
+
+    iRect boxr(r);
+
+    boxr.max.x = boxr.min.x + 12;
+    boxr.max.y = boxr.min.y + 12;
+
+    dest.fillRect( boxr, Color::blue);
+    dest.drawRect( boxr, Color::gray96);
+
+    boxr.min.x += 1;
+    boxr.min.y += 1;
+
+    boxr.max.x += 1;
+    boxr.max.y += 1;
+
+    dest.drawRect(boxr, Color::white);
+
+    boxr.max.x -= 1;
+    boxr.max.y -= 1;
+
+    dest.drawRect(boxr, Color::black);
+
+    boxr.min.x += 3;
+    boxr.min.y += 3;
+
+    boxr.max.x -= 2;
+    boxr.max.y -= 2;
+
     if (state) {
-        surface.drawLine( 2, 2, 11, 11, Color::white);
-        surface.drawLine( 2, 11, 11, 2, Color::white);
+        dest.fillRect( boxr, Color::cobaltGreen);
     }
     
-    text.blt( surface, 14+2, (surface.getHeight()/2) - (text.getHeight()/2) );
-    dirty = false;
+    // 4 = font height / 2
+    // 3 = offset to center the label (14/2) - font height
+    dest.bltString(position.x + 14+2, position.y + 3, label.c_str(), textColor);
 }
 
 // actionPerformed
@@ -46,15 +69,11 @@
     if (	me.getID() == mMouseEvent::MOUSE_EVENT_CLICKED &amp;&amp;
             (me.getModifiers() &amp; InputEvent::BUTTON1_MASK)) {
         state = !state;
-        if(callback)
-            callback-&gt;stateChanged(this);
-        dirty = true;
+        stateChanged();
     } else if (me.getID() == mMouseEvent::MOUSE_EVENT_ENTERED) {
         textColor = Color::yellow;
-        dirty = true; // draw text in red
     } else if (me.getID() == mMouseEvent::MOUSE_EVENT_EXITED) {
         textColor = Color::white;
-        dirty = true; // draw defaults;
     }
 
 

Modified: branches/krom/src/NetPanzer/Views/Components/CheckBox.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/CheckBox.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/CheckBox.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -22,41 +22,42 @@
 #include &quot;Component.hpp&quot;
 #include &quot;MouseEvent.hpp&quot;
 #include &quot;Util/Log.hpp&quot;
+#include &quot;Core/CoreTypes.hpp&quot;
+#include &quot;Util/MinSignal.hpp&quot;
 
-class StateChangedCallback;
-
 //--------------------------------------------------------------------------
 class CheckBox : public Component
 {
 protected:
     std::string label;
     bool   state;
-    StateChangedCallback* callback;
 
     PIX textColor;
+    PIX backgroundColor;
+    virtual void draw(Surface &amp;dest);
 
-    void render();
-
 public:
-    CheckBox(StateChangedCallback* newcallback = 0)
-            : Component(), state(false), callback(newcallback)
+    CheckBox()
+            : Component(), state(false)
     {
         setSize( 14, 14);
         textColor = Color::white;
     }
 
     CheckBox(const std::string&amp; newlabel, bool newstate = false)
-            : Component(), label(newlabel), state(newstate), callback(0)
+            : Component(), label(newlabel), state(newstate)
     {
         setSize( 14+label.length()*8, 14);
         textColor = Color::white;
-        dirty = true;
+        backgroundColor = Color::brown;
     }
 
     virtual ~CheckBox()
     {
     }
 
+    MinSignal stateChanged;
+
     const std::string&amp; getLabel() const
     {
         return label;
@@ -70,16 +71,11 @@
     {
         CheckBox::label = label;
         setSize( 14+label.length()*8, 14);
-        dirty = true;
     }
     void setState(bool state)
     {
         CheckBox::state = state;
     }
-    void setStateChangedCallback(StateChangedCallback* newcallback)
-    {
-        callback = newcallback;
-    }
 
     virtual void actionPerformed(const mMouseEvent &amp;me);
 }; // end CheckBox

Modified: branches/krom/src/NetPanzer/Views/Components/Choice.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Choice.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/Choice.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -20,8 +20,9 @@
 #include &lt;algorithm&gt;
 #include &quot;Views/Components/Choice.hpp&quot;
 #include &quot;Views/Components/View.hpp&quot;
-#include &quot;Views/Components/StateChangedCallback.hpp&quot;
 
+#define BORDER_SIZE (12)
+
 //---------------------------------------------------------------------------
 void Choice::reset()
 {
@@ -39,7 +40,7 @@
 {
     choiceList.push_back(item);
 
-    int borderSpace = borderSize * 2;
+    int borderSpace = BORDER_SIZE * 2;
 
     size.x = std::max((Surface::getTextLength(item) + borderSpace), size.y);
     size.y = ChoiceItemHeight;
@@ -54,8 +55,7 @@
                 return;
 
             mouseover = index = i;
-            if(callback)
-                callback-&gt;stateChanged(this);
+            stateChanged();
 
             return;
         }
@@ -71,8 +71,7 @@
         return;
 
     Choice::index = mouseover = index;
-    if(callback)
-        callback-&gt;stateChanged(this);
+    stateChanged();
 }
 
 //---------------------------------------------------------------------------
@@ -139,8 +138,7 @@
             return;
 
         index = mouseover;
-        if(callback)
-            callback-&gt;stateChanged(this);
+        stateChanged();
 
         // Since an item was selected, find which item was selected.
     } else if (	me.getID() == mMouseEvent::MOUSE_EVENT_EXITED) {
@@ -177,7 +175,7 @@
 
     // Draw the name of the choice.
     dest.bltStringShadowed( position.x, pos.y + adjustedY,
-                            componentName.c_str(), Color::white, Color::black);
+                            label.c_str(), Color::white, Color::black);
 
     getBounds(r);
 
@@ -219,7 +217,7 @@
 {
     choiceList.push_back(item);
 
-    int borderSpace = borderSize * 2;
+    int borderSpace = BORDER_SIZE * 2;
 
     size.x = std::max(Surface::getTextLength(item) + borderSpace, size.y);
     size.x = std::max(minWidth, size.x);

Modified: branches/krom/src/NetPanzer/Views/Components/Choice.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Choice.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/Choice.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -24,7 +24,7 @@
 #include &quot;Component.hpp&quot;
 #include &quot;MouseEvent.hpp&quot;
 
-class StateChangedCallback;
+#include &quot;Util/MinSignal.hpp&quot;
 
 //--------------------------------------------------------------------------
 class Choice : public Component
@@ -36,19 +36,21 @@
     bool                isOpen;
     size_t              mouseover;
     int                 adjustedY;  // The y translation value to keep the choice on the screen.
-    StateChangedCallback* callback;
 
+    std::string         label;
+
     enum { ChoiceItemHeight = 14 };
 
 public:
-    Choice(StateChangedCallback* newcallback = 0)
-            : callback(newcallback)
+    Choice()
     {
         reset();
     }
     virtual ~Choice()
     {}
 
+    MinSignal stateChanged;
+
     void   add(const std::string&amp; item);
     void   addItem(const std::string&amp; item);
     void   copyItems(const Choice &amp;choice);
@@ -63,16 +65,9 @@
     void   select(const std::string&amp; item);
     void   select(size_t index);
     void   setMinWidth(int minWidth);
+    void   setLabel(const std::string&amp; label) { this-&gt;label = label; }
 
-    void setStateChangedCallback(StateChangedCallback* newcallback)
-    {
-        callback = newcallback;
-    }
-
     virtual void draw(Surface &amp;dest);
-    virtual void render()
-    {
-    }
     virtual void actionPerformed(const mMouseEvent &amp;me);
 
 private:

Modified: branches/krom/src/NetPanzer/Views/Components/Component.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Component.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/Component.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -21,21 +21,13 @@
 #include &quot;ViewGlobals.hpp&quot;
 #include &quot;Views/Components/View.hpp&quot;
 
-int Component::borderSize = 12;
-
 // reset
 //---------------------------------------------------------------------------
 void Component::reset()
 {
-    foreground = gForeground;
-    background = gBackground;
     size.zero();
     position.zero();
-    enabled    = true;
-    visible    = true;
     parent     = 0;
-    surface.free();
-
 } // end Component::reset
 
 // contains

Modified: branches/krom/src/NetPanzer/Views/Components/Component.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Component.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/Component.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -24,61 +24,32 @@
 #include &quot;2D/Surface.hpp&quot;
 #include &quot;Types/iXY.hpp&quot;
 #include &quot;Types/iRect.hpp&quot;
-#include &quot;Util/NoCopy.hpp&quot;
-#include &quot;Util/Log.hpp&quot;
 
 class mMouseEvent;
 
 //--------------------------------------------------------------------------
-class Component : public NoCopy
+class Component
 {
 protected:
-    PIX    background;
-    PIX    foreground;
     iXY     size;
-    iXY    position;
-    Surface surface;
-    std::string componentName;
-    bool    enabled;
-    bool    visible;
-    bool    dirty;
+    iXY     position;
 
-    static int borderSize;
-
     void reset();
 
 public:
-    Component *next;
-    Component *prev;
-
     void *parent;       // Who is my daddy?
 
     void setParent(void *parent);
 
-    enum
-    {
-        BOTTOM_ALIGNMENT,
-        CENTER_ALIGNMENT,
-        LEFT_ALIGNMENT,
-        RIGHT_ALIGNMENT,
-        TOP_ALIGNMENT
-    };
-
     Component()
     {
         reset();
     }
-    
-    Component(const std::string &amp;cname) : componentName(cname)
-    {
-        reset();
-    }
-    
+        
     virtual ~Component()
     {
     }
 
-    // Accessor functions.
     void getBounds(iRect &amp;r)
     {
         r.min = position;
@@ -86,50 +57,31 @@
     }
     bool contains(int x, int y) const;
     bool contains(iXY p) const { return contains(p.x, p.y); }
-//    Uint8 getBackground() const { return background; }
-//    Uint8 getForeground() const { return foreground; }
-//    const std::string&amp; getName() const { return name; }
-//    const iXY &amp;getSize() const { return size; }
-//    int getSizeX() const { return size.x; }
-//    int getSizeY() const { return size.y; }
-//    bool isEnabled() const { return enabled; }
-//    bool isVisible() const { return visible; }
 
     void setBounds(const iRect &amp;r)
     {
         position  = r.min;
         size = r.getSize();
-        //surface.create(r.getSizeX(), r.getSizeY(), 1);
-        dirty = true;
     }
     
     virtual void setSize(int x, int y)
     {
         size.x=x;
         size.y=y;
-        surface.create(x,y,1);
-        dirty=true;
     }
 
-//    void setEnabled(bool _enabled) { enabled = _enabled; }
-//    void setForeground(PIX _foreground) { foreground = _foreground; }
     void setLocation(int x, int y);
     void setLocation(const iXY &amp;p) { setLocation(p.x, p.y); }
-    void setName(const std::string&amp; name) { Component::componentName = name; }
 
-    virtual void draw(Surface &amp;dest)
-    {
-        iRect bounds;
-        getBounds(bounds);
-        
-        if ( dirty )
-            render();
-        
-        surface.blt(dest, bounds.min.x, bounds.min.y);
-    }
-    
-    virtual void render() = 0;
+    virtual void draw(Surface &amp;dest) = 0;
     virtual void actionPerformed(const mMouseEvent &amp;me) = 0;
+    virtual void handleKeyboard() {}
+
+private:
+    Component(const Component&amp; )
+    { }
+    void operator=(const Component&amp; )
+    { }
 }; // end Component
 
 #endif // end __Component_hpp__

Modified: branches/krom/src/NetPanzer/Views/Components/Desktop.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/Desktop.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -24,31 +24,23 @@
 #include &quot;Interfaces/MouseInterface.hpp&quot;
 
 #include &quot;Views/Components/Label.hpp&quot;
+#include &quot;Views/Components/Component.hpp&quot;
 
 using std::min;
 using std::max;
 
-float     Desktop::totalMouseDownTime   = 0.0;
-float     Desktop::currentMouseDownTime = 0.0;
 std::vector&lt;View*&gt; Desktop::views;
-View     *Desktop::focus;
-int       Desktop::mouseActions;
+std::vector&lt;View*&gt; Desktop::all_views;
+View     *Desktop::focus = 0;
+Component *Desktop::keyboardFocusComponent = 0;
 iXY       Desktop::lMouseDownPos;
 iXY       Desktop::rMouseDownPos;
 iXY       Desktop::prevMousePos;
-iXY       Desktop::mouseActionOffset;
 int       Desktop::prevButton;
-int       Desktop::mouseIsDown;
 View     *Desktop::mouseView;
-View     *Desktop::prevMouseView;
 View     *Desktop::lMouseView;
 View     *Desktop::rMouseView;
-TimeStamp Desktop::lDoubleClickDeadline;
-TimeStamp Desktop::rDoubleClickDeadline;
-float     Desktop::doubleClickTime = 0.15f;
-int       Desktop::mouseMoveStatus = 0;
 
-
 /////////////////////////////////////////////////////////////////////////////
 // Class definitions.
 /////////////////////////////////////////////////////////////////////////////
@@ -60,14 +52,59 @@
 Desktop::Desktop()
 {
     focus        = 0;
-    mouseActions = 0;
     prevButton   = 0;
-
-    // Set the double click deadlines to 1 minute ago, so we don't
-    // double click on the first press
-    lDoubleClickDeadline = rDoubleClickDeadline = now() - 60;
 } // end Desktop constructor
 
+// add
+//--------------------------------------------------------------------------
+// Purpose: Adds a new window to the end of the current window list.
+//--------------------------------------------------------------------------
+void Desktop::add(View *view)
+{
+    if ( view )
+    {
+        all_views.push_back(view);
+        if ( view-&gt;isVisible() )
+        {
+            views.push_back(view);
+        }
+    }
+} // end add
+
+// remove
+//--------------------------------------------------------------------------
+// Purpose: Removes a window from the list.
+//--------------------------------------------------------------------------
+void Desktop::remove(View *view)
+{
+    if ( view )
+    {
+        std::remove(views.begin(), views.end(), view);
+        std::remove(all_views.begin(), all_views.end(), view);
+    }
+} // end add
+
+// setVisibility
+//--------------------------------------------------------------------------
+// Purpose:
+//--------------------------------------------------------------------------
+void Desktop::setVisibility(View *view, int isVisible)
+{
+    if ( isVisible &amp;&amp; ! view-&gt;isVisible() )
+    {
+        view-&gt;status |= View::STATUS_VISIBLE;
+        views.push_back(view);
+        view-&gt;doActivate();
+    }
+    else if ( ! isVisible &amp;&amp; view-&gt;isVisible() )
+    {
+        view-&gt;status &amp;= ~View::STATUS_VISIBLE;
+        std::remove(views.begin(), views.end(), view);
+        view-&gt;doDeactivate();
+    }
+} // end setVisibility
+
+
 // manage
 //--------------------------------------------------------------------------
 // Purpose: Manages the window manager.  Check for button presses, actions
@@ -79,21 +116,26 @@
 
     MouseInterface::setCursor(&quot;default.bmp&quot;);
 
-    prevMouseView = mouseView;
+    View* prevMouseView = mouseView;
 
     mouseView = findViewContaining(mousePos);
 
     // Check for mouseEnter and mouseExit.
-    if (mouseView != prevMouseView) {
-        if (mouseView != 0) {
-            mouseView-&gt;mouseEnter(mouseView-&gt;getScreenToClientPos(mousePos));
-        }
-        if (prevMouseView != 0) {
+    if (mouseView != prevMouseView)
+    {
+        if (prevMouseView != 0)
+        {
             prevMouseView-&gt;mouseExit(prevMouseView-&gt;getScreenToClientPos(mousePos));
         }
+
+        if (mouseView != 0)
+        {
+            mouseView-&gt;mouseEnter(mouseView-&gt;getScreenToClientPos(mousePos));
+        }
     }
 
-    if (mouseView != 0) {
+    if (mouseView != 0)
+    {
         mouseView-&gt;mouseMove(mouseView-&gt;getScreenToClientPos(prevMousePos), mouseView-&gt;getScreenToClientPos(mousePos));
     }
 
@@ -103,120 +145,41 @@
     //
     //////////////////////////////////////////////////////////////////////////
 
-    if (curButton &amp; MouseInterface::left_button_mask) {
-        // The button is down.  See if it just got pressed, or if it was pressed
-        // before and is being dragged.
-        if (!(prevButton &amp; MouseInterface::left_button_mask)) {
-            // The mouse button just got pressed. Remember the initial place
-            // where it got pressed.
+    if (curButton &amp; MouseInterface::left_button_mask) // left button is pressed
+    {
+        if (!(prevButton &amp; MouseInterface::left_button_mask)) // new press
+        {
+            keyboardFocusComponent = 0;
             lMouseDownPos = mousePos;
-
-            // Is this a double click? **FIX THE DOUBLE CLICK SENSITIVITY**
-            if (lMouseView != 0) {
-                // XXX what is this? ;-) commented out to avoid warning
-                //int shit = 123456789;
-
-            } else {
-                // Not a double click.  See what window we're over
-                lMouseView = mouseView;
-                if (lMouseView != 0) {
-                    lMouseView-&gt;lMouseDown(lMouseView-&gt;getScreenToClientPos(mousePos));
-                    if (focus != lMouseView) {
-                        activate(lMouseView);
-                    }
-                    // We are over a window.  Get the standard mouse actions for that
-                    // window at this mouse position.
-
-                    // mouseActionOffset is relative to the current window
-                    mouseActionOffset = mousePos - lMouseView-&gt;min;
-                    mouseActions      = lMouseView-&gt;getMouseActions(mouseActionOffset);
-                    if (mouseActions != 0) {
-                        // A standard mouse action is supposed to happen here.  Remember
-                        // what that action is, and record the offset of the mouse from
-                        // the window, so the distance we move the mouse is the distance
-                        // the window gets resized, etc. exactly.
-
-                        if (lMouseView-&gt;status &amp; View::STATUS_ALLOW_RESIZE) {
-                            if (mouseActions &amp; View::MA_RESIZE_LEFT) {
-                                mouseActionOffset.x = mousePos.x - lMouseView-&gt;min.x;
-                            } else if (mouseActions &amp; View::MA_RESIZE_RIGHT) {
-                                mouseActionOffset.x = lMouseView-&gt;max.x - mousePos.x;
-                            }
-
-                            if (mouseActions &amp; View::MA_RESIZE_TOP) {
-                                mouseActionOffset.y = mousePos.y - lMouseView-&gt;min.y;
-                            } else if (mouseActions &amp; View::MA_RESIZE_BOTTOM) {
-                                mouseActionOffset.y = lMouseView-&gt;max.y - mousePos.y;
-                            }
-                        }
-
-                        doMouseActions(mousePos);
-
-                    } else {
-                        // No standard mouse actions.  Tell the window that the mouse
-                        // just got pressed.
-                    }
+            lMouseView = mouseView;
+            if (lMouseView != 0)
+            {
+                lMouseView-&gt;lMouseDown(lMouseView-&gt;getScreenToClientPos(mousePos));
+                if (focus != lMouseView)
+                {
+                    activate(lMouseView);
                 }
             }
-        } else {
-            // The mouse was down before and is still down.  Are we performing
-            // and standard window actions?
-
-            if (lMouseView != 0 &amp;&amp; mouseActions != 0) {
-                //throw Exception(&quot;Double click!&quot;);
-
-                // Yes - it's a double click.  Inform the window as such.
-                //lMouseView-&gt;lMouseDouble(lMouseView-&gt;getScreenToClientPos(mousePos));
-
-                // We're doing some standard mouse actions.  Do them.
-                doMouseActions(mousePos);
-            } else {
-                //currentMouseDownTime += TimerInterface::getTimeSlice();
-                //totalMouseDownTime   += TimerInterface::getTimeSlice();
-                //
-                //if (totalMouseDownTime &gt; 2.0f &amp;&amp; totalMouseDownTime &lt; 0.5f)
-                //{
-                //	if (currentMouseDownTime &gt; 0.4f)
-                //	{
-                //		currentMouseDownTime = 0.0f;
-                //		lMouseView-&gt;lMouseUp(lMouseView-&gt;getScreenToClientPos(lMouseDownPos), lMouseView-&gt;getScreenToClientPos(mousePos));
-                //		lMouseView-&gt;lMouseDown(lMouseView-&gt;getScreenToClientPos(mousePos));
-                //	}
-                //}
-                //else if (totalMouseDownTime &gt;= 5.0f)
-                //{
-                //	if (currentMouseDownTime &gt; 0.1f)
-                //	{
-                //		currentMouseDownTime = 0.0f;
-                //		lMouseView-&gt;lMouseUp(lMouseView-&gt;getScreenToClientPos(lMouseDownPos), lMouseView-&gt;getScreenToClientPos(mousePos));
-                //		lMouseView-&gt;lMouseDown(lMouseView-&gt;getScreenToClientPos(mousePos));
-                //	}
-                //}
-
-                // No standard mouse actions.  Tell the window where the mouse
-                // was originally clicked that the mouse is being dragged over
-                // it.
-                if (lMouseView != 0) {
-                    lMouseView-&gt;lMouseDrag(lMouseView-&gt;getScreenToClientPos(lMouseDownPos), lMouseView-&gt;getScreenToClientPos(prevMousePos), lMouseView-&gt;getScreenToClientPos(mousePos));
-                }
+        }
+        else // continued press
+        {
+            if (lMouseView != 0)
+            {
+                lMouseView-&gt;lMouseDrag(lMouseView-&gt;getScreenToClientPos(lMouseDownPos), lMouseView-&gt;getScreenToClientPos(prevMousePos), lMouseView-&gt;getScreenToClientPos(mousePos));
             }
         }
-    } else {
-        // The mouse button is up.
-        //See if it just got released, or if it was up before.
-        if (prevButton &amp; MouseInterface::left_button_mask) {
-            // The mouse button just got released.  If it was on top of a window
-            // before, then tell the window that the button was released
-            if (lMouseView != 0) {
+    }
+    else // left button is not pressed
+    {
+        if (prevButton &amp; MouseInterface::left_button_mask)
+        {
+            if (lMouseView != 0)
+            {
                 lMouseView-&gt;lMouseUp(lMouseView-&gt;getScreenToClientPos(lMouseDownPos), lMouseView-&gt;getScreenToClientPos(mousePos));
             }
-            // Set double click deadline
-            lDoubleClickDeadline = now() + doubleClickTime;
         }
 
-        //LOG((&quot;Button released - clearing lMouseView and mouseActions&quot;));
         lMouseView = 0;
-        mouseActions = 0;
     }
 
     //////////////////////////////////////////////////////////////////////////
@@ -225,51 +188,34 @@
     //
     //////////////////////////////////////////////////////////////////////////
 
-    if (curButton &amp; MouseInterface::right_button_mask) {
-        // The button is down.  See if it just got pressed, or if it was pressed
-        // before and is being dragged.
-        if (!(prevButton &amp; MouseInterface::right_button_mask)) {
-            // The mouse button just got pressed. Remember the initial place
-            // where it got pressed.
+    if (curButton &amp; MouseInterface::right_button_mask) // right button pressed
+    {
+        if (!(prevButton &amp; MouseInterface::right_button_mask))
+        {
+            keyboardFocusComponent = 0;
             rMouseDownPos = mousePos;
-
-            // Is this a double click? **FIX THE DOUBLE CLICK SENSITIVITY**
-            if (rMouseView != 0 &amp;&amp; now() &lt;= rDoubleClickDeadline &amp;&amp; 0) {
-                //throw Exception(&quot;Double click!&quot;);
-
-                // Yes - it's a double click.  Inform the window as such.
-                rMouseView-&gt;rMouseDouble(rMouseView-&gt;getScreenToClientPos(mousePos));
-            } else {
-                // Not a double click.  See what window we're over.
-                rMouseView = mouseView;
-                if (rMouseView != 0) {
-                    // No standard mouse actions.  Tell the window that the mouse
-                    // just got pressed.
-                    rMouseView-&gt;rMouseDown(rMouseView-&gt;getScreenToClientPos(mousePos));
-                }
+            rMouseView = mouseView;
+            if (rMouseView != 0)
+            {
+                rMouseView-&gt;rMouseDown(rMouseView-&gt;getScreenToClientPos(mousePos));
             }
-        } else {
-            // The mouse was down before and is still down.
-
-            // No standard mouse actions.  Tell the window where the mouse
-            // was originally clicked that the mouse is being dragged over
-            // it.
-            if (rMouseView != 0) {
+        }
+        else
+        {
+            if (rMouseView != 0)
+            {
                 rMouseView-&gt;rMouseDrag(rMouseView-&gt;getScreenToClientPos(rMouseDownPos), rMouseView-&gt;getScreenToClientPos(prevMousePos), rMouseView-&gt;getScreenToClientPos(mousePos));
             }
         }
-    } else {
-        // The mouse button is up.
-        //See if it just got released, or if it was up before.
-        if (prevButton &amp; MouseInterface::right_button_mask) {
-            // The mouse button just got released.  If it was on top of a window
-            // before, then tell the window that the button was released
-            if (rMouseView != 0) {
+    }
+    else
+    {
+        if (prevButton &amp; MouseInterface::right_button_mask)
+        {
+            if (rMouseView != 0)
+            {
                 rMouseView-&gt;rMouseUp(rMouseView-&gt;getScreenToClientPos(rMouseDownPos), rMouseView-&gt;getScreenToClientPos(mousePos));
             }
-
-            // Set double click deadline
-            rDoubleClickDeadline = now() + doubleClickTime;
         }
         rMouseView = 0;
     }
@@ -277,13 +223,13 @@
     prevButton   = curButton;
     prevMousePos = mousePos;
 
-    //mouseView = findViewContaining(mousePos);
-    unsigned effActions = mouseActions;
-    if (mouseView != 0 &amp;&amp; effActions == 0) {
-        effActions = mouseView-&gt;getMouseActions(mousePos-mouseView-&gt;min);
+    if ( keyboardFocusComponent )
+    {
+        keyboardFocusComponent-&gt;handleKeyboard();
+        KeyboardInterface::flushCharBuffer();
     }
-
-    if (focus != 0) {
+    else if (focus != 0)
+    {
         focus-&gt;processEvents();
         KeyboardInterface::flushCharBuffer();
     }
@@ -296,35 +242,15 @@
 //--------------------------------------------------------------------------
 void Desktop::draw(Surface&amp; surface)
 {
+    surface.fill(Color::black); // XXX remove this
     std::vector&lt;View*&gt;::reverse_iterator i;
     for(i = views.rbegin(); i != views.rend(); i++) {
         (*i)-&gt;draw(surface);
     }
 } // end draw
 
-// add
-//--------------------------------------------------------------------------
-// Purpose: Adds a new window to the end of the current window list.
-//--------------------------------------------------------------------------
-void Desktop::add(View *view, bool autoActivate)
-{
-    assert(view != 0);
-    views.push_back(view);
-    if (autoActivate)
-        activate(view);
-} // end add
 
-// remove
-//--------------------------------------------------------------------------
-// Purpose: Removes a window from the list.
-//--------------------------------------------------------------------------
-void Desktop::remove(View *view)
-{
-    if ( view )
-        std::remove(views.begin(), views.end(), view);
-} // end add
 
-
 // activate
 //--------------------------------------------------------------------------
 // Purpose:
@@ -475,114 +401,6 @@
 
 }
 
-// doMouseActions
-//--------------------------------------------------------------------------
-// Purpose:
-//--------------------------------------------------------------------------
-void Desktop::doMouseActions(const iXY &amp;mousePos)
-{
-    if (lMouseView == 0) return;
-
-    if (mouseActions &amp; View::MA_MOVE) {
-        // Move the window
-        // XXX need to check for screen size
-        //lMouseView-&gt;moveTo(mousePos - mouseActionOffset);
-    } else if (mouseActions &amp; View::MA_SCROLL_BAR) {
-        lMouseView-&gt;scrollBarMove(lMouseView-&gt;getScreenToClientPos(prevMousePos), lMouseView-&gt;getScreenToClientPos(mousePos));
-    } else if (lMouseView-&gt;getResize()) {
-        // Resize the window and move it if necessary
-        iXY resizeMin(lMouseView-&gt;min);
-        iXY resizeMax(lMouseView-&gt;max);
-
-        if (mouseActions &amp; View::MA_RESIZE_LEFT) {
-            resizeMin.x = min(	mousePos.x - mouseActionOffset.x,
-                               lMouseView-&gt;max.x - View::RESIZE_XMINSIZE);
-        }
-        if (mouseActions &amp; View::MA_RESIZE_TOP) {
-            resizeMin.y = min(	mousePos.y + mouseActionOffset.y,
-                               lMouseView-&gt;max.y - View::RESIZE_XMINSIZE);
-        }
-        if (mouseActions &amp; View::MA_RESIZE_RIGHT) {
-            resizeMax.x = max(	mousePos.x + mouseActionOffset.x,
-                               lMouseView-&gt;min.x + View::RESIZE_XMINSIZE);
-        }
-        if (mouseActions &amp; View::MA_RESIZE_BOTTOM) {
-            resizeMax.y = max(	mousePos.y + mouseActionOffset.y,
-                               lMouseView-&gt;min.y + View::RESIZE_YMINSIZE);
-        }
-
-        // XXX
-        /*
-        lMouseView-&gt;moveTo(resizeMin);
-        lMouseView-&gt;resize(resizeMax - resizeMin);
-        */
-    }
-
-} // end Desktop::doMouseActions
-
-// getViewCount
-//--------------------------------------------------------------------------
-// Purpose: Returns the number of windows in the window manager.
-//--------------------------------------------------------------------------
-int Desktop::getViewCount()
-{
-    return views.size();
-} // end getViewCount
-
-// getViewSearchName
-//--------------------------------------------------------------------------
-// Purpose: Returns the searchName of the specified window.
-//--------------------------------------------------------------------------
-const char *Desktop::getViewSearchName(int winNum)
-{
-    assert(winNum &lt; getViewCount());
-
-    // Returnthe requested windows searchName.
-    return views[winNum]-&gt;searchName;
-} // end getViewSearchName
-
-// getViewStatus
-//--------------------------------------------------------------------------
-// Purpose: Returns the status of the specified window.
-//--------------------------------------------------------------------------
-int Desktop::getViewStatus(const char *searchName)
-{
-    std::vector&lt;View*&gt;::iterator i;
-    for(i = views.begin(); i != views.end(); i++) {
-        View* view = *i;
-
-        if (strcmp(view-&gt;searchName, searchName) == 0) {
-            return view-&gt;status;
-        }
-    }
-
-    return 0;
-} // end getViewStatus
-
-// setVisibility
-//--------------------------------------------------------------------------
-// Purpose:
-//--------------------------------------------------------------------------
-void Desktop::setVisibility(const char *searchName, int isVisible)
-{
-    std::vector&lt;View*&gt;::iterator i;
-    for(i = views.begin(); i != views.end(); i++) {
-        View* view = *i;
-
-        if (strcmp(view-&gt;searchName, searchName) == 0) {
-            if (isVisible) {
-                view-&gt;status |= View::STATUS_VISIBLE;
-                view-&gt;doActivate();
-                //activate(view);
-            } else {
-                view-&gt;status &amp;= ~View::STATUS_VISIBLE;
-                view-&gt;doDeactivate();
-            }
-            break;
-        }
-    }
-} // end setVisibility
-
 // setVisibilityNoDoAnything
 //--------------------------------------------------------------------------
 // Purpose: Only changes whether a visibility of the view, no activate or
@@ -634,13 +452,17 @@
     int yOffset = 10;
     char strBuf[256];
 
-    for (int i = 0; i &lt; Desktop::getViewCount(); i++) {
-        clientArea.bltString(0, yOffset, Desktop::getViewSearchName(i), Color::white);
+    for (unsigned int i = 0; i &lt; Desktop::views.size(); i++)
+    {
+        clientArea.bltString(0, yOffset, Desktop::views[i]-&gt;getSearchName(), Color::white);
 
-        if (Desktop::getViewStatus(Desktop::getViewSearchName(i)) &amp; STATUS_VISIBLE) {
+        if ( Desktop::views[i]-&gt;isVisible() )
+        {
             sprintf(strBuf, &quot;STATUS_VISIBLE&quot;);
 
-        } else {
+        }
+        else
+        {
             sprintf(strBuf, &quot;INVISIBLE&quot;);
         }
 
@@ -649,7 +471,7 @@
         yOffset += Surface::getFontHeight();
     }
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 
 } // end doDraw
 

Modified: branches/krom/src/NetPanzer/Views/Components/Desktop.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/Desktop.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -30,76 +30,64 @@
 class Desktop
 {
 private: // Variables
+    friend class DesktopView;
     enum { RESIZE_NONE,
            RESIZE_TOPLEFT,
            RESIZE_TOPRIGHT,
            RESIZE_BOTTOMLEFT,
            RESIZE_BOTTOMRIGHT };
 
-    static float      totalMouseDownTime;
-    static float      currentMouseDownTime;
     static std::vector&lt;View*&gt; views;
+    static std::vector&lt;View*&gt; all_views;
     static View      *focus;
-    static int        mouseActions;
+    static Component *keyboardFocusComponent;
     static iXY        lMouseDownPos;
     static iXY        rMouseDownPos;
     static iXY        prevMousePos;
     static int        prevButton;
-    static int        mouseIsDown;
     static View      *lMouseView;
     static View      *rMouseView;
     static View      *mouseView;
-    static View      *prevMouseView;
-    static TimeStamp  lDoubleClickDeadline;
-    static TimeStamp  rDoubleClickDeadline;
-    static float      doubleClickTime;
-    static int        mouseMoveStatus;
 
-    // Movement events. MOVE THIS OUT OF THIS CLASS!  INTO GAME_WIN.
-    enum { MM_LEFT  = (1U &lt;&lt; 0) };
-    enum { MM_RIGHT = (1U &lt;&lt; 1) };
-    enum { MM_UP    = (1U &lt;&lt; 2) };
-    enum { MM_DOWN  = (1U &lt;&lt; 3) };
-
-    // The following are used when the window is moved using move()
-    static iXY mouseActionOffset; // The displacement from the mouse press to th window
-
 private: // Functions
-    static void isMouseInBox(int mouseX, int mouseY, int x1, int y1, int x2, int y2);
-
-    static unsigned isMouseOverResizeArea(int mouseX, int mouseY);
-    static bool     isMouseOverMoveArea  (int mouseX, int mouseY);
-
-    static bool   isMouseInView(int mouseX, int mouseY);
     static View *findViewContaining(iXY p);
-    static void   doMouseActions(const iXY &amp;mousePos);
 
 public:
     Desktop();
 
-    static void manage(int mouseX, int mouseY, int curButton);
-    static void activate(View *view);
-    static void toggleVisibility(const char *viewName);
-    static void setVisibility(const char *viewName, int isVisible);
-    static void toggleVisibilityNoDoAnything(const char *viewName);
-    static void setVisibilityNoDoAnything(const char *viewName, int isVisible);
-    static void add(View *view, bool autoActivate = true);
+    static void add(View *view);
     static void remove(View *view);
-    static void draw(Surface&amp; surface);
 
-    static iXY      getMouseActionOffset  ()
+    static View *getView(const char *searchName)
     {
-        return mouseActionOffset;
+        std::vector&lt;View*&gt;::iterator i;
+
+        for( i = all_views.begin(); i != all_views.end(); i++ )
+        {
+            View* view = *i;
+            if ( strcmp(view-&gt;searchName, searchName) == 0 )
+            {
+                return view;
+            }
+        }
+
+        return 0;
     }
-    static void     resetMouseActionOffset()
+
+    static void setVisibility(View *view, int isVisible);
+    static void setVisibility(const char *viewName, int isVisible)
     {
-        mouseActionOffset.zero();
+        setVisibility( getView(viewName), isVisible );
     }
 
-    static int         getViewCount();
-    static const char *getViewTitle(int viewNum);
-    static const char *getViewSearchName(int viewNum);
-    static int         getViewStatus(const char *searchName);
+
+    static void manage(int mouseX, int mouseY, int curButton);
+    static void activate(View *view);
+    static void toggleVisibility(const char *viewName);
+    static void toggleVisibilityNoDoAnything(const char *viewName);
+    static void setVisibilityNoDoAnything(const char *viewName, int isVisible);
+    static void draw(Surface&amp; surface);
+
     static void        setActiveView(const char *viewitle);
     static void        setActiveView(View *view);
 
@@ -108,18 +96,16 @@
         toggleVisibility(view-&gt;getSearchName());
     }
 
-    static void setVisibility(View *view, int isVisible)
+    static void hideAllWindows()
     {
-        setVisibility(view-&gt;getSearchName(), isVisible);
-    }
-
-    static void setVisibilityAllWindows(int isVisible)
-    {
-        int viewCount = getViewCount();
-
-        for (int i = 0; i &lt; viewCount; i++) {
-            setVisibility(getViewSearchName(i), isVisible);
+        unsigned int i;
+        for ( i = 0; i &lt; views.size(); i++ )
+        {
+            views[i]-&gt;status &amp;= ~View::STATUS_VISIBLE;
+            views[i]-&gt;doDeactivate();
         }
+
+        views.clear();
     }
 
     static void toggleVisibilityNoDoAnything(View *view)
@@ -134,27 +120,10 @@
 
     static bool getVisible(const char *searchName)
     {
-        if (getViewStatus(searchName) &amp; View::STATUS_VISIBLE) {
-            return true;
-        }
-
-        return false;
+        View *v = getView(searchName);
+        return v &amp;&amp; v-&gt;isVisible();
     }
 
-    static View *getView(const char *searchName)
-    {
-        std::vector&lt;View*&gt;::iterator i;
-        for(i = views.begin(); i != views.end(); i++) {
-            View* view = *i;
-
-            if (strcmp(view-&gt;searchName, searchName) == 0) {
-                return view;
-            }
-        }
-
-        return 0;
-    }
-
     static void checkViewPositions(iXY viewarea);
     static void checkResolution(iXY oldResolution, iXY newResolution);
 
@@ -162,10 +131,19 @@
     {
         return focus;
     }
+
     static void setFocusView(View *view)
     {
         activate(view);
     }
+
+    static void setKeyboardFocusComponent(Component *c)
+    {
+        keyboardFocusComponent = c;
+    }
+
+    static Component * getKeyboardFocusComponent() { return keyboardFocusComponent; }
+
 }
 ; // end Desktop
 

Modified: branches/krom/src/NetPanzer/Views/Components/InfoBar.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/InfoBar.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/InfoBar.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -34,11 +34,6 @@
     
     void draw(Surface &amp;dest);
     
-    virtual void render()
-    {
-        // nothing
-    }
-    
     void actionPerformed(const mMouseEvent &amp;me)
     {
         // nothing

Added: branches/krom/src/NetPanzer/Views/Components/InputField.cpp
===================================================================
--- branches/krom/src/NetPanzer/Views/Components/InputField.cpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Views/Components/InputField.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,219 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ * Created on September 1, 2011, 05:01 PM
+ */
+
+#include &quot;InputField.hpp&quot;
+#include &quot;2D/Color.hpp&quot;
+#include &quot;Views/Components/Desktop.hpp&quot;
+#include &quot;Interfaces/KeyboardInterface.hpp&quot;
+#include &quot;SDL.h&quot;
+
+InputField::InputField()
+{
+    this-&gt;has_focus = false;
+    this-&gt;max_chars = 50;
+    this-&gt;text_display_start = 0;
+    this-&gt;cursor_pos = 0;
+    this-&gt;text = &quot;Testingvery long text&quot;;
+
+    this-&gt;last_pressed_key = 0;
+    this-&gt;was_special_key = false;
+}
+
+void InputField::draw(Surface &amp;dest)
+{
+    iRect r;
+    getBounds(r);
+
+    dest.fillRect(r, Color::black);
+
+    bool inFocus = Desktop::getKeyboardFocusComponent() == this;
+
+    if ( inFocus )
+    {
+        checkRepeatKey();
+        dest.drawButtonBorder(r, Color::gray64, Color::white);
+    }
+    else
+    {
+        last_pressed_key = 0;
+        dest.drawButtonBorder(r, Color::white, Color::gray64);
+    }
+    r.min.y += 2; // add the border;
+    r.min.x += 2;
+    r.max.y -= 2;
+    r.max.x -= 2;
+
+    Surface s;
+    s.setTo(dest, r);
+
+    s.bltString(0,0, text.substr(text_display_start).c_str(), Color::white);
+
+    if ( inFocus )
+    {
+        drawCursor(s);
+    }
+}
+
+void InputField::drawCursor(Surface&amp; dest)
+{
+    Uint32 now = SDL_GetTicks()/100;
+
+    if ( now &amp; 2)
+    {
+        int cpos = (cursor_pos - text_display_start) * 8;
+        iRect r(cpos, (8-3), cpos+7, (8-1));
+        dest.fillRect(r, Color::white);
+    }
+}
+
+void InputField::actionPerformed(const mMouseEvent &amp;me)
+{
+    if ( me.getID() == mMouseEvent::MOUSE_EVENT_PRESSED )
+    {
+        Desktop::setKeyboardFocusComponent(this);
+    }
+}
+
+void InputField::handleKeyboard()
+{
+    int kchar;
+    while (KeyboardInterface::getChar(kchar))
+    {
+        if (kchar == 0)
+        {
+            if (KeyboardInterface::getChar(kchar))
+            {
+                was_special_key = true;
+                handleSpecialKey(kchar);
+            }
+        }
+        else
+        {
+            was_special_key = false;
+            handleNormalKey(kchar);
+        }
+
+        last_pressed_key = kchar;
+        key_repeat_timer.setTimeOut(250);
+        key_repeat_timer.reset();
+
+    }
+}
+
+void InputField::handleNormalKey(int key)
+{
+    text.insert(cursor_pos,1,key);
+    ++cursor_pos;
+    int end_pos = ((cursor_pos - text_display_start) * 8) + 8;
+    if ( end_pos &gt; size.x-2 )
+    {
+        ++text_display_start;
+    }
+
+}
+
+void InputField::handleSpecialKey(int key)
+{
+    switch ( key )
+    {
+        case SDLK_LEFT:
+            if ( cursor_pos &gt; 0 )
+            {
+                --cursor_pos;
+                if ( cursor_pos &lt; text_display_start )
+                {
+                    text_display_start = cursor_pos;
+                }
+            }
+            break;
+
+        case SDLK_RIGHT:
+            if ( cursor_pos &lt; text.length() )
+            {
+                ++cursor_pos;
+                int end_pos = ((cursor_pos - text_display_start) * 8) + 8;
+                if ( end_pos &gt; size.x-2 )
+                {
+                    ++text_display_start;
+                }
+            }
+            break;
+
+        case SDLK_BACKSPACE:
+            if (cursor_pos &gt; 0)
+            {
+                --cursor_pos;
+                text.erase(cursor_pos,1);
+                if ( cursor_pos &lt; text_display_start )
+                {
+                    text_display_start = cursor_pos;
+                }
+            }
+            break;
+
+        case SDLK_DELETE:
+            if ( cursor_pos &lt; text.length() )
+            {
+                text.erase(cursor_pos, 1);
+            }
+            break;
+
+        case SDLK_HOME:
+            cursor_pos = 0;
+            text_display_start = 0;
+            break;
+
+        case SDLK_END:
+            cursor_pos = text.length();
+            text_display_start = 0;
+            while ( (((cursor_pos - text_display_start) * 8) + 8) &gt; size.x -2 )
+            {
+                ++text_display_start;
+            }
+            break;
+
+        default:
+            break;
+    }
+}
+
+void InputField::checkRepeatKey()
+{
+    if ( last_pressed_key &amp;&amp; key_repeat_timer.isTimeOut() )
+    {
+        if ( KeyboardInterface::getKeyState(last_pressed_key) )
+        {
+            if ( was_special_key )
+            {
+                handleSpecialKey(last_pressed_key);
+            }
+            else
+            {
+                handleNormalKey(last_pressed_key);
+            }
+            key_repeat_timer.setTimeOut(50);
+            key_repeat_timer.reset();
+        }
+        else
+        {
+            last_pressed_key = 0;
+        }
+    }
+}

Added: branches/krom/src/NetPanzer/Views/Components/InputField.hpp
===================================================================
--- branches/krom/src/NetPanzer/Views/Components/InputField.hpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Views/Components/InputField.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,73 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ * Created on September 1, 2011, 05:01 PM
+ */
+
+#ifndef INPUTFIELD_HPP
+#define INPUTFIELD_HPP
+
+#include &quot;Component.hpp&quot;
+#include &quot;Util/NTimer.hpp&quot;
+#include &lt;string&gt;
+
+class InputField : public Component
+{
+protected:
+    virtual void draw(Surface &amp;dest);
+    virtual void actionPerformed(const mMouseEvent &amp;me);
+
+    void drawCursor(Surface&amp; dest);
+
+public:
+    InputField();
+    virtual ~InputField() {}
+
+    void setText(const std::string&amp; text)
+    {
+        this-&gt;text = text;
+    }
+
+    const std::string&amp; getText() const { return text; }
+
+    void setSize(int x, int y)
+    {
+        (void)y;
+        Component::setSize(x+4, 12);
+    }
+
+    virtual void handleKeyboard();
+
+    void handleNormalKey(int key);
+    void handleSpecialKey(int key);
+
+private:
+    bool has_focus;
+    int cursor_pos;
+    int max_chars;
+    int text_display_start;
+    std::string text;
+
+    int last_pressed_key;
+    bool was_special_key;
+    NTimer key_repeat_timer;
+
+    void checkRepeatKey();
+
+};
+
+#endif // INPUTFIELD_HPP

Modified: branches/krom/src/NetPanzer/Views/Components/Label.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Label.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/Label.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -36,14 +36,11 @@
         position.x = x;
         position.y = y;
     }
+
+    void setText(const string&amp; text) { this-&gt;text = text; }
     
     void draw(Surface &amp;dest);
     
-    virtual void render()
-    {
-        // nothing
-    }
-    
     void actionPerformed(const mMouseEvent &amp;me)
     {
         // nothing
@@ -52,6 +49,8 @@
 private:
     string text;
     bool shadowed;
+    PIX foreground;
+    PIX background;
 };
 
 #endif

Modified: branches/krom/src/NetPanzer/Views/Components/MiniMap.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/MiniMap.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/MiniMap.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -41,6 +41,7 @@
 {
     setLocation(x, y);
     setSize(w,h);
+    surface.create(w, h, 1);
     moving=false;
     mouseinside=false;
     

Modified: branches/krom/src/NetPanzer/Views/Components/MiniMap.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/MiniMap.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/MiniMap.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -24,6 +24,7 @@
 #include &quot;Views/Components/Component.hpp&quot;
 #include &quot;Interfaces/MapInterface.hpp&quot;
 #include &quot;Util/NTimer.hpp&quot;
+#include &quot;Util/Log.hpp&quot;
 
 class MiniMap : public Component, public MapEventListener
 {
@@ -33,11 +34,6 @@
     
     void draw(Surface &amp;dest);
     
-    virtual void render()
-    {
-        // nothing
-    }
-    
     void actionPerformed(const mMouseEvent &amp;me);
     
 protected:
@@ -60,6 +56,7 @@
     float yratio;
     NTimer blinktimer;
     bool blinkstatus;
+    Surface surface;
 };
 
 #endif	/* _MINIMAP_HPP */

Deleted: branches/krom/src/NetPanzer/Views/Components/ScrollBar.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/ScrollBar.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/ScrollBar.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,313 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;Views/Components/ScrollBar.hpp&quot;
-
-// ScrollBar
-//---------------------------------------------------------------------------
-ScrollBar::ScrollBar() : Component()
-{
-    reset();
-    decrease = new Button( &quot;decreaseButton&quot;);
-    decrease-&gt;setLabel(&quot;-&quot;);
-    
-    increase = new Button( &quot;increaseButton&quot;);
-    increase-&gt;setLabel(&quot;+&quot;);
-
-
-} // end ScrollBar::ScrollBar
-
-// ScrollBar
-//---------------------------------------------------------------------------
-ScrollBar::ScrollBar(Orientation orientation)
-{
-    reset();
-
-    ScrollBar::orientation = orientation;
-    decrease = new Button( &quot;decreaseButton&quot;);
-    decrease-&gt;setLabel(&quot;-&quot;);
-    
-    increase = new Button( &quot;increaseButton&quot;);
-    increase-&gt;setLabel(&quot;+&quot;);
-
-} // end ScrollBar::ScrollBar
-
-// ScrollBar
-//---------------------------------------------------------------------------
-ScrollBar::ScrollBar(Orientation orientation, int value, int visible, int minimum, int maximum)
-{
-    reset();
-
-    ScrollBar::orientation = orientation;
-    ScrollBar::value       = value;
-    ScrollBar::value       = visible;
-    ScrollBar::minimum     = minimum;
-    ScrollBar::maximum     = maximum;
- 
-    decrease = new Button( &quot;decreaseButton&quot;);
-    decrease-&gt;setLabel(&quot;-&quot;);
-    
-    increase = new Button( &quot;increaseButton&quot;);
-    increase-&gt;setLabel(&quot;+&quot;);
-    
-    decrease-&gt;setSize(MINOR_AXIS_SIZE, MINOR_AXIS_SIZE);
-    increase-&gt;setSize(MINOR_AXIS_SIZE, MINOR_AXIS_SIZE);
-
-} // end ScrollBar::ScrollBar
-
-// reset
-//---------------------------------------------------------------------------
-void ScrollBar::reset()
-{
-    blockIncrement = DEFAULT_BLOCK_INCREMENT;
-    minimum        = DEFAULT_MINIMUM;
-    maximum        = DEFAULT_MAXIMUM;
-    orientation    = VERTICAL;
-    value          = DEFAULT_VALUE;
-    unitIncrement  = DEFAULT_UNIT_INCREMENT;
-    viewableAmount = 0;
-    percent        = 0.0f;
-
-} // end reset
-
-// setLocation
-//---------------------------------------------------------------------------
-void ScrollBar::setLocation()
-{
-    if (parent != 0) {
-        if (orientation == HORIZONTAL) {
-            // MINOR_AXIS_SIZE * 2 is room for the click buttons.
-            position.x = ((View *) parent)-&gt;getClientRect().min.x + MINOR_AXIS_SIZE;
-            position.y = ((View *) parent)-&gt;getClientRect().max.y - MINOR_AXIS_SIZE;
-        } else if (orientation == VERTICAL) {
-            // MINOR_AXIS_SIZE * 2 is room for the click buttons.
-            position.x = ((View *) parent)-&gt;getClientRect().max.x - MINOR_AXIS_SIZE;
-            position.y = ((View *) parent)-&gt;getClientRect().min.y + MINOR_AXIS_SIZE;
-        } else {
-            assert(false);
-        }
-    }
-
-} // end ScrollBar::setLocation
-
-// setSize
-//---------------------------------------------------------------------------
-void ScrollBar::setSize()
-{
-    if (parent != 0) {
-        if (orientation == HORIZONTAL) {
-            // MINOR_AXIS_SIZE * 2 is room for the click buttons.
-            size.x = ((View *) parent)-&gt;getClientRect().getSizeX() - MINOR_AXIS_SIZE * 2;
-            size.y = MINOR_AXIS_SIZE;
-        } else if (orientation == VERTICAL) {
-            // MINOR_AXIS_SIZE * 2 is room for the click buttons.
-            size.x = MINOR_AXIS_SIZE;
-            size.y = ((View *) parent)-&gt;getClientRect().getSizeY() - MINOR_AXIS_SIZE * 2;
-
-        } else {
-            assert(false);
-        }
-    }
-
-} // end ScrollBar::setSize
-
-// draw
-//---------------------------------------------------------------------------
-void ScrollBar::draw(Surface &amp;dest)
-{
-    setLocation();
-    setSize();
-
-    // Set the button locations.
-    if (orientation == VERTICAL) {
-        decrease-&gt;setLocation(position.x, position.y - MINOR_AXIS_SIZE);
-        increase-&gt;setLocation(position.x, position.y + MINOR_AXIS_SIZE);
-    } else if (orientation == HORIZONTAL) {
-        decrease-&gt;setLocation(position.x - MINOR_AXIS_SIZE, position.y);
-        increase-&gt;setLocation(position.x + MINOR_AXIS_SIZE, position.y);
-    } else {
-        assert(false);
-    }
-
-    // Draw the value indicator bar.
-    if (enabled) {
-        iXY drawMin;
-
-        if (orientation == VERTICAL) {
-            drawMin.x = dest.getWidth() - size.x;
-            drawMin.y = MINOR_AXIS_SIZE;
-
-        } else if (orientation == HORIZONTAL) {
-            drawMin.x = MINOR_AXIS_SIZE;
-            drawMin.y = dest.getHeight() - size.y;
-        } else {
-            assert(false);
-        }
-
-        iRect r(drawMin, drawMin + size);
-
-        surface.setTo(dest, r);
-        //surface.fill(Color::gray128);
-        //surface.shade(Color::white);
-
-        //surface.drawButtonBorder(Color::gray192, Color::gray64);
-        if (orientation == VERTICAL) {
-            int midHandlePos = (int) (float(size.y) * percent);
-
-            r = iRect(0, midHandlePos, size.x, midHandlePos);
-            surface.fillRect(r, Color::gray128);
-            surface.drawButtonBorder(r, Color::gray64, Color::gray192);
-
-        } else if (orientation == HORIZONTAL) {
-            int midHandlePos = (int) (float(size.x) * percent);
-
-            r = iRect(midHandlePos, 0, midHandlePos, size.y);
-            surface.fillRect(r, Color::gray128);
-            surface.drawButtonBorder(r, Color::gray64, Color::gray192);
-
-        } else {
-            assert(false);
-        }
-
-        // Draw the top click button.
-        //Surface shit;
-        //
-        //r = iRect(0, 0, MINOR_AXIS_SIZE, MINOR_AXIS_SIZE);
-        //shit.setTo(surface, r);
-        //shit.fill(Color::gray128);
-        //shit.drawButtonBorder(Color::gray64, Color::gray192);
-        //iXY shitCenter(shit.getPix() / 2);
-        //
-        //if (orientation == VERTICAL)
-        //{
-        //	shit.drawHLine(shitCenter.x - 3, shitCenter.y + 0, shitCenter.x + 3, Color::black);
-        //	shit.drawHLine(shitCenter.x - 2, shitCenter.y - 1, shitCenter.x + 2, Color::black);
-        //	shit.drawHLine(shitCenter.x - 1, shitCenter.y - 2, shitCenter.x + 1, Color::black);
-        //	shit.drawHLine(shitCenter.x - 0, shitCenter.y - 3, shitCenter.x + 0, Color::black);
-        //}
-        //else if (orientation== HORIZONTAL)
-        //{
-        //	shit.drawVLine(shitCenter.x - 0, shitCenter.y - 0, shitCenter.y + 0, Color::black);
-        //	shit.drawVLine(shitCenter.x - 1, shitCenter.y - 1, shitCenter.y + 1, Color::black);
-        //	shit.drawVLine(shitCenter.x - 2, shitCenter.y - 2, shitCenter.y + 2, Color::black);
-        //	shit.drawVLine(shitCenter.x - 3, shitCenter.y - 3, shitCenter.y + 3, Color::black);
-        //} else
-        //{
-        //	assert(false);
-        //}
-        //
-        //// Draw the bottom click button.
-        //if (orientation == VERTICAL)
-        //{
-        //	r = iRect(0, size.y, size.x, size.y + MINOR_AXIS_SIZE);
-        //}
-        //else if (orientation == HORIZONTAL)
-        //{
-        //	r = iRect(size.x, 0, size.x + MINOR_AXIS_SIZE, MINOR_AXIS_SIZE);
-        //} else
-        //{
-        //	assert(false);
-        //}
-        //
-        //
-        //shit.setTo(surface, r);
-        //shit.fill(Color::gray128);
-        //shit.drawButtonBorder(Color::gray64, Color::gray192);
-        //
-        //if (orientation == VERTICAL)
-        //{
-        //	shit.drawHLine(shitCenter.x - 3, shitCenter.y + 0, shitCenter.x + 3, Color::black);
-        //	shit.drawHLine(shitCenter.x - 2, shitCenter.y + 1, shitCenter.x + 2, Color::black);
-        //	shit.drawHLine(shitCenter.x - 1, shitCenter.y + 2, shitCenter.x + 1, Color::black);
-        //	shit.drawHLine(shitCenter.x - 0, shitCenter.y + 3, shitCenter.x + 0, Color::black);
-        //}
-        //else if (orientation == HORIZONTAL)
-        //{
-        //	shit.drawVLine(shitCenter.x + 0, shitCenter.y - 0, shitCenter.y + 0, Color::black);
-        //	shit.drawVLine(shitCenter.x + 1, shitCenter.y - 1, shitCenter.y + 1, Color::black);
-        //	shit.drawVLine(shitCenter.x + 2, shitCenter.y - 2, shitCenter.y + 2, Color::black);
-        //	shit.drawVLine(shitCenter.x + 3, shitCenter.y - 3, shitCenter.y + 3, Color::black);
-        //}
-
-    } else {
-        //surface.fill(background);
-        //surface.shade(Color::red);
-    }
-
-} // end ScrollBar::draw
-
-// clicked
-//---------------------------------------------------------------------------
-void ScrollBar::actionPerformed(const mMouseEvent&amp; me)
-{
-    iXY pos = me.getPoint();
-    if (parent != 0) {
-        if (orientation == HORIZONTAL) {
-            percent = float(pos.x) / float(size.x);
-        } else if (orientation == VERTICAL) {
-            percent = float(pos.y) / float(size.y);
-        } else {
-            assert(false);
-        }
-
-        int newValue = int(percent * float(maximum - minimum -
-		       viewableAmount));
-
-        int difference = newValue - value;
-
-        // Move the bar only by the block increment.
-        if (difference &gt; blockIncrement) {
-            value += blockIncrement;
-        } else if(difference &lt; -blockIncrement) {
-            value -= blockIncrement;
-        }
-
-        // Check lower bounds.
-        if (value &gt; maximum) {
-            value = maximum;
-        }
-
-        // Check upper bounds.
-        if (value &lt; minimum) {
-            value = minimum;
-        }
-
-        enabled = true;
-
-        // This is the case where there are not enough items to fill up the scroll area.
-        if (viewableAmount &gt; (maximum - minimum)) {
-            value   = 0;
-            enabled = false;
-        }
-
-        // Recalculate the percent.
-        //percent = float(value) / float(maximum - minimum - viewableAmount);
-    }
-
-} // end ScrollBar::clicked
-
-// getValue
-//---------------------------------------------------------------------------
-int ScrollBar::getValue() const
-{
-    //float scale = ((TEXT_GAP_SPACE + CHAR_YPIX) * (maximum - minimum)) / viewableAmount;
-
-    return value;//int(percent * float(maximum - minimum - viewableAmount));
-
-} // end ScrollBar::getValue

Deleted: branches/krom/src/NetPanzer/Views/Components/ScrollBar.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/ScrollBar.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/ScrollBar.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,125 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __ScrollBar_hpp__
-#define __ScrollBar_hpp__
-
-#include &quot;Component.hpp&quot;
-#include &quot;Views/Components/View.hpp&quot;
-#include &quot;Views/Components/Button.hpp&quot;
-
-//--------------------------------------------------------------------------
-class ScrollBar : public Component
-{
-public:
-    enum Orientation {
-        HORIZONTAL, VERTICAL
-    };                          
-
-private:
-    enum { DEFAULT_BLOCK_INCREMENT =   1 };
-    enum { DEFAULT_MINIMUM         =   0 };
-    enum { DEFAULT_MAXIMUM         = 100 };
-    enum { DEFAULT_VALUE           =   0 };
-    enum { DEFAULT_UNIT_INCREMENT  =   1 };
-    enum { MINOR_AXIS_SIZE         =  12 };
-
-    int   blockIncrement;
-    int   minimum;
-    int   maximum;
-    Orientation orientation;
-    int   unitIncrement;
-    int   value;
-    int   viewableAmount; // The total number of viewable items.
-    float percent;
-
-    Button * decrease;
-    Button * increase;
-
-protected:
-    void clicked(const iXY &amp;pos);
-    void setSize();
-    void setLocation();
-    void reset();
-
-public:
-    ScrollBar();
-    ScrollBar(Orientation orientation);
-    ScrollBar(Orientation orientation, int value, int visible, int minimum, int maximum);
-    virtual ~ScrollBar()
-    {}
-
-    int getBlockIncrement() const
-    {
-        return blockIncrement;
-    }
-    int getMaximum() const
-    {
-        return maximum;
-    }
-    int getMinimum() const
-    {
-        return minimum;
-    }
-    int getOrientation() const
-    {
-        return orientation;
-    }
-    int getUnitIncrement() const
-    {
-        return unitIncrement;
-    }
-    int getViewableAmount() const
-    {
-        return viewableAmount;
-    }
-    int getValue() const;
-
-    void setBlockIncrement(int blockIncrement)
-    {
-        ScrollBar::blockIncrement = blockIncrement;
-    }
-    void setMaximum(int maximum)
-    {
-        ScrollBar::maximum = maximum;
-    }
-    void setMinimum(int minimum)
-    {
-        ScrollBar::minimum = minimum;
-    }
-    void setOrientation(Orientation orientation)
-    {
-        ScrollBar::orientation = orientation;
-    }
-    void setUnitIncrement(int unitIncrement)
-    {
-        ScrollBar::unitIncrement = unitIncrement;
-    }
-    void setViewableAmount(int viewableAmount)
-    {
-        ScrollBar::viewableAmount = viewableAmount;
-    }
-
-    virtual void draw(Surface &amp;dest);
-    virtual void render()
-    {
-        
-    }
-    virtual void actionPerformed(const mMouseEvent&amp; me);
-}; // end ScrollBar
-
-#endif // end __ScrollBar_hpp__

Added: branches/krom/src/NetPanzer/Views/Components/Slider.cpp
===================================================================
--- branches/krom/src/NetPanzer/Views/Components/Slider.cpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Views/Components/Slider.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,130 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ */
+
+#include &quot;Slider.hpp&quot;
+#include &quot;2D/Color.hpp&quot;
+#include &quot;Views/Components/MouseEvent.hpp&quot;
+
+#include &quot;Util/Log.hpp&quot;
+
+#include &lt;algorithm&gt;
+
+#include &lt;math.h&gt;
+
+Slider::Slider()
+{
+    this-&gt;min_value = 1;
+    this-&gt;max_value = 100;
+    this-&gt;value = 1;
+    this-&gt;setSize(106, 8);
+}
+
+Slider::~Slider()
+{
+
+}
+
+void Slider::setSize(int x, int y)
+{
+    Component::setSize(x, 8);
+
+    if ( y &gt; 8 )
+    {
+        int to_move = (y - 8) / 2;
+        setLocation( position.x, position.y + to_move);
+    }
+
+    update_step_rate();
+    update_selector_position();
+}
+
+void Slider::draw(Surface &amp;dest)
+{
+    iRect r;
+    getBounds(r);
+
+    r.min.y += 2;
+    r.min.x += 2;
+    r.max.y -= 3;
+    r.max.x -= 3;
+    dest.drawRect(r, Color::gray64);
+
+    ++r.min.y;
+    ++r.min.x;
+    dest.fillRect(r, Color::chartreuse);
+
+    r.min.y -= 3;
+    r.min.x -= 3;
+    r.max.y += 2;
+//    r.max.x += 2;
+
+    r.min.x += selector_position-1; // XXX why -1?
+    r.max.x = r.min.x + 6;
+
+    dest.drawRect(r, Color::gray64);
+
+    ++r.min.y;
+    ++r.min.x;
+    dest.fillRect(r, Color::chartreuse);
+
+}
+
+void Slider::actionPerformed(const mMouseEvent &amp;me)
+{
+    if ( me.getID() == mMouseEvent::MOUSE_EVENT_PRESSED
+        || me.getID() == mMouseEvent::MOUSE_EVENT_DRAGGED )
+    {
+        iRect r;
+        getBounds(r);
+
+        int pressy = me.getY() - r.min.y;
+
+        LOGGER.info(&quot;pressed in y: %d&quot;, pressy);
+        if ( pressy &gt;= 0 &amp;&amp; pressy &lt; 8 )
+        {
+            int pressx = me.getX() - r.min.x - 2;
+            LOGGER.info(&quot;pressed in x: %d, rate is %f&quot;, pressx, step_rate);
+            int val = round(pressx / step_rate); // XXX double to int conversion
+            setValue(val+min_value);
+            LOGGER.info(&quot;Setted new value to: %d&quot;, this-&gt;value);
+            changed();
+        }
+    }
+}
+
+void Slider::setMax(int max_value)
+{
+    this-&gt;max_value = max_value;
+    update_step_rate();
+    update_selector_position();
+}
+
+void Slider::setMin(int min_value)
+{
+    this-&gt;min_value = min_value;
+    update_step_rate();
+    update_selector_position();
+}
+
+int Slider::setValue(int value)
+{
+    this-&gt;value = std::min(std::max(min_value, value), max_value);
+    update_selector_position();
+    return this-&gt;value;
+}

Added: branches/krom/src/NetPanzer/Views/Components/Slider.hpp
===================================================================
--- branches/krom/src/NetPanzer/Views/Components/Slider.hpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Views/Components/Slider.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,60 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ */
+#ifndef SLIDER_HPP
+#define SLIDER_HPP
+
+#include &quot;Views/Components/Component.hpp&quot;
+#include &quot;Util/MinSignal.hpp&quot;
+
+class Slider : public Component
+{
+protected:
+    virtual void draw(Surface &amp;dest);
+    virtual void actionPerformed(const mMouseEvent &amp;me);
+
+public:
+    Slider();
+    virtual ~Slider();
+
+    MinSignal changed;
+
+    void setMin(int min_value);
+    void setMax(int max_value);
+
+    int setValue(int value);
+    int getValue() const { return value; }
+
+    virtual void setSize(int x, int y);
+
+private:
+    int min_value;
+    int max_value;
+    int value;
+
+    // total size is size-6, that is because there are 3 extra pixels left and right
+    // note that all the range has 1 element less, this is the correct way.
+
+    void update_step_rate() { step_rate = (float)(size.x-6) / (max_value - min_value); }
+    float step_rate;
+
+    void update_selector_position() { selector_position = (value-min_value) * step_rate; } // XXX float to int conversion
+    int selector_position;
+};
+
+#endif // SLIDER_HPP

Deleted: branches/krom/src/NetPanzer/Views/Components/StateChangedCallback.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/StateChangedCallback.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/StateChangedCallback.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,33 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __LIBVIEW_STATECHANGEDCALLBACK_HPP__
-#define __LIBVIEW_STATECHANGEDCALLBACK_HPP__
-
-class Component;
-
-class StateChangedCallback
-{
-public:
-	virtual ~StateChangedCallback()
-	{ }
-
-    virtual void stateChanged(Component* source) = 0;
-};
-
-#endif
-

Modified: branches/krom/src/NetPanzer/Views/Components/View.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/View.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/View.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -73,15 +73,8 @@
 //---------------------------------------------------------------------------
 View::~View()
 {
-    std::vector&lt;cButton*&gt;::iterator i;
-    for(i = buttons.begin(); i != buttons.end(); i++) {
-        delete *i;
-    }
-    std::vector&lt;cInputField*&gt;::iterator f;
-    for(f = inputFields.begin(); f != inputFields.end(); f++) {
-        delete *f;
-    }
-    
+    removeComponents();
+
     free(title);
     free(subTitle);
     free(searchName);
@@ -96,11 +89,6 @@
     min.zero();
     max.zero();
     status                =  0;
-    pressedButton         = -1;
-    prevPressedButton     = -1;
-    highlightedButton     = -1;
-    prevHighlightedButton = -1;
-    selectedInputField    = -1;
     searchName            = 0;
     title                 = 0;
     subTitle              = 0;
@@ -111,8 +99,6 @@
     setTitle(&quot;donut&quot;);
     setSubTitle(&quot;donut&quot;);
 
-    //scrollBar             = 0;
-
     removeComponents();
 
     moveAreaHeight  = DEFAULT_MOVE_AREA_HEIGHT;
@@ -135,8 +121,6 @@
 //---------------------------------------------------------------------------
 void View::drawBorder(Surface &amp;viewArea)
 {
-    assert(this != 0);
-    
     viewArea.drawWindowsBorder();
 } // end drawBorder
 
@@ -348,11 +332,43 @@
         return;
 
     currentscreen = &surface; // hack
-    Surface* viewarea = getViewArea(surface);
-    Surface* clientarea = getClientArea(surface);
-    doDraw(*viewarea, *clientarea);
-    delete viewarea;
-    delete clientarea;
+    Surface* viewArea = getViewArea(surface);
+    Surface* clientArea = getClientArea(surface);
+
+    if ( backgroundColor != NoColor )
+    {
+        viewArea-&gt;fill( backgroundColor );
+    }
+
+    if (getShowStatus())
+    {
+        drawStatus(*clientArea);
+    }
+
+    // Draw all non-selected components.
+    ComponentsIterator i;
+    for ( i=components.begin(); i != components.end(); i++)
+    {
+        if (*i != focusComponent)
+        {
+            (*i)-&gt;draw(*clientArea);
+        }
+    }
+
+    // Now draw the selected component.
+    if (focusComponent != 0)
+    {
+        focusComponent-&gt;draw(*clientArea);
+    }
+
+    if (getBordered())
+    {
+        drawTitle(*viewArea);
+        drawBorder(*viewArea);
+    }
+
+    delete viewArea;
+    delete clientArea;
 } // end draw
 
 // activate
@@ -385,47 +401,8 @@
     setActive(false);
 
     doDeactivate();
-
-    highlightedButton     = -1;
-    prevHighlightedButton = -1;
-    selectedInputField    = -1;
-
 } // end View::deactivate
 
-// doDraw
-//---------------------------------------------------------------------------
-// Purpose: Default implementation - draws all the componentList of the window.
-//---------------------------------------------------------------------------
-void View::doDraw(Surface &amp;viewArea, Surface &amp;clientArea)
-{
-    if (getShowStatus()) {
-        drawStatus(clientArea);
-    }
-
-    drawDefinedButtons(clientArea);
-    drawInputFields(clientArea);
-    drawHighlightedButton(clientArea);
-    drawPressedButton(clientArea);
-
-    // Draw all non-selected components.
-    ComponentsIterator i;
-    for ( i=components.begin(); i != components.end(); i++) {
-        if (*i != focusComponent) {
-            (*i)-&gt;draw(clientArea);
-        }
-    }
-
-    // Now draw the selected component.
-    if (focusComponent != 0) {
-        focusComponent-&gt;draw(clientArea);
-    }
-
-    if (getBordered()) {
-        drawTitle(viewArea);
-        drawBorder(viewArea);
-    }
-} // end View::doDraw
-
 // doActivate
 //---------------------------------------------------------------------------
 // Purpose: Default Implementation -
@@ -467,72 +444,6 @@
     }
 } // end View::doDeactivate
 
-// getMouseActions
-//---------------------------------------------------------------------------
-// Purpose: Find the actions associated with the position of the mouse arrow
-//          cursor in the window.
-//---------------------------------------------------------------------------
-int View::getMouseActions(const iXY &amp;pos) const
-{
-    assert(this != 0);
-
-    int actions = 0;
-
-    if (!getVisible() || !getActive()) {
-        return actions;
-    }
-
-    if (!getBordered()) {
-        return actions;
-    }
-
-    if (getResize()) {
-        // Now lets check for a window resize
-        iXY minOff;
-        iXY maxOff;
-
-        minOff.x = abs(pos.x); maxOff.x = abs(pos.x - getSizeX());
-        minOff.y = abs(pos.y); maxOff.y = abs(pos.y - getSizeY());
-
-        // Check the left,  then the right
-        if      (minOff.x &lt; RESIZE_XMIN) actions |= MA_RESIZE_LEFT;
-        else if (maxOff.x &lt; RESIZE_XMIN) actions |= MA_RESIZE_RIGHT;
-
-        // Check the top, then the bottom
-        if      (minOff.y &lt; RESIZE_YMIN) actions |= MA_RESIZE_TOP;
-        else if (maxOff.y &lt; RESIZE_YMIN) actions |= MA_RESIZE_BOTTOM;
-
-        // If a left or right was turned on, then give more area for selecting the
-        // resize area
-        if (actions &amp; (MA_RESIZE_LEFT | MA_RESIZE_RIGHT)) {
-            if      (minOff.y &lt; RESIZE_YMAX) actions |= MA_RESIZE_TOP;
-            else if (maxOff.y &lt; RESIZE_YMAX) actions |= MA_RESIZE_BOTTOM;
-        }
-
-        if (actions &amp; (MA_RESIZE_TOP | MA_RESIZE_BOTTOM)) {
-            if      (minOff.x &lt; RESIZE_XMAX) actions |= MA_RESIZE_LEFT;
-            else if (maxOff.x &lt; RESIZE_XMAX) actions |= MA_RESIZE_RIGHT;
-        }
-    }
-
-    // Check for moving the window via the move area.
-    if (getAllowMove()) {
-        //iRect titleBar(borderSize, borderSize, getSizeX()-borderSize, borderSize + moveAreaHeight);
-        iRect titleBar(borderSize, borderSize, getSizeX() - borderSize, borderSize + moveAreaHeight);
-        if (titleBar.contains(pos)) return actions |= MA_MOVE;
-    }
-
-    // Check for moving the window via the status bar.
-    //if (getAllowMove())
-    //{
-    //	//iRect titleBar(borderSize, borderSize, getSizeX()-borderSize, borderSize + moveAreaHeight);
-    //	iRect titleBar(borderSize, getSizeY() - borderSize - DEFAULT_STATUS_BAR_HEIGHT, getSizeX() - borderSize, getSizeY() - borderSize);
-    //	if (titleBar.contains(pos)) return actions |= MA_MOVE;
-    //}
-
-    return actions;
-} // end getMouseActions
-
 // getScreenToClientPos
 //---------------------------------------------------------------------------
 // Purpose: Finds the position of the mouse in the client area of a window.
@@ -623,9 +534,6 @@
 //---------------------------------------------------------------------------
 void View::mouseMove(const iXY &amp; prevPos, const iXY &amp;newPos)
 {
-    prevHighlightedButton = highlightedButton;
-    highlightedButton     = findButtonContaining(newPos);
-
     // Check all components for a clicked event.
     ComponentsIterator i;
     for ( i=components.begin(); i != components.end(); i++)
@@ -673,15 +581,6 @@
 //---------------------------------------------------------------------------
 void View::lMouseDown(const iXY &amp;pos)
 {
-    if (pressedButton &lt; 0) {
-        prevPressedButton = pressedButton;
-        pressedButton     = findButtonContaining(pos);
-    }
-
-    if (selectedInputField &lt; 0) {
-        selectedInputField = findInputFieldContaining(pos);
-    }
-
     focusComponent = 0;
 
     // Check all components for a pressed event.
@@ -703,24 +602,8 @@
 
 // lMouseUp
 //---------------------------------------------------------------------------
-int View::lMouseUp(const iXY &amp;downPos, const iXY &amp;upPos)
+void View::lMouseUp(const iXY &amp;downPos, const iXY &amp;upPos)
 {
-    Desktop::resetMouseActionOffset();
-
-    if (pressedButton == findButtonContaining(upPos)) {
-        if (pressedButton &gt;= 0) {
-            //if (mouse.getCurButton() &amp; 0)
-            if (buttons[pressedButton]-&gt;leftClickFunc != 0)
-                buttons[pressedButton]-&gt;leftClickFunc();
-            else
-            if (buttons[pressedButton]-&gt;rightClickFunc != 0)
-                buttons[pressedButton]-&gt;rightClickFunc();
-        }
-    }
-
-    prevPressedButton = pressedButton;
-    pressedButton     = -1;
-
     // Check all components for a clicked event.
     {    
         ComponentsIterator i;
@@ -733,7 +616,8 @@
 
                 actionPerformed(me);
             }
-        }}
+        }
+    }
 
     // Report a mouse release to all components except for a clicked one.
     {    
@@ -747,12 +631,8 @@
 
                 actionPerformed(me);
             }
-        }}
-
-    // I added this so I can tell if a button was pressed when
-    // the mouse button is let up.
-    return prevPressedButton;
-
+        }
+    }
 } // end View::lMouseUp
 
 // lMouseDrag
@@ -934,108 +814,6 @@
 
 } // end View::mouseExit
 
-// scrollBarMove
-//---------------------------------------------------------------------------
-// Purpose:
-//---------------------------------------------------------------------------
-void View::scrollBarMove(const iXY &amp;prevPos, const iXY &amp;newPos)
-{
-    (void) prevPos;
-    (void) newPos;
-    //if (scrollBar != 0)
-    //{
-    //	scrollBar-&gt;actionPerformed(newPos);
-    //}
-} // end scrollBarMove
-
-
-// drawDefinedButtons
-//---------------------------------------------------------------------------
-// Purpose:
-//---------------------------------------------------------------------------
-void View::drawDefinedButtons(Surface &amp;clientArea)
-{
-    std::vector&lt;cButton*&gt;::iterator i;
-    for(i = buttons.begin(); i != buttons.end(); i++) {
-        cButton* button = *i;
-        button-&gt;topSurface.blt(clientArea, button-&gt;getBounds().min);
-    }
-} // end drawDefinedButtons
-
-// drawInputFields
-//---------------------------------------------------------------------------
-// Purpose:
-//---------------------------------------------------------------------------
-void View::drawInputFields(Surface &amp;clientArea)
-{
-    for (size_t num = 0; num &lt; inputFields.size(); num++) {
-        if (num == (size_t) selectedInputField) {
-            inputFields[num]-&gt;drawHighlighted(clientArea);
-        } else {
-            inputFields[num]-&gt;draw(clientArea);
-        }
-    }
-} // end drawInputFields
-
-// drawHighlightedButton
-//---------------------------------------------------------------------------
-// Purpose: Draws the correct image frame for the currently highlighted button.
-//---------------------------------------------------------------------------
-void View::drawHighlightedButton(Surface &amp;clientArea)
-{
-    assert(this != 0);
-
-    if (highlightedButton &lt; 0) {
-        return;
-    } else if (buttons[highlightedButton]-&gt;topSurface.getFrameCount() &lt; 2) {
-        cButton* button = buttons[highlightedButton];
-        clientArea.drawRect(iRect(button-&gt;getBounds().min.x,
-                                  button-&gt;getBounds().min.y,
-                                  button-&gt;getBounds().max.x,
-                                  button-&gt;getBounds().max.y),
-                            Color::red);
-        return;
-    }
-
-    if (pressedButton == highlightedButton) {
-        return;
-    }
-
-    if (highlightedButton &gt; (int) buttons.size()) {
-        throw Exception(&quot;ERROR: highlightedButton &gt; butons.getCount()&quot;);
-    }
-
-    // Change to the highlight button frame.
-    buttons[highlightedButton]-&gt;topSurface.setFrame(1);
-    buttons[highlightedButton]-&gt;topSurface.blt(clientArea,
-            iXY(buttons[highlightedButton]-&gt;getBounds().min.x,
-                buttons[highlightedButton]-&gt;getBounds().min.y));
-    buttons[highlightedButton]-&gt;topSurface.setFrame(0);
-
-} // end drawHighlightedButton
-
-void View::addButtonPackedSurface(const iXY &amp;pos, PackedSurface &amp;source, const char *toolTip, ITEM_FUNC leftClickFunc)
-{
-    cButton* button = new cButton;
-    button-&gt;createPacked(pos, source, toolTip, leftClickFunc);
-    buttons.push_back(button);
-}
-
-// addButtonCenterText
-//---------------------------------------------------------------------------
-// Purpose: Adds a centered type button to the list of buttons.
-//---------------------------------------------------------------------------
-void View::addButtonCenterText(const iXY &amp;pos,
-                               const int &amp;xSize,
-                               const char *name,
-                               const char *toolTip,
-                               ITEM_FUNC leftClickFunc)
-{
-    cButton* button = new cButton;
-    button-&gt;createCenterText(pos, xSize, name, toolTip, leftClickFunc);
-    buttons.push_back(button);
-} // end addButtonCenterText
-
 // setSearchName
 //---------------------------------------------------------------------------
 // Purpose: Sets the title of the window.
@@ -1135,61 +913,6 @@
     }
 } // end View::drawStatus
 
-// findButtonContaining
-//---------------------------------------------------------------------------
-// Purpose: Finds the button containing the position of the mouse.  The
-//          button are bounded relative to the window, so make sure to make
-//          the mouse position relative to the window before calling this.
-//---------------------------------------------------------------------------
-int View::findButtonContaining(const iXY &amp;pos)
-{
-    assert(this != 0);
-
-    for (size_t num = 0; num &lt; buttons.size(); num++) {
-        if (buttons[num]-&gt;contains(pos)) {
-            //LOG((&quot;pressed button: %u&quot;, num));
-            return num;
-        }
-    }
-    return -1;
-} // end findButtonContaining
-
-// findInputFieldContaining
-//---------------------------------------------------------------------------
-// Purpose:
-//---------------------------------------------------------------------------
-int View::findInputFieldContaining(const iXY &amp;pos)
-{
-    assert(this != 0);
-
-    for(size_t num = 0; num &lt; inputFields.size(); num++) {
-        if (inputFields[num]-&gt;contains(pos)) {
-            return num;
-        }
-    }
-    return -1;
-} // end findInputFieldContaining
-
-// drawPressedButton
-//---------------------------------------------------------------------------
-// Purpose: Draws the selected button.
-//---------------------------------------------------------------------------
-void View::drawPressedButton(Surface &amp;clientArea)
-{
-    assert(this != 0);
-
-    if (pressedButton &lt; 0 || buttons[pressedButton]-&gt;topSurface.getFrameCount() &lt; 2) return;
-    if (highlightedButton != pressedButton) return;
-    assert(pressedButton &lt; (int) buttons.size());
-
-    // Chage to the highlight button frame.
-    buttons[pressedButton]-&gt;topSurface.setFrame(2);
-    buttons[pressedButton]-&gt;topSurface.blt(clientArea,
-            iXY(buttons[pressedButton]-&gt;getBounds().min.x,
-                buttons[pressedButton]-&gt;getBounds().min.y));
-    buttons[pressedButton]-&gt;topSurface.setFrame(0);
-} // drawPressedButton
-
 // checkResolution
 //---------------------------------------------------------------------------
 // Purpose: Check position after resolution change
@@ -1248,30 +971,6 @@
     max = min + destSize;
 } // end View::resize
 
-// setPressedButton
-//---------------------------------------------------------------------------
-void View::setPressedButton(const int &amp;button)
-{
-    if (button &gt;= (int) buttons.size()) {
-        throw Exception(&quot;ERROR: pressedButton &gt;= numButtons&quot;);
-    }
-
-    prevPressedButton = pressedButton;
-    pressedButton     = button;
-} // end setPressedButton
-
-// setHighlightedButton
-//---------------------------------------------------------------------------
-void View::setHighlightedButton(const int &amp;button)
-{
-    if (button &gt;= (int) buttons.size()) {
-        throw Exception(&quot;ERROR: highlightedButton &gt;= numButtons&quot;);
-    }
-
-    prevHighlightedButton = highlightedButton;
-    highlightedButton     = button;
-} // end setHighlightedButton
-
 // moveTo
 //---------------------------------------------------------------------------
 // Purpose: Move the window to the specified position, while making sure the
@@ -1365,53 +1064,4 @@
 //---------------------------------------------------------------------------
 void View::processEvents(void)
 {
-    if (selectedInputField &gt;= 0) {
-        int shit;
-        while (KeyboardInterface::getChar(shit)) {
-            // Check for extended code.
-            if (shit == 0) {
-                if (KeyboardInterface::getChar(shit)) {
-                    inputFields[selectedInputField]-&gt;addExtendedChar(shit);
-                } else {
-                    throw Exception(&quot;ERROR: Expecting extended char code.&quot;);
-                }
-            } else {
-                inputFields[selectedInputField]-&gt;addChar(shit);
-            }
-        }
-    }
 } // end processEvents
-
-// addInputField
-//---------------------------------------------------------------------------
-cInputField* View::addInputField(
-    const iXY &amp;pos,
-    cInputFieldString *string,
-    const char *excludedCharacters,
-    const bool &amp;isSelected)
-{
-    cInputField* inputfield = new cInputField;
-
-    inputfield-&gt;setPos(pos);
-    inputfield-&gt;setInputFieldString(string);
-    inputfield-&gt;setExcludedCharacters(excludedCharacters);
-
-    inputFields.push_back(inputfield);
-
-    if (isSelected) {
-        selectedInputField = inputFields.size() - 1;
-    }
-
-    return inputfield;
-} // end addInputField
-
-//---------------------------------------------------------------------------
-void View::add(DEFAULT_VIEW_BUTTON button)
-{
-    if (button == CLOSE_VIEW_BUTTON) {}
-    else if (button == MINMAX_VIEW_BUTTON) {}
-    else {
-        assert(false);
-    }
-}
-

Modified: branches/krom/src/NetPanzer/Views/Components/View.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/View.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/View.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -19,14 +19,13 @@
 #ifndef __View_hpp__
 #define __View_hpp__
 
-#include &quot;cButton.hpp&quot;
 #include &quot;2D/Surface.hpp&quot;
 #include &quot;2D/PackedSurface.hpp&quot;
-#include &quot;cInputField.hpp&quot;
 #include &quot;Types/iRect.hpp&quot;
 #include &quot;Types/iXY.hpp&quot;
 #include &quot;Component.hpp&quot;
 #include &quot;MouseEvent.hpp&quot;
+#include &quot;Core/CoreTypes.hpp&quot;
 
 #include &lt;list&gt;
 
@@ -43,8 +42,9 @@
     friend class Desktop;
 public:
     void add(Component *Component);
-    void add(DEFAULT_VIEW_BUTTON button);
 
+    bool isVisible() const { return status &amp; STATUS_VISIBLE; }
+
 public:
     typedef list&lt;Component *&gt; ComponentList;
     typedef ComponentList::iterator ComponentsIterator;
@@ -53,47 +53,16 @@
     
     Component *focusComponent;
 
-    std::vector&lt;cButton*&gt;     buttons;
-    std::vector&lt;cInputField*&gt; inputFields;
+    void setBackgroundColor( ColorType c ) { backgroundColor = c; }
 
-    enum
-    {
-        MAX_WINDOW_CLIENT_XSIZE = 632
-    };
-    enum
-    {
-        MAX_WINDOW_CLIENT_YSIZE = 458
-    };
-
-    int getPressedButton()
-    {
-        return pressedButton;
-    }
-    int getPrevPressedButton()
-    {
-        return prevPressedButton;
-    }
-    int getHighlightedButton()
-    {
-        return highlightedButton;
-    }
-    int getPrevHighlightedButton()
-    {
-        return prevHighlightedButton;
-    }
-
 protected:
+    ColorType        backgroundColor;
+
     virtual void     actionPerformed(mMouseEvent )
     {}
     Surface*         getViewArea(Surface&amp; dest);
     virtual Surface* getClientArea(Surface&amp; dest);
 
-    int              pressedButton;
-    int              prevPressedButton;
-    int              highlightedButton;
-    int              prevHighlightedButton;
-
-    int              selectedInputField;
     char            *searchName;
     char            *title;
     char            *subTitle;
@@ -101,9 +70,6 @@
 
     char            *statusText;
 
-    enum { RESIZE_XMINSIZE = 15 };
-    enum { RESIZE_YMINSIZE = 15 };
-
     // Status items
     enum { STATUS_ACTIVE             = (1U &lt;&lt; 0) };
     enum { STATUS_VISIBLE            = (1U &lt;&lt; 1) };
@@ -114,21 +80,6 @@
     enum { STATUS_DISPLAY_STATUS_BAR = (1U &lt;&lt; 6) };
     enum { STATUS_SCROLL_BAR         = (1U &lt;&lt; 7) };
 
-    // Mouse actions
-    enum { MA_RESIZE_TOP    = (1U &lt;&lt;  0) };
-    enum { MA_RESIZE_LEFT   = (1U &lt;&lt;  1) };
-    enum { MA_RESIZE_BOTTOM = (1U &lt;&lt;  2) };
-    enum { MA_RESIZE_RIGHT  = (1U &lt;&lt;  3) };
-    enum { MA_MOVE          = (1U &lt;&lt;  4) };
-    enum { MA_CLOSE         = (1U &lt;&lt;  5) };
-    enum { MA_MINIMIZE      = (1U &lt;&lt;  6) };
-    enum { MA_MAXIMIZE      = (1U &lt;&lt;  7) };
-    enum { MA_RESTORE       = (1U &lt;&lt;  8) };
-    enum { MA_IMAGE_TILES   = (1U &lt;&lt;  9) };
-    enum { MA_SCROLL_BAR    = (1U &lt;&lt; 10) };
-    enum { MA_MOUSE_ENTER   = (1U &lt;&lt; 11) };
-    enum { MA_MOUSE_EXIT    = (1U &lt;&lt; 12) };
-
     void        reset     ();
     void        activate  ();
     void        deactivate();
@@ -144,17 +95,10 @@
     void setActive          (const bool &amp;newStatus);
     //void setScrollBar       (const bool &amp;newStatus);
 
-    // Scroll bar functions.
+    // cButton Functions. XXX remove them
+    void addButtonPackedSurface(const iXY &amp;pos, PackedSurface &amp;source, const char *toolTip, ITEM_FUNC leftClickFunc){};
+    void addButtonCenterText(const iXY &amp;pos, const int &amp;xSize, const char *nName, const char *nToolTip, ITEM_FUNC nLeftClickFunc){};
 
-    // cButton Functions.
-    void addButtonPackedSurface(const iXY &amp;pos, PackedSurface &amp;source, const char *toolTip, ITEM_FUNC leftClickFunc);
-    void addButtonCenterText(const iXY &amp;pos, const int &amp;xSize, const char *nName, const char *nToolTip, ITEM_FUNC nLeftClickFunc);
-    /*!FIXME!*/ void drawDefinedButtons   (Surface &amp;clientArea);
-    void drawHighlightedButton(Surface &amp;clientArea);
-    void drawPressedButton(Surface &amp;clientArea);
-    void setPressedButton(const int &amp;cButton);
-    void setHighlightedButton(const int &amp;cButton);
-    int  findButtonContaining(const iXY &amp;pos);
 
     // SearchName, Title, and SubTitle functions.
     void  setSearchName(const char *searchName);
@@ -162,11 +106,6 @@
     void  setSubTitle(const char *subTitle);
     void  drawTitle(Surface &amp;windowArea);
 
-    // Input Field Functions
-    cInputField* addInputField(const iXY &amp;pos, cInputFieldString *string, const char *excludedCharacters, const bool &amp;isSelected);
-    int  findInputFieldContaining(const iXY &amp;pos);
-    void drawInputFields(Surface &amp;clientArea);
-
     /////////////////////////////////
     void draw(Surface&amp; drawon);
     void showStatus(const char *string);
@@ -179,13 +118,12 @@
     /////////////////////////////////
 
     // These options can be modified on a per View type basis
-    virtual void drawBorder(Surface &amp;windowArea);
-    virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
+    void drawBorder(Surface &amp;windowArea);
     virtual void doActivate();
     virtual void doDeactivate();
     virtual void mouseMove(const iXY &amp;prevPos, const iXY &amp;newPos);
     virtual void lMouseDown(const iXY &amp;pos);
-    virtual int  lMouseUp(const iXY &amp;downPos, const iXY &amp;upPos);
+    virtual void lMouseUp(const iXY &amp;downPos, const iXY &amp;upPos);
     virtual void lMouseDrag(const iXY &amp;downPos, const iXY &amp;prevPos, const iXY &amp;newPos);
     virtual void lMouseDouble(const iXY &amp;pos);
     virtual void rMouseDown(const iXY &amp;pos);
@@ -197,7 +135,6 @@
     virtual void mouseEnter(const iXY &amp;pos);
     virtual void mouseExit(const iXY &amp;pos);
     //virtual void keyUp();
-    void scrollBarMove(const iXY &amp;prevpos, const iXY &amp;newpos);
 
     void resize(const iXY &amp;size);
     inline void resize(const int &amp;x, const int &amp;y)
@@ -239,10 +176,7 @@
     {
         moveTo(iXY(x, y));
     }
-    void removeAllButtons()
-    {
-        buttons.clear(); // XXX LEAK
-    }
+
     void removeComponents()
     {
         ComponentsIterator i = components.begin();
@@ -303,8 +237,6 @@
         return status &amp; STATUS_SCROLL_BAR;
     }
 
-    virtual int getMouseActions(const iXY &amp;p) const;
-
     iRect getClientRect() const;
 };
 

Deleted: branches/krom/src/NetPanzer/Views/Components/cButton.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/cButton.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/cButton.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,122 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;cButton.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-#include &quot;Util/Exception.hpp&quot;
-#include &quot;2D/Color.hpp&quot;
-#include &quot;ViewGlobals.hpp&quot;
-
-
-void cButton::createPacked(const iXY &amp;pos, PackedSurface &amp;source, const char *toolTip, ITEM_FUNC leftClickFunc)
-{
-    Surface tempTopSurface(source.getWidth(), source.getHeight(), source.getFrameCount());
-
-    for (unsigned int i = 0; i &lt; tempTopSurface.getNumFrames(); i++) {
-        tempTopSurface.setFrame(i);
-        tempTopSurface.fill(0);
-        source.setFrame(i);
-        source.blt(tempTopSurface, 0, 0);
-    }
-
-    topSurface.pack(tempTopSurface);
-
-    cButton::toolTip       = strdup(toolTip); assert(toolTip != 0);
-    cButton::bounds        = iRect(pos.x, pos.y, pos.x + tempTopSurface.getWidth(), pos.y + tempTopSurface.getHeight());
-    cButton::leftClickFunc = leftClickFunc;
-}
-
-// createCenterText
-//---------------------------------------------------------------------------
-// Purpose: Creates a button with the name centered in the absolute horizontal
-//          middle of the button.
-//---------------------------------------------------------------------------
-void cButton::createCenterText(iXY pos,
-                               int xSize,
-                               const char *nName,
-                               const char *nToolTip,
-                               ITEM_FUNC nLeftClickFunc)
-{
-    Surface tempTopSurface;
-
-    const unsigned GAP_SPACE = 6;
-
-    int ySize = Surface::getFontHeight() + GAP_SPACE;
-    tempTopSurface.create(xSize, ySize, 3);
-
-    // Find out the horizontal offset to put the button name on the button.
-    int xOffset;
-    if (nName != 0) xOffset = (xSize-(Surface::getTextLength(nName)))/2;
-    else xOffset = xSize/2;
-
-    // Make the unselected button
-    tempTopSurface.fill(componentBodyColor);
-    tempTopSurface.drawButtonBorder(topLeftBorderColor, bottomRightBorderColor);
-    tempTopSurface.bltString(xOffset, GAP_SPACE/2, nName, componentInActiveTextColor);
-
-    // Make the mouse-over button
-    tempTopSurface.setFrame(1);
-    tempTopSurface.fill(componentBodyColor);
-    tempTopSurface.drawButtonBorder(topLeftBorderColor, bottomRightBorderColor);
-    tempTopSurface.bltString(xOffset, GAP_SPACE/2, nName, componentFocusTextColor);
-
-    // Make the selected button
-    tempTopSurface.setFrame(2);
-    tempTopSurface.fill(componentBodyColor);
-    tempTopSurface.drawButtonBorder(bottomRightBorderColor, topLeftBorderColor);
-    tempTopSurface.bltString(xOffset+1, GAP_SPACE/2+1, nName, componentActiveTextColor);
-
-    // Save the button name.
-    setName(nName); assert(name != 0);
-
-    // Save the button tool tip.
-    toolTip = strdup(nToolTip); assert(toolTip != 0);
-
-    // Save the bounds of the button.
-    bounds = iRect(pos.x, pos.y, pos.x+tempTopSurface.getWidth(), pos.y+tempTopSurface.getHeight());
-
-    // Save the function associated with the button.
-    leftClickFunc = nLeftClickFunc;
-
-    // Reset the button to unselected status.
-    tempTopSurface.setFrame(0);
-
-    topSurface.pack(tempTopSurface);
-
-} // end createCenterText
-
-// RESET
-//---------------------------------------------------------------------------
-void cButton::reset()
-{
-    toolTip        = 0;
-    name           = 0;
-    isSelected     = false;
-    leftClickFunc  = 0;
-    rightClickFunc = 0;
-} // end RESET
-
-// SET NAME
-//---------------------------------------------------------------------------
-void cButton::setName(const char *buttonName)
-{
-    name = strdup(buttonName);
-    if (buttonName == 0) throw Exception(&quot;ERROR: Unable to allocate button name: %s&quot;, buttonName);
-} // end SET NAME
-

Deleted: branches/krom/src/NetPanzer/Views/Components/cButton.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/cButton.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Components/cButton.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,99 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __cButton_hpp__
-#define __cButton_hpp__
-
-#include &lt;stdlib.h&gt;
-#include &quot;Types/iXY.hpp&quot;
-#include &quot;Types/iRect.hpp&quot;
-#include &quot;2D/PackedSurface.hpp&quot;
-#include &quot;Util/NoCopy.hpp&quot;
-
-class Surface;
-
-class cButton : public NoCopy
-{
-public:
-    cButton()
-    {
-        reset();
-    }
-    ~cButton()
-    {
-        if (name    != 0) free(name);
-        if (toolTip != 0) free(toolTip);
-    }
-
-    typedef void (*ITEM_FUNC)(void);
-
-    ITEM_FUNC rightClickFunc;
-    ITEM_FUNC leftClickFunc;
-    PackedSurface topSurface;
-    PackedSurface bottomSurface;
-
-    iRect getBounds    () const
-    {
-        return bounds;
-    }
-    const char *getName () const
-    {
-        return name;
-    }
-    bool  getIsSelected() const
-    {
-        return isSelected;
-    }
-    const char* getToolTip() const
-    {
-        return toolTip;
-    }
-
-    void createPacked(const iXY &amp;pos, PackedSurface &amp;source, const char *toolTip, ITEM_FUNC leftClickFunc);
-
-    void createCenterText(iXY pos, int xSize, const char *nName, const char *nToolTip, ITEM_FUNC nLeftClickFunc);
-
-    inline bool contains(iXY pos)
-    {
-        assert(this != 0);
-
-        if (	pos.x &gt;= bounds.min.x &amp;&amp;
-                pos.y &gt;=  bounds.min.y &amp;&amp;
-                pos.x &lt; bounds.max.x &amp;&amp;
-                pos.y &lt; bounds.max.y) {
-            return true;
-
-        } else {
-            return false;
-        }
-    }
-    bool   isSelected;
-
-private:
-    iRect  bounds;
-    char  *toolTip;
-    char  *name;
-
-    void  reset();
-
-protected:
-    void setName(const char *buttonName);
-
-}
-; // end cButton
-
-#endif // end __cButton_hpp__

Modified: branches/krom/src/NetPanzer/Views/Game/AreYouSureExitView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/AreYouSureExitView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -40,7 +40,7 @@
 
 // AreYouSureExitView
 //---------------------------------------------------------------------------
-AreYouSureExitView::AreYouSureExitView() : SpecialButtonView()
+AreYouSureExitView::AreYouSureExitView()
 {
     setSearchName(&quot;AreYouSureExitView&quot;);
     setTitle(&quot;Exit netPanzer&quot;);
@@ -52,8 +52,6 @@
 //---------------------------------------------------------------------------
 void AreYouSureExitView::init()
 {
-    removeAllButtons();
-
     setBordered(false);
     setAllowResize(false);
     setDisplayStatusBar(false);
@@ -63,14 +61,14 @@
 
     int x = (getClientRect().getSize().x - (141 * 2 + 20)) / 2;
     int y = screen-&gt;getHeight()/2 + 30;
-    addSpecialButton(	iXY(x, y),
-                      &quot;YES&quot;,
-                      bYES);
+//    addSpecialButton(	iXY(x, y),
+//                      &quot;YES&quot;,
+//                      bYES);
 
     x += 141 + 10;
-    addSpecialButton(	iXY(x, y),
-                      &quot;NO&quot;,
-                      bNO);
+//    addSpecialButton(	iXY(x, y),
+//                      &quot;NO&quot;,
+//                      bNO);
 
 } // end AreYouSureExitView::init
 
@@ -85,7 +83,7 @@
 
     viewArea.bltStringCenter(&quot;Are you sure you wish to exit netPanzer?&quot;, Color::white);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 } // end AreYouSureExitView::doDraw
 
 // doActivate

Modified: branches/krom/src/NetPanzer/Views/Game/AreYouSureExitView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/AreYouSureExitView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -18,11 +18,11 @@
 #ifndef __AreYouSureExitView_hpp__
 #define __AreYouSureExitView_hpp__
 
-#include &quot;Views/MainMenu/SpecialButtonView.hpp&quot;
+#include &quot;Views/Components/View.hpp&quot;
 #include &quot;2D/Surface.hpp&quot;
 
 //---------------------------------------------------------------------------
-class AreYouSureExitView : public SpecialButtonView
+class AreYouSureExitView : public View
 {
 private:
     void init();

Modified: branches/krom/src/NetPanzer/Views/Game/AreYouSureResignView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/AreYouSureResignView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -57,7 +57,7 @@
 
     // Must remove the gameView first so that the initButtons detects that
     // and loads the correct buttons.
-    Desktop::setVisibilityAllWindows(false);
+    Desktop::hideAllWindows();
     Desktop::setVisibility(&quot;MainView&quot;, true);
 
     View *v = Desktop::getView(&quot;OptionsView&quot;);
@@ -122,8 +122,6 @@
 //---------------------------------------------------------------------------
 void AreYouSureResignView::init()
 {
-    removeAllButtons();
-
     setBordered(false);
     setAllowResize(false);
     setDisplayStatusBar(false);
@@ -155,7 +153,7 @@
 
     viewArea.bltStringCenter(&quot;Are you sure you wish to Resign?&quot;, Color::white);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 } // end AreYouSureResignView::doDraw
 
 // doActivate

Modified: branches/krom/src/NetPanzer/Views/Game/CodeStatsView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/CodeStatsView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/CodeStatsView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -184,7 +184,7 @@
 
     clientArea.bltString(2, INFO_AREA_Y_OFFSET - 18, strBuf, Color::white);
     */
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 
 } // end CodeStatsView::doDraw
 

Modified: branches/krom/src/NetPanzer/Views/Game/DisconectedView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/DisconectedView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -57,7 +57,7 @@
 
     // Must remove the gameView first so that the initButtons detects that
     // and loads the correct buttons.
-    Desktop::setVisibilityAllWindows(false);
+    Desktop::hideAllWindows();
     Desktop::setVisibility(&quot;MainView&quot;, true);
 
     View *v = Desktop::getView(&quot;OptionsView&quot;);
@@ -114,8 +114,6 @@
 void
 DisconectedView::init()
 {
-    removeAllButtons();
-
     setBordered(true);
     setAllowResize(false);
 
@@ -136,7 +134,7 @@
     viewArea.bltLookup(r, Palette::darkGray256.getColorArray());
     viewArea.bltStringCenter(disconectMsg.c_str(), Color::white);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 }
 
 void

Modified: branches/krom/src/NetPanzer/Views/Game/GameView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/GameView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/GameView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -133,7 +133,7 @@
     // Make sure the console info is the last thing drawn.
     ConsoleInterface::update(clientArea);
     
-    View::doDraw(va, clientArea);
+//    View::doDraw(va, clientArea);
 } // end GameView::doDraw
 
 // lMouseDown

Modified: branches/krom/src/NetPanzer/Views/Game/HelpScrollView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/HelpScrollView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/HelpScrollView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -113,7 +113,7 @@
     iXY size(20, 20);
     iXY pos(getClientRect().getSizeX() - size.x, 0);
 
-    upButton = new Button(&quot;upButton&quot;);
+    upButton = new Button();
     upButton-&gt;setLabel(&quot;+&quot;);
     upButton-&gt;setLocation(pos.x, pos.y);
     upButton-&gt;setSize(size.x, size.y);
@@ -121,7 +121,7 @@
     add(upButton);
 
     pos = iXY(getClientRect().getSizeX() - size.x, getClientRect().getSizeY() - size.y);
-    downButton = new Button(&quot;downButton&quot;);
+    downButton = new Button();
     downButton-&gt;setLabel(&quot;-&quot;);
     downButton-&gt;setLocation(pos.x, pos.y);
     downButton-&gt;setSize(size.x, size.y);
@@ -145,11 +145,7 @@
                             &quot;Note: Use the right mouse button to accomplish fast mouse clicking.&quot;,
                             Color::white);
 
-    //char strBuf[256];
-    //sprintf(strBuf, &quot;%d&quot;, scrollBar-&gt;getValue());
-    //clientArea.bltStringCenter(strBuf, Color::red);
-
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 } // end HelpScrollView::doDraw
 
 // drawHelpText
@@ -158,23 +154,13 @@
 {
     PIX color   = Color::white;
 
-    //if (scrollBar != 0)
-    //{
-    //	int minView = scrollBar-&gt;getValue();
-    //	int maxView = minView + scrollBar-&gt;getViewableAmount();
-    //
-    //	if(maxView &gt; scrollBar-&gt;getMaximum())
-    //	{
-    //		maxView = scrollBar-&gt;getMaximum();
-    //	}
-    //
     int curIndex = 0;
-    for (int i = topViewableItem; i &lt; topViewableItem + maxViewableItems; i++) {
+    for (int i = topViewableItem; i &lt; topViewableItem + maxViewableItems; i++)
+    {
         dest.bltString(1, 6 + curIndex * (TEXT_GAP_SPACE +
                     Surface::getFontHeight()), text[i].c_str(), color);
         curIndex++;
     }
-    //}
 
 } // end HelpScrollView::drawHelpText
 

Modified: branches/krom/src/NetPanzer/Views/Game/HelpScrollView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/HelpScrollView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/HelpScrollView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -24,7 +24,6 @@
 
 #include &quot;Views/MainMenu/SpecialButtonView.hpp&quot;
 #include &quot;2D/Surface.hpp&quot;
-#include &quot;Views/Components/ScrollBar.hpp&quot;
 #include &quot;Views/Components/Button.hpp&quot;
 
 //---------------------------------------------------------------------------
@@ -37,7 +36,6 @@
     int  maxYOffset;
     void drawHelpText(Surface &amp;dest, const int &amp;x, const int &amp;y);
 
-    ScrollBar *scrollBar;
     std::vector&lt;std::string&gt; text;
 
     enum { TEXT_GAP_SPACE = 2 };
@@ -51,10 +49,7 @@
 
 public:
     HelpScrollView();
-    virtual ~HelpScrollView()
-    {
-        delete scrollBar;
-    }
+    virtual ~HelpScrollView() {}
 
     virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
     virtual void actionPerformed(mMouseEvent me);

Modified: branches/krom/src/NetPanzer/Views/Game/LibView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/LibView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/LibView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -151,7 +151,7 @@
         break;
     }
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 
 } // end LibView::doDraw
 

Modified: branches/krom/src/NetPanzer/Views/Game/LoadingView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/LoadingView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -26,7 +26,7 @@
         return;
     }
     sound-&gt;stopTankIdle();
-    Desktop::setVisibilityAllWindows(false);
+    Desktop::hideAllWindows();
     Desktop::setVisibility(&quot;MainView&quot;, true);
 }
 
@@ -66,7 +66,7 @@
     backgroundSurface.blt(clientArea, 0, 0);
     surface.blt(clientArea, 179, 153);
     
-    View::doDraw(viewArea, clientArea);    
+//    View::doDraw(viewArea, clientArea);
 }
 
 void

Modified: branches/krom/src/NetPanzer/Views/Game/LoadingView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/LoadingView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -60,7 +60,7 @@
     
     static void loadFinish()
     {
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
         GameManager::loadPalette(&quot;netp&quot;);
         GameManager::setNetPanzerGameOptions();
         Desktop::setVisibility(&quot;MiniMapView&quot;, true);
@@ -70,14 +70,14 @@
     static void loadError()
     {
         GameManager::loadPalette(&quot;netpmenu&quot;);
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
         Desktop::setVisibility(&quot;MainView&quot;, true);
 
     }
     
     static void show()
     {
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
         Desktop::setVisibility(&quot;LoadingView&quot;, true);
     }
     

Modified: branches/krom/src/NetPanzer/Views/Game/MiniMapView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/MiniMapView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/MiniMapView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -61,5 +61,5 @@
     // border
     viewArea.drawRect(iRect(0,0,viewArea.getWidth(), viewArea.getHeight()),Color::gray);
     
-    GameTemplateView::doDraw(viewArea, clientArea);
+//    GameTemplateView::doDraw(viewArea, clientArea);
 } // end doDraw

Modified: branches/krom/src/NetPanzer/Views/Game/RankView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/RankView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/RankView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -67,12 +67,6 @@
     resize(iXY(WINDOW_WIDTH, 200));
     checkArea(iXY(screen-&gt;getWidth(),screen-&gt;getHeight()));
 
-    // Define the scrollBar fot this view.
-    scrollBar = new ScrollBar(ScrollBar::VERTICAL, 0, 1, 0, 100);
-    if (scrollBar == 0) {
-        throw Exception(&quot;ERROR: Unable to allocate the scrollBar.&quot;);
-    }
-
     allyImage.loadBMP(&quot;pics/default/ally.bmp&quot;);
     allyRequestImage.loadBMP(&quot;pics/default/allyRequest.bmp&quot;);
     allyOtherImage.loadBMP(&quot;pics/default/allyOther.bmp&quot;);
@@ -109,7 +103,7 @@
     clientArea.bltStringShadowed(0, 16, table_header, Color::red, Color::gray64);
     drawPlayerStats(clientArea, flagHeight);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 } // end doDraw
 
 class StatesSortByFrags

Modified: branches/krom/src/NetPanzer/Views/Game/RankView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/RankView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/RankView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -24,7 +24,6 @@
 #include &quot;Views/Components/View.hpp&quot;
 #include &quot;2D/Surface.hpp&quot;
 #include &quot;GameTemplateView.hpp&quot;
-#include &quot;Views/Components/ScrollBar.hpp&quot;
 
 class PlayerState;
 
@@ -36,7 +35,6 @@
     enum { ITEM_GAP_SPACE = 10 };
     void drawPlayerStats(Surface &amp;dest, unsigned int flagHeight);
 
-    ScrollBar *scrollBar;
     Surface allyImage;
     Surface allyRequestImage;
     Surface allyOtherImage;
@@ -47,10 +45,7 @@
 
 public:
     RankView();
-    virtual ~RankView()
-    {
-        delete scrollBar;
-    }
+    virtual ~RankView() {}
 
     virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
     virtual void notifyMoveTo();

Modified: branches/krom/src/NetPanzer/Views/Game/ResignView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/ResignView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/ResignView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -58,8 +58,6 @@
 //---------------------------------------------------------------------------
 void ResignView::init()
 {
-    removeAllButtons();
-
     setBordered(false);
     setAllowResize(false);
     setDisplayStatusBar(false);
@@ -90,7 +88,7 @@
     currentscreen-&gt;bltLookup(r, Palette::darkGray256.getColorArray());
     currentscreen-&gt;drawButtonBorder(r, Color::lightGreen, Color::darkGreen);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 } // end ResignView::doDraw
 
 // doActivate

Modified: branches/krom/src/NetPanzer/Views/Game/VehicleSelectionView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/VehicleSelectionView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/Game/VehicleSelectionView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -82,9 +82,9 @@
     VehicleSelectionView * p;
 public:
     UnitSelectionButton(VehicleSelectionView * vsv, const char *cname, int unit_type, int x, int y, const Surface &amp;s)
-        : Button(cname), unitType(unit_type), p(vsv)
+        : Button(), unitType(unit_type), p(vsv)
     {
-        bimage.copy(s);
+        bimage.pack(s);
         setSize( bimage.getWidth(), bimage.getHeight());
         setLocation(x, y);
         setUnitSelectionBorder();
@@ -181,7 +181,7 @@
 
     pos.x = getClientRect().getSizeX() - 100;
     if ( !buttonStaticDisplay )
-        buttonStaticDisplay = new Button( &quot;ButtonStaticDisplay&quot;);
+        buttonStaticDisplay = new Button();
     buttonStaticDisplay-&gt;setLabel(&quot;On&quot;);
     buttonStaticDisplay-&gt;setLocation(pos.x, pos.y);
     buttonStaticDisplay-&gt;setSize( 100, 15);
@@ -194,7 +194,7 @@
 
     pos.x = getClientRect().getSizeX() - 100;
     if ( !buttonPower )
-        buttonPower = new Button( &quot;ButtonPower&quot;);
+        buttonPower = new Button();
     
     buttonPower-&gt;setLabel(&quot;Off&quot;);
     buttonPower-&gt;setLocation(pos.x,pos.y);
@@ -273,7 +273,7 @@
 
     pos.x = (getClientRect().getSizeX() - 100) / 2;
     if ( !buttonOk )
-        buttonOk = new Button( &quot;buttonClose&quot;);
+        buttonOk = new Button();
     
     buttonOk-&gt;setLabel(&quot;Close&quot;);
     buttonOk-&gt;setLocation(pos.x,pos.y);
@@ -421,7 +421,7 @@
     //sprintf(strBuf, &quot;%01d:%02d&quot;, ( (int) outpost_status.unit_generation_time_remaining ) / 60, ( (int) outpost_status.unit_generation_time_remaining) % 60 );
     //clientArea.bltString(timeRemainingPos, strBuf, color);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 
 } // end VehicleSelectionView::doDraw
 

Added: branches/krom/src/NetPanzer/Views/MainMenu/HostView.cpp
===================================================================
--- branches/krom/src/NetPanzer/Views/MainMenu/HostView.cpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Views/MainMenu/HostView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,128 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ */
+
+#include &quot;HostView.hpp&quot;
+
+#include &lt;sstream&gt;
+
+#include &quot;Views/Components/Button.hpp&quot;
+#include &quot;Views/Components/CheckBox.hpp&quot;
+#include &quot;Views/Components/Choice.hpp&quot;
+#include &quot;Views/Components/Label.hpp&quot;
+#include &quot;Views/Components/InputField.hpp&quot;
+#include &quot;Views/Components/Slider.hpp&quot;
+#include &quot;Util/Log.hpp&quot;
+
+
+XHostView::XHostView()
+{
+    setSearchName(&quot;XHostView&quot;);
+    setTitle(&quot;XHostView&quot;);
+    setSubTitle(&quot;&quot;);
+
+    setAllowResize(false);
+    setAllowMove(false);
+
+    setBackgroundColor(Color::black);
+
+    moveTo(iXY(242,60));
+    resize(iXY(400,400));
+
+    int y_pos = 12;
+    int x_pos = 10;
+
+    player_name_label = new Label(x_pos,y_pos,&quot;Player Name:&quot;,Color::white);
+    add(player_name_label);
+
+    player_name_field = new InputField();
+    player_name_field-&gt;setLocation(x_pos + 100, y_pos-2);
+    player_name_field-&gt;setSize(100, 12);
+    add(player_name_field);
+
+    y_pos += 14;
+    server_name_label = new Label(x_pos, y_pos, &quot;Server Name:&quot;, Color::white);
+    add(server_name_label);
+
+    server_name_field = new InputField();
+    server_name_field-&gt;setLocation(x_pos + 100, y_pos - 2);
+    server_name_field-&gt;setSize(100, 12);
+    add(server_name_field);
+
+    y_pos += 14;
+    motd_label = new Label(x_pos, y_pos, &quot;MOTD:&quot;, Color::white);
+    add(motd_label);
+
+    motd_field = new InputField();
+    motd_field-&gt;setLocation(x_pos + 100, y_pos - 2);
+    motd_field-&gt;setSize(200, 12);
+    add(motd_field);
+
+    y_pos += 14;
+    max_players_label = new Label(x_pos, y_pos, &quot;Max players:&quot;, Color::white);
+    add(max_players_label);
+
+    max_players_num = new Label(x_pos + 100, y_pos, &quot;8&quot;, Color::white);
+    add(max_players_num);
+
+    max_players_slider = new Slider();
+    max_players_slider-&gt;setLocation(x_pos + 120, y_pos);
+    max_players_slider-&gt;setSize(250, 8);
+    max_players_slider-&gt;setMin(2);
+    max_players_slider-&gt;setMax(16);
+    max_players_slider-&gt;setValue(8);
+    max_players_slider-&gt;changed.connect(this, &amp;XHostView::onMaxPlayersSliderChanged);
+    add(max_players_slider);
+
+    y_pos += 14;
+    units_per_player_label = new Label(x_pos, y_pos, &quot;Units per player:&quot;, Color::white);
+    add(units_per_player_label);
+
+    units_per_player_num = new Label(x_pos + 150, y_pos, &quot;40&quot;, Color::white);
+    add(units_per_player_num);
+
+    units_per_player_slider = new Slider();
+    units_per_player_slider-&gt;setLocation(x_pos + 180, y_pos);
+    units_per_player_slider-&gt;setSize(200, 8);
+    units_per_player_slider-&gt;setMin(1);
+    units_per_player_slider-&gt;setMax(255);
+    units_per_player_slider-&gt;setValue(40);
+    units_per_player_slider-&gt;changed.connect(this, &amp;XHostView::onUnitsPerPlayerSliderChanged);
+    add(units_per_player_slider);
+
+
+}
+
+XHostView::~XHostView()
+{
+}
+
+void XHostView::onMaxPlayersSliderChanged()
+{
+    stringstream ss;
+    ss &lt;&lt; max_players_slider-&gt;getValue();
+    max_players_num-&gt;setText(ss.str());
+}
+
+void XHostView::onUnitsPerPlayerSliderChanged()
+{
+    stringstream ss;
+    ss &lt;&lt; units_per_player_slider-&gt;getValue();
+    units_per_player_num-&gt;setText(ss.str());
+}
+

Added: branches/krom/src/NetPanzer/Views/MainMenu/HostView.hpp
===================================================================
--- branches/krom/src/NetPanzer/Views/MainMenu/HostView.hpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Views/MainMenu/HostView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,56 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ */
+#ifndef HOSTVIEW_HPP
+#define HOSTVIEW_HPP
+
+#include &quot;Views/Components/View.hpp&quot;
+
+class Label;
+class InputField;
+class Slider;
+
+class XHostView : public View
+{
+public:
+    XHostView();
+    virtual ~XHostView();
+private:
+    Label       * player_name_label;
+    InputField  * player_name_field;
+
+    Label       * server_name_label;
+    InputField  * server_name_field;
+
+    Label       * motd_label;
+    InputField  * motd_field;
+
+    Label       * max_players_label;
+    Label       * max_players_num;
+    Slider      * max_players_slider;
+    void onMaxPlayersSliderChanged();
+
+    Label       * units_per_player_label;
+    Label       * units_per_player_num;
+    Slider      * units_per_player_slider;
+    void onUnitsPerPlayerSliderChanged();
+
+};
+
+
+#endif // HOSTVIEW_HPP

Added: branches/krom/src/NetPanzer/Views/MainMenu/JoinView.cpp
===================================================================
--- branches/krom/src/NetPanzer/Views/MainMenu/JoinView.cpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Views/MainMenu/JoinView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,97 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#include &quot;JoinView.hpp&quot;
+
+#include &quot;Views/Components/Button.hpp&quot;
+#include &quot;Views/Components/CheckBox.hpp&quot;
+#include &quot;Views/Components/Choice.hpp&quot;
+#include &quot;Views/Components/Label.hpp&quot;
+#include &quot;Views/Components/InputField.hpp&quot;
+#include &quot;Util/Log.hpp&quot;
+
+
+JoinView::JoinView()
+{
+    setSearchName(&quot;XJoinView&quot;);
+    setTitle(&quot;XJoinView&quot;);
+    setSubTitle(&quot;&quot;);
+
+    setAllowResize(false);
+    setAllowMove(false);
+
+    setBackgroundColor(Color::black);
+
+    moveTo(iXY(242,60));
+    resize(iXY(400,400));
+
+    Label * player_name_label = new Label(10,12,&quot;Name:&quot;,Color::white);
+    add(player_name_label);
+
+    InputField * infi = new InputField();
+    infi-&gt;setLocation(50,10);
+    infi-&gt;setSize(100, 12);
+    add(infi);
+
+    Button * test_button = new Button();
+    test_button-&gt;setLocation(10,30);
+    test_button-&gt;setNormalBorder();
+    test_button-&gt;setSize(80,20);
+    test_button-&gt;setLabel(&quot;A Button&quot;);
+    test_button-&gt;clicked.connect(this, &amp;JoinView::onButtonClicked);
+    add(test_button);
+
+    cb = new CheckBox(&quot;A CheckBox&quot;, false);
+    cb-&gt;stateChanged.connect(this, &amp;JoinView::onCheckBoxStateChanged);
+    cb-&gt;setLocation(100, 30);
+    add(cb);
+
+    choice = new Choice();
+    choice-&gt;setLocation(10,60);
+    choice-&gt;addItem(&quot;item 1&quot;);
+    choice-&gt;addItem(&quot;item 2&quot;);
+    choice-&gt;addItem(&quot;item 3&quot;);
+    choice-&gt;addItem(&quot;item 4&quot;);
+    choice-&gt;stateChanged.connect(this, &amp;JoinView::onChoiceChanged);
+    add(choice);
+
+    Button * other_button = new Button();
+    other_button-&gt;loadPackedImage(&quot;pics/backgrounds/menus/buttons/default/pak/inMenusHelp.pak&quot;);
+    other_button-&gt;setLocation(10, 150);
+    add(other_button);
+
+}
+
+JoinView::~JoinView()
+{
+}
+
+void JoinView::onButtonClicked()
+{
+    LOGGER.warning(&quot;The button was clicked!!!&quot;);
+}
+
+void JoinView::onCheckBoxStateChanged()
+{
+    LOGGER.warning(&quot;The checkbox now is %s&quot;, cb-&gt;getState() ? &quot;on&quot; : &quot;off&quot;);
+}
+
+void JoinView::onChoiceChanged()
+{
+    LOGGER.warning(&quot;The new choice index is %d&quot;, choice-&gt;getSelectedIndex());
+}

Added: branches/krom/src/NetPanzer/Views/MainMenu/JoinView.hpp
===================================================================
--- branches/krom/src/NetPanzer/Views/MainMenu/JoinView.hpp	                        (rev 0)
+++ branches/krom/src/NetPanzer/Views/MainMenu/JoinView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -0,0 +1,42 @@
+/*
+Copyright (C) 2011 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+ */
+#ifndef JOINVIEW_HPP
+#define JOINVIEW_HPP
+
+#include &quot;Views/Components/View.hpp&quot;
+#include &quot;2D/Surface.hpp&quot;
+
+class CheckBox;
+class Choice;
+
+class JoinView : public View
+{
+public:
+    JoinView();
+    virtual ~JoinView();
+private:
+    CheckBox *cb;
+    Choice * choice;
+
+    void onButtonClicked();
+    void onCheckBoxStateChanged();
+    void onChoiceChanged();
+};
+
+#endif // JOINVIEW_HPP

Modified: branches/krom/src/NetPanzer/Views/MainMenu/MainMenuView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/MainMenuView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/MainMenuView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -18,9 +18,12 @@
 
 
 #include &quot;MainMenuView.hpp&quot;
+#include &quot;JoinView.hpp&quot;
 #include &quot;Views/Components/Desktop.hpp&quot;
+#include &quot;Views/Components/Button.hpp&quot;
 #include &quot;Interfaces/GameManager.hpp&quot;
 #include &quot;Views/GameViewGlobals.hpp&quot;
+#include &quot;Classes/ScreenSurface.hpp&quot;
 
 #include &quot;Views/MainMenu/Multi/HostJoinTemplateView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/GetSessionView.hpp&quot;
@@ -30,23 +33,98 @@
 	#define PACKAGE_VERSION &quot;testing&quot;
 #endif
 
+class JoinView;
+
+//static void bJoin()
+//{
+//    View *jv = Desktop::getView(&quot;XJoinView&quot;);
+//    if ( !jv )
+//    {
+//        jv = new JoinView();
+//        Desktop::add(jv);
+//    }
+////    Desktop::hideLastView();
+//    Desktop::setVisibility(jv, true);
+//}
+
 // MainMenuView
 //---------------------------------------------------------------------------
-MainMenuView::MainMenuView() : MenuTemplateView()
+MainMenuView::MainMenuView()
 {
     setSearchName(&quot;MainView&quot;);
-    setTitle(&quot;Main&quot;);
+    setTitle(&quot;Menu&quot;);
     setSubTitle(&quot;&quot;);
 
+    setAllowResize(false);
+    setAllowMove(false);
+    //setBordered(false);
+
+    int x = 10;
+    int y = 10;
+
+    moveTo(iXY(0, 0));
+
+    Button * joinbutton = new Button();
+    joinbutton-&gt;loadPackedImage(&quot;pics/backgrounds/menus/buttons/default/pak/inMenusJoin.pak&quot;);
+    joinbutton-&gt;setLocation(x, y);
+//    exitbutton-&gt;clicked.connect(this, &amp;MainMenuView::onExitButtonClicked);
+    add(joinbutton);
+
+    y += 22;
+    Button * hostbutton = new Button();
+    hostbutton-&gt;loadPackedImage(&quot;pics/backgrounds/menus/buttons/default/pak/inMenusHost.pak&quot;);
+    hostbutton-&gt;setLocation(x, y);
+//    exitbutton-&gt;clicked.connect(this, &amp;MainMenuView::onExitButtonClicked);
+    add(hostbutton);
+
+    y += 22;
+    Button * optionsbutton = new Button();
+    optionsbutton-&gt;loadPackedImage(&quot;pics/backgrounds/menus/buttons/default/pak/inMenusOptions.pak&quot;);
+    optionsbutton-&gt;setLocation(x, y);
+//    exitbutton-&gt;clicked.connect(this, &amp;MainMenuView::onExitButtonClicked);
+    add(optionsbutton);
+
+    y += 22;
+    Button * helpbutton = new Button();
+    helpbutton-&gt;loadPackedImage(&quot;pics/backgrounds/menus/buttons/default/pak/inMenusHelp.pak&quot;);
+    helpbutton-&gt;setLocation(x, y);
+//    exitbutton-&gt;clicked.connect(this, &amp;MainMenuView::onExitButtonClicked);
+    add(helpbutton);
+
+    y += 22;
+    Button * mainbutton = new Button();
+    mainbutton-&gt;loadPackedImage(&quot;pics/backgrounds/menus/buttons/default/pak/inMenusMain.pak&quot;);
+    mainbutton-&gt;setLocation(x, y);
+//    exitbutton-&gt;clicked.connect(this, &amp;MainMenuView::onExitButtonClicked);
+    add(mainbutton);
+
+    y += 22;
+
+    Button * exitbutton = new Button();
+    exitbutton-&gt;loadPackedImage(&quot;pics/backgrounds/menus/buttons/default/pak/inMenusExit netPanzer.pak&quot;);
+    exitbutton-&gt;setLocation(x, y);
+    exitbutton-&gt;clicked.connect(this, &amp;MainMenuView::onExitButtonClicked);
+    add(exitbutton);
+
+    y += 22;
+    resize(iXY(x*2 + 141, y + 20));
+/*
+    textRect.min.x = x*2 + 141 + 10;
+    textRect.min.y = 10;
+    textRect.max.x = 630 - textRect.min.x;
+    textRect.max.y = 470 - textRect.min.y;
+*/
+
+    setBackgroundColor(Color::black);
     setVisible(true);
 } // end MainMenuView::MainMenuView
 
-// doDraw
-//---------------------------------------------------------------------------
-void MainMenuView::doDraw(Surface &amp;viewArea, Surface &amp;clientArea)
+void MainMenuView::onExitButtonClicked()
 {
-    MenuTemplateView::doDraw(viewArea, clientArea);
+    GameManager::exitNetPanzer();
+}
 
+/* // for later drawing in a box
     static char text[] =
         &quot;This is NetPanzer version &quot; PACKAGE_VERSION
         &quot;, a massively multiplayer tank battle game.  &quot;
@@ -69,5 +147,5 @@
         &quot;Related Tools:\n&quot;
         &quot;   Tobias Blerch, Ingo Ruhnke\n&quot;;
 
-    viewArea.bltStringInBox(bodyTextRect, text, Color::white, 12);
-} // end MainMenuView::doDraw
+    viewArea.bltStringInBox(textRect, text, Color::white, 12, true);
+*/

Modified: branches/krom/src/NetPanzer/Views/MainMenu/MainMenuView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/MainMenuView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/MainMenuView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -19,16 +19,17 @@
 #define __MainMenuView_hpp__
 
 #include &quot;Views/Components/View.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-#include &quot;Views/MainMenu/MenuTemplateView.hpp&quot;
 
 //--------------------------------------------------------------------------
-class MainMenuView : public MenuTemplateView
+class MainMenuView : public View
 {
 public:
     MainMenuView();
 
-    virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
+
+private:
+    iRect textRect;
+    void onExitButtonClicked();
 }; // end MainMenuView
 
 #endif // end __MainMenuView_hpp__

Modified: branches/krom/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -43,25 +43,24 @@
 
 static void bMain()
 {
-    Desktop::setVisibilityAllWindows(false);
+    Desktop::hideAllWindows();
     Desktop::setVisibility(&quot;MainView&quot;, true);
 }
 
 static void bMulti()
 {
     if (strcmp(MenuTemplateView::currentMultiView, &quot;GetSessionView&quot;) == 0) {
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
         Desktop::setVisibility(&quot;GetSessionView&quot;, true);
     } else if (strcmp(MenuTemplateView::currentMultiView, &quot;HostView&quot;) == 0) {
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
         Desktop::setVisibility(&quot;HostView&quot;, true);
-        Desktop::setVisibility(&quot;UnitSelectionView&quot;, true);
         Desktop::setVisibility(&quot;FlagSelectionView&quot;, true);
         Desktop::setVisibility(&quot;HostOptionsView&quot;, true);
         Desktop::setVisibility(&quot;MapSelectionView&quot;, true);
         Desktop::setVisibility(&quot;PlayerNameView&quot;, true);
     } else if (strcmp(MenuTemplateView::currentMultiView, &quot;JoinView&quot;) == 0) {
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
         Desktop::setVisibility(&quot;JoinView&quot;, true);
         Desktop::setVisibility(&quot;FlagSelectionView&quot;, true);
         Desktop::setVisibility(&quot;PlayerNameView&quot;, true);
@@ -74,13 +73,13 @@
 
 static void bOptions()
 {
-    Desktop::setVisibilityAllWindows(false);
+    Desktop::hideAllWindows();
     Desktop::setVisibility(&quot;OptionsView&quot;, true);
 }
 
 static void bHelp()
 {
-    Desktop::setVisibilityAllWindows(false);
+    Desktop::hideAllWindows();
     Desktop::setVisibility(&quot;HelpView&quot;, true);
 }
 
@@ -229,7 +228,7 @@
         titlePackedSurface.bltBlend(clientArea, bodyTextRect.min.x, 390, Palette::colorTable6040);
     }
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 } // end doDraw
 
 // doActivate

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -37,13 +37,15 @@
     FlagSelectionView* fsv;
 public:
     FlagButton(FlagSelectionView* fsv, int x, int y, Surface &amp;s, FlagID flagCode)
-        : Button(&quot;flag&quot;)
+        : Button()
     {
         this-&gt;fsv = fsv;
         setLocation(x, y);
         setSize(s.getWidth(), s.getHeight());
-        bimage.create(s.getWidth(), s.getHeight(), 1);
-        s.blt(bimage, 0, 0);
+        Surface sf;
+        sf.create(s.getWidth(), s.getHeight(), 1);
+        s.blt(sf, 0, 0);
+        bimage.pack(sf);
         fcode = flagCode;
         
         setExtraBorder();
@@ -151,7 +153,7 @@
     
     menu_flags.blt(clientArea, loc_player_flag.x, loc_player_flag.y);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 
 } // end FlagSelectionView::doDraw
 void

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/GetSessionView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -38,17 +38,16 @@
 
 static void bBack()
 {
-    Desktop::setVisibilityAllWindows(false);
+    Desktop::hideAllWindows();
     Desktop::setVisibility(&quot;MainView&quot;, true);
 }
 
 void bNext()
 {
     if (gameconfig-&gt;hostorjoin == _game_session_host) {
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
 
         Desktop::setVisibility(&quot;HostView&quot;, true);
-        Desktop::setVisibility(&quot;UnitSelectionView&quot;, true);
         Desktop::setVisibility(&quot;FlagSelectionView&quot;, true);
         Desktop::setVisibility(&quot;HostOptionsView&quot;, true);
         Desktop::setVisibility(&quot;MapSelectionView&quot;, true);

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/HostJoinTemplateView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -60,7 +60,7 @@
             SERVER-&gt;closeSession();
         }
 
-    Desktop::setVisibilityAllWindows(false);
+    Desktop::hideAllWindows();
     Desktop::setVisibility(&quot;GetSessionView&quot;, true);
 }
 
@@ -76,20 +76,20 @@
     if (MapSelectionView::curMap == -1) {
         return;
     }
-    if (gameconfig-&gt;hostorjoin == _game_session_join &amp;&amp;
-        strcmp(IPAddressView::szServer.getString(), &quot;&quot;) == 0)
-        return;
+//    if (gameconfig-&gt;hostorjoin == _game_session_join &amp;&amp;
+//        strcmp(IPAddressView::szServer.getString(), &quot;&quot;) == 0)
+//        return;
 
     // Set the player flag.
     // XXX FLAG
     //gameconfig-&gt;playerflag = FlagSelectionView::getSelectedFlag();
 
     // Close all menu views.
-    Desktop::setVisibilityAllWindows(false);
+    Desktop::hideAllWindows();
 
-    if(gameconfig-&gt;hostorjoin == _game_session_join) {
-        gameconfig-&gt;serverConnect = IPAddressView::szServer.getString();
-    }
+//    if(gameconfig-&gt;hostorjoin == _game_session_join) {
+//        gameconfig-&gt;serverConnect = IPAddressView::szServer.getString();
+//    }
     
     serverlistview-&gt;endQuery();
 
@@ -128,7 +128,7 @@
 {
     MenuTemplateView::doDraw(viewArea, clientArea);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 } // end doDraw
 
 // doActivate

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -282,7 +282,7 @@
                     &quot;Note: Use the right mouse button to accomplish fast mouse clicking.&quot;,
                     Color::white);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 
 } // end HostOptionsView::doDraw
 
@@ -371,7 +371,7 @@
     const int minWidth = 150;
     int xChoiceOffset = 2;
 
-    choiceGameType.setName(&quot;Game Type&quot;);
+    choiceGameType.setLabel(&quot;Game Type&quot;);
     choiceGameType.addItem(&quot;Objective&quot;);
     choiceGameType.addItem(&quot;Frag Limit&quot;);
     choiceGameType.addItem(&quot;Time Limit&quot;);
@@ -381,7 +381,7 @@
     add(&amp;choiceGameType);
     xChoiceOffset += minWidth + 123;
 
-    choiceCloudCoverage.setName(&quot;Cloud Coverage&quot;);
+    choiceCloudCoverage.setLabel(&quot;Cloud Coverage&quot;);
     choiceCloudCoverage.addItem(&quot;Clear&quot;);
     choiceCloudCoverage.addItem(&quot;Broken&quot;);
     choiceCloudCoverage.addItem(&quot;Partly Cloudy&quot;);
@@ -393,7 +393,7 @@
     add(&amp;choiceCloudCoverage);
     xChoiceOffset += minWidth + 13;
 
-    choiceWindSpeed.setName(&quot;Wind Speed&quot;);
+    choiceWindSpeed.setLabel(&quot;Wind Speed&quot;);
     choiceWindSpeed.addItem(&quot;Calm&quot;);
     choiceWindSpeed.addItem(&quot;Breezy&quot;);
     choiceWindSpeed.addItem(&quot;Brisk&quot;);

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/HostView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/HostView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -119,7 +119,7 @@
     	sprintf(strBuf, &quot;%3d&quot;, gameconfig-&gt;GetNumberPlayers());
     	clientArea.bltString(x + 125, y, strBuf, Color::white);
     */
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 
 } // end HostView::doDraw
 

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -21,7 +21,7 @@
 #include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/GameViewGlobals.hpp&quot;
 
-cInputFieldString IPAddressView::szServer;
+//cInputFieldString IPAddressView::szServer;
 
 // IPAddressView
 //---------------------------------------------------------------------------
@@ -47,8 +47,8 @@
 
 void IPAddressView::Init()
 {
-    szServer.init(&quot;&quot;, 256,29);
-    addInputField(iXY(8, 8), &amp;szServer, &quot;&quot;, true);
+//    szServer.init(&quot;&quot;, 256,29);
+//    addInputField(iXY(8, 8), &amp;szServer, &quot;&quot;, true);
 } // end IPAddressView::init
 
 // doDraw
@@ -56,6 +56,6 @@
 void IPAddressView::doDraw(Surface &amp;viewArea, Surface &amp;clientArea)
 {
     clientArea.fill(Color::black);
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 } // end IPAddressView::doDraw
 

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -25,7 +25,7 @@
 class IPAddressView : public View
 {
 public:
- static cInputFieldString szServer;
+// static cInputFieldString szServer;
 	
  IPAddressView();
 

Deleted: branches/krom/src/NetPanzer/Views/MainMenu/Multi/JoinView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/JoinView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/JoinView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,61 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;JoinView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
-#include &quot;Interfaces/GameConfig.hpp&quot;
-#include &quot;Interfaces/GameManager.hpp&quot;
-#include &quot;Interfaces/GameManager.hpp&quot;
-#include &quot;Views/GameViewGlobals.hpp&quot;
-
-// JoinView
-//---------------------------------------------------------------------------
-JoinView::JoinView() : HostJoinTemplateView()
-{
-    setSearchName(&quot;JoinView&quot;);
-    setTitle(&quot;Join Options&quot;);
-    setSubTitle(&quot;&quot;);
-} // end JoinView constructor
-
-// doDraw
-//---------------------------------------------------------------------------
-void JoinView::doDraw(Surface &amp;viewArea, Surface &amp;clientArea)
-{
-    HostJoinTemplateView::doDraw(viewArea, clientArea);
-} // end JoinView::doDraw
-
-// doDeactivate
-//---------------------------------------------------------------------------
-void JoinView::doDeactivate()
-{
-    if (strcmp(MenuTemplateView::currentMultiView, searchName) != 0 ||
-            strcmp(MenuTemplateView::currentView, searchName) != 0) {
-        MenuTemplateView::doDeactivate();
-        Desktop::setVisibility(&quot;GetSessionJoinView&quot;, false);
-    }
-
-} // end JoinView::doDeactivate
-
-// loadTitleSurface
-//---------------------------------------------------------------------------
-void JoinView::loadTitleSurface()
-{
-    doLoadTitleSurface(&quot;joinTitle&quot;);
-} // end JoinView::loadTitleSurface
-

Deleted: branches/krom/src/NetPanzer/Views/MainMenu/Multi/JoinView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/JoinView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/JoinView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,39 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __JoinView_hpp__
-#define __JoinView_hpp__
-
-#include &quot;Views/Components/View.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-#include &quot;HostJoinTemplateView.hpp&quot;
-
-
-//---------------------------------------------------------------------------
-class JoinView : public HostJoinTemplateView
-{
-protected:
-    virtual void loadTitleSurface();
-
-public:
-    JoinView();
-
-    virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
-    virtual void doDeactivate();
-}; // end JoinView
-
-#endif // end __JoinView_hpp__

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -134,7 +134,7 @@
         drawCurMapInfo(clientArea, iXY(MAP_SIZE + BORDER_SPACE * 2, BORDER_SPACE));
     }
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 
 } // end MapSelectionView::doDraw
 

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -53,11 +53,11 @@
 //---------------------------------------------------------------------------
 void PlayerNameView::init()
 {
-    playerName.init(gameconfig-&gt;playername.c_str(), INPUT_FIELD_CHARACTERS);
-    cInputField* input 
-        = addInputField(iXY(BORDER_SPACE, BORDER_SPACE), &amp;playerName, &quot;&quot;, true);
-    input-&gt;setTextAction(textChanged);
-    input-&gt;setExcludedCharacters(&quot;\\&quot;);
+//    playerName.init(gameconfig-&gt;playername.c_str(), INPUT_FIELD_CHARACTERS);
+//    cInputField* input
+//        = addInputField(iXY(BORDER_SPACE, BORDER_SPACE), &amp;playerName, &quot;&quot;, true);
+//    input-&gt;setTextAction(textChanged);
+//    input-&gt;setExcludedCharacters(&quot;\\&quot;);
 } // end PlayerNameView::init
 
 // doDraw
@@ -67,11 +67,11 @@
     //iRect r(getViewRect());
     //viewArea.bltLookup(r, Palette::darkGray256.getColorArray());
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 } // end PlayerNameView::doDraw
 
-void PlayerNameView::textChanged(cInputField* input)
-{
-    gameconfig-&gt;playername = input-&gt;getDestString();
-}
+//void PlayerNameView::textChanged(cInputField* input)
+//{
+//    gameconfig-&gt;playername = input-&gt;getDestString();
+//}
 

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -35,13 +35,13 @@
     void init();
 
 private:
-    static void textChanged(cInputField* input);
+//    static void textChanged(cInputField* input);
     
     enum { BORDER_SPACE           =  4 };    
     // irc nick is 16 chars max, 2 = &quot;np&quot;, 1 spare for digit if nick is taken
     enum { INPUT_FIELD_CHARACTERS = 13 };
 
-    cInputFieldString playerName;
+//    cInputFieldString playerName;
 }; // end PlayerNameView
 
 #endif // end __PlayerNameView_hpp__

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/ServerListView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/ServerListView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/ServerListView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -123,7 +123,7 @@
             msg = &quot;Resolving masterserver address&quot;;
         }
         clientArea.bltString(0, 0, msg, Color::white);
-        View::doDraw(windowArea, clientArea);
+//        View::doDraw(windowArea, clientArea);
         return;
     }
 
@@ -156,12 +156,12 @@
             
             Uint8 textcolor = Color::white;
             
-            if (servaddr.str()==IPAddressView::szServer.getString()) {
-                textcolor = Color::yellow;
-                clientArea.fillRect(
-                    iRect(0,y,clientArea.getWidth(),y+Surface::getFontHeight()),
-                    Color::blue);
-            }
+//            if (servaddr.str()==IPAddressView::szServer.getString()) {
+//                textcolor = Color::yellow;
+//                clientArea.fillRect(
+//                    iRect(0,y,clientArea.getWidth(),y+Surface::getFontHeight()),
+//                    Color::blue);
+//            }
 
             char ssn[44];
             SDL_strlcpy(ssn, server.name.c_str(), sizeof(ssn));
@@ -177,10 +177,10 @@
             break;                             
     }
 
-    View::doDraw(windowArea, clientArea);
+//    View::doDraw(windowArea, clientArea);
 }
 
-int
+void
 ServerListView::lMouseUp(const iXY&amp; down_pos, const iXY&amp; up_pos)
 {
     if(down_pos.x &lt; 0 || down_pos.y &lt; 0 || up_pos.x &lt; 0 || up_pos.y &lt; 0)
@@ -194,8 +194,6 @@
     const masterserver::ServerInfo&amp; server = *(serverlist[listpos]);
     std::stringstream addr;
     addr &lt;&lt; server.address &lt;&lt; ':' &lt;&lt; server.port;
-    IPAddressView::szServer.setString(addr.str());
-    
-    return View::lMouseUp(down_pos, up_pos);
+//    IPAddressView::szServer.setString(addr.str());
 }
 

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Multi/ServerListView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/ServerListView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/ServerListView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -33,7 +33,7 @@
     void endQuery();
         
     virtual void doDraw(Surface&amp; windowArea, Surface&amp; clientArea);
-    virtual int lMouseUp(const iXY&amp; up_pos, const iXY&amp; down_pos);
+    virtual void lMouseUp(const iXY&amp; up_pos, const iXY&amp; down_pos);
 
 private:
     masterserver::ServerList serverlist;

Deleted: branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,160 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;UnitColorView.hpp&quot;
-#include &quot;Views/Game/GameView.hpp&quot;
-#include &quot;Views/GameViewGlobals.hpp&quot;
-#include &quot;2D/Palette.hpp&quot;
-#include &quot;2D/ColorTable.hpp&quot;
-
-static float maxPercent       = 3.5f;
-static float minPercent       = 0.5f;
-static float incrementPercent = 0.025f;
-static float grayPercent      = 2.0f;
-static ColorTable *colorTable;
-ColorTable gray256;
-
-static void setGrayColorTable()
-{
-    colorTable = &amp;gray256;
-}
-
-static void increasePercent(float &amp;color)
-{
-    if ((color += incrementPercent) &gt; maxPercent) {
-        color = maxPercent;
-    }
-}
-
-static void decreasePercent(float &amp;color)
-{
-    if ((color -= incrementPercent) &lt; minPercent) {
-        color = minPercent;
-    }
-}
-
-static void rebuildGrayColorTable()
-{
-    // 256 shades of gray.
-    gray256.init(256);
-    for (int num = 0; num &lt; 256; num++) {
-        int c = int(Palette::color[num].r+Palette::color[num].g+Palette::color[num].b)/3; //brightness
-
-        int nearestColor = Palette::findNearestColor(
-                        int(c * grayPercent),
-                        int(c * grayPercent),
-                        int(c * grayPercent));
-        gray256.setColor(num, nearestColor);
-    }
-    gray256.setColor(255, 0);
-}
-
-static void bIncreaseBrightness()
-{
-    increasePercent(grayPercent);
-    rebuildGrayColorTable();
-}
-
-static void bDecreaseBrightness()
-{
-    decreasePercent(grayPercent);
-    rebuildGrayColorTable();
-}
-
-// UnitColorView
-//---------------------------------------------------------------------------
-UnitColorView::UnitColorView() : View()
-{
-    setSearchName(&quot;UnitColorView&quot;);
-    setTitle(&quot;Selects Your Unit Color&quot;);
-    setSubTitle(&quot;&quot;);
-
-    setAllowResize(false);
-    setAllowMove(false);
-    setVisible(false);
-
-    Surface unitSurface;
-
-    moveTo(400, 200);
-
-    packedBody.load(&quot;units/pics/pak/TitaHNSD.pak&quot;);
-    packedBody.setFPS(12);
-
-    packedTurret.load(&quot;units/pics/pak/TitaTNSD.pak&quot;);
-    packedTurret.setFPS(8);
-
-    grassSurface.loadBMP(&quot;pics/grass.bmp&quot;);
-
-    fuckingSurface.create(packedTurret.getWidth(), packedTurret.getHeight(), 1);
-    fuckingSurface.fill(0);
-
-    resizeClientArea(packedTurret.getWidth(), packedTurret.getHeight());
-
-    int size = packedTurret.getWidth() / 2;
-    addButtonCenterText(iXY(0, 0), size, &quot;Up&quot;, &quot;&quot;, bIncreaseBrightness);
-    addButtonCenterText(iXY(size, 0), size, &quot;Down&quot;, &quot;&quot;, bDecreaseBrightness);
-
-    setGrayColorTable();
-    rebuildGrayColorTable();
-
-} // end UnitColorView::UnitColorView
-
-// doDraw
-//---------------------------------------------------------------------------
-void UnitColorView::doDraw(Surface &amp;viewArea, Surface &amp;clientArea)
-{
-    //unitSurface.fill(0);
-
-    packedBody.nextFrame();
-    packedTurret.nextFrame();
-
-    fuckingSurface.fill(Color::white);
-    packedBody.blt(fuckingSurface, 0, 0);
-    packedTurret.blt(fuckingSurface, 0, 0);
-    fuckingSurface.bltLookup(fuckingSurface.getRect(), colorTable-&gt;getColorArray());
-
-    grassSurface.blt(clientArea, 0, 0);
-    fuckingSurface.bltTrans(clientArea, 0, 0);
-
-    char strBuf[256];
-    sprintf(strBuf, &quot;%1.3f of %1.3f&quot;, grayPercent, maxPercent);
-    clientArea.bltString(2, fuckingSurface.getHeight() - Surface::getFontHeight() - 1, strBuf, Color::white);
-
-    View::doDraw(viewArea, clientArea);
-
-} // end UnitColorView::doDraw
-
-//---------------------------------------------------------------------------
-void UnitColorView::rMouseDown(const iXY &amp;pos)
-{
-    View::lMouseDown(pos);
-}
-
-//---------------------------------------------------------------------------
-void UnitColorView::rMouseUp(const iXY &amp;downPos, const iXY &amp;upPos)
-{
-    View::lMouseUp(downPos, upPos);
-}
-
-//---------------------------------------------------------------------------
-void UnitColorView::rMouseDrag(const iXY &amp;downPos, const iXY&amp;, const iXY &amp;newPos)
-{
-    View::lMouseUp(downPos, newPos);
-    View::lMouseDown(newPos);
-}

Deleted: branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,44 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __UnitColorView_hpp__
-#define __UnitColorView_hpp__
-
-#include &quot;Views/Components/View.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-#include &quot;2D/PackedSurface.hpp&quot;
-
-
-//---------------------------------------------------------------------------
-class UnitColorView : public View
-{
-private:
-    Surface       fuckingSurface;
-    Surface       grassSurface;
-    PackedSurface packedBody;
-    PackedSurface packedTurret;
-
-public:
-    UnitColorView();
-
-    virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
-    virtual void rMouseDown  (const iXY &amp;pos);
-    virtual void rMouseUp    (const iXY &amp;downPos, const iXY &amp;upPos);
-    virtual void rMouseDrag  (const iXY &amp;downPos, const iXY &amp;prevPos, const iXY &amp;newPos);
-}; // end UnitColorView
-
-#endif // end __UnitColorView_hpp__

Deleted: branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitSelectionView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/UnitSelectionView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitSelectionView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,61 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-#include &quot;UnitSelectionView.hpp&quot;
-#include &quot;Views/Game/GameView.hpp&quot;
-#include &quot;Views/GameViewGlobals.hpp&quot;
-
-// UnitSelectionView
-//---------------------------------------------------------------------------
-UnitSelectionView::UnitSelectionView() : View()
-{
-    setSearchName(&quot;UnitSelectionView&quot;);
-    setTitle(&quot;Selects Your Units&quot;);
-    setSubTitle(&quot;&quot;);
-
-    setAllowResize(false);
-    setAllowMove(false);
-    setDisplayStatusBar(true);
-    setVisible(false);
-
-    moveTo(bodyTextRect.min);
-
-    resize(bodyTextRect.getSize());
-
-    //setScrollBar(true);
-
-    maxYOffset =  0;
-
-    // Define the scrollBar fot this view.
-    scrollBar = new ScrollBar(ScrollBar::HORIZONTAL, 0, 1, 0, 100);
-
-    add(scrollBar);
-
-} // end UnitSelectionView::UnitSelectionView
-
-// doDraw
-//---------------------------------------------------------------------------
-void UnitSelectionView::doDraw(Surface &amp;viewArea, Surface &amp;clientArea)
-{
-    char strBuf[256];
-    sprintf(strBuf, &quot;%d&quot;, scrollBar-&gt;getValue());
-    clientArea.bltStringCenter(strBuf, Color::white);
-
-    View::doDraw(viewArea, clientArea);
-
-} // end UnitSelectionView::doDraw

Deleted: branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitSelectionView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/UnitSelectionView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Multi/UnitSelectionView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,44 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __UnitSelectionView_hpp__
-#define __UnitSelectionView_hpp__
-
-#include &quot;Views/Components/View.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-#include &quot;Views/Components/ScrollBar.hpp&quot;
-
-
-//---------------------------------------------------------------------------
-class UnitSelectionView : public View
-{
-private:
-    int  maxYOffset;
-
-    ScrollBar *scrollBar;
-
-public:
-    UnitSelectionView();
-    virtual ~UnitSelectionView()
-    {
-        delete scrollBar;
-    }
-
-    virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
-}; // end UnitSelectionView
-
-#endif // end __UnitSelectionView_hpp__

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Options/SoundView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Options/SoundView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Options/SoundView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -114,7 +114,7 @@
     checkBoxSoundEnabled-&gt;setState(gameconfig-&gt;enablesound);
     x += Surface::getTextLength(&quot;Sound Status: &quot;);
     checkBoxSoundEnabled-&gt;setLocation(x, y-2);
-    checkBoxSoundEnabled-&gt;setStateChangedCallback(this);
+    checkBoxSoundEnabled-&gt;stateChanged.connect(this, &amp;SoundView::onSoundCheckBoxModified);
     add(checkBoxSoundEnabled);
     y += yOffset;
 
@@ -134,7 +134,7 @@
     checkBoxMusicEnabled-&gt;setState(gameconfig-&gt;enablemusic);
     x += Surface::getTextLength(&quot;Music Status: &quot;);
     checkBoxMusicEnabled-&gt;setLocation(x, y-2);
-    checkBoxMusicEnabled-&gt;setStateChangedCallback(this);
+    checkBoxMusicEnabled-&gt;stateChanged.connect(this, &amp;SoundView::onMusicCheckBoxModified);
     add(checkBoxMusicEnabled);
     y += yOffset;
 
@@ -209,35 +209,35 @@
 
 } // end SoundView::loadTitleSurface
 
-void SoundView::stateChanged(Component* source)
+void SoundView::onSoundCheckBoxModified()
 {
-    if (source == checkBoxSoundEnabled) {
-        gameconfig-&gt;enablesound = checkBoxSoundEnabled-&gt;getState();
-        
-        delete sound;
+    gameconfig-&gt;enablesound = checkBoxSoundEnabled-&gt;getState();
 
-        if ( checkBoxSoundEnabled-&gt;getState() ) {
-            sound = new SDLSound();
-            checkBoxSoundEnabled-&gt;setLabel(&quot;Enabled&quot;);
-            if ( GameControlRulesDaemon::getGameState() ) {
-                sound-&gt;playTankIdle();
-            }
-            if ( checkBoxMusicEnabled-&gt;getState() )
-                sound-&gt;playMusic(&quot;sound/music/&quot;);
-        } else {
-            sound = new DummySound();
-            checkBoxSoundEnabled-&gt;setLabel(&quot;Disabled&quot;);
+    delete sound;
+
+    if ( checkBoxSoundEnabled-&gt;getState() ) {
+        sound = new SDLSound();
+        checkBoxSoundEnabled-&gt;setLabel(&quot;Enabled&quot;);
+        if ( GameControlRulesDaemon::getGameState() ) {
+            sound-&gt;playTankIdle();
         }
-    } else if (source == checkBoxMusicEnabled) {
-        gameconfig-&gt;enablemusic = checkBoxMusicEnabled-&gt;getState();
-        
-        if ( checkBoxMusicEnabled-&gt;getState() ) {
+        if ( checkBoxMusicEnabled-&gt;getState() )
             sound-&gt;playMusic(&quot;sound/music/&quot;);
-            checkBoxMusicEnabled-&gt;setLabel(&quot;Enabled&quot;);
-        } else {
-            sound-&gt;stopMusic();
-            checkBoxMusicEnabled-&gt;setLabel(&quot;Disabled&quot;);
-        }
+    } else {
+        sound = new DummySound();
+        checkBoxSoundEnabled-&gt;setLabel(&quot;Disabled&quot;);
     }
-    
 }
+
+void SoundView::onMusicCheckBoxModified()
+{
+    gameconfig-&gt;enablemusic = checkBoxMusicEnabled-&gt;getState();
+        
+    if ( checkBoxMusicEnabled-&gt;getState() ) {
+        sound-&gt;playMusic(&quot;sound/music/&quot;);
+        checkBoxMusicEnabled-&gt;setLabel(&quot;Enabled&quot;);
+    } else {
+        sound-&gt;stopMusic();
+        checkBoxMusicEnabled-&gt;setLabel(&quot;Disabled&quot;);
+    }
+}

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Options/SoundView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Options/SoundView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Options/SoundView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -21,7 +21,6 @@
 #include &quot;Views/Components/View.hpp&quot;
 #include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
 #include &quot;Views/Components/CheckBox.hpp&quot;
-#include &quot;Views/Components/StateChangedCallback.hpp&quot;
 
 /////////////////////////////////////////////////////////////////////////////
 // forward declarations
@@ -34,19 +33,21 @@
 /////////////////////////////////////////////////////////////////////////////
 
 //--------------------------------------------------------------------------
-class SoundView : public OptionsTemplateView, public StateChangedCallback
+class SoundView : public OptionsTemplateView
 {
 protected:
     virtual void loadTitleSurface();
     CheckBox * checkBoxSoundEnabled;
     CheckBox * checkBoxMusicEnabled;
 
+    void onSoundCheckBoxModified();
+    void onMusicCheckBoxModified();
+
 public:
     SoundView();
 
     virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
     virtual void initButtons();
-    virtual void stateChanged(Component* source);
 }; // end SoundView
 
 #endif // end __SoundView_hpp__

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Options/VisualsView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Options/VisualsView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Options/VisualsView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -58,7 +58,7 @@
     
     char res_str[20];
     choiceResolution = new Choice();
-    choiceResolution-&gt;setName(&quot;Resolution&quot;);
+    choiceResolution-&gt;setLabel(&quot;Resolution&quot;);
     choiceResolution-&gt;addItem(&quot;current&quot;);
     SDL_Rect** modes = SDL_ListModes(0, SDL_FULLSCREEN);
     int cur_mode = 0;
@@ -76,7 +76,7 @@
     choiceResolution-&gt;setLocation(x, y);
     choiceResolution-&gt;select(0);
     choiceResolution-&gt;setMinWidth(minWidth);
-    choiceResolution-&gt;setStateChangedCallback(this);
+    choiceResolution-&gt;stateChanged.connect(this, &amp;VisualsView::onResolutionChoiceModified);
     add(choiceResolution);
     
     current_width = 0;
@@ -85,19 +85,19 @@
     checkBoxFullscreen = new CheckBox();
     checkBoxFullscreen-&gt;setLabel(&quot;Fullscreen&quot;);
     checkBoxFullscreen-&gt;setLocation(x+ 200, y);
-    checkBoxFullscreen-&gt;setStateChangedCallback(this);
+    checkBoxFullscreen-&gt;stateChanged.connect(this, &amp;VisualsView::onFullscreenCheckBoxModified);
     add(checkBoxFullscreen);
     y += yOffset;
     y += yOffset;
     
     choiceMiniMapUnitSize = new Choice();
-    choiceMiniMapUnitSize-&gt;setName(&quot;Mini Map Unit Size&quot;);
+    choiceMiniMapUnitSize-&gt;setLabel(&quot;Mini Map Unit Size&quot;);
     choiceMiniMapUnitSize-&gt;addItem(&quot;Small&quot;);
     choiceMiniMapUnitSize-&gt;addItem(&quot;Large&quot;);
     choiceMiniMapUnitSize-&gt;setLocation(x, y);
     choiceMiniMapUnitSize-&gt;select(gameconfig-&gt;radar_unitsize);
     choiceMiniMapUnitSize-&gt;setMinWidth(minWidth);
-    choiceMiniMapUnitSize-&gt;setStateChangedCallback(this);
+    choiceMiniMapUnitSize-&gt;stateChanged.connect(this, &amp;VisualsView::onMiniMapUnitSizeChoiceModified);
     add(choiceMiniMapUnitSize);
     y += yOffset;
     y += yOffset;
@@ -111,7 +111,7 @@
     checkBoxDrawAllShadows-&gt;setLabel(&quot;Draw All Shadows&quot;);
     checkBoxDrawAllShadows-&gt;setState(GameConfig::video_shadows);
     checkBoxDrawAllShadows-&gt;setLocation(x, y);
-    checkBoxDrawAllShadows-&gt;setStateChangedCallback(this);
+    checkBoxDrawAllShadows-&gt;stateChanged.connect(this, &amp;VisualsView::onDrawAllShadowsCheckBoxModified);
     add(checkBoxDrawAllShadows);
     y += yOffset;
     
@@ -119,7 +119,7 @@
     checkBoxBlendSmoke-&gt;setLabel(&quot;Blend Smoke&quot;);
     checkBoxBlendSmoke-&gt;setState(GameConfig::video_blendsmoke);
     checkBoxBlendSmoke-&gt;setLocation(x, y);
-    checkBoxBlendSmoke-&gt;setStateChangedCallback(this);
+    checkBoxBlendSmoke-&gt;stateChanged.connect(this, &amp;VisualsView::onBlendSmokeCheckBoxModified);
     add(checkBoxBlendSmoke);
     y += yOffset;
 
@@ -128,18 +128,14 @@
     checkBoxUseDirectX-&gt;setLabel(&quot;Use DirectX&quot;);
     checkBoxUseDirectX-&gt;setState(GameConfig::video_usedirectx);
     checkBoxUseDirectX-&gt;setLocation(x, y);
-    checkBoxUseDirectX-&gt;setStateChangedCallback(this);
+    checkBoxUseDirectX-&gt;stateChanged.connect(this, &amp;VisualsView::onUseDirectXCheckBoxModified);
     add(checkBoxUseDirectX);
     y += yOffset;
 #endif
     
     //removeAllButtons();
     //removeComponents();
-    
 
-
-    
-    
     //add(&amp;choiceGameViewBackgroundColor);
     //add(&amp;choiceMiniMapObjectiveDrawMode);
     
@@ -164,7 +160,7 @@
 
     MenuTemplateView::doDraw(viewArea, clientArea);
 
-    View::doDraw(viewArea, clientArea);
+//    View::doDraw(viewArea, clientArea);
 
 } // end VisualsView::doDraw
 
@@ -182,70 +178,70 @@
     doLoadTitleSurface(&quot;visualsTitle&quot;);
 } // end VisualsView::loadTitleSurface
 
-// actionPerformed
-//---------------------------------------------------------------------------
-void VisualsView::stateChanged(Component* source)
+void VisualsView::onFullscreenCheckBoxModified()
 {
-    if ( source == checkBoxDrawAllShadows )
+    GameConfig::video_fullscreen = checkBoxFullscreen-&gt;getState();
+    GameManager::setVideoMode();
+}
+
+void VisualsView::onDrawAllShadowsCheckBoxModified()
+{
+    GameConfig::video_shadows = checkBoxDrawAllShadows-&gt;getState();
+}
+
+void VisualsView::onBlendSmokeCheckBoxModified()
+{
+    GameConfig::video_blendsmoke = checkBoxBlendSmoke-&gt;getState();
+}
+
+#ifdef _WIN32
+void VisualsView::onUseDirectXCheckBoxModified()
+{
+    GameConfig::video_usedirectx = checkBoxUseDirectX-&gt;getState();
+}
+#endif
+
+void VisualsView::onResolutionChoiceModified()
+{
+    int sel_index = choiceResolution-&gt;getSelectedIndex()-1;
+    if ( sel_index &lt; 0 )
     {
-        GameConfig::video_shadows = checkBoxDrawAllShadows-&gt;getState();
+        return;
     }
-    else if ( source == checkBoxBlendSmoke )
+
+    SDL_Rect** modes = SDL_ListModes(0, SDL_FULLSCREEN);
+    SDL_Rect* mode = 0;
+    if ( modes &amp;&amp; modes != (SDL_Rect**)-1 )
     {
-        GameConfig::video_blendsmoke = checkBoxBlendSmoke-&gt;getState();
+        mode = modes[sel_index];
     }
-    else if ( source == checkBoxFullscreen )
+
+    if ( mode )
     {
-        GameConfig::video_fullscreen = checkBoxFullscreen-&gt;getState();
-        GameManager::setVideoMode();
+        GameConfig::video_width = mode-&gt;w;
+        GameConfig::video_height = mode-&gt;h;
     }
-    else if ( source == choiceResolution )
+
+    if ( sel_index == 0 &amp;&amp; ! GameConfig::video_fullscreen )
     {
-        int sel_index = choiceResolution-&gt;getSelectedIndex()-1;
-        if ( sel_index &lt; 0 )
-        {
-            return;
-        }
+        // on Mac crash if we are in window and we select the biggest
+        // resolution (the first one in theory), we make it smaller so it
+        // wont crash, it is a SDL error.
+        GameConfig::video_height -= 50;
+    }
 
-        SDL_Rect** modes = SDL_ListModes(0, SDL_FULLSCREEN);
-        SDL_Rect* mode = 0;
-        if ( modes &amp;&amp; modes != (SDL_Rect**)-1 )
-        {
-            mode = modes[sel_index];
-        }
+    GameManager::setVideoMode();
+}
 
-        if ( mode )
-        {
-            GameConfig::video_width = mode-&gt;w;
-            GameConfig::video_height = mode-&gt;h;
-        }
-
-        if ( sel_index == 0 &amp;&amp; ! GameConfig::video_fullscreen )
-        {
-            // on Mac crash if we are in window and we select the biggest
-            // resolution (the first one in theory), we make it smaller so it
-            // wont crash, it is a SDL error.
-            GameConfig::video_height -= 50;
-        }
-
-        GameManager::setVideoMode();
-    }
-    else if ( source == choiceMiniMapUnitSize )
+void VisualsView::onMiniMapUnitSizeChoiceModified()
+{
+    if (choiceMiniMapUnitSize-&gt;getSelectedIndex() == 0)
     {
-        if (choiceMiniMapUnitSize-&gt;getSelectedIndex() == 0)
-        {
-            gameconfig-&gt;radar_unitsize = _mini_map_unit_size_small;
-        }
-        else if (choiceMiniMapUnitSize-&gt;getSelectedIndex() == 1)
-        {
-            gameconfig-&gt;radar_unitsize = _mini_map_unit_size_large;
-        }
+        gameconfig-&gt;radar_unitsize = _mini_map_unit_size_small;
     }
-#ifdef _WIN32
-    else if ( source == checkBoxUseDirectX )
+    else if (choiceMiniMapUnitSize-&gt;getSelectedIndex() == 1)
     {
-        GameConfig::video_usedirectx = checkBoxUseDirectX-&gt;getState();
+        gameconfig-&gt;radar_unitsize = _mini_map_unit_size_large;
     }
-#endif
 }
 

Modified: branches/krom/src/NetPanzer/Views/MainMenu/Options/VisualsView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Options/VisualsView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/Options/VisualsView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -23,7 +23,6 @@
 #include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
 #include &quot;Views/Components/CheckBox.hpp&quot;
 #include &quot;Views/Components/Choice.hpp&quot;
-#include &quot;Views/Components/StateChangedCallback.hpp&quot;
 
 /////////////////////////////////////////////////////////////////////////////
 // forward declarations
@@ -36,28 +35,38 @@
 /////////////////////////////////////////////////////////////////////////////
 
 //--------------------------------------------------------------------------
-class VisualsView : public OptionsTemplateView, public StateChangedCallback
+class VisualsView : public OptionsTemplateView
 {
 private:
     int      selectedColorStartY;
 
     // Option check boxes.
+    CheckBox * checkBoxFullscreen;
     CheckBox * checkBoxDrawAllShadows;
     CheckBox * checkBoxBlendSmoke;
-    CheckBox * checkBoxFullscreen;
+
+    void onFullscreenCheckBoxModified();
+    void onDrawAllShadowsCheckBoxModified();
+    void onBlendSmokeCheckBoxModified();
+
 #ifdef _WIN32
     CheckBox * checkBoxUseDirectX;
+    void onUseDirectXCheckBoxModified();
 #endif
     //CheckBox drawUnitReload;
 
+
     // Option choices.
     Choice   * choiceResolution;
+    void onResolutionChoiceModified();
+
     unsigned int current_width;
     unsigned int current_height;
 
     Choice   * choiceGameViewBackgroundColor;
     Choice   * choiceMiniMapObjectiveDrawMode;
     Choice   * choiceMiniMapUnitSize;
+    void onMiniMapUnitSizeChoiceModified();
     Choice   * choiceUnitSelectionDrawMode;
 
     //Choice   choiceUnitInfoDrawLayer;
@@ -81,7 +90,6 @@
     virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
     virtual void processEvents();
     virtual void initButtons();
-    virtual void stateChanged(Component* source);
 }
 ; // end VisualsView
 

Modified: branches/krom/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -30,7 +30,7 @@
         Desktop::setVisibility(&quot;SoundView&quot;, false);
         Desktop::setVisibility(&quot;OptionsView&quot;, false);
     } else {
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
     }
 
     Desktop::setVisibility(&quot;InterfaceView&quot;, true);
@@ -45,7 +45,7 @@
         Desktop::setVisibility(&quot;SoundView&quot;, false);
         Desktop::setVisibility(&quot;OptionsView&quot;, false);
     } else {
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
     }
 
     Desktop::setVisibility(&quot;VisualsView&quot;, true);
@@ -60,7 +60,7 @@
         //Desktop::setVisibility(&quot;SoundView&quot;, false);
         Desktop::setVisibility(&quot;OptionsView&quot;, false);
     } else {
-        Desktop::setVisibilityAllWindows(false);
+        Desktop::hideAllWindows();
     }
     Desktop::setVisibility(&quot;SoundView&quot;, true);
     //Desktop::setVisibility(&quot;VisualsView&quot;, true);
@@ -84,7 +84,6 @@
 //---------------------------------------------------------------------------
 void OptionsTemplateView::initButtons()
 {
-    removeAllButtons();
     removeComponents();
 
     MenuTemplateView::initButtons();

Deleted: branches/krom/src/NetPanzer/Views/MainMenu/SkirmishView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/SkirmishView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/SkirmishView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,42 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;SkirmishView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
-#include &quot;Views/GameViewGlobals.hpp&quot;
-
-// SkirmishView
-//---------------------------------------------------------------------------
-SkirmishView::SkirmishView() : MenuTemplateView()
-{
-    setSearchName(&quot;SkirmishView&quot;);
-    setTitle(&quot;Skirmish Options&quot;);
-    setSubTitle(&quot;&quot;);
-
-} // end SkirmishView::SkirmishView
-
-// doDraw
-//---------------------------------------------------------------------------
-void SkirmishView::doDraw(Surface &amp;viewArea, Surface &amp;clientArea)
-{
-    MenuTemplateView::doDraw(viewArea, clientArea);
-
-    clientArea.bltString(100, 200, &quot;Umm... complete me!&quot;, Color::white);
-
-} // end SkirmishView::doDraw

Deleted: branches/krom/src/NetPanzer/Views/MainMenu/SkirmishView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/SkirmishView.hpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/SkirmishView.hpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -1,34 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __SkirmishView_hpp__
-#define __SkirmishView_hpp__
-
-#include &quot;Views/Components/View.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-#include &quot;Views/MainMenu/MenuTemplateView.hpp&quot;
-
-//--------------------------------------------------------------------------
-class SkirmishView : public MenuTemplateView
-{
-public:
-    SkirmishView();
-
-    virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
-}; // end SkirmishView
-
-#endif // end __SkirmishView_hpp__

Modified: branches/krom/src/NetPanzer/Views/MainMenu/SpecialButtonView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/SpecialButtonView.cpp	2010-11-18 12:47:46 UTC (rev 1228)
+++ branches/krom/src/NetPanzer/Views/MainMenu/SpecialButtonView.cpp	2011-09-06 15:03:18 UTC (rev 1229)
@@ -22,6 +22,7 @@
 #include &quot;2D/PackedSurface.hpp&quot;
 #include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Util/Exception.hpp&quot;
+#include &quot;Util/Log.hpp&quot;
 #include &quot;Classes/WorldInputCmdProcessor.hpp&quot;
 
 // addSpecialButton


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000256.html">[Netpanzer-cvs] r1230 - trunk/netpanzer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#255">[ date ]</a>
              <a href="thread.html#255">[ thread ]</a>
              <a href="subject.html#255">[ subject ]</a>
              <a href="author.html#255">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">More information about the Netpanzer-cvs
mailing list</a><br>
</body></html>
