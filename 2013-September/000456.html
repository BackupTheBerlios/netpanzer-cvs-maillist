<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Netpanzer-cvs] r1435 - in trunk/netpanzer:	projects/netpanzer-svn-windows/nbproject	projects/netpanzer-svn-windows/nbproject/private src/Lib/2D	src/NetPanzer/Classes src/NetPanzer/Core	src/NetPanzer/Interfaces src/NetPanzer/Network	src/NetPanzer/Scenes src/NetPanzer/Scenes/MainMenu
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/netpanzer-cvs/2013-September/index.html" >
   <LINK REL="made" HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1435%20-%20in%20trunk/netpanzer%3A%0A%09projects/netpanzer-svn-windows/nbproject%0A%09projects/netpanzer-svn-windows/nbproject/private%20src/Lib/2D%0A%09src/NetPanzer/Classes%20src/NetPanzer/Core%0A%09src/NetPanzer/Interfaces%20src/NetPanzer/Network%0A%09src/NetPanzer/Scenes%20src/NetPanzer/Scenes/MainMenu&In-Reply-To=%3C20130914135044.7C8C855B0C%40scm.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000455.html">
   <LINK REL="Next"  HREF="000457.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Netpanzer-cvs] r1435 - in trunk/netpanzer:	projects/netpanzer-svn-windows/nbproject	projects/netpanzer-svn-windows/nbproject/private src/Lib/2D	src/NetPanzer/Classes src/NetPanzer/Core	src/NetPanzer/Interfaces src/NetPanzer/Network	src/NetPanzer/Scenes src/NetPanzer/Scenes/MainMenu</H1>
    <B>kromxp at scm.berlios.de</B> 
    <A HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1435%20-%20in%20trunk/netpanzer%3A%0A%09projects/netpanzer-svn-windows/nbproject%0A%09projects/netpanzer-svn-windows/nbproject/private%20src/Lib/2D%0A%09src/NetPanzer/Classes%20src/NetPanzer/Core%0A%09src/NetPanzer/Interfaces%20src/NetPanzer/Network%0A%09src/NetPanzer/Scenes%20src/NetPanzer/Scenes/MainMenu&In-Reply-To=%3C20130914135044.7C8C855B0C%40scm.berlios.de%3E"
       TITLE="[Netpanzer-cvs] r1435 - in trunk/netpanzer:	projects/netpanzer-svn-windows/nbproject	projects/netpanzer-svn-windows/nbproject/private src/Lib/2D	src/NetPanzer/Classes src/NetPanzer/Core	src/NetPanzer/Interfaces src/NetPanzer/Network	src/NetPanzer/Scenes src/NetPanzer/Scenes/MainMenu">kromxp at scm.berlios.de
       </A><BR>
    <I>Sat Sep 14 15:50:43 CEST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000455.html">[Netpanzer-cvs] r1434 - in trunk/netpanzer:	projects/netpanzer-svn-windows/nbproject	projects/netpanzer-svn-windows/nbproject/private src	src/Lib/2D src/NetPanzer/Actions	src/NetPanzer/Scenes/MainMenu src/NetPanzer/Views	src/NetPanzer/Views/Components src/NetPanzer/Views/Game
</A></li>
        <LI>Next message: <A HREF="000457.html">[Netpanzer-cvs] r1436 - in trunk/netpanzer:	projects/netpanzer-svn-windows/nbproject/private	src/NetPanzer/Classes src/NetPanzer/Network	src/NetPanzer/Scenes/MainMenu
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#456">[ date ]</a>
              <a href="thread.html#456">[ thread ]</a>
              <a href="subject.html#456">[ subject ]</a>
              <a href="author.html#456">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: kromxp
Date: 2013-09-14 15:50:43 +0200 (Sat, 14 Sep 2013)
New Revision: 1435

Added:
   trunk/netpanzer/src/NetPanzer/Classes/ServerListDataSource.cpp
   trunk/netpanzer/src/NetPanzer/Classes/ServerListDataSource.hpp
   trunk/netpanzer/src/NetPanzer/Network/GameserverQuerier.cpp
   trunk/netpanzer/src/NetPanzer/Network/GameserverQuerier.hpp
   trunk/netpanzer/src/NetPanzer/Network/MasterserverQuerier.cpp
   trunk/netpanzer/src/NetPanzer/Network/MasterserverQuerier.hpp
   trunk/netpanzer/src/NetPanzer/Network/ServerAddress.hpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.cpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.hpp
Removed:
   trunk/netpanzer/src/NetPanzer/Classes/GameServerList.hpp
Modified:
   trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/configurations.xml
   trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/configurations.xml
   trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/private.xml
   trunk/netpanzer/src/Lib/2D/ComponentLayer.cpp
   trunk/netpanzer/src/Lib/2D/ComponentLayer.hpp
   trunk/netpanzer/src/Lib/2D/SceneManager.cpp
   trunk/netpanzer/src/Lib/2D/SceneManager.hpp
   trunk/netpanzer/src/NetPanzer/Classes/GameServerInfo.hpp
   trunk/netpanzer/src/NetPanzer/Core/main.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/GameConfig.cpp
   trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.cpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/HostGameLayer.cpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/IntroLayer.cpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/IntroLayer.hpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/JoinGameLayer.cpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/JoinGameLayer.hpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp
Log:
More work on join game view, query and show game list

Modified: trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/configurations.xml
===================================================================
--- trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/configurations.xml	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/configurations.xml	2013-09-14 13:50:43 UTC (rev 1435)
@@ -421,6 +421,8 @@
             &lt;in&gt;SelectionBoxSprite.hpp&lt;/in&gt;
             &lt;in&gt;SelectionList.cpp&lt;/in&gt;
             &lt;in&gt;SelectionList.hpp&lt;/in&gt;
+            &lt;in&gt;ServerListDataSource.cpp&lt;/in&gt;
+            &lt;in&gt;ServerListDataSource.hpp&lt;/in&gt;
             &lt;in&gt;SpawnList.cpp&lt;/in&gt;
             &lt;in&gt;SpawnList.hpp&lt;/in&gt;
             &lt;in&gt;Sprite.cpp&lt;/in&gt;
@@ -513,14 +515,19 @@
             &lt;/df&gt;
             &lt;in&gt;ClientSocket.cpp&lt;/in&gt;
             &lt;in&gt;ClientSocket.hpp&lt;/in&gt;
+            &lt;in&gt;GameserverQuerier.cpp&lt;/in&gt;
+            &lt;in&gt;GameserverQuerier.hpp&lt;/in&gt;
             &lt;in&gt;HTTPClientSocket.cpp&lt;/in&gt;
             &lt;in&gt;HTTPClientSocket.hpp&lt;/in&gt;
             &lt;in&gt;HTTPServerSocket.cpp&lt;/in&gt;
             &lt;in&gt;HTTPServerSocket.hpp&lt;/in&gt;
+            &lt;in&gt;MasterserverQuerier.cpp&lt;/in&gt;
+            &lt;in&gt;MasterserverQuerier.hpp&lt;/in&gt;
             &lt;in&gt;NewsGetter.cpp&lt;/in&gt;
             &lt;in&gt;NewsGetter.hpp&lt;/in&gt;
             &lt;in&gt;ProxyServer.cpp&lt;/in&gt;
             &lt;in&gt;ProxyServer.hpp&lt;/in&gt;
+            &lt;in&gt;ServerAddress.hpp&lt;/in&gt;
             &lt;in&gt;WebSocketUtil.cpp&lt;/in&gt;
             &lt;in&gt;WebSocketUtil.hpp&lt;/in&gt;
           &lt;/df&gt;
@@ -599,6 +606,8 @@
               &lt;in&gt;IntroLayer.hpp&lt;/in&gt;
               &lt;in&gt;JoinGameLayer.cpp&lt;/in&gt;
               &lt;in&gt;JoinGameLayer.hpp&lt;/in&gt;
+              &lt;in&gt;MapThumbnailComponent.cpp&lt;/in&gt;
+              &lt;in&gt;MapThumbnailComponent.hpp&lt;/in&gt;
             &lt;/df&gt;
             &lt;in&gt;InitialScene.cpp&lt;/in&gt;
             &lt;in&gt;InitialScene.hpp&lt;/in&gt;
@@ -772,6 +781,7 @@
               &lt;Elem&gt;PHYSFS_NO_CDROM_SUPPORT=1&lt;/Elem&gt;
               &lt;Elem&gt;PHYSFS_SUPPORTS_ZIP=1&lt;/Elem&gt;
               &lt;Elem&gt;Z_PREFIX=1&lt;/Elem&gt;
+              &lt;Elem&gt;_WIN32_WINNT=0x0501&lt;/Elem&gt;
               &lt;Elem&gt;__WIN32__&lt;/Elem&gt;
             &lt;/preprocessorList&gt;
           &lt;/cTool&gt;
@@ -3463,6 +3473,16 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Classes/ServerListDataSource.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Classes/ServerListDataSource.hpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;3&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Classes/SpawnList.cpp&quot;
             ex=&quot;false&quot;
             tool=&quot;1&quot;
@@ -4518,6 +4538,16 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Network/GameserverQuerier.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Network/GameserverQuerier.hpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;3&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Network/HTTPClientSocket.cpp&quot;
             ex=&quot;false&quot;
             tool=&quot;1&quot;
@@ -4576,6 +4606,16 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Network/MasterserverQuerier.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Network/MasterserverQuerier.hpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;3&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Network/NewsGetter.cpp&quot;
             ex=&quot;false&quot;
             tool=&quot;1&quot;
@@ -4703,6 +4743,11 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Network/ServerAddress.hpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;3&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Network/WebSocketUtil.cpp&quot;
             ex=&quot;false&quot;
             tool=&quot;1&quot;
@@ -5515,6 +5560,16 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.hpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;3&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Scenes/MainMenuScene.cpp&quot;
             ex=&quot;false&quot;
             tool=&quot;1&quot;
@@ -7200,6 +7255,7 @@
               &lt;Elem&gt;PHYSFS_NO_CDROM_SUPPORT=1&lt;/Elem&gt;
               &lt;Elem&gt;PHYSFS_SUPPORTS_ZIP=1&lt;/Elem&gt;
               &lt;Elem&gt;Z_PREFIX=1&lt;/Elem&gt;
+              &lt;Elem&gt;_WIN32_WINNT=0x0501&lt;/Elem&gt;
               &lt;Elem&gt;__WIN32__&lt;/Elem&gt;
             &lt;/preprocessorList&gt;
           &lt;/cTool&gt;
@@ -9891,6 +9947,16 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Classes/ServerListDataSource.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Classes/ServerListDataSource.hpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;3&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Classes/SpawnList.cpp&quot;
             ex=&quot;false&quot;
             tool=&quot;1&quot;
@@ -10946,6 +11012,16 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Network/GameserverQuerier.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Network/GameserverQuerier.hpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;3&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Network/HTTPClientSocket.cpp&quot;
             ex=&quot;false&quot;
             tool=&quot;1&quot;
@@ -11004,6 +11080,16 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Network/MasterserverQuerier.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Network/MasterserverQuerier.hpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;3&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Network/NewsGetter.cpp&quot;
             ex=&quot;false&quot;
             tool=&quot;1&quot;
@@ -11131,6 +11217,11 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Network/ServerAddress.hpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;3&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Network/WebSocketUtil.cpp&quot;
             ex=&quot;false&quot;
             tool=&quot;1&quot;
@@ -11943,6 +12034,16 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.hpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;3&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Scenes/MainMenuScene.cpp&quot;
             ex=&quot;false&quot;
             tool=&quot;1&quot;

Modified: trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/configurations.xml
===================================================================
--- trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/configurations.xml	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/configurations.xml	2013-09-14 13:50:43 UTC (rev 1435)
@@ -1269,7 +1269,6 @@
               &lt;in&gt;UnitNetMessage.hpp&lt;/in&gt;
             &lt;/df&gt;
             &lt;in&gt;GameServerInfo.hpp&lt;/in&gt;
-            &lt;in&gt;GameServerList.hpp&lt;/in&gt;
             &lt;in&gt;MapFile.hpp&lt;/in&gt;
             &lt;in&gt;OpcodeDebugger.cpp&lt;/in&gt;
             &lt;in&gt;OpcodeDebugger.hpp&lt;/in&gt;
@@ -1285,6 +1284,8 @@
             &lt;in&gt;SelectionBoxSprite.hpp&lt;/in&gt;
             &lt;in&gt;SelectionList.cpp&lt;/in&gt;
             &lt;in&gt;SelectionList.hpp&lt;/in&gt;
+            &lt;in&gt;ServerListDataSource.cpp&lt;/in&gt;
+            &lt;in&gt;ServerListDataSource.hpp&lt;/in&gt;
             &lt;in&gt;SpawnList.cpp&lt;/in&gt;
             &lt;in&gt;SpawnList.hpp&lt;/in&gt;
             &lt;in&gt;Sprite.cpp&lt;/in&gt;
@@ -1378,14 +1379,19 @@
             &lt;/df&gt;
             &lt;in&gt;ClientSocket.cpp&lt;/in&gt;
             &lt;in&gt;ClientSocket.hpp&lt;/in&gt;
+            &lt;in&gt;GameserverQuerier.cpp&lt;/in&gt;
+            &lt;in&gt;GameserverQuerier.hpp&lt;/in&gt;
             &lt;in&gt;HTTPClientSocket.cpp&lt;/in&gt;
             &lt;in&gt;HTTPClientSocket.hpp&lt;/in&gt;
             &lt;in&gt;HTTPServerSocket.cpp&lt;/in&gt;
             &lt;in&gt;HTTPServerSocket.hpp&lt;/in&gt;
+            &lt;in&gt;MasterserverQuerier.cpp&lt;/in&gt;
+            &lt;in&gt;MasterserverQuerier.hpp&lt;/in&gt;
             &lt;in&gt;NewsGetter.cpp&lt;/in&gt;
             &lt;in&gt;NewsGetter.hpp&lt;/in&gt;
             &lt;in&gt;ProxyServer.cpp&lt;/in&gt;
             &lt;in&gt;ProxyServer.hpp&lt;/in&gt;
+            &lt;in&gt;ServerAddress.hpp&lt;/in&gt;
             &lt;in&gt;WebSocketUtil.cpp&lt;/in&gt;
             &lt;in&gt;WebSocketUtil.hpp&lt;/in&gt;
           &lt;/df&gt;
@@ -1464,6 +1470,8 @@
               &lt;in&gt;IntroLayer.hpp&lt;/in&gt;
               &lt;in&gt;JoinGameLayer.cpp&lt;/in&gt;
               &lt;in&gt;JoinGameLayer.hpp&lt;/in&gt;
+              &lt;in&gt;MapThumbnailComponent.cpp&lt;/in&gt;
+              &lt;in&gt;MapThumbnailComponent.hpp&lt;/in&gt;
             &lt;/df&gt;
             &lt;in&gt;InitialScene.cpp&lt;/in&gt;
             &lt;in&gt;InitialScene.hpp&lt;/in&gt;

Modified: trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/private.xml
===================================================================
--- trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/private.xml	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/private.xml	2013-09-14 13:50:43 UTC (rev 1435)
@@ -10,12 +10,15 @@
     &lt;editor-bookmarks xmlns=&quot;<A HREF="http://www.netbeans.org/ns/editor-bookmarks/2">http://www.netbeans.org/ns/editor-bookmarks/2</A>&quot; lastBookmarkId=&quot;0&quot;/&gt;
     &lt;open-files xmlns=&quot;<A HREF="http://www.netbeans.org/ns/projectui-open-files/2">http://www.netbeans.org/ns/projectui-open-files/2</A>&quot;&gt;
         &lt;group&gt;
-            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/NetPanzer/Scenes/MainMenu/IntroLayer.cpp&lt;/file&gt;
-            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/2D/Components/Table.hpp&lt;/file&gt;
-            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/NetPanzer/Views/MainMenu/Multi/ServerListView.hpp&lt;/file&gt;
-            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/NetPanzer/Views/MainMenu/Multi/ServerListView.cpp&lt;/file&gt;
-            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/2D/Components/Table.cpp&lt;/file&gt;
-            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/NetPanzer/Scenes/MainMenu/IntroLayer.hpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/2D/Layer.hpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/NetPanzer/Network/MasterserverQuerier.hpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/NetPanzer/Classes/GameServerInfo.hpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/ArrayUtil/PtrArray.hpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/NetPanzer/Network/MasterserverQuerier.cpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/NetPanzer/Scenes/MainMenu/JoinGameLayer.cpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/NetPanzer/Scenes/MainMenu/JoinGameLayer.hpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/2D/ComponentLayer.hpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/Network/Address.hpp&lt;/file&gt;
         &lt;/group&gt;
     &lt;/open-files&gt;
     &lt;preferences xmlns=&quot;<A HREF="http://www.netbeans.org/ns/auxiliary-configuration-preferences/1">http://www.netbeans.org/ns/auxiliary-configuration-preferences/1</A>&quot;&gt;

Modified: trunk/netpanzer/src/Lib/2D/ComponentLayer.cpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/ComponentLayer.cpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/Lib/2D/ComponentLayer.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -46,6 +46,12 @@
     visible_components.push_back(c);
 }
 
+void ComponentLayer::setSubLayer(ComponentLayer* sublayer)
+{
+     this-&gt;sublayer = sublayer;
+     sublayer-&gt;recalculateComponentLocations();
+}
+
 void ComponentLayer::draw() const
 {
     for ( size_t n = 0; n &lt; visible_components.size(); n++ )
@@ -223,6 +229,7 @@
 void ComponentLayer::onSceneActivated()
 {
     GameInput::InputManager::pushInputHandler(this);
+    recalculateComponentLocations();
 }
 
 void ComponentLayer::onSceneDeactivated()

Modified: trunk/netpanzer/src/Lib/2D/ComponentLayer.hpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/ComponentLayer.hpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/Lib/2D/ComponentLayer.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -39,16 +39,16 @@
     ComponentEvents component_events;
 
     void addComponent(Component * c);
-    void setSubLayer(ComponentLayer * sublayer) { this-&gt;sublayer = sublayer; }
+    void setSubLayer(ComponentLayer * sublayer);
 
     virtual void recalculateComponentLocations() { }
     virtual void handleComponentEvents() {}
 
     void setModal(bool modal) { this-&gt;modal = modal; }
+    virtual void logic();
     
 private:
     void draw() const;
-    virtual void logic();
     Component * reverseSearchComponentAt( const int x, const int y);
 
     bool handleInput( GameInput::InputState * input );

Modified: trunk/netpanzer/src/Lib/2D/SceneManager.cpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/SceneManager.cpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/Lib/2D/SceneManager.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -46,6 +46,7 @@
 #include &quot;2D/Palette.hpp&quot;
 #include &quot;Interfaces/GameManager.hpp&quot;
 #include &quot;System/SDLVideo.hpp&quot;
+#include &quot;Network/NetworkManager.hpp&quot;
 
 static Scene * current_scene = 0;
 static bool shall_run = false;
@@ -90,6 +91,8 @@
 {
     current_scene = first_scene;
 
+    network::NetworkManager::initialize();
+    
     GameInput::InputManager::initialize();
     dih = new DefaultInputHandler();
     GameInput::InputManager::pushInputHandler(dih);
@@ -98,8 +101,16 @@
     return shall_run;
 }
 
+void SceneManager::deinit()
+{
+    // @todo network may not close properly sockets, do it.
+    network::NetworkManager::cleanUp();
+}
+
 bool SceneManager::run()
 {
+    network::NetworkManager::run();
+    
     GameInput::InputManager::logic();
     
     current_scene-&gt;doLogic();

Modified: trunk/netpanzer/src/Lib/2D/SceneManager.hpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/SceneManager.hpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/Lib/2D/SceneManager.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -28,6 +28,7 @@
 {
 public:
     static bool init( Scene * first_scene );
+    static void deinit();
     
     static bool run();
     

Modified: trunk/netpanzer/src/NetPanzer/Classes/GameServerInfo.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/GameServerInfo.hpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Classes/GameServerInfo.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -23,12 +23,13 @@
 #define	GAMESERVERINFO_HPP
 
 #include &quot;Core/CoreTypes.hpp&quot;
+#include &quot;Network/Address.hpp&quot;
 
 class GameServerInfo
 {
 public:
     GameServerInfo(const NPString&amp; ip, const uint16_t port)
-        : query_state(NOT_STARTED), ip(ip), port(port)
+        : query_state(NOT_STARTED), ip(ip), port(port), retryNum(0)
     {
         // nothing
     }
@@ -41,9 +42,11 @@
         TIMEOUT
     } query_state;
 
+    network::Address address;
     NPString ip;
     uint16_t port;
 
+    NPString server_name;
     NPString current_map;
     NPString map_cycle;
     bool needs_password;
@@ -57,6 +60,12 @@
     unsigned time_limit;
     unsigned frag_limit;
     unsigned objective_limit;
+    
+    NPString game_version;
+    unsigned protocol;
+    unsigned queryTimestamp;
+    unsigned ping;
+    unsigned retryNum;
 };
 
 #endif	/* GAMESERVERINFO_HPP */

Deleted: trunk/netpanzer/src/NetPanzer/Classes/GameServerList.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/GameServerList.hpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Classes/GameServerList.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -1,45 +0,0 @@
-/*
-Copyright (C) 2013 Netpanzer Team. (www.netpanzer.org), Aaron Perez Sanchez
-
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
-
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
-
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-
- *
- * Created on February 2, 2013, 12:50 AM
- */
-
-#ifndef GAMESERVERLIST_HPP
-#define	GAMESERVERLIST_HPP
-
-class GameServerList
-{
-private:
-    void* operator new(size_t);          // standard new
-    void* operator new(size_t, void*);   // placement new
-    void* operator new[](size_t);        // array new
-    void* operator new[](size_t, void*); // placement array new
-
-public:
-    GameServerList();
-    virtual ~GameServerList();
-
-    virtual void onLoad() = 0;
-    virtual void onNewList() = 0;
-    virtual void onBeginUpdatingNewList() {};
-
-    void updateServerList();
-};
-
-#endif	/* GAMESERVERLIST_HPP */
-

Added: trunk/netpanzer/src/NetPanzer/Classes/ServerListDataSource.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/ServerListDataSource.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Classes/ServerListDataSource.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -0,0 +1,141 @@
+/*
+Copyright (C) 2013 Netpanzer Team. (www.netpanzer.org), Aaron Perez
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ * 
+ * Created on September 14, 2013, 3:41 PM
+ */
+
+#include &quot;ServerListDataSource.hpp&quot;
+#include &quot;2D/TextRenderingSystem.hpp&quot;
+
+#include &lt;sstream&gt;
+
+class ServerRowPainter : public Table::RowPainter
+{
+public:
+    ServerRowPainter() {}
+    ~ServerRowPainter() {}
+    
+    void setServerInfo(const GameServerInfo * si)
+    {
+        if ( si-&gt;query_state == GameServerInfo::TIMEOUT )
+        {
+            std::stringstream sn;
+            sn &lt;&lt; si-&gt;ip &lt;&lt; ':' &lt;&lt; si-&gt;port;
+            name.setText(sn.str().c_str());
+            map.setText(&quot;&quot;);
+            players.setText(&quot;&quot;);
+            type.setText(&quot;&quot;);
+            
+            std::stringstream pi;
+            pi &lt;&lt; si-&gt;ping;
+
+            ping.setText(pi.str().c_str());
+        }
+        else
+        {
+            name.setText(si-&gt;server_name.c_str());
+            map.setText(si-&gt;current_map.c_str());
+
+            std::stringstream p;
+            p &lt;&lt; si-&gt;current_players &lt;&lt; '/' &lt;&lt; si-&gt;max_players;
+            players.setText(p.str().c_str());
+
+            type.setText(si-&gt;gamestyle.c_str());
+
+            std::stringstream pi;
+            pi &lt;&lt; si-&gt;ping;
+
+            ping.setText(pi.str().c_str());
+        }
+    }
+    
+    void paintCell(Surface&amp; dest, const int x, const int y, const iRect&amp; rect, const unsigned column) const
+    {
+        switch ( column )
+        {
+            case 0: name.drawPart(dest, x, y, rect); break;
+            case 1: map.drawPart(dest, x, y, rect); break;
+            case 2: players.drawPart(dest, x, y, rect); break;
+            case 3: type.drawPart(dest, x, y, rect); break;
+            case 4: ping.drawPart(dest, x, y, rect); break;
+        }
+    }
+    
+    // name, map, players, type, ping
+    
+    TextRenderer name;
+    TextRenderer map;
+    TextRenderer players;
+    TextRenderer type;
+    TextRenderer ping;
+};
+
+ServerListDataSource::ServerListDataSource()
+: Table::DataSource()
+{
+    
+}
+
+ServerListDataSource::~ServerListDataSource()
+{
+    
+}
+
+unsigned ServerListDataSource::getRowCount() const
+{
+    return servers.size();
+}
+
+unsigned ServerListDataSource::getRowHeight() const
+{
+     return TextRenderingSystem::line_height();
+}
+
+Table::RowPainter * ServerListDataSource::newRowPainter() const
+{
+     return new ServerRowPainter();
+}
+
+void ServerListDataSource::configureRowPainter(Table::RowPainter* painter, const unsigned row) const
+{
+    ServerRowPainter * p = static_cast&lt;ServerRowPainter*&gt;(painter);
+    if ( row &lt; servers.size() )
+    {
+        p-&gt;setServerInfo(servers[row]);
+    }
+}
+
+void ServerListDataSource::addServer(GameServerInfo* data)
+{
+    servers.push_back(data);
+    notifyDataChanged();
+}
+
+void ServerListDataSource::clear()
+{
+    servers.deleteAll();
+    notifyDataChanged();
+}
+
+const GameServerInfo * ServerListDataSource::getServerInfo(const unsigned index) const
+{
+    if ( index &lt; servers.size() )
+    {
+        return servers[index];
+    }
+    return 0;
+}

Added: trunk/netpanzer/src/NetPanzer/Classes/ServerListDataSource.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/ServerListDataSource.hpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Classes/ServerListDataSource.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -0,0 +1,56 @@
+/*
+Copyright (C) 2013 Netpanzer Team. (www.netpanzer.org), Aaron Perez
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * Created on September 14, 2013, 3:41 PM
+ */
+
+#ifndef SERVERLISTDATASOURCE_HPP
+#define	SERVERLISTDATASOURCE_HPP
+
+#include &quot;2D/Components/Table.hpp&quot;
+#include &quot;ArrayUtil/PtrArray.hpp&quot;
+#include &quot;Classes/GameServerInfo.hpp&quot;
+
+class ServerListDataSource : public Table::DataSource
+{
+public:
+    ServerListDataSource();
+    ~ServerListDataSource();
+    
+    unsigned getRowCount() const;
+
+    unsigned getRowHeight() const;
+
+    Table::RowPainter * newRowPainter() const;
+
+    void configureRowPainter(Table::RowPainter * painter, const unsigned row) const;
+    
+    void addServer(GameServerInfo * data);
+    
+    void clear();
+    
+    const GameServerInfo * getServerInfo(const unsigned index) const;
+    
+private:
+    ServerListDataSource(const ServerListDataSource&amp; );
+    
+    PtrArray&lt;GameServerInfo&gt; servers;
+
+};
+
+#endif	/* SERVERLISTDATASOURCE_HPP */
+

Modified: trunk/netpanzer/src/NetPanzer/Core/main.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Core/main.cpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Core/main.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -302,6 +302,8 @@
         {
             while ( SceneManager::run() )
                 ;
+            
+            SceneManager::deinit();
         }
 
 //        manager-&gt;shutdown();

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/GameConfig.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/GameConfig.cpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/GameConfig.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -359,7 +359,7 @@
 
     if ( ! server_masterservers )
     {
-        server_masterservers = new NPString(&quot;masterserver.netpanzer.org, masterserver2.netpanzer.org, masterserver.netpanzer.info&quot;);
+        server_masterservers = new NPString(&quot;masterserver.netpanzer.org, masterserver.netpanzer.info&quot;);
     }
 
     if ( ! server_name )

Added: trunk/netpanzer/src/NetPanzer/Network/GameserverQuerier.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Network/GameserverQuerier.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Network/GameserverQuerier.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -0,0 +1,268 @@
+/*
+Copyright (C) 2013 Netpanzer Team. (www.netpanzer.org), Aaron Perez
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ * 
+ * Created on September 14, 2013, 12:15 PM
+ */
+
+#include &quot;GameserverQuerier.hpp&quot;
+#include &quot;Util/Log.hpp&quot;
+#include &quot;Util/StringTokenizer.hpp&quot;
+#include &quot;Classes/ServerListDataSource.hpp&quot;
+#include &lt;sstream&gt;
+#include &lt;string&gt;
+
+#define MAXQUERY (5)
+#define SERVERTIMEOUT (2000)
+
+const char query[] = &quot;\\status\\final\\&quot;;
+
+GameserverQuerier::GameserverQuerier(ServerListDataSource * ds) : udpsocket(0), ds(ds)
+{
+    
+}
+
+GameserverQuerier::~GameserverQuerier()
+{
+    if ( udpsocket )
+    {
+        udpsocket-&gt;destroy();
+        udpsocket = 0;
+    }
+}
+
+void GameserverQuerier::onDataReceived(network::UDPSocket* so, const network::Address&amp; from, const char* data, const int len)
+{
+    (void)so;
+    std::stringstream fromaddress;
+    fromaddress &lt;&lt; from.getIP() &lt;&lt; &quot;:&quot; &lt;&lt; from.getPort();
+    
+    const std::string address(from.getIP());
+    const uint16_t port(from.getPort());
+    
+    bool found = false;
+    
+    for ( unsigned n = 0; n &lt; checking_servers.size(); n++ )
+    {
+        GameServerInfo * info = checking_servers[n];
+        if ( (info-&gt;ip == address) &amp;&amp; (info-&gt;port == port) )
+        {
+            found = true;
+            NPString str;
+            str.append(data, len);
+            
+            parseServerData(info, str);
+            
+            // *info now owned by ds
+            
+            checking_servers.erase(n);
+            break;
+        }
+    }
+    
+    if ( ! found )
+    {
+        LOGGER.warning(&quot;Received answer from unknown server [%s]&quot;, fromaddress.str().c_str());
+    }
+    
+    sendNextQuery();
+}
+
+void GameserverQuerier::onSocketError(network::UDPSocket* so)
+{
+    
+}
+
+void GameserverQuerier::sendQuery( GameServerInfo * info)
+{
+    unsigned serverIndex = 0;
+    for ( ; serverIndex &lt; checking_servers.size(); serverIndex++ )
+    {
+        if ( checking_servers[serverIndex] == info )
+            break;
+    }
+    
+    if ( serverIndex &gt;= checking_servers.size() ) // is a new one
+    {
+        LOGGER.warning(&quot;New query server [%s:%u]&quot;, info-&gt;ip.c_str(), info-&gt;port);
+        // address shall be numeric
+        info-&gt;address = network::Address::resolve(info-&gt;ip, info-&gt;port);
+        checking_servers.push_back(info);
+    }
+    else
+    {
+        LOGGER.warning(&quot;Querying server [%s:%u]&quot;, info-&gt;ip.c_str(), info-&gt;port);
+    }
+    
+    info-&gt;queryTimestamp = SDL_GetTicks();
+    udpsocket-&gt;send(info-&gt;address, query, sizeof(query)-1);
+}
+
+void GameserverQuerier::sendNextQuery()
+{
+    if ( checking_servers.size() &gt;= MAXQUERY ) // max 5 query at time
+        return;
+    
+    if ( ! not_queried.empty() )
+    {
+        const ServerAddress * a = not_queried.back();
+        not_queried.pop_back();
+        
+        GameServerInfo * info = new GameServerInfo(a-&gt;ip, a-&gt;port);
+
+//        delete a; // ServerAddress is not owned by me, don't delete it
+        
+        sendQuery(info);
+    }
+}
+
+void GameserverQuerier::parseServerData(GameServerInfo* info, NPString&amp; data)
+{
+    info-&gt;ping = SDL_GetTicks() - info-&gt;queryTimestamp;
+    
+    StringTokenizer tokenizer(data, '\\');
+
+    std::string token;
+    while( (token = tokenizer.getNextToken()) != &quot;&quot;) {
+        if (token == &quot;protocol&quot;) {
+            std::stringstream str(tokenizer.getNextToken());
+            str &gt;&gt; info-&gt;protocol;
+        } else if (token == &quot;hostname&quot;) {
+            info-&gt;server_name = tokenizer.getNextToken();
+        } else if(token == &quot;gameversion&quot;) {
+            info-&gt;game_version = tokenizer.getNextToken();
+        } else if(token == &quot;mapname&quot;) {
+            info-&gt;current_map = tokenizer.getNextToken();
+        } else if(token == &quot;mapcycle&quot;) {
+            info-&gt;map_cycle = tokenizer.getNextToken();
+        } else if(token == &quot;password&quot;) {
+            info-&gt;needs_password = tokenizer.getNextToken().compare(&quot;y&quot;) == 0 ? true : false;
+        } else if(token == &quot;numplayers&quot;) {
+            std::stringstream str(tokenizer.getNextToken());
+            str &gt;&gt; info-&gt;current_players;
+        } else if(token == &quot;maxplayers&quot;) {
+            std::stringstream str(tokenizer.getNextToken());
+            str &gt;&gt; info-&gt;max_players;
+        } else if(token == &quot;gamestyle&quot;) {
+            info-&gt;gamestyle = tokenizer.getNextToken();
+        } else if(token == &quot;units_per_player&quot;) {
+            std::stringstream str(tokenizer.getNextToken());
+            str &gt;&gt; info-&gt;units_per_player;
+        } else if(token == &quot;time&quot;) {
+            std::stringstream str(tokenizer.getNextToken());
+            str &gt;&gt; info-&gt;runtime;
+        } else if(token == &quot;timelimit&quot;) {
+            std::stringstream str(tokenizer.getNextToken());
+            str &gt;&gt; info-&gt;time_limit;
+        } else if(token == &quot;fraglimit&quot;) {
+            std::stringstream str(tokenizer.getNextToken());
+            str &gt;&gt; info-&gt;frag_limit;
+        } else if(token == &quot;objectivelimit&quot;) {
+            std::stringstream str(tokenizer.getNextToken());
+            str &gt;&gt; info-&gt;objective_limit;
+        } else {
+            // handle more tokens...
+        }
+    }
+    
+    info-&gt;query_state = GameServerInfo::COMPLETE;
+    
+//    LOGGER.warning(&quot;-- SERVER REPPLY -- address : %s:%u&quot;, info-&gt;ip.c_str(), info-&gt;port );
+//    LOGGER.warning(&quot;game version : %s&quot;, info-&gt;game_version.c_str() );
+//    LOGGER.warning(&quot;name : %s&quot;, info-&gt;server_name.c_str() );
+//    LOGGER.warning(&quot;map : %s&quot;, info-&gt;current_map.c_str() );
+//    LOGGER.warning(&quot;cycle : %s&quot;, info-&gt;map_cycle.c_str() );
+//    LOGGER.warning(&quot;password : %s&quot;, info-&gt;needs_password ? &quot;yes&quot; : &quot;no&quot; );
+//    LOGGER.warning(&quot;players : %u&quot;, info-&gt;current_players );
+//    LOGGER.warning(&quot;max players : %u&quot;, info-&gt;max_players );
+//    LOGGER.warning(&quot;gametype : %s&quot;, info-&gt;gamestyle.c_str() );
+//    LOGGER.warning(&quot;units/player : %u&quot;, info-&gt;units_per_player );
+//    LOGGER.warning(&quot;runtime : %u&quot;, info-&gt;runtime );
+//    LOGGER.warning(&quot;timelimit : %u&quot;, info-&gt;time_limit );
+//    LOGGER.warning(&quot;fraglimit : %u&quot;, info-&gt;frag_limit );
+//    LOGGER.warning(&quot;objlimit : %u&quot;, info-&gt;objective_limit );
+//    LOGGER.warning(&quot;protocol : %u&quot;, info-&gt;protocol );
+//    LOGGER.warning(&quot;ping : %u&quot;, info-&gt;ping );
+//    LOGGER.warning(&quot;retries : %u&quot;, info-&gt;retryNum );
+//    LOGGER.warning(&quot; : %s&quot;, info-&gt; );
+    
+    ds-&gt;addServer(info);
+}
+
+void GameserverQuerier::checkTimeouts()
+{
+    if ( udpsocket )
+    {
+        unsigned now = SDL_GetTicks();
+        for ( unsigned n = 0; n &lt; checking_servers.size(); n++ )
+        {
+            GameServerInfo * info = checking_servers[n];
+            if ( (now - info-&gt;queryTimestamp) &gt;= SERVERTIMEOUT )
+            {
+                if ( info-&gt;retryNum++ &gt;= 3 ) // @todo make the retry numbers comfigurable?
+                {
+                    info-&gt;ping = 9999;
+                    info-&gt;query_state = GameServerInfo::TIMEOUT;
+                    checking_servers.erase(n);
+                    LOGGER.warning(&quot;-- SERVER TIMEOUTTTTT -- %s:%u&quot;, info-&gt;ip.c_str(), info-&gt;port);
+                    ds-&gt;addServer(info);
+                    sendNextQuery();
+                }
+                else
+                {
+                    sendQuery(info);
+                }
+            }
+        }
+        
+        // if empty, then not_queried is empty too
+        if ( checking_servers.empty() )
+        {
+            endQuery();
+        }
+    }
+}
+
+void GameserverQuerier::beginQuery(const PtrArray&lt;ServerAddress&gt;&amp; list)
+{
+    if ( (udpsocket == 0) &amp;&amp; list.size() )
+    {
+        not_queried.initialize(list.size());
+        for ( unsigned n = 0; n &lt; list.size(); n++ )
+        {
+            not_queried.push_back(list[n]);
+        }
+
+        udpsocket = new network::UDPSocket(this);
+
+        for (unsigned n = 0; n &lt; MAXQUERY; n++ )
+        {
+            sendNextQuery();
+        }
+    }
+}
+
+void GameserverQuerier::endQuery()
+{
+    if ( udpsocket )
+    {
+        // @todo notify finished?
+        not_queried.fastClear();
+        checking_servers.deleteAll();
+        udpsocket-&gt;destroy();
+        udpsocket = 0;
+    }
+}

Added: trunk/netpanzer/src/NetPanzer/Network/GameserverQuerier.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Network/GameserverQuerier.hpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Network/GameserverQuerier.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -0,0 +1,61 @@
+/*
+Copyright (C) 2013 Netpanzer Team. (www.netpanzer.org), Aaron Perez
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * Created on September 14, 2013, 12:15 PM
+ */
+
+#ifndef GAMESERVERQUERIER_HPP
+#define	GAMESERVERQUERIER_HPP
+
+#include &quot;Network/UDPSocket.hpp&quot;
+#include &quot;Network/ServerAddress.hpp&quot;
+#include &quot;ArrayUtil/PtrArray.hpp&quot;
+#include &quot;Classes/GameServerInfo.hpp&quot;
+
+class ServerListDataSource;
+
+class GameserverQuerier : public network::UDPSocketObserver
+{
+public:
+    GameserverQuerier(ServerListDataSource * ds);
+    ~GameserverQuerier();
+    
+    void checkTimeouts();
+    
+    void beginQuery(const PtrArray&lt;ServerAddress&gt;&amp; list);
+    void endQuery();
+    
+    bool isQuerying() const { return udpsocket != 0; }
+    
+private:
+    GameserverQuerier(const GameserverQuerier&amp;);
+    
+    void sendQuery( GameServerInfo * info );
+    void sendNextQuery();
+    void parseServerData(GameServerInfo * info, NPString&amp; data);
+    
+    void onDataReceived(network::UDPSocket *so, const network::Address &amp;from, const char *data, const int len);
+    void onSocketError(network::UDPSocket *so);
+    
+    PtrArray&lt;const ServerAddress&gt; not_queried;
+    PtrArray&lt;GameServerInfo&gt; checking_servers;
+    network::UDPSocket * udpsocket;
+    ServerListDataSource * ds;
+};
+
+#endif	/* GAMESERVERQUERIER_HPP */
+

Added: trunk/netpanzer/src/NetPanzer/Network/MasterserverQuerier.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Network/MasterserverQuerier.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Network/MasterserverQuerier.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -0,0 +1,231 @@
+/*
+Copyright (C) 2013 Netpanzer Team. (www.netpanzer.org), Aaron Perez
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ * 
+ * Created on September 11, 2013, 7:41 PM
+ */
+
+#include &quot;MasterserverQuerier.hpp&quot;
+
+#include &lt;stddef.h&gt;
+#include &lt;sstream&gt;
+#include &quot;Network/TCPSocket.hpp&quot;
+#include &quot;Util/Log.hpp&quot;
+#include &quot;Util/StringTokenizer.hpp&quot;
+#include &quot;Util/StringUtil.hpp&quot;
+#include &quot;Interfaces/GameConfig.hpp&quot;
+
+// old_query = &quot;\\list\\gamename\\master\\final\\list\\gamename\\netpanzer\\final\\&quot;;
+static const char  masterserver_query[] = &quot;\\list\\gamename\\netpanzer\\final\\&quot;;
+
+static inline bool getToken(StringTokenizer&amp; tkn, const std::string&amp; name, std::string&amp; dest)
+{
+    if ( tkn.hasMore() &amp;&amp; (tkn.getNextToken() == name) )
+    {
+        if ( tkn.hasMore() )
+        {
+            dest = tkn.getNextToken();
+            return true;
+        }
+    }
+
+    return false;
+}
+
+MasterserverQuerier::Data::~Data()
+{
+    if ( socket )
+    {
+        socket-&gt;destroy();
+        socket = 0;
+    }
+}
+
+void MasterserverQuerier::Data::connect(network::TCPSocketObserver* o)
+{
+    timer.reset();
+    socket = new network::TCPSocket(host, &quot;28900&quot;, o);
+}
+
+size_t MasterserverQuerier::findMasterserverBySocket(network::TCPSocket* so)
+{
+    for ( size_t n = 0; n &lt; masterservers.size(); n++ )
+    {
+        if ( masterservers[n]-&gt;socket == so )
+        {
+            return n;
+        }
+    }
+    return -1;
+}
+
+
+MasterserverQuerier::MasterserverQuerier(ComponentEvents * events, int event_code)
+: events(events), event_code(event_code)
+{
+    servers = 0;
+}
+
+MasterserverQuerier::~MasterserverQuerier()
+{
+    endQuery();
+}
+
+void MasterserverQuerier::beginQuery(PtrArray&lt;ServerAddress&gt;* dest)
+{
+    servers = dest;
+    masterservers.deleteAll();
+    masterservers.clear();
+
+    NPString server;
+    StringTokenizer tokenizer(*GameConfig::server_masterservers, ',');
+    while( (server = tokenizer.getNextToken()) != &quot;&quot;)
+    {
+        LOGGER.debug(&quot;Begin connect to masterserver: '%s'&quot;, StringUtil::trim(server).c_str() );
+        Data * d = new Data(StringUtil::trim(server));
+        d-&gt;connect(this);
+        masterservers.push_back( d );
+    }
+}
+
+void MasterserverQuerier::endQuery()
+{
+    masterservers.deleteAll();
+    masterservers.clear();
+    servers = 0;
+}
+
+void MasterserverQuerier::addServer(const NPString&amp; ip, const uint16_t port)
+{
+    for ( size_t n = 0; n &lt; servers-&gt;size(); n++ )
+    {
+        if ( (servers-&gt;get(n)-&gt;ip == ip) &amp;&amp; (servers-&gt;get(n)-&gt;port == port) )
+        {
+            return; // already there
+        }
+    }
+
+    LOGGER.warning(&quot;New server IP received: [%s:%d]&quot;, ip.c_str(), port);
+    servers-&gt;push_back( new ServerAddress(ip, port) );
+}
+
+void MasterserverQuerier::parseMasterserverRepply(Data* ms)
+{
+    if ( ! servers )
+        return;
+    
+    std::string str = ms-&gt;data;
+    str.erase( str.find(&quot;\\final&quot;) );
+
+    StringTokenizer tknizer(str,'\\');
+
+    std::string dirip;
+    std::string portstr;
+
+    while ( tknizer.hasMore() )
+    {
+        if (  (! getToken(tknizer, &quot;ip&quot;, dirip))
+            ||(! getToken(tknizer, &quot;port&quot;, portstr)) )
+        {
+            continue;
+        }
+
+        uint16_t port = 0;
+        std::stringstream ss(portstr);
+        ss &gt;&gt; port;
+
+        if ( dirip.empty() || (port == 0) )
+        {
+            LOGGER.warning(&quot;Invalid IP received from masterserver&quot;);
+            continue;
+        }
+
+        addServer(dirip, port);
+    }
+}
+
+void MasterserverQuerier::onConnected(network::TCPSocket* so)
+{
+    size_t i = findMasterserverBySocket(so);
+    Data * ms = masterservers[i];
+    // only sockets we create can be connected, no need to check, MUST BE OK
+
+    LOGGER.warning(&quot;MASTERSERVER Connected [%s]&quot;, ms-&gt;host.c_str());
+    
+    ms-&gt;timer.reset();
+
+    so-&gt;send(masterserver_query,sizeof(masterserver_query)-1);
+}
+
+void MasterserverQuerier::onDisconected(network::TCPSocket* so)
+{
+    size_t i = findMasterserverBySocket(so);
+    LOGGER.warning(&quot;MASTERSERVER Disconected [%s]&quot;, masterservers[i]-&gt;host.c_str());
+
+    masterservers[i]-&gt;socket = 0;
+    delete masterservers[i];
+    masterservers.erase(i);
+    if ( masterservers.empty() )
+    {
+        queryFinished();
+    }
+}
+
+void MasterserverQuerier::onSocketError(network::TCPSocket* so)
+{
+    size_t i = findMasterserverBySocket(so);
+    LOGGER.warning(&quot;MASTERSERVER SocketError [%s]&quot;, masterservers[i]-&gt;host.c_str());
+
+    masterservers[i]-&gt;socket = 0;
+    delete masterservers[i];
+    masterservers.erase(i);
+    if ( masterservers.empty() )
+    {
+        queryFinished();
+    }
+}
+
+void MasterserverQuerier::onDataReceived(network::TCPSocket* so, const char* data, const int len)
+{
+    size_t i = findMasterserverBySocket(so);
+    Data * ms = masterservers[i];
+    
+    ms-&gt;timer.reset();
+    ms-&gt;data.append(data,len);
+
+    if ( ms-&gt;data.find(&quot;\\final&quot;) != std::string::npos )
+    {
+        LOGGER.warning(&quot;Masterserver data:[%s]&quot;, ms-&gt;data.c_str());
+
+        parseMasterserverRepply(ms);
+
+        delete ms;
+        masterservers.erase(i);
+        if ( masterservers.empty() )
+        {
+            queryFinished();
+        }
+    }
+}
+
+void MasterserverQuerier::queryFinished()
+{
+    if ( servers )
+    {
+        servers = 0;
+        events-&gt;push(event_code);
+    }
+}

Added: trunk/netpanzer/src/NetPanzer/Network/MasterserverQuerier.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Network/MasterserverQuerier.hpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Network/MasterserverQuerier.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -0,0 +1,78 @@
+/*
+Copyright (C) 2013 Netpanzer Team. (www.netpanzer.org), Aaron Perez
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * Created on September 11, 2013, 7:41 PM
+ */
+
+#ifndef MASTERSERVERQUERIER_HPP
+#define	MASTERSERVERQUERIER_HPP
+
+#include &quot;Core/CoreTypes.hpp&quot;
+#include &quot;Util/NTimer.hpp&quot;
+#include &quot;ArrayUtil/PtrArray.hpp&quot;
+#include &quot;Network/TCPSocket.hpp&quot;
+
+#include &quot;2D/ComponentEvents.hpp&quot;
+#include &quot;Network/ServerAddress.hpp&quot;
+
+class MasterserverQuerier : public network::TCPSocketObserver
+{
+public:
+    MasterserverQuerier(ComponentEvents * events, int event_code);
+    ~MasterserverQuerier();
+    
+    void beginQuery(PtrArray&lt;ServerAddress&gt; * dest);
+    void endQuery();
+    
+    bool isQuerying() const { return servers != 0; }
+    
+private:
+    MasterserverQuerier(const MasterserverQuerier&amp;);
+    void operator=(const MasterserverQuerier&amp;);
+    
+    struct Data
+    {
+        Data(const NPString&amp; host) : host(host), socket(0) {}
+        ~Data();
+        
+        void connect(network::TCPSocketObserver * o);
+        
+        NPString host;
+        NPString data;
+        NTimer timer;
+        network::TCPSocket * socket;
+    };
+    
+    PtrArray&lt;Data&gt; masterservers;
+    PtrArray&lt;ServerAddress&gt; * servers;
+    ComponentEvents * events;
+    int event_code;
+    
+    void queryFinished();
+    
+    size_t findMasterserverBySocket(network::TCPSocket * so);
+    void addServer(const NPString&amp; ip, const uint16_t port);
+    void parseMasterserverRepply(Data * ms);
+    
+    void onConnected(network::TCPSocket *so);
+    void onDisconected(network::TCPSocket *so);
+    void onSocketError(network::TCPSocket *so);
+    void onDataReceived(network::TCPSocket *so, const char *data, const int len);
+};
+
+#endif	/* MASTERSERVERQUERIER_HPP */
+

Added: trunk/netpanzer/src/NetPanzer/Network/ServerAddress.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Network/ServerAddress.hpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Network/ServerAddress.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -0,0 +1,22 @@
+/* 
+ * File:   ServerAddress.hpp
+ * Author: krom
+ *
+ * Created on September 14, 2013, 12:24 PM
+ */
+
+#ifndef SERVERADDRESS_HPP
+#define	SERVERADDRESS_HPP
+
+#include &quot;Core/CoreTypes.hpp&quot;
+
+struct ServerAddress
+{
+    ServerAddress(const NPString&amp; ip, const uint16_t port) : ip(ip), port(port) {}
+    
+    NPString ip;
+    uint16_t port;
+};
+
+#endif	/* SERVERADDRESS_HPP */
+

Modified: trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.cpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -10,6 +10,7 @@
 #include &quot;Classes/ScreenSurface.hpp&quot;
 #include &quot;Interfaces/StrManager.hpp&quot;
 #include &quot;MainMenuScene.hpp&quot;
+#include &quot;Resources/ResourceManager.hpp&quot;
 
 //#define TEST_TEXT
 
@@ -60,6 +61,9 @@
 void InitialScene::logic()
 {
 #ifndef TEST_TEXT
+    
+    ResourceManager::refreshMapList();
+    
     MainMenuScene * mms = new MainMenuScene();
     SceneManager::setNextScene(mms);
 #endif

Modified: trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/HostGameLayer.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/HostGameLayer.cpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/HostGameLayer.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -39,7 +39,9 @@
 #include &quot;2D/Components/Choice.hpp&quot;
 #include &quot;2D/TextRenderingSystem.hpp&quot;
 
+#include &quot;MapThumbnailComponent.hpp&quot;
 
+
 #define MENU_WIDTH  (640)
 #define MENU_HEIGHT (480-26-26)
 
@@ -120,33 +122,6 @@
     return int(typhoonWindSpeed);
 }
 
-
-class MapThumbnailComponent : public Component
-{
-private:
-    Surface mapimage;
-    
-public:
-    MapThumbnailComponent(int w, int h)
-    {
-//        setLocation(x, y);
-        setSize(w, h);
-        mapimage.create(w - 2, h - 2);
-    }
-    
-    void draw(Surface &amp;dest) const
-    {
-        dest.drawRect(rect, Color::lightGray);
-        mapimage.blt(dest, rect.getLocationX()+1, rect.getLocationY()+1); // full blit
-    }
-    
-    void setImage(const Surface&amp; from)
-    {
-        iRect r(0,0, rect.getWidth()-2, rect.getHeight()-2);
-        mapimage.bltScale(from, r);
-    }
-};
-
 class GameTypeChoice : public Choice
 {
 public:
@@ -390,7 +365,8 @@
 
 void HostGameLayer::refreshMaps()
 {
-    ResourceManager::refreshMapList();
+    // @todo when do we refresh the map list?
+//    ResourceManager::refreshMapList();
     mapList.clear();
 
     if ( ResourceManager::listMaps(mapList) == 0 )

Modified: trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/IntroLayer.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/IntroLayer.cpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/IntroLayer.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -32,12 +32,6 @@
 #include &quot;Types/UString.hpp&quot;
 #include &quot;Interfaces/StrManager.hpp&quot;
 #include &quot;Util/StringTokenizer.hpp&quot;
-#ifdef TEST_TABLE
-#include &quot;2D/Components/Table.hpp&quot;
-#include &quot;2D/Components/Button.hpp&quot;
-#include &quot;2D/TextRenderingSystem.hpp&quot;
-#include &quot;Util/Log.hpp&quot;
-#endif
 
 #define MENU_WIDTH  (640)
 #define MENU_HEIGHT (480-26-26)
@@ -46,147 +40,19 @@
 	#define PACKAGE_VERSION &quot;testing&quot;
 #endif
 
-#ifdef TEST_TABLE
-
-#include &lt;vector&gt;
-#include &lt;string&gt;
-
-struct Events
-{
-    enum
-    {
-        AddToTable = 1,
-        TableSelectionChanged,
-        ClearSelection
-    };
-};
-
-class TestData
-{
-public:
-    TestData(const std::string&amp; s1, const std::string&amp; s2, const std::string &amp;s3)
-        : s1(s1), s2(s2), s3(s3)
-        {}
-    std::string s1, s2, s3;
-};
-
-class TestRowPainter : public Table::RowPainter
-{
-public:
-    TestRowPainter() : Table::RowPainter()
-    {
-        
-    }
-    
-    ~TestRowPainter()
-    {
-        
-    }
-    
-    void setData(const TestData&amp; data)
-    {
-        c1.setText(data.s1.c_str());
-        c2.setText(data.s2.c_str());
-        c3.setText(data.s3.c_str());
-    }
-    
-    void paintCell(Surface&amp; dest, const int x, const int y, const iRect&amp; rect, const unsigned column) const
-    {
-        switch ( column )
-        {
-            case 0: c1.drawPart(dest, x, y, rect); break;
-            case 1: c2.drawPart(dest, x, y, rect); break;
-            case 2: c3.drawPart(dest, x, y, rect); break;
-        }
-    }
-            
-private:
-    
-    TextRenderer c1, c2, c3;
-};
-
-class TestDataSource : public Table::DataSource
-{
-public:
-    std::vector&lt;TestData&gt; testrows;
-    TestDataSource() : Table::DataSource()
-    {
-        testrows.push_back(TestData(&quot;0,0&quot;,&quot;0,1&quot;,&quot;0,2&quot;));
-        testrows.push_back(TestData(&quot;1,0&quot;,&quot;1,1&quot;,&quot;1,2&quot;));
-        testrows.push_back(TestData(&quot;2,0&quot;,&quot;2,1&quot;,&quot;2,2&quot;));
-        testrows.push_back(TestData(&quot;3,0&quot;,&quot;3,1&quot;,&quot;3,2&quot;));
-        testrows.push_back(TestData(&quot;4,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;5,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;6,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;7,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;8,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;9,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;10,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;11,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;12,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;13,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;14,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;15,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-        testrows.push_back(TestData(&quot;16,0&quot;,&quot;4,1&quot;,&quot;4,2&quot;));
-    }
-    
-    ~TestDataSource()
-    {
-        
-    }
-    
-    void addRow(const std::string&amp; s1, const std::string&amp; s2, const std::string&amp; s3)
-    {
-        testrows.push_back(TestData(s1,s2,s3));
-        notifyDataChanged();
-    }
-    
-    const TestData&amp; getRowData(const unsigned n)
-    {
-        return testrows[n];
-    }
-    
-    unsigned getRowCount() const
-    {
-        return testrows.size();
-    }
-    
-    Table::RowPainter * newRowPainter() const
-    {
-        return new TestRowPainter();
-    }
-    
-    unsigned getRowHeight() const
-    {
-        return TextRenderingSystem::line_height();
-    }
-    
-    void configureRowPainter(Table::RowPainter * painter, const unsigned row) const
-    {
-        TestRowPainter * p = reinterpret_cast&lt;TestRowPainter*&gt;(painter);
-        if ( row &lt; testrows.size() )
-        {
-            p-&gt;setData(testrows[row]);
-        }
-    }
-};
-
-TestDataSource tds;
-        
-#endif
-
 IntroLayer::IntroLayer() : ComponentLayer(0)
 {
     area = new AreaComponent( MENU_WIDTH, MENU_HEIGHT );
-    
+
+#ifdef TEST_INPUTFIELD
     label = new Label( UString(&quot;The input field&quot;), Color::white);
     input_field = new InputField();
     input_field-&gt;setMaxTextLength(20);
     input_field-&gt;setExcludedChars(UString(&quot;bc&quot;));
     input_field-&gt;setSize(100, 21);
     input_field-&gt;setText(UString(&quot;Jafgjy this is a very long line lets see what happens&quot;));
-
-#ifndef TEST_TABLE
+#endif
+    
     intro_text = new ScrollableList(MENU_WIDTH-20, MENU_HEIGHT-150);
 
     char Buf[1024];    
@@ -201,36 +67,13 @@
     {
         intro_text-&gt;addLine(UString(tok.getNextToken(true).c_str()));
     }
-#else
-    table = new Table(3, 1);
-    table-&gt;setSize(MENU_WIDTH-20, MENU_HEIGHT-150);
     
-    table-&gt;addColumn(UString(&quot;First Column&quot;), 150);
-    table-&gt;addColumn(UString(&quot;Second Column&quot;), 175);
-    table-&gt;addColumn(UString(&quot;Thirth Column&quot;), 80);
-    
-    table-&gt;setChangeEvent(Events::TableSelectionChanged);
-    
-    tds.setTable(table);
-    
-    tableButton = Button::createNewSpecialButton(&quot;Add&quot;, iXY(0,0), 100);
-    tableButton-&gt;setClickEvent(Events::AddToTable);
-    
-    clearTableButton = Button::createNewSpecialButton(&quot;Clear selection&quot;, iXY(0,0), 150);
-    clearTableButton-&gt;setClickEvent(Events::ClearSelection);
-    
-#endif
-    
     addComponent(area);
-#ifndef TEST_TABLE
     addComponent(intro_text);
-#else
-    addComponent(table);
-    addComponent(tableButton);
-    addComponent(clearTableButton);
+#ifdef TEST_INPUTFIELD
+    addComponent(label);
+    addComponent(input_field);
 #endif
-//    addComponent(label);
-//    addComponent(input_field);
 }
 
 IntroLayer::~IntroLayer()
@@ -247,15 +90,9 @@
 
     int x = area-&gt;getLocationX() + 10;
     int y = area-&gt;getLocationY() + 10;
-#ifndef TEST_TABLE
+
     intro_text-&gt;setLocation(x, y);
     y += intro_text-&gt;getHeight();
-#else
-    table-&gt;setLocation(x, y);
-    y += table-&gt;getHeight();
-    tableButton-&gt;setLocation(x+250, y+50);
-    clearTableButton-&gt;setLocation(x+350, y+50);
-#endif
     
 #ifdef TEST_INPUTFIELD
     label-&gt;setLocation(x, y+20);
@@ -265,29 +102,9 @@
 
 void IntroLayer::handleComponentEvents()
 {
-#ifdef TEST_TABLE
-    int event;
-    while ( (event = component_events.nextEvent()) ) switch ( event )
-    {
-        case Events::AddToTable:
-            tds.addRow(&quot;Added col 1&quot;,&quot;Added col 2&quot;,&quot;Even more&quot;);
-            break;
-            
-        case Events::TableSelectionChanged:
-        {
-            int sindex = table-&gt;getSelectedIndex();
-            const TestData&amp; td = tds.getRowData(sindex);
-            LOGGER.warning(&quot;Row selected %d: '%s' '%s' '%s'&quot;, sindex, td.s1.c_str(), td.s2.c_str(), td.s3.c_str());
-        }
-            break;
-            
-        case Events::ClearSelection:
-        {
-            table-&gt;clearSelection();
-            LOGGER.warning(&quot;Unselected&quot;);
-        }
-            break;
-            
-    }
-#endif
+//    int event;
+//    while ( (event = component_events.nextEvent()) ) switch ( event )
+//    {
+//            
+//    }
 }

Modified: trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/IntroLayer.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/IntroLayer.hpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/IntroLayer.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -23,7 +23,6 @@
 
 #include &quot;2D/ComponentLayer.hpp&quot;
 
-#define TEST_TABLE
 #define TEST_INPUTFIELD
 
 class Component;
@@ -34,11 +33,6 @@
 class Slider;
 class ScrollableList;
 
-#ifdef TEST_TABLE
-class Table;
-class Button;
-#endif
-
 #ifdef TEST_INPUTFIELD
 class InputField;
 #endif
@@ -54,17 +48,8 @@
     void handleComponentEvents();
     
     Component   * area;
-    
-#ifndef TEST_TABLE
     ScrollableList * intro_text;
-#endif
     
-#ifdef TEST_TABLE
-    Table       * table;
-    Button      * tableButton;
-    Button      * clearTableButton;
-#endif
-    
 #ifdef TEST_INPUTFIELD
     Label       * label;
     InputField  * input_field;

Modified: trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/JoinGameLayer.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/JoinGameLayer.cpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/JoinGameLayer.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -20,9 +20,14 @@
 #include &quot;JoinGameLayer.hpp&quot;
 
 #include &quot;2D/Components/AreaComponent.hpp&quot;
+#include &quot;2D/Components/Button.hpp&quot;
+#include &quot;2D/Components/Table.hpp&quot;
+#include &quot;2D/TextRenderingSystem.hpp&quot;
 
 #include &quot;Classes/ScreenSurface.hpp&quot;
 #include &quot;Classes/GameServerInfo.hpp&quot;
+#include &quot;Classes/ServerListDataSource.hpp&quot;
+#include &quot;Classes/MapFile.hpp&quot;
 #include &quot;Interfaces/GameConfig.hpp&quot;
 #include &quot;Network/TCPSocket.hpp&quot;
 #include &quot;Network/UDPSocket.hpp&quot;
@@ -30,6 +35,10 @@
 #include &quot;Util/StringTokenizer.hpp&quot;
 #include &quot;Util/StringUtil.hpp&quot;
 #include &quot;Util/Log.hpp&quot;
+#include &quot;Network/MasterserverQuerier.hpp&quot;
+#include &quot;Network/GameserverQuerier.hpp&quot;
+#include &quot;MapThumbnailComponent.hpp&quot;
+#include &quot;Resources/ResourceManager.hpp&quot;
 #include &lt;string&gt;
 #include &lt;sstream&gt;
 
@@ -41,362 +50,68 @@
     enum
     {
         RefreshGameList = 1,
-        RefreshGameData
+        MasterserverQueryFinished,
+        RefreshGameData,
+        ServerSelected
     };
 };
 
-static const size_t MAX_QUERIES = 4;
-static const Uint32 QUERY_TIMEOUT = 3 * 1000;
-static const Uint32 MS_TIMEOUT = 12 * 1000;
-
-static const char  masterserver_query[] = &quot;\\list\\gamename\\netpanzer\\final\\&quot;;
-
 /* Notes
  * 
- * // old_query = &quot;\\list\\gamename\\master\\final\\list\\gamename\\netpanzer\\final\\&quot;;
- * // new_query = &quot;\\list\\gamename\\netpanzer\\final\\&quot;;
- *
- * original table: name, map, players, ping
  * if proto != NETPANZER_PROTOCOL_VERSION, show getNetpanzerProtocolMessage(server-&gt;protocol)
  * 
  * password protected servers: lock_image.loadBMP(&quot;pics/default/lock.bmp&quot;);
  * 
- * 
- * for querying game servers
- * 
- * udpsocket = new network::UDPSocket(this);
- * 
-void
-ServerQueryThread::sendNextQuery()
-{
-    if ( querying_server.size() &gt;= 5 ) // max 5 query at time
-        return;
-    if ( ! not_queried.empty() )
-    {
-        ServerInfo *info = not_queried.back();
-        not_queried.pop_back();
-        sendQuery(info);
-    }
-}
-
-void 
-ServerQueryThread::sendQuery(ServerInfo *server)
-{
-    if (server-&gt;tryNum++ &gt;= 3) { // 3 retrys fixed for now
-        server-&gt;status = ServerInfo::TIMEOUT;
-        sendNextQuery();
-        return;
-    }
-    
-    if (server-&gt;ipaddress == network::Address::ANY) {
-        server-&gt;ipaddress = network::Address::resolve(server-&gt;address, server-&gt;port);
-    }
-
-    stringstream serveraddr;
-    serveraddr &lt;&lt; server-&gt;address &lt;&lt; &quot;:&quot; &lt;&lt; server-&gt;port;
-    querying_server[serveraddr.str()]=server;
-    LOGGER.warning(&quot;Querying server [%s]&quot;, serveraddr.str().c_str());
-    
-    char q[] = &quot;\\status\\final\\&quot;;
-    server-&gt;querystartticks = SDL_GetTicks();
-    udpsocket-&gt;send(server-&gt;ipaddress,q,sizeof(q)-1);
-    
-}
-
-void
-ServerQueryThread::onDataReceived(network::UDPSocket *s, const network::Address&amp; from, const char *data, const int len)
-{
-    (void)s;
-    stringstream fromaddress;
-    fromaddress &lt;&lt; from.getIP() &lt;&lt; &quot;:&quot; &lt;&lt; from.getPort();
-    
-    string str;
-    str.append(data,len);
-    
-    ServerInfo * server = querying_server[fromaddress.str()];
-    if (server) {
-        parseServerData(server,str);
-        querying_server.erase(fromaddress.str());
-    } else {
-        LOGGER.warning(&quot;Received answer from unknown server [%s]&quot;, fromaddress.str().c_str());
-        querying_server.erase(fromaddress.str()); // Quick &amp; Dirty, should use find()
-    }
-    
-    sendNextQuery();
-    
-}
-
-void
-ServerQueryThread::parseServerData(ServerInfo *server, string &amp;data)
-{
-    server-&gt;ping = SDL_GetTicks() - server-&gt;querystartticks;
-    
-    StringTokenizer tokenizer(data, '\\');
-
-    std::string token;
-    while( (token = tokenizer.getNextToken()) != &quot;&quot;) {
-        if(token == &quot;hostname&quot;) {
-            server-&gt;name = tokenizer.getNextToken();
-        } else if(token == &quot;mapname&quot;) {
-            server-&gt;map = tokenizer.getNextToken();
-        } else if(token == &quot;numplayers&quot;) {
-            std::stringstream str(tokenizer.getNextToken());
-            str &gt;&gt; server-&gt;players;
-        } else if(token == &quot;maxplayers&quot;) {
-            std::stringstream str(tokenizer.getNextToken());
-            str &gt;&gt; server-&gt;maxplayers;
-        } else if(token == &quot;protocol&quot;) {
-            std::stringstream str(tokenizer.getNextToken());
-            str &gt;&gt; server-&gt;protocol;
-        } else if(token == &quot;password&quot;) {
-            server-&gt;needs_password = tokenizer.getNextToken().compare(&quot;y&quot;) == 0 ? true : false;
-        } else {
-            // handle more tokens...
-        }
-    }
-    server-&gt;status = ServerInfo::RUNNING;
-    
-}
- * 
- * void
-ServerQueryThread::checkTimeOuts()
-{
-    Uint32 now = SDL_GetTicks();
-    
-    if ( querying_msdata.empty() &amp;&amp; querying_server.empty() &amp;&amp; not_queried.empty())
-    {
-        LOGGER.warning(&quot;Stopping querys to servers, no more servers&quot;);
-        running = false;
-        state = STATE_DONE;
-        if (udpsocket)
-        {
-            udpsocket-&gt;destroy();
-            udpsocket = 0;
-        }
-        return;
-    }
-    
-    map&lt;network::TCPSocket *,MSInfo *&gt;::iterator msiter;
-    for (msiter=querying_msdata.begin(); msiter!=querying_msdata.end(); msiter++) {
-        if ( now - msiter-&gt;second-&gt;lastTicks &gt; MS_TIMEOUT ) {
-            LOGGER.warning(&quot;Masterserver [%s] timeout&quot;, msiter-&gt;first-&gt;getAddress().getIP().c_str());
-            delete msiter-&gt;second;
-            msiter-&gt;first-&gt;destroy();
-            querying_msdata.erase(msiter);
-            sendNextQuery();
-        }
-    }
-    
-    
-    map&lt;string, ServerInfo *&gt;::iterator i;
-    for (i=querying_server.begin(); i!=querying_server.end(); i++) {
-        if ( i-&gt;second-&gt;status == ServerInfo::TIMEOUT ) {
-            LOGGER.warning(&quot;Server [%s] timeout, removing&quot;, i-&gt;first.c_str());
-            querying_server.erase(i);
-            break; // no more today, needed for invalid iterator
-        } else if ( now - i-&gt;second-&gt;querystartticks &gt; QUERY_TIMEOUT ) {
-            LOGGER.warning(&quot;Server [%s] timeout, retrying&quot;, i-&gt;first.c_str());
-            sendQuery(i-&gt;second);
-        }
-    }
-}
- * 
- * 
- * 
  */
 
-class ServerListQuery : public network::TCPSocketObserver
+JoinGameLayer::JoinGameLayer() : ComponentLayer(0)
 {
-private:
-    struct Data
-    {
-        Data(const NPString&amp; host) : host(host), socket(0) {}
-        
-        ~Data()
-        {
-            if ( socket )
-            {
-                socket-&gt;destroy();
-                socket = 0;
-            }
-        }
-        
-        void connect(network::TCPSocketObserver * o)
-        {
-            timer.reset();
-            socket = new network::TCPSocket(host, &quot;28900&quot;, o);
-        }
-        
-        NPString host;
-        NPString data;
-        NTimer timer;
-        network::TCPSocket * socket;
-    };
+    area = new AreaComponent( MENU_WIDTH, MENU_HEIGHT );
     
-    PtrArray&lt;Data&gt; masterservers;
-    PtrArray&lt;GameServerInfo&gt; game_servers;
+    // remain width = 640 - 20 = 620
+    // scrollbar = 15, so 605
+    // separators = 1 * 5, so 600
     
-    size_t findMasterserverBySocket(network::TCPSocket * so)
-    {
-        for ( size_t n = 0; n &lt; masterservers.size(); n++ )
-        {
-            if ( masterservers[n]-&gt;socket == so )
-            {
-                return n;
-            }
-        }
-        return -1;
-    }
-
+    // heigh; remain 428 - 20 = 408
+    // height use, 278, the 30, for buttons, 100 for server data
     
-public:
-    ServerListQuery() {}
-    ~ServerListQuery()
-    {
-        
-    }
     
-    void beginQuery()
-    {
-        masterservers.deleteAll();
-        masterservers.clear();
-        
-        NPString server;
-        StringTokenizer tokenizer(*GameConfig::server_masterservers, ',');
-        while( (server = tokenizer.getNextToken()) != &quot;&quot;)
-        {
-            LOGGER.debug(&quot;Begin connect to masterserver: '%s'&quot;, StringUtil::trim(server).c_str() );
-            Data * d = new Data(StringUtil::trim(server));
-            d-&gt;connect(this);
-            masterservers.push_back( d );
-        }
-    }
+    serverListTable = new Table(5,1);
     
-    void onDataReceived(network::TCPSocket *so, const char *data, const int len)
-    {
-        size_t i = findMasterserverBySocket(so);
-        Data * ms = masterservers[i];
-
-        ms-&gt;timer.reset();
-        ms-&gt;data.append(data,len);
-        
-        if ( ms-&gt;data.find(&quot;\\final&quot;) != std::string::npos )
-        {
-            LOGGER.warning(&quot;Masterserver data:[%s]&quot;, ms-&gt;data.c_str());
-            
-            parseMasterserverRepply(ms);
-            
-            delete ms;
-            masterservers.erase(i);
-        }
-    }
+    serverListTable-&gt;addColumn(UString(&quot;Server&quot;), 200);
+    serverListTable-&gt;addColumn(UString(&quot;Map&quot;), 140);
+    serverListTable-&gt;addColumn(UString(&quot;Players&quot;), 80);
+    serverListTable-&gt;addColumn(UString(&quot;Type&quot;), 100);
+    serverListTable-&gt;addColumn(UString(&quot;Ping&quot;), 80);
+    serverListTable-&gt;setSize(620, 228);
+    serverListTable-&gt;setChangeEvent(Events::ServerSelected);
     
-    static inline bool getToken(StringTokenizer&amp; tkn, const std::string&amp; name, std::string&amp; dest)
-    {
-        if ( tkn.hasMore() &amp;&amp; (tkn.getNextToken() == name) )
-        {
-            if ( tkn.hasMore() )
-            {
-                dest = tkn.getNextToken();
-                return true;
-            }
-        }
-        
-        return false;
-    }
+    serverListDS = new ServerListDataSource();
+    serverListDS-&gt;setTable(serverListTable);
     
-    void addServer(const NPString&amp; ip, const uint16_t port)
-    {
-        for ( size_t n = 0; n &lt; game_servers.size(); n++ )
-        {
-            if ( (game_servers[n]-&gt;ip == ip) &amp;&amp; (game_servers[n]-&gt;port == port) )
-            {
-                return; // already there
-            }
-        }
-
-        LOGGER.warning(&quot;New server IP received: [%s:%d]&quot;, ip.c_str(), port);
-        game_servers.push_back( new GameServerInfo(ip, port) );
-    }
-
-    void parseMasterserverRepply(Data * ms)
-    {
-        std::string str = ms-&gt;data;
-        str.erase( str.find(&quot;\\final&quot;) );
-        
-        StringTokenizer tknizer(str,'\\');
-        
-        std::string dirip;
-        std::string portstr;
-        
-        while ( tknizer.hasMore() )
-        {
-            if (  (! getToken(tknizer, &quot;ip&quot;, dirip))
-                ||(! getToken(tknizer, &quot;port&quot;, portstr)) )
-            {
-                continue;
-            }
-
-            uint16_t port = 0;
-            std::stringstream ss(portstr);
-            ss &gt;&gt; port;
-                
-            if ( dirip.empty() || (port == 0) )
-            {
-                LOGGER.warning(&quot;Invalid IP received from masterserver&quot;);
-                continue;
-            }
-            
-            addServer(dirip, port);
-        }
-    }
+    getNewListButton = Button::createNewSpecialButton(&quot;Get new list&quot;, iXY(0,0), 100);
+    getNewListButton-&gt;setClickEvent(Events::RefreshGameList);
     
-    void onConnected(network::TCPSocket *so)
-    {
-        Data * ms = masterservers[findMasterserverBySocket(so)];
-        // only sockets we create can be connected, no need to check, MUST BE OK
-        
-        LOGGER.warning(&quot;MASTERSERVER Connected [%s]&quot;, ms-&gt;host.c_str());
-        
-        ms-&gt;timer.reset();
-        
-        so-&gt;send(masterserver_query,sizeof(masterserver_query)-1);
-    }
+    refreshListButton = Button::createNewSpecialButton(&quot;Refresh&quot;, iXY(0,0), 100);
+    refreshListButton-&gt;setClickEvent(Events::RefreshGameData);
     
-    void onDisconected(network::TCPSocket *so)
-    {
-        size_t i = findMasterserverBySocket(so);
-        LOGGER.warning(&quot;MASTERSERVER Disconected [%s]&quot;, masterservers[i]-&gt;host.c_str());
-
-        masterservers[i]-&gt;socket = 0;
-        delete masterservers[i];
-        masterservers.erase(i);
-    }
+    mapThumbnail = new MapThumbnailComponent(100, 100);
     
-    void onSocketError(network::TCPSocket *so)
-    {
-        size_t i = findMasterserverBySocket(so);
-        LOGGER.warning(&quot;MASTERSERVER SocketError [%s]&quot;, masterservers[i]-&gt;host.c_str());
-
-        masterservers[i]-&gt;socket = 0;
-        delete masterservers[i];
-        masterservers.erase(i);
-    }
-    
-};
-
-
-
-JoinGameLayer::JoinGameLayer() : ComponentLayer(0)
-{
-    area = new AreaComponent( MENU_WIDTH, MENU_HEIGHT );
-    
     addComponent(area);
+    addComponent(mapThumbnail);
+    addComponent(serverListTable);
+    addComponent(getNewListButton);
+    addComponent(refreshListButton);
     
+    masterserverQuerier = new MasterserverQuerier(&amp;component_events, Events::MasterserverQueryFinished);
+    gameserverQuerier = new GameserverQuerier(serverListDS);
+    
 }
 
 JoinGameLayer::~JoinGameLayer()
 {
+    delete masterserverQuerier;
+    delete gameserverQuerier;
 }
 
 void JoinGameLayer::recalculateComponentLocations()
@@ -410,18 +125,84 @@
     int y = area-&gt;getLocationY() + 10;
     
     // @todo move the components
+    
+    mapThumbnail-&gt;setLocation(x, y);
+    
+    y += 150; // server data
+    
+    serverListTable-&gt;setLocation(x, y);
+    
+    y += serverListTable-&gt;getHeight() + 1;
+    
+    getNewListButton-&gt;setLocation(x, y);
+    refreshListButton-&gt;setLocation(x + 105, y);
+    
 }
 
+void JoinGameLayer::logic()
+{
+    ComponentLayer::logic();
+    if ( gameserverQuerier-&gt;isQuerying() )
+    {
+        gameserverQuerier-&gt;checkTimeouts();
+    }
+}
+
 void JoinGameLayer::handleComponentEvents()
 {
     int event;
     while ( (event = component_events.nextEvent()) ) switch ( event )
     {
         case Events::RefreshGameList:
+            if ( ! masterserverQuerier-&gt;isQuerying() &amp;&amp; ! gameserverQuerier-&gt;isQuerying() )
+            {
+                servers.deleteAll();
+                serverListTable-&gt;clearSelection();
+                mapThumbnail-&gt;setEmpty();
+                masterserverQuerier-&gt;beginQuery(&amp;servers);
+            }
             break;
             
+        case Events::MasterserverQueryFinished:
+            LOGGER.warning(&quot;Received %d servers&quot;, servers.size());
+            for ( unsigned n = 0; n &lt; servers.size(); n++ )
+            {
+                LOGGER.warning(&quot;Server: %s : %d&quot;, servers[n]-&gt;ip.c_str(), servers[n]-&gt;port);
+            }
+            
+            if ( servers.empty() )
+                break;
+            
+            // else fallthrough
+            
         case Events::RefreshGameData:
+            if ( ! masterserverQuerier-&gt;isQuerying() &amp;&amp; ! gameserverQuerier-&gt;isQuerying() )
+            {
+                serverListDS-&gt;clear();
+                serverListTable-&gt;clearSelection();
+                mapThumbnail-&gt;setEmpty();
+                gameserverQuerier-&gt;beginQuery(servers);
+            }
             break;
             
+        case Events::ServerSelected:
+        {
+            int index = serverListTable-&gt;getSelectedIndex();
+            const GameServerInfo * info = serverListDS-&gt;getServerInfo(index);
+            if ( info )
+            {
+                const MapFile * mf = ResourceManager::getMap(info-&gt;current_map, ResourceManager::MAP_THUMBNAIL);
+                if ( mf )
+                {
+                    mapThumbnail-&gt;setImage(*(mf-&gt;thumbnail));
+                }
+                else
+                {
+                    mapThumbnail-&gt;setEmpty();
+                }
+            }
+            
+        }
+            break;
     }
 }

Modified: trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/JoinGameLayer.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/JoinGameLayer.hpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/JoinGameLayer.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -22,7 +22,16 @@
 #define	JOINGAMELAYER_HPP
 
 #include &quot;2D/ComponentLayer.hpp&quot;
+#include &quot;Network/MasterserverQuerier.hpp&quot;
+#include &quot;Network/ServerAddress.hpp&quot;
 
+class Button;
+class Table;
+class ServerListDataSource;
+class GameServerInfo;
+class GameserverQuerier;
+class MapThumbnailComponent;
+
 class JoinGameLayer : public ComponentLayer
 {
 public:
@@ -33,8 +42,22 @@
     void recalculateComponentLocations();
     void handleComponentEvents();
     
+    void logic();
+    
     Component * area;
+    Button * getNewListButton;
+    Button * refreshListButton;
+    Table  * serverListTable;
     
+    MapThumbnailComponent * mapThumbnail;
+    
+    ServerListDataSource * serverListDS;
+    GameServerInfo * selectedServer;
+    
+    MasterserverQuerier * masterserverQuerier;
+    PtrArray&lt;ServerAddress&gt; servers;
+    
+    GameserverQuerier *  gameserverQuerier;
 };
 
 #endif	/* JOINGAMELAYER_HPP */

Added: trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -0,0 +1,54 @@
+/*
+Copyright (C) 2013 Netpanzer Team. (www.netpanzer.org), Aaron Perez
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA 
+ * 
+ * Created on September 14, 2013, 5:29 PM
+ */
+
+#include &quot;MapThumbnailComponent.hpp&quot;
+#include &quot;2D/Color.hpp&quot;
+
+
+MapThumbnailComponent::MapThumbnailComponent(int w, int h)
+{
+//        setLocation(x, y);
+    setSize(w, h);
+    mapimage.create(w - 2, h - 2);
+    setEmpty();
+}
+
+MapThumbnailComponent::~MapThumbnailComponent()
+{
+    
+}
+
+void MapThumbnailComponent::draw(Surface &amp;dest) const
+{
+    dest.drawRect(rect, Color::lightGray);
+    mapimage.blt(dest, rect.getLocationX()+1, rect.getLocationY()+1); // full blit
+}
+
+void MapThumbnailComponent::setImage(const Surface&amp; from)
+{
+    iRect r(0,0, rect.getWidth()-2, rect.getHeight()-2);
+    mapimage.bltScale(from, r);
+}
+
+void MapThumbnailComponent::setEmpty()
+{
+    mapimage.fill(0);
+}
+

Added: trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.hpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenu/MapThumbnailComponent.hpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -0,0 +1,46 @@
+/*
+Copyright (C) 2013 Netpanzer Team. (www.netpanzer.org), Aaron Perez
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA 
+ *
+ * Created on September 14, 2013, 5:29 PM
+ */
+
+#ifndef MAPTHUMBNAILCOMPONENT_HPP
+#define	MAPTHUMBNAILCOMPONENT_HPP
+
+#include &quot;2D/Surface.hpp&quot;
+#include &quot;Views/Components/Component.hpp&quot;
+
+class MapThumbnailComponent : public Component
+{
+public:
+    MapThumbnailComponent(int w, int h);
+    ~MapThumbnailComponent();
+    
+    void draw(Surface &amp;dest) const;
+    
+    void setImage(const Surface&amp; from);
+    
+    void setEmpty();
+    
+private:
+    MapThumbnailComponent(const MapThumbnailComponent&amp; );
+
+    Surface mapimage;
+};
+
+#endif	/* MAPTHUMBNAILCOMPONENT_HPP */
+

Modified: trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp	2013-09-10 00:17:13 UTC (rev 1434)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp	2013-09-14 13:50:43 UTC (rev 1435)
@@ -25,6 +25,7 @@
 #include &quot;Scenes/Common/OptionsLayer.hpp&quot;
 #include &quot;Scenes/MainMenu/IntroLayer.hpp&quot;
 #include &quot;Scenes/MainMenu/HostGameLayer.hpp&quot;
+#include &quot;Scenes/MainMenu/JoinGameLayer.hpp&quot;
 
 #include &quot;2D/Components/Slider.hpp&quot;
 
@@ -130,6 +131,7 @@
     IntroLayer    * intro_layer;
     OptionsLayer  * options_layer;
     HostGameLayer * hostgame_layer;
+    JoinGameLayer * joingame_layer;
 
     struct Events {
         enum
@@ -149,6 +151,7 @@
     {
         options_layer = 0;
         hostgame_layer = 0;
+        joingame_layer = 0;
 
         panel_darkgray = new DarkGrayPanel();
         panel_darkgray-&gt;setSize(MENU_WIDTH, MENU_HEIGHT-26-26);
@@ -188,6 +191,11 @@
         {
             delete hostgame_layer;
         }
+        
+        if ( joingame_layer )
+        {
+            delete joingame_layer;
+        }
     }
     
 private:
@@ -197,11 +205,16 @@
         while ( (event = component_events.nextEvent()) ) switch ( event )
         {
             case Events::ShowMain:
-                LOGGER.warning(&quot;Clicked on Main!!!&quot;);
                 setSubLayer(intro_layer);
                 break;
+                
             case Events::ShowJoin:
-                LOGGER.warning(&quot;Clicked on Join!!!&quot;);
+                if ( joingame_layer == 0 )
+                {
+                    joingame_layer = new JoinGameLayer();
+                }
+                
+                setSubLayer(joingame_layer);
                 break;
 
             case Events::ShowHost:

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000455.html">[Netpanzer-cvs] r1434 - in trunk/netpanzer:	projects/netpanzer-svn-windows/nbproject	projects/netpanzer-svn-windows/nbproject/private src	src/Lib/2D src/NetPanzer/Actions	src/NetPanzer/Scenes/MainMenu src/NetPanzer/Views	src/NetPanzer/Views/Components src/NetPanzer/Views/Game
</A></li>
	<LI>Next message: <A HREF="000457.html">[Netpanzer-cvs] r1436 - in trunk/netpanzer:	projects/netpanzer-svn-windows/nbproject/private	src/NetPanzer/Classes src/NetPanzer/Network	src/NetPanzer/Scenes/MainMenu
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#456">[ date ]</a>
              <a href="thread.html#456">[ thread ]</a>
              <a href="subject.html#456">[ subject ]</a>
              <a href="author.html#456">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">More information about the Netpanzer-cvs
mailing list</a><br>
</body></html>
