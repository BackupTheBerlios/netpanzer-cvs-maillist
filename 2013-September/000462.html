<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Netpanzer-cvs] r1443 - in trunk/netpanzer: . data pics/buttons	projects/netpanzer-svn-windows/nbproject	projects/netpanzer-svn-windows/nbproject/private	src/Lib/2D/Components src/NetPanzer/Interfaces	src/NetPanzer/Resources src/NetPanzer/Scenes	src/NetPanzer/Scenes/Common src/NetPanzer/Views/Game
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/netpanzer-cvs/2013-September/index.html" >
   <LINK REL="made" HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1443%20-%20in%20trunk/netpanzer%3A%20.%20data%20pics/buttons%0A%09projects/netpanzer-svn-windows/nbproject%0A%09projects/netpanzer-svn-windows/nbproject/private%0A%09src/Lib/2D/Components%20src/NetPanzer/Interfaces%0A%09src/NetPanzer/Resources%20src/NetPanzer/Scenes%0A%09src/NetPanzer/Scenes/Common%20src/NetPanzer/Views/Game&In-Reply-To=%3C20130928175456.C64EC55B0C%40scm.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000461.html">
   <LINK REL="Next"  HREF="000463.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Netpanzer-cvs] r1443 - in trunk/netpanzer: . data pics/buttons	projects/netpanzer-svn-windows/nbproject	projects/netpanzer-svn-windows/nbproject/private	src/Lib/2D/Components src/NetPanzer/Interfaces	src/NetPanzer/Resources src/NetPanzer/Scenes	src/NetPanzer/Scenes/Common src/NetPanzer/Views/Game</H1>
    <B>kromxp at scm.berlios.de</B> 
    <A HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1443%20-%20in%20trunk/netpanzer%3A%20.%20data%20pics/buttons%0A%09projects/netpanzer-svn-windows/nbproject%0A%09projects/netpanzer-svn-windows/nbproject/private%0A%09src/Lib/2D/Components%20src/NetPanzer/Interfaces%0A%09src/NetPanzer/Resources%20src/NetPanzer/Scenes%0A%09src/NetPanzer/Scenes/Common%20src/NetPanzer/Views/Game&In-Reply-To=%3C20130928175456.C64EC55B0C%40scm.berlios.de%3E"
       TITLE="[Netpanzer-cvs] r1443 - in trunk/netpanzer: . data pics/buttons	projects/netpanzer-svn-windows/nbproject	projects/netpanzer-svn-windows/nbproject/private	src/Lib/2D/Components src/NetPanzer/Interfaces	src/NetPanzer/Resources src/NetPanzer/Scenes	src/NetPanzer/Scenes/Common src/NetPanzer/Views/Game">kromxp at scm.berlios.de
       </A><BR>
    <I>Sat Sep 28 19:54:56 CEST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000461.html">[Netpanzer-cvs] r1442 - in trunk/netpanzer: pics/flags	projects/netpanzer-svn-windows/nbproject	projects/netpanzer-svn-windows/nbproject/private src/Lib/2D	src/NetPanzer/Classes/Network src/NetPanzer/Interfaces	src/NetPanzer/Resources src/NetPanzer/Views/Components	src/NetPanzer/Views/Game
</A></li>
        <LI>Next message: <A HREF="000463.html">[Netpanzer-cvs] r1444 - trunk/netpanzer/src/NetPanzer/Resources
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#462">[ date ]</a>
              <a href="thread.html#462">[ thread ]</a>
              <a href="subject.html#462">[ subject ]</a>
              <a href="author.html#462">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: kromxp
Date: 2013-09-28 19:54:55 +0200 (Sat, 28 Sep 2013)
New Revision: 1443

Added:
   trunk/netpanzer/data/colordef.json
   trunk/netpanzer/pics/buttons/newscroll.png
   trunk/netpanzer/src/NetPanzer/Resources/BlendTable.cpp
   trunk/netpanzer/src/NetPanzer/Resources/Image.cpp
   trunk/netpanzer/src/NetPanzer/Resources/MImage.cpp
   trunk/netpanzer/src/NetPanzer/Resources/MouseCursor.cpp
Modified:
   trunk/netpanzer/SConstruct
   trunk/netpanzer/data/resources.json
   trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/configurations.xml
   trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/configurations.xml
   trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/private.xml
   trunk/netpanzer/src/Lib/2D/Components/Button.cpp
   trunk/netpanzer/src/Lib/2D/Components/VScrollBar.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/MouseInterface.cpp
   trunk/netpanzer/src/NetPanzer/Resources/BlendTable.hpp
   trunk/netpanzer/src/NetPanzer/Resources/Image.hpp
   trunk/netpanzer/src/NetPanzer/Resources/ImageFilter.cpp
   trunk/netpanzer/src/NetPanzer/Resources/ImageFilter.hpp
   trunk/netpanzer/src/NetPanzer/Resources/MImage.hpp
   trunk/netpanzer/src/NetPanzer/Resources/MouseCursor.hpp
   trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.cpp
   trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.hpp
   trunk/netpanzer/src/NetPanzer/Scenes/Common/ModalMessageLayer.cpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.cpp
Log:
more use of templates in resource management

Modified: trunk/netpanzer/SConstruct
===================================================================
--- trunk/netpanzer/SConstruct	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/SConstruct	2013-09-28 17:54:55 UTC (rev 1443)
@@ -275,8 +275,8 @@
 
 # BUILDS FREETYPE
 
-env.Append( CFLAGS = [ '-Isrc/Lib/freetype/include', '-DFT2_BUILD_LIBRARY'] )
-env.StaticLibrary( libpath + 'npfreetype', [ 'src/Lib/freetype/ftsystem.c', 'src/Lib/freetype/ftinit.c', 'src/Lib/freetype/ftdebug.c','src/Lib/freetype/ftbase.c','src/Lib/freetype/truetype.c','src/Lib/freetype/raster.c','src/Lib/freetype/smooth.c','src/Lib/freetype/sfnt.c'] )
+freetypeenv.Append( CFLAGS = [ '-Isrc/Lib/freetype/include', '-DFT2_BUILD_LIBRARY'] )
+freetypeenv.StaticLibrary( libpath + 'npfreetype', [ 'src/Lib/freetype/ftsystem.c', 'src/Lib/freetype/ftinit.c', 'src/Lib/freetype/ftdebug.c','src/Lib/freetype/ftbase.c','src/Lib/freetype/truetype.c','src/Lib/freetype/raster.c','src/Lib/freetype/smooth.c','src/Lib/freetype/sfnt.c'] )
 
 # BUILDS 2D
 env.Append( CFLAGS = [ '-DZ_PREFIX=1' ] )

Added: trunk/netpanzer/data/colordef.json
===================================================================
--- trunk/netpanzer/data/colordef.json	                        (rev 0)
+++ trunk/netpanzer/data/colordef.json	2013-09-28 17:54:55 UTC (rev 1443)
@@ -0,0 +1,67 @@
+{
+    &quot;unitAqua&quot;:         [  0, 204, 255],
+    &quot;unitYellow&quot;:       [255, 255,   0],
+    &quot;unitRed&quot;:          [255,   0,   0],
+    &quot;unitBlue&quot;:         [  3,   3, 255],
+    &quot;unitDarkBlue&quot;:     [  0,   0, 128],
+    &quot;unitLightGreen&quot;:   [163, 214, 159],
+    &quot;unitGreen&quot;:        [ 31, 166,  36],
+    &quot;unitBlueGray&quot;:     [ 43,  85, 131],
+    &quot;unitDarkRed&quot;:      [150,   0,   0],
+    &quot;unitBlack&quot;:        [  6,   2,   2],
+    &quot;unitDarkGreen&quot;:    [ 26,  88,  36],
+    &quot;unitWhite&quot;:        [250, 253, 248],
+    &quot;unitLightOrange&quot;:  [246, 210,  99],
+    &quot;unitOrange&quot;:       [205, 144,   9],
+    &quot;unitGray&quot;:         [186, 186, 186],
+    &quot;unitDarkGray&quot;:     [ 99, 100, 102],
+
+    &quot;black&quot;:            [  6,   2,   2], // so it skips the color 0
+    &quot;gray32&quot;:           [ 32,  32,  32],
+    &quot;gray64&quot;:           [ 64,  64,  64],
+    &quot;gray96&quot;:           [ 96,  96,  96],
+    &quot;gray128&quot;:          [128, 128, 128],
+    &quot;gray160&quot;:          [160, 160, 160],
+    &quot;gray192&quot;:          [192, 192, 192],
+    &quot;gray224&quot;:          [224, 224, 224],
+    &quot;white&quot;:            [255, 255, 255],
+
+
+    &quot;darkGray&quot;:         &quot;gray64&quot;,
+    &quot;darkRed&quot;:          [128,   0,   0], 
+    &quot;darkGreen&quot;:        [  0, 128,   0], 
+    &quot;darkBlue&quot;:         [  0,   0, 128], 
+    &quot;darkYellow&quot;:       [255, 168,  18], 
+    &quot;darkOrange&quot;:       [255, 140,   0], 
+    &quot;darkMagenta&quot;:      [148,   0, 211], 
+    &quot;darkCyan&quot;:         [  0, 206, 209], 
+
+
+    &quot;gray&quot;:             &quot;gray128&quot;,
+    &quot;red&quot;:              [255,   0,   0], 
+    &quot;green&quot;:            [  0, 255,   0], 
+    &quot;blue&quot;:             [  0,   0, 255], 
+    &quot;yellow&quot;:           [255, 255,   0], 
+    &quot;orange&quot;:           [255, 128,   0], 
+    &quot;magenta&quot;:          [255,   0, 255], 
+    &quot;cyan&quot;:             [  0, 255, 255], 
+
+    &quot;brown&quot;:            [200,  80,  80], 
+
+    &quot;tan&quot;:              [210, 180, 140], 
+    &quot;chartreuse&quot;:       [127, 255,   0], 
+    &quot;cobaltGreen&quot;:      [ 61, 145,  64], 
+    &quot;emeraldGreen&quot;:     [  0, 201,  87], 
+    &quot;forestGreen&quot;:      [ 34, 139,  34], 
+    &quot;darkOliveGreen&quot;:   [ 85, 107,  47], 
+    &quot;terreVerte&quot;:       [ 56,  94,  15], 
+
+    &quot;lightGray&quot;:        &quot;gray192&quot;,
+    &quot;lightRed&quot;:         [255, 160, 122], 
+    &quot;lightGreen&quot;:       [ 50, 205,  50], 
+    &quot;lightBlue&quot;:        [135, 206, 250], 
+    &quot;lightYellow&quot;:      [255, 255, 224], 
+    &quot;lightOrange&quot;:      [237, 145,  33], 
+    &quot;lightMagenta&quot;:     [  0, 255, 255],
+    &quot;lightCyan&quot;:        [224, 255, 255]
+}

Modified: trunk/netpanzer/data/resources.json
===================================================================
--- trunk/netpanzer/data/resources.json	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/data/resources.json	2013-09-28 17:54:55 UTC (rev 1443)
@@ -33,6 +33,7 @@
     
     &quot;mimages&quot;: [
         { &quot;name&quot;: &quot;scroll-buttons&quot;, &quot;file&quot;: &quot;pics/buttons/scrollbutton.png&quot;, &quot;size&quot;: [ 15, 15 ], &quot;offset&quot;: [ 0, 0 ], &quot;frames&quot;: 10, &quot;fps&quot;: 0 },
+        { &quot;name&quot;: &quot;new-scroll-buttons&quot;, &quot;file&quot;: &quot;pics/buttons/newscroll.png&quot;, &quot;size&quot;: [ 15, 15 ], &quot;offset&quot;: [ 0, 0 ], &quot;frames&quot;: 8, &quot;fps&quot;: 0 },
 
         { &quot;name&quot;: &quot;burn-ground-chunks&quot;, &quot;file&quot;: &quot;pics/particles/burnGroundChunks.png&quot;, &quot;size&quot;: [2, 2], &quot;offset&quot;: [0, 0], &quot;frames&quot;: 26, &quot;fps&quot;: 0 },
         { &quot;name&quot;: &quot;chunks&quot;,             &quot;file&quot;: &quot;pics/particles/chunks.png&quot;,           &quot;size&quot;: [2, 2], &quot;offset&quot;: [0, 0], &quot;frames&quot;: 256, &quot;fps&quot;: 0 },

Added: trunk/netpanzer/pics/buttons/newscroll.png
===================================================================
(Binary files differ)


Property changes on: trunk/netpanzer/pics/buttons/newscroll.png
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Modified: trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/configurations.xml
===================================================================
--- trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/configurations.xml	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/configurations.xml	2013-09-28 17:54:55 UTC (rev 1443)
@@ -2,6 +2,9 @@
 &lt;configurationDescriptor version=&quot;89&quot;&gt;
   &lt;logicalFolder name=&quot;root&quot; displayName=&quot;root&quot; projectFiles=&quot;true&quot; kind=&quot;ROOT&quot;&gt;
     &lt;df root=&quot;../..&quot; name=&quot;0&quot;&gt;
+      &lt;df name=&quot;data&quot;&gt;
+        &lt;in&gt;colordef.json&lt;/in&gt;
+      &lt;/df&gt;
       &lt;df name=&quot;src&quot;&gt;
         &lt;df name=&quot;Lib&quot;&gt;
           &lt;df name=&quot;2D&quot;&gt;
@@ -547,11 +550,15 @@
             &lt;in&gt;UnitPowerUp.hpp&lt;/in&gt;
           &lt;/df&gt;
           &lt;df name=&quot;Resources&quot;&gt;
+            &lt;in&gt;BlendTable.cpp&lt;/in&gt;
             &lt;in&gt;BlendTable.hpp&lt;/in&gt;
+            &lt;in&gt;Image.cpp&lt;/in&gt;
             &lt;in&gt;Image.hpp&lt;/in&gt;
             &lt;in&gt;ImageFilter.cpp&lt;/in&gt;
             &lt;in&gt;ImageFilter.hpp&lt;/in&gt;
+            &lt;in&gt;MImage.cpp&lt;/in&gt;
             &lt;in&gt;MImage.hpp&lt;/in&gt;
+            &lt;in&gt;MouseCursor.cpp&lt;/in&gt;
             &lt;in&gt;MouseCursor.hpp&lt;/in&gt;
             &lt;in&gt;ResourceManager.cpp&lt;/in&gt;
             &lt;in&gt;ResourceManager.hpp&lt;/in&gt;
@@ -747,6 +754,8 @@
           &lt;/ccTool&gt;
         &lt;/makeTool&gt;
       &lt;/makefileType&gt;
+      &lt;item path=&quot;../../data/colordef.json&quot; ex=&quot;false&quot; tool=&quot;3&quot; flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/Lib/2D/Color.cpp&quot; ex=&quot;false&quot; tool=&quot;1&quot; flavor2=&quot;0&quot;&gt;
         &lt;ccTool&gt;
           &lt;incDir&gt;
@@ -5181,11 +5190,21 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/BlendTable.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/BlendTable.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/Image.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/Image.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
@@ -5201,11 +5220,21 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/MImage.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/MImage.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/MouseCursor.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/MouseCursor.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
@@ -6762,6 +6791,8 @@
           &lt;/ccTool&gt;
         &lt;/makeTool&gt;
       &lt;/makefileType&gt;
+      &lt;item path=&quot;../../data/colordef.json&quot; ex=&quot;false&quot; tool=&quot;3&quot; flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/Lib/2D/Color.cpp&quot; ex=&quot;false&quot; tool=&quot;1&quot; flavor2=&quot;0&quot;&gt;
         &lt;ccTool&gt;
           &lt;incDir&gt;
@@ -11190,11 +11221,21 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/BlendTable.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/BlendTable.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/Image.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/Image.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
@@ -11210,11 +11251,21 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/MImage.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/MImage.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/MouseCursor.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/MouseCursor.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
@@ -12769,6 +12820,8 @@
           &lt;/ccTool&gt;
         &lt;/makeTool&gt;
       &lt;/makefileType&gt;
+      &lt;item path=&quot;../../data/colordef.json&quot; ex=&quot;false&quot; tool=&quot;3&quot; flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/Lib/2D/Color.cpp&quot; ex=&quot;false&quot; tool=&quot;1&quot; flavor2=&quot;9&quot;&gt;
         &lt;ccTool&gt;
           &lt;incDir&gt;
@@ -17237,11 +17290,21 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/BlendTable.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/BlendTable.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/Image.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/Image.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
@@ -17257,11 +17320,21 @@
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/MImage.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/MImage.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;
             flavor2=&quot;0&quot;&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;../../src/NetPanzer/Resources/MouseCursor.cpp&quot;
+            ex=&quot;false&quot;
+            tool=&quot;1&quot;
+            flavor2=&quot;0&quot;&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;../../src/NetPanzer/Resources/MouseCursor.hpp&quot;
             ex=&quot;false&quot;
             tool=&quot;3&quot;

Modified: trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/configurations.xml
===================================================================
--- trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/configurations.xml	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/configurations.xml	2013-09-28 17:54:55 UTC (rev 1443)
@@ -114,6 +114,8 @@
               &lt;/df&gt;
               &lt;df name=&quot;GameInput&quot;&gt;
               &lt;/df&gt;
+              &lt;df name=&quot;json&quot;&gt;
+              &lt;/df&gt;
               &lt;df name=&quot;libjson&quot;&gt;
                 &lt;df name=&quot;_internal&quot;&gt;
                   &lt;df name=&quot;Source&quot;&gt;
@@ -207,6 +209,7 @@
         &lt;/df&gt;
       &lt;/df&gt;
       &lt;df name=&quot;data&quot;&gt;
+        &lt;in&gt;colordef.json&lt;/in&gt;
       &lt;/df&gt;
       &lt;df name=&quot;docs&quot;&gt;
         &lt;df name=&quot;docbook&quot;&gt;
@@ -952,11 +955,15 @@
             &lt;in&gt;UnitPowerUp.hpp&lt;/in&gt;
           &lt;/df&gt;
           &lt;df name=&quot;Resources&quot;&gt;
+            &lt;in&gt;BlendTable.cpp&lt;/in&gt;
             &lt;in&gt;BlendTable.hpp&lt;/in&gt;
+            &lt;in&gt;Image.cpp&lt;/in&gt;
             &lt;in&gt;Image.hpp&lt;/in&gt;
             &lt;in&gt;ImageFilter.cpp&lt;/in&gt;
             &lt;in&gt;ImageFilter.hpp&lt;/in&gt;
+            &lt;in&gt;MImage.cpp&lt;/in&gt;
             &lt;in&gt;MImage.hpp&lt;/in&gt;
+            &lt;in&gt;MouseCursor.cpp&lt;/in&gt;
             &lt;in&gt;MouseCursor.hpp&lt;/in&gt;
             &lt;in&gt;ResourceManager.cpp&lt;/in&gt;
             &lt;in&gt;ResourceManager.hpp&lt;/in&gt;

Modified: trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/private.xml
===================================================================
--- trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/private.xml	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/projects/netpanzer-svn-windows/nbproject/private/private.xml	2013-09-28 17:54:55 UTC (rev 1443)
@@ -9,7 +9,16 @@
     &lt;/data&gt;
     &lt;editor-bookmarks xmlns=&quot;<A HREF="http://www.netbeans.org/ns/editor-bookmarks/2">http://www.netbeans.org/ns/editor-bookmarks/2</A>&quot; lastBookmarkId=&quot;0&quot;/&gt;
     &lt;open-files xmlns=&quot;<A HREF="http://www.netbeans.org/ns/projectui-open-files/2">http://www.netbeans.org/ns/projectui-open-files/2</A>&quot;&gt;
-        &lt;group/&gt;
+        &lt;group&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/data/colordef.json&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/2D/Color.hpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/2D/Surface.hpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/2D/Color.cpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/2D/Components/Button.cpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/Lib/2D/Surface.cpp&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/data/resources.json&lt;/file&gt;
+            &lt;file&gt;file:/C:/prog/netpanzer-svn/src/NetPanzer/Resources/ResourceManager.cpp&lt;/file&gt;
+        &lt;/group&gt;
     &lt;/open-files&gt;
     &lt;preferences xmlns=&quot;<A HREF="http://www.netbeans.org/ns/auxiliary-configuration-preferences/1">http://www.netbeans.org/ns/auxiliary-configuration-preferences/1</A>&quot;&gt;
         &lt;module name=&quot;org-netbeans-modules-cnd-discovery&quot;&gt;

Modified: trunk/netpanzer/src/Lib/2D/Components/Button.cpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/Components/Button.cpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/Lib/2D/Components/Button.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -308,7 +308,7 @@
                                    const iXY&amp; loc,
                                    int width )
 {
-    ImageResource bitmap = ResourceManager::getImage(&quot;newbutton-background&quot;);
+    ImageResource bitmap = ResourceManager::getResource&lt;ImageResource&gt;(&quot;newbutton-background&quot;);
 
     Surface bstart(15, bitmap.getHeight());
     Surface bend(15, bitmap.getHeight());

Modified: trunk/netpanzer/src/Lib/2D/Components/VScrollBar.cpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/Components/VScrollBar.cpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/Lib/2D/Components/VScrollBar.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -24,6 +24,8 @@
 #include &lt;algorithm&gt;
 
 #include &quot;Util/Log.hpp&quot;
+#include &quot;Resources/MImage.hpp&quot;
+#include &quot;Resources/ResourceManager.hpp&quot;
 
 #define BSIZE (15)
 #define REPEAT_INITIAL (500)
@@ -61,30 +63,44 @@
     scrollArea.setWidth(BSIZE);
     movableBar.setWidth(BSIZE);
     
-    Surface pics;
-    pics.loadPNG(&quot;pics/buttons/scrollbutton.png&quot;);
+//    MImageResource sbuttons = ResourceManager::getMImage(&quot;scroll-buttons&quot;);
+    MImageResource sbuttons = ResourceManager::getResource&lt;MImageResource&gt;(&quot;new-scroll-buttons&quot;);
     
     PtrArray&lt;Surface&gt; piclist(3);
+    
+    piclist.push_back(new Surface(sbuttons.getWidth(), sbuttons.getHeight()));
+    piclist.push_back(new Surface(sbuttons.getWidth(), sbuttons.getHeight()));
+    piclist.push_back(new Surface(sbuttons.getWidth(), sbuttons.getHeight()));
 
-    piclist.fillNew();
-    piclist[0]-&gt;grab(pics, iRect(BSIZE*3, 0, BSIZE, BSIZE));
-    piclist[1]-&gt;grab(pics, iRect(BSIZE*2, 0, BSIZE, BSIZE));
-    piclist[2]-&gt;grab(pics, iRect(BSIZE*2, 0, BSIZE, BSIZE));
+    piclist[0]-&gt;fill(0);
+    piclist[1]-&gt;fill(0);
+    piclist[2]-&gt;fill(0);
     
+    sbuttons.draw(*piclist[0], 0, 0, 0); // 3,2,2
+    sbuttons.draw(*piclist[1], 1, 0, 0);
+    sbuttons.draw(*piclist[2], 2, 0, 0);
+    
     upButton = new Button();
     upButton-&gt;setImage(piclist);
-    upButton-&gt;setStateOffset(Button::BPRESSED, 1, 1);
+//    upButton-&gt;setStateOffset(Button::BPRESSED, 1, 1);
     upButton-&gt;setComponentEvents(&amp;myEvents);
     upButton-&gt;setClickEvent(Events::GoUp);
 
-    piclist.fillNew();
-    piclist[0]-&gt;grab(pics, iRect(BSIZE, 0, BSIZE, BSIZE));
-    piclist[1]-&gt;grab(pics, iRect(    0, 0, BSIZE, BSIZE));
-    piclist[2]-&gt;grab(pics, iRect(    0, 0, BSIZE, BSIZE));
+    piclist.push_back(new Surface(sbuttons.getWidth(), sbuttons.getHeight()));
+    piclist.push_back(new Surface(sbuttons.getWidth(), sbuttons.getHeight()));
+    piclist.push_back(new Surface(sbuttons.getWidth(), sbuttons.getHeight()));
+
+    piclist[0]-&gt;fill(0);
+    piclist[1]-&gt;fill(0);
+    piclist[2]-&gt;fill(0);
     
+    sbuttons.draw(*piclist[0], 4, 0, 0); // 1, 0, 0
+    sbuttons.draw(*piclist[1], 5, 0, 0);
+    sbuttons.draw(*piclist[2], 6, 0, 0);
+
     downButton = new Button();
     downButton-&gt;setImage(piclist);
-    downButton-&gt;setStateOffset(Button::BPRESSED, 1, 1);
+//    downButton-&gt;setStateOffset(Button::BPRESSED, 1, 1);
     downButton-&gt;setComponentEvents(&amp;myEvents);
     downButton-&gt;setClickEvent(Events::GoDown);
     

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/MouseInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/MouseInterface.cpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/MouseInterface.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -48,7 +48,7 @@
 //    }
 //    filesystem::freeList(cursorfiles);
 
-    setCursor(ResourceManager::getMouseCursor(&quot;default&quot;));
+    setCursor(ResourceManager::getResource&lt;MouseCursorResource&gt;(&quot;default&quot;));
 }
 
 void MouseInterface::shutdown()

Added: trunk/netpanzer/src/NetPanzer/Resources/BlendTable.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/BlendTable.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Resources/BlendTable.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -0,0 +1,33 @@
+
+#include &quot;BlendTable.hpp&quot;
+#include &quot;json/json.h&quot;
+#include &quot;ResourceManager.hpp&quot;
+#include &quot;Util/FileSystem.hpp&quot;
+
+template&lt;&gt; BlendTable * ResourceManager::resourceFromJSon&lt;BlendTable&gt;(const Json::Value&amp; node)
+{
+    if ( node.isMember(&quot;name&quot;)
+      &amp;&amp; node.isMember(&quot;file&quot;) )
+    {
+        BlendTable * b = new BlendTable();
+        b-&gt;name   = node[&quot;name&quot;].asString();
+        b-&gt;file   = node[&quot;file&quot;].asString();
+        return b;
+    }
+    
+    return 0;
+}
+
+bool BlendTable::load()
+{
+    filesystem::ReadFile f(file);
+    if ( f.isOpen() )
+    {
+        const unsigned blendtablesize = 256*256;
+        uint8_t * buffer = new uint8_t[blendtablesize];
+        f.read(buffer, blendtablesize, 1);
+        data = buffer;
+        loaded = true;
+    }
+    return loaded;
+}

Modified: trunk/netpanzer/src/NetPanzer/Resources/BlendTable.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/BlendTable.hpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Resources/BlendTable.hpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -28,6 +28,8 @@
 public:
     inline bool isLoaded() const { return loaded; }
 
+    bool load();
+    
     inline void unload()
     {
         delete[] data;

Added: trunk/netpanzer/src/NetPanzer/Resources/Image.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/Image.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Resources/Image.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -0,0 +1,32 @@
+
+#include &quot;Image.hpp&quot;
+#include &quot;json/json.h&quot;
+#include &quot;ResourceManager.hpp&quot;
+
+template&lt;&gt; Image * ResourceManager::resourceFromJSon&lt;Image&gt;(const Json::Value&amp; node)
+{
+    if ( node.isMember(&quot;name&quot;)
+      &amp;&amp; node.isMember(&quot;file&quot;)
+      &amp;&amp; node.isMember(&quot;size&quot;) )
+    {
+        const Json::Value&amp; siz = node[&quot;size&quot;];
+        if ( siz.isArray() &amp;&amp; siz.size() &gt;= 2 )
+        {
+            Image * i = new Image();
+            i-&gt;name   = node[&quot;name&quot;].asString();
+            i-&gt;file   = node[&quot;file&quot;].asString();
+            i-&gt;width  = siz[0].asInt();
+            i-&gt;height = siz[1].asInt();
+            return i;
+        }
+    }
+    
+    return 0;
+}
+
+bool Image::load()
+{
+    image.loadPNG(file.c_str());
+    loaded = true;
+    return loaded;
+}

Modified: trunk/netpanzer/src/NetPanzer/Resources/Image.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/Image.hpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Resources/Image.hpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -29,6 +29,8 @@
 public:
     inline bool isLoaded() const { return loaded; }
 
+    bool load();
+    
     inline void unload()
     {
         image.free();

Modified: trunk/netpanzer/src/NetPanzer/Resources/ImageFilter.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/ImageFilter.cpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Resources/ImageFilter.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -17,8 +17,38 @@
  */
 
 #include &quot;ImageFilter.hpp&quot;
+#include &quot;json/json.h&quot;
+#include &quot;ResourceManager.hpp&quot;
+#include &quot;Util/FileSystem.hpp&quot;
 
+template&lt;&gt; ImageFilter * ResourceManager::resourceFromJSon&lt;ImageFilter&gt;(const Json::Value&amp; node)
+{
+    if ( node.isMember(&quot;name&quot;)
+      &amp;&amp; node.isMember(&quot;file&quot;) )
+    {
+        ImageFilter * b = new ImageFilter();
+        b-&gt;name   = node[&quot;name&quot;].asString();
+        b-&gt;file   = node[&quot;file&quot;].asString();
+        return b;
+    }
+    
+    return 0;
+}
 
+bool ImageFilter::load()
+{
+    filesystem::ReadFile f(file);
+    if ( f.isOpen() )
+    {
+        const unsigned imagefiltersize = 256;
+        uint8_t * buffer = new uint8_t[imagefiltersize];
+        f.read(buffer, imagefiltersize, 1);
+        data = buffer;
+        loaded = true;
+    }
+    return loaded;
+}
+
 // @todo full check on sizing
 void ImageFilterResource::applyRounded(Surface&amp; dest, const iRect&amp; rect, const int radius) const
 {
@@ -119,6 +149,5 @@
 
         x++;
     }
-    
-    
+
 }

Modified: trunk/netpanzer/src/NetPanzer/Resources/ImageFilter.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/ImageFilter.hpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Resources/ImageFilter.hpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -29,6 +29,8 @@
 public:
     inline bool isLoaded() const { return loaded; }
 
+    bool load();
+    
     inline void unload()
     {
         delete[] data;

Added: trunk/netpanzer/src/NetPanzer/Resources/MImage.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/MImage.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Resources/MImage.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -0,0 +1,81 @@
+
+#include &quot;MImage.hpp&quot;
+#include &quot;json/json.h&quot;
+#include &quot;ResourceManager.hpp&quot;
+
+template&lt;&gt; MImage * ResourceManager::resourceFromJSon&lt;MImage&gt;(const Json::Value&amp; node)
+{
+        // offset and fps are optional
+    if ( node.isMember(&quot;name&quot;)
+      &amp;&amp; node.isMember(&quot;file&quot;)
+      &amp;&amp; node.isMember(&quot;size&quot;)
+      &amp;&amp; node.isMember(&quot;frames&quot;) )
+    {
+        const Json::Value&amp; siz = node[&quot;size&quot;];
+        if ( siz.isArray() &amp;&amp; siz.size() &gt;= 2 )
+        {
+            MImage * i = new MImage();
+            i-&gt;name   = node[&quot;name&quot;].asString();
+            i-&gt;file   = node[&quot;file&quot;].asString();
+            i-&gt;width  = siz[0].asInt();
+            i-&gt;height = siz[1].asInt();
+            i-&gt;frames = node[&quot;frames&quot;].asInt();
+            
+            const Json::Value&amp; off = node[&quot;offset&quot;];
+            if ( off.isArray() &amp;&amp; off.size() &gt;= 2 )
+            {
+                i-&gt;offset_x = off[0].asInt();
+                i-&gt;offset_y = off[1].asInt();
+            }
+            else
+            {
+                i-&gt;offset_x = 0;
+                i-&gt;offset_y = 0;
+            }
+            
+            const Json::Value&amp; fps = node[&quot;fps&quot;];
+            if ( fps.isInt() )
+            {
+                i-&gt;fps = fps.asInt();
+            }
+            else
+            {
+                i-&gt;fps = 0;
+            }
+            
+            return i;
+        }
+    }
+    
+    return 0;
+}
+
+bool MImage::load()
+{
+    Surface surf;
+    surf.loadPNG(file.c_str());
+
+    iRect bounds(0, 0, width, height);
+
+    PtrArray&lt;Surface&gt; ps(frames);
+    for ( int n = 0; n &lt; frames; n++ )
+    {
+        // @todo replace grab with create and blit
+        Surface * s = new Surface();
+        s-&gt;grab(surf, bounds);
+        ps.push_back(s);
+
+        bounds.translate(width, 0);
+        if ( bounds.getLocationX() &gt;= surf.getWidth() )
+        {
+            bounds.setLocationX(0);
+            bounds.translate(0, height);
+        }
+    }
+
+    image.pack(ps);
+    ps.deleteAll();
+
+    loaded = true;
+    return loaded;
+}

Modified: trunk/netpanzer/src/NetPanzer/Resources/MImage.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/MImage.hpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Resources/MImage.hpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -30,6 +30,8 @@
 {
 public:
     inline bool isLoaded() const { return loaded; }
+    
+    bool load();
 
     inline void unload()
     {

Added: trunk/netpanzer/src/NetPanzer/Resources/MouseCursor.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/MouseCursor.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Resources/MouseCursor.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -0,0 +1,34 @@
+
+#include &quot;MouseCursor.hpp&quot;
+#include &quot;json/json.h&quot;
+#include &quot;ResourceManager.hpp&quot;
+
+template&lt;&gt; MouseCursor * ResourceManager::resourceFromJSon&lt;MouseCursor&gt;(const Json::Value&amp; node)
+{
+    if ( node.isMember(&quot;name&quot;)
+      &amp;&amp; node.isMember(&quot;file&quot;)
+      &amp;&amp; node.isMember(&quot;offset&quot;) )
+    {
+        const Json::Value&amp; off = node[&quot;offset&quot;];
+        if ( off.isArray() &amp;&amp; off.size() &gt;= 2 )
+        {
+            MouseCursor * mc = new MouseCursor();
+            mc-&gt;name = node[&quot;name&quot;].asString();
+            mc-&gt;file = node[&quot;file&quot;].asString();
+            mc-&gt;offset_x = off[0].asInt();
+            mc-&gt;offset_y = off[1].asInt();
+            return mc;
+        }
+    }
+    
+    return 0;
+}
+
+bool MouseCursor::load()
+{
+    image.loadPNG(file.c_str());
+    loaded = true;
+    return loaded;
+}
+
+//template&lt;MouseCursor&gt; ResourceManager::resourceFromJSon;

Modified: trunk/netpanzer/src/NetPanzer/Resources/MouseCursor.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/MouseCursor.hpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Resources/MouseCursor.hpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -29,6 +29,8 @@
 public:
     inline bool isLoaded() const { return loaded; }
 
+    bool load();
+
     inline void unload()
     {
         image.free();

Modified: trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.cpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -377,125 +377,35 @@
     return mapfile;
 }
 
-static bool loadMouseCursor(const Json::Value&amp; node, MouseCursor * mc)
+template&lt;typename T&gt; void ResourceManager::loadJSonResourceArray(const Json::Value&amp; v, std::map&lt;NPString, T*&gt;&amp; m, const char * rname )
 {
-    if ( node.isMember(&quot;name&quot;)
-      &amp;&amp; node.isMember(&quot;file&quot;)
-      &amp;&amp; node.isMember(&quot;offset&quot;) )
+    if ( v.isArray() &amp;&amp; v.size() &gt; 0 )
     {
-        const Json::Value&amp; off = node[&quot;offset&quot;];
-        if ( off.isArray() &amp;&amp; off.size() &gt;= 2 )
+        for ( int n = 0, e = v.size(); n &lt; e; n++ )
         {
-            mc-&gt;name = node[&quot;name&quot;].asString();
-            mc-&gt;file = node[&quot;file&quot;].asString();
-            mc-&gt;offset_x = off[0].asInt();
-            mc-&gt;offset_y = off[1].asInt();
-            return true;
-        }
-    }
-    
-    return false;
-}
-
-static bool loadImage(const Json::Value&amp; node, Image * i)
-{
-    if ( node.isMember(&quot;name&quot;)
-      &amp;&amp; node.isMember(&quot;file&quot;)
-      &amp;&amp; node.isMember(&quot;size&quot;) )
-    {
-        const Json::Value&amp; siz = node[&quot;size&quot;];
-        if ( siz.isArray() &amp;&amp; siz.size() &gt;= 2 )
-        {
-            i-&gt;name   = node[&quot;name&quot;].asString();
-            i-&gt;file   = node[&quot;file&quot;].asString();
-            i-&gt;width  = siz[0].asInt();
-            i-&gt;height = siz[1].asInt();
-            return true;
-        }
-    }
-    
-    return false;
-}
-
-static bool loadMImage(const Json::Value&amp; node, MImage * i)
-{
-    // offset and fps are optional
-    if ( node.isMember(&quot;name&quot;)
-      &amp;&amp; node.isMember(&quot;file&quot;)
-      &amp;&amp; node.isMember(&quot;size&quot;)
-      &amp;&amp; node.isMember(&quot;frames&quot;) )
-    {
-        const Json::Value&amp; siz = node[&quot;size&quot;];
-        if ( siz.isArray() &amp;&amp; siz.size() &gt;= 2 )
-        {
-            i-&gt;name   = node[&quot;name&quot;].asString();
-            i-&gt;file   = node[&quot;file&quot;].asString();
-            i-&gt;width  = siz[0].asInt();
-            i-&gt;height = siz[1].asInt();
-            i-&gt;frames = node[&quot;frames&quot;].asInt();
-            
-            const Json::Value&amp; off = node[&quot;offset&quot;];
-            if ( off.isArray() &amp;&amp; off.size() &gt;= 2 )
+            T * c = resourceFromJSon&lt;T&gt;(v[n]);
+            if ( c )
             {
-                i-&gt;offset_x = off[0].asInt();
-                i-&gt;offset_y = off[1].asInt();
+                typename std::map&lt;NPString, T*&gt;::iterator i = m.find(c-&gt;name);
+                if ( i == m.end() )
+                {
+                    LOGGER.warning(&quot;Adding %s: '%s'&quot;, rname, c-&gt;name.c_str());
+                    m.insert(std::make_pair(c-&gt;name, c));
+                }
+                else
+                {
+                    // @todo do something with the already existing resource
+                }
             }
-            else
-            {
-                i-&gt;offset_x = 0;
-                i-&gt;offset_y = 0;
-            }
-            
-            const Json::Value&amp; fps = node[&quot;fps&quot;];
-            if ( fps.isInt() )
-            {
-                i-&gt;fps = fps.asInt();
-            }
-            else
-            {
-                i-&gt;fps = 0;
-            }
-            
-            return true;
         }
     }
-    
-    return false;
 }
 
-static bool loadBlendTable(const Json::Value&amp; node, BlendTable * b)
-{
-    if ( node.isMember(&quot;name&quot;)
-      &amp;&amp; node.isMember(&quot;file&quot;) )
-    {
-        b-&gt;name   = node[&quot;name&quot;].asString();
-        b-&gt;file   = node[&quot;file&quot;].asString();
-        return true;
-    }
-    
-    return false;
-}
-
-static bool loadImageFilter(const Json::Value&amp; node, ImageFilter * b)
-{
-    if ( node.isMember(&quot;name&quot;)
-      &amp;&amp; node.isMember(&quot;file&quot;) )
-    {
-        b-&gt;name   = node[&quot;name&quot;].asString();
-        b-&gt;file   = node[&quot;file&quot;].asString();
-        return true;
-    }
-    
-    return false;
-}
-
 bool ResourceManager::loadResourceDescriptions(const NPString&amp; filename)
 {
-    bool wasGood = false;
     IFileStream ifile(filename);
     if ( ifile.good() )
     {
-        wasGood = true;
         Json::Value root;
         Json::Reader reader;
         if ( ! reader.parse(ifile, root, true) )
@@ -504,279 +414,57 @@
             return false;
         }
         
-        {
-            const Json::Value&amp; v = root[&quot;mcursors&quot;];
-            if ( v.isArray() &amp;&amp; v.size() &gt; 0 )
-            {
-                for ( int n = 0, e = v.size(); n &lt; e; n++ )
-                {
-                    MouseCursor * c = new MouseCursor();
-                    if ( loadMouseCursor(v[n], c) )
-                    {
-                        MouseCursors::iterator i = RMan-&gt;mcursors.find(c-&gt;name);
-                        if ( i == RMan-&gt;mcursors.end() )
-                        {
-                            LOGGER.warning(&quot;Adding cursor: '%s'&quot;, c-&gt;name.c_str());
-                            RMan-&gt;mcursors.insert(std::make_pair(c-&gt;name, c));
-                        }
-                        else
-                        {
-                            // @todo replace cursor with new one or do something
-                        }
-                    }
-                    else
-                    {
-                        delete c;
-                    }
-                }
-            }
-        }
-        
-        {
-            const Json::Value&amp; v = root[&quot;images&quot;];
-            if ( v.isArray() &amp;&amp; v.size() &gt; 0 )
-            {
-                for ( int n = 0, e = v.size(); n &lt; e; n++ )
-                {
-                    Image * c = new Image();
-                    if ( loadImage(v[n], c) )
-                    {
-                        Images::iterator i = RMan-&gt;images.find(c-&gt;name);
-                        if ( i == RMan-&gt;images.end() )
-                        {
-                            LOGGER.warning(&quot;Adding image: '%s'&quot;, c-&gt;name.c_str());
-                            RMan-&gt;images.insert(std::make_pair(c-&gt;name, c));
-                        }
-                        else
-                        {
-                            // @todo replace cursor with new one or do something
-                        }
-                    }
-                    else
-                    {
-                        delete c;
-                    }
-                }
-            }
-        }
-        
-        {
-            const Json::Value&amp; v = root[&quot;mimages&quot;];
-            if ( v.isArray() &amp;&amp; v.size() &gt; 0 )
-            {
-                for ( int n = 0, e = v.size(); n &lt; e; n++ )
-                {
-                    MImage * c = new MImage();
-                    if ( loadMImage(v[n], c) )
-                    {
-                        MImages::iterator i = RMan-&gt;mimages.find(c-&gt;name);
-                        if ( i == RMan-&gt;mimages.end() )
-                        {
-                            LOGGER.warning(&quot;Adding mimage: '%s'&quot;, c-&gt;name.c_str());
-                            RMan-&gt;mimages.insert(std::make_pair(c-&gt;name, c));
-                        }
-                        else
-                        {
-                            // @todo replace cursor with new one or do something
-                        }
-                    }
-                    else
-                    {
-                        delete c;
-                    }
-                }
-            }
-        }
-        
-        {
-            const Json::Value&amp; v = root[&quot;blendtables&quot;];
-            if ( v.isArray() &amp;&amp; v.size() &gt; 0 )
-            {
-                for ( int n = 0, e = v.size(); n &lt; e; n++ )
-                {
-                    BlendTable * c = new BlendTable();
-                    if ( loadBlendTable(v[n], c) )
-                    {
-                        BlendTables::iterator i = RMan-&gt;blendtables.find(c-&gt;name);
-                        if ( i == RMan-&gt;blendtables.end() )
-                        {
-                            LOGGER.warning(&quot;Adding blendtable: '%s'&quot;, c-&gt;name.c_str());
-                            RMan-&gt;blendtables.insert(std::make_pair(c-&gt;name, c));
-                        }
-                        else
-                        {
-                            // @todo replace cursor with new one or do something
-                        }
-                    }
-                    else
-                    {
-                        delete c;
-                    }
-                }
-            }
-        }
-        
-        {
-            const Json::Value&amp; v = root[&quot;imagefilters&quot;];
-            if ( v.isArray() &amp;&amp; v.size() &gt; 0 )
-            {
-                for ( int n = 0, e = v.size(); n &lt; e; n++ )
-                {
-                    ImageFilter * c = new ImageFilter();
-                    if ( loadImageFilter(v[n], c) )
-                    {
-                        ImageFilters::iterator i = RMan-&gt;imagefilters.find(c-&gt;name);
-                        if ( i == RMan-&gt;imagefilters.end() )
-                        {
-                            LOGGER.warning(&quot;Adding imagefilter: '%s'&quot;, c-&gt;name.c_str());
-                            RMan-&gt;imagefilters.insert(std::make_pair(c-&gt;name, c));
-                        }
-                        else
-                        {
-                            // @todo replace cursor with new one or do something
-                        }
-                    }
-                    else
-                    {
-                        delete c;
-                    }
-                }
-            }
-        }
+        loadJSonResourceArray(root[&quot;mcursors&quot;],     RMan-&gt;mcursors,     &quot;cursor&quot;);
+        loadJSonResourceArray(root[&quot;images&quot;],       RMan-&gt;images,       &quot;image&quot;);
+        loadJSonResourceArray(root[&quot;mimages&quot;],      RMan-&gt;mimages,      &quot;mimage&quot;);
+        loadJSonResourceArray(root[&quot;blendtables&quot;],  RMan-&gt;blendtables,  &quot;blendtable&quot;);
+        loadJSonResourceArray(root[&quot;imagefilters&quot;], RMan-&gt;imagefilters, &quot;imagefilter&quot;);
+
+        return true;
     }
-    return wasGood;
+    
+    return false;
 }
 
-MouseCursorResource ResourceManager::getMouseCursor(const NPString&amp; name)
+template&lt;typename T, typename R&gt; R resourceOrDefault(std::map&lt;NPString, T*&gt;&amp; m, const NPString&amp; name, const char * rt)
 {
-    MouseCursors::iterator i = RMan-&gt;mcursors.find(name);
-    if ( i == RMan-&gt;mcursors.end())
+    typename std::map&lt;NPString, T*&gt;::iterator i = m.find(name);
+    if ( i == m.end())
     {
         // @todo return default thing
-        LOGGER.warning(&quot;Resource not found (cursor): '%s'&quot;, name.c_str());
-        return MouseCursorResource(0); // will die!!!!
+        LOGGER.warning(&quot;Resource (%s)not found: '%s'&quot;, rt, name.c_str());
+        return R(0); // will die!!!!
     }
     
     if ( ! i-&gt;second-&gt;isLoaded() )
     {
-        i-&gt;second-&gt;image.loadPNG(i-&gt;second-&gt;file.c_str());
-        i-&gt;second-&gt;loaded = true;
+        i-&gt;second-&gt;load();
     }
     
-    return MouseCursorResource(i-&gt;second);
+    return R(i-&gt;second);
 }
 
-ImageResource ResourceManager::getImage(const NPString&amp; name)
+template&lt;&gt; MouseCursorResource ResourceManager::getResource&lt;MouseCursorResource&gt;(const NPString&amp; name)
 {
-    Images::iterator i = RMan-&gt;images.find(name);
-    if ( i == RMan-&gt;images.end())
-    {
-        // @todo return default thing
-        LOGGER.warning(&quot;Resource not found (image): '%s'&quot;, name.c_str());
-        return ImageResource(0); // will die!!!!
-    }
-    
-    if ( ! i-&gt;second-&gt;isLoaded() )
-    {
-        i-&gt;second-&gt;image.loadPNG(i-&gt;second-&gt;file.c_str());
-        i-&gt;second-&gt;loaded = true;
-    }
-    
-    return ImageResource(i-&gt;second);
+    return resourceOrDefault&lt;MouseCursor, MouseCursorResource&gt;(RMan-&gt;mcursors, name, &quot;cursor&quot;);
 }
 
-MImageResource ResourceManager::getMImage(const NPString&amp; name)
+template&lt;&gt; ImageResource ResourceManager::getResource&lt;ImageResource&gt;(const NPString&amp; name)
 {
-    MImages::iterator i = RMan-&gt;mimages.find(name);
-    if ( i == RMan-&gt;mimages.end())
-    {
-        // @todo return default thing
-        LOGGER.warning(&quot;Resource not found (mimage): '%s'&quot;, name.c_str());
-        return MImageResource(0); // will die!!!!
-    }
-    
-    if ( ! i-&gt;second-&gt;isLoaded() )
-    {
-        MImage * mimage = i-&gt;second;
-        
-        Surface surf;
-        surf.loadPNG(mimage-&gt;file.c_str());
+    return resourceOrDefault&lt;Image, ImageResource&gt;(RMan-&gt;images, name, &quot;image&quot;);
+}
 
-        iRect bounds(0, 0, mimage-&gt;width, mimage-&gt;height);
-            
-        PtrArray&lt;Surface&gt; ps(mimage-&gt;frames);
-        for ( int n = 0; n &lt; mimage-&gt;frames; n++ )
-        {
-            // @todo replace grab with create and blit
-            Surface * s = new Surface();
-            s-&gt;grab(surf, bounds);
-            ps.push_back(s);
-
-            bounds.translate(mimage-&gt;width, 0);
-            if ( bounds.getLocationX() &gt;= surf.getWidth() )
-            {
-                bounds.setLocationX(0);
-                bounds.translate(0, mimage-&gt;height);
-            }
-        }
-        
-        mimage-&gt;image.pack(ps);
-        ps.deleteAll();
-        
-        mimage-&gt;loaded = true;
-    }
-    
-    return MImageResource(i-&gt;second);
+template&lt;&gt; MImageResource ResourceManager::getResource&lt;MImageResource&gt;(const NPString&amp; name)
+{
+    return resourceOrDefault&lt;MImage, MImageResource&gt;(RMan-&gt;mimages, name, &quot;mimage&quot;);
 }
 
-BlendTableResource ResourceManager::getBlendTable(const NPString&amp; name)
+template&lt;&gt; BlendTableResource ResourceManager::getResource&lt;BlendTableResource&gt;(const NPString&amp; name)
 {
-    BlendTables::iterator i = RMan-&gt;blendtables.find(name);
-    if ( i == RMan-&gt;blendtables.end())
-    {
-        // @todo return default thing
-        LOGGER.warning(&quot;Resource not found (blendtable): '%s'&quot;, name.c_str());
-        return BlendTableResource(0); // will die!!!!
-    }
-    
-    if ( ! i-&gt;second-&gt;isLoaded() )
-    {
-        filesystem::ReadFile f(i-&gt;second-&gt;file);
-        if ( f.isOpen() )
-        {
-            const unsigned blendtablesize = 256*256;
-            uint8_t * buffer = new uint8_t[blendtablesize];
-            f.read(buffer, blendtablesize, 1);
-            i-&gt;second-&gt;data = buffer;
-            i-&gt;second-&gt;loaded = true;
-        }
-    }
-    
-    return BlendTableResource(i-&gt;second);
+    return resourceOrDefault&lt;BlendTable, BlendTableResource&gt;(RMan-&gt;blendtables, name, &quot;blendtable&quot;);
 }
 
-ImageFilterResource ResourceManager::getImageFilter(const NPString&amp; name)
+template&lt;&gt; ImageFilterResource ResourceManager::getResource&lt;ImageFilterResource&gt;(const NPString&amp; name)
 {
-    ImageFilters::iterator i = RMan-&gt;imagefilters.find(name);
-    if ( i == RMan-&gt;imagefilters.end())
-    {
-        // @todo return default thing
-        LOGGER.warning(&quot;Resource not found (imagefilter): '%s'&quot;, name.c_str());
-        return ImageFilterResource(0); // will die!!!!
-    }
-    
-    if ( ! i-&gt;second-&gt;isLoaded() )
-    {
-        filesystem::ReadFile f(i-&gt;second-&gt;file);
-        if ( f.isOpen() )
-        {
-            const unsigned imagefiltersize = 256;
-            uint8_t * buffer = new uint8_t[imagefiltersize];
-            f.read(buffer, imagefiltersize, 1);
-            i-&gt;second-&gt;data = buffer;
-            i-&gt;second-&gt;loaded = true;
-        }
-    }
-    
-    return ImageFilterResource(i-&gt;second);
+    return resourceOrDefault&lt;ImageFilter, ImageFilterResource&gt;(RMan-&gt;imagefilters, name, &quot;imagefilter&quot;);
 }

Modified: trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.hpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.hpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -29,7 +29,10 @@
 #include &quot;BlendTable.hpp&quot;
 #include &quot;ImageFilter.hpp&quot;
 #include &lt;vector&gt;
+#include &lt;map&gt;
 
+#include &quot;json/json-forwards.h&quot;
+
 // forward declarations
 class Surface;
 class MapFile;
@@ -64,11 +67,11 @@
     
     static bool loadResourceDescriptions(const NPString&amp; filename);
     
-    static MouseCursorResource getMouseCursor(const NPString&amp; name);
-    static ImageResource getImage(const NPString&amp; name);
-    static MImageResource getMImage(const NPString&amp; name);
-    static BlendTableResource getBlendTable(const NPString&amp; name);
-    static ImageFilterResource getImageFilter(const NPString&amp; name);
+    template&lt;typename T&gt; static T getResource(const NPString&amp; name);
+
+private:
+    template&lt;typename T&gt; static T* resourceFromJSon(const Json::Value&amp; node);
+    template&lt;typename T&gt; static void loadJSonResourceArray(const Json::Value&amp; v, std::map&lt;NPString, T*&gt;&amp; m, const char * rname );
 };
 
 #endif	/* _RESOURCEMANAGER_HPP */

Modified: trunk/netpanzer/src/NetPanzer/Scenes/Common/ModalMessageLayer.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/Common/ModalMessageLayer.cpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Scenes/Common/ModalMessageLayer.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -48,7 +48,7 @@
 public:
     DarkGrayPanel()
     {
-        filter = ResourceManager::getImageFilter(&quot;darkgray&quot;);
+        filter = ResourceManager::getResource&lt;ImageFilterResource&gt;(&quot;darkgray&quot;);
     }
     
     void draw(Surface&amp; dest) const

Modified: trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -56,11 +56,11 @@
 public:
     BackgroundImageLayer() : Layer(-1), version_render(npver)
     {
-        image = ResourceManager::getImage(&quot;main-background&quot;);
-        tankbody = ResourceManager::getMImage(&quot;heavy-tank-2-body&quot;);
-        tankturret= ResourceManager::getMImage(&quot;heavy-tank-2-turret&quot;);
-        tankturretshadow= ResourceManager::getMImage(&quot;heavy-tank-2-turret-shadow&quot;);
-        darkenalot = ResourceManager::getBlendTable(&quot;darkenalot&quot;);
+        image = ResourceManager::getResource&lt;ImageResource&gt;(&quot;main-background&quot;);
+        tankbody = ResourceManager::getResource&lt;MImageResource&gt;(&quot;heavy-tank-2-body&quot;);
+        tankturret= ResourceManager::getResource&lt;MImageResource&gt;(&quot;heavy-tank-2-turret&quot;);
+        tankturretshadow= ResourceManager::getResource&lt;MImageResource&gt;(&quot;heavy-tank-2-turret-shadow&quot;);
+        darkenalot = ResourceManager::getResource&lt;BlendTableResource&gt;(&quot;darkenalot&quot;);
 
         hw = image.getWidth()/2;
         hh = image.getHeight()/2;
@@ -91,7 +91,7 @@
 public:
     DarkGrayPanel()
     {
-        filter = ResourceManager::getImageFilter(&quot;darkgray&quot;);
+        filter = ResourceManager::getResource&lt;ImageFilterResource&gt;(&quot;darkgray&quot;);
     }
     
     void draw(Surface&amp; dest) const
@@ -104,7 +104,7 @@
 static Button* createMainMenuButton(const NPString&amp; label, const unsigned event, const bool inverted = false)
 {
     Button * b = new Button();
-    ImageResource image = ResourceManager::getImage(&quot;mainmenu-button-background&quot;);
+    ImageResource image = ResourceManager::getResource&lt;ImageResource&gt;(&quot;mainmenu-button-background&quot;);
     
     Surface bitmap(image.getWidth(), image.getHeight());
 //    bitmap.fill(0);

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.cpp	2013-09-28 09:30:31 UTC (rev 1442)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.cpp	2013-09-28 17:54:55 UTC (rev 1443)
@@ -62,36 +62,6 @@
     }
 };
 
-
-static Button* createTitlebarButton(int x, int y, const Surface&amp; button_images, Action* action)
-{
-    PtrArray&lt;Surface&gt; bg(4);
-
-    Surface *bimage = new Surface(15,15);
-    button_images.blt(*bimage, 0, 0);
-//    bimage-&gt;bltLookup(bimage-&gt;getRect(), Palette::filterDarkGray());
-    bg.push_back(bimage);
-
-    bimage = new Surface(15,15);
-    button_images.blt(*bimage, 0, 0);
-    bg.push_back(bimage);
-    
-    bimage = new Surface(15,15);
-    button_images.blt(*bimage, 0, 0);
-    bg.push_back(bimage);
-
-    bimage = new Surface(15,15);
-    button_images.blt(*bimage, 0, 0);
-//    bimage-&gt;bltLookup(bimage-&gt;getRect(), Palette::filterDarkGray());
-    bg.push_back(bimage);
-
-    Button *b = new Button();
-    b-&gt;setImage(bg);
-    b-&gt;setLocation( x, y);
-    b-&gt;setStateOffset(Button::BPRESSED, 1, 1);
-    return b;
-}
-
 class MinimizeChatAction : public Action
 {
 public:
@@ -122,16 +92,16 @@
     resize(500, 150);
     moveTo(screen-&gt;getWidth()-getWidth(), screen-&gt;getHeight()-getHeight());
 
-    Surface button_images;
-    button_images.loadPNG(itScroll);
+//    Surface button_images;
+//    button_images.loadPNG(itScroll);
     
-    bHideWindow = createTitlebarButton( 0, 0, button_images, new MinimizeChatAction(this));
+//    bHideWindow = createTitlebarButton( 0, 0, button_images, new MinimizeChatAction(this));
     add(bHideWindow);
 
-    Surface show_button_image;
-    show_button_image.grab(button_images, iRect(30,0, 15, 15) );
-    bShowWindow = createTitlebarButton( 15, 0, show_button_image, new RetoreChatAction(this));
-    bShowWindow-&gt;disable();
+//    Surface show_button_image;
+//    show_button_image.grab(button_images, iRect(30,0, 15, 15) );
+//    bShowWindow = createTitlebarButton( 15, 0, show_button_image, new RetoreChatAction(this));
+//    bShowWindow-&gt;disable();
     add(bShowWindow);
     
     HideWindow = false;

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000461.html">[Netpanzer-cvs] r1442 - in trunk/netpanzer: pics/flags	projects/netpanzer-svn-windows/nbproject	projects/netpanzer-svn-windows/nbproject/private src/Lib/2D	src/NetPanzer/Classes/Network src/NetPanzer/Interfaces	src/NetPanzer/Resources src/NetPanzer/Views/Components	src/NetPanzer/Views/Game
</A></li>
	<LI>Next message: <A HREF="000463.html">[Netpanzer-cvs] r1444 - trunk/netpanzer/src/NetPanzer/Resources
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#462">[ date ]</a>
              <a href="thread.html#462">[ thread ]</a>
              <a href="subject.html#462">[ subject ]</a>
              <a href="author.html#462">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">More information about the Netpanzer-cvs
mailing list</a><br>
</body></html>
