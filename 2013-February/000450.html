<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Netpanzer-cvs] r1427 - in trunk/netpanzer: . pics pics/backgrounds	pics/buttons src/Lib/2D src/Lib/Types src/Lib/Util	src/NetPanzer src/NetPanzer/Actions src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Core	src/NetPanzer/Interfaces src/NetPanzer/Particles	src/NetPanzer/Scenes src/NetPanzer/System src/NetPanzer/Units	src/NetPanzer/Views src/NetPanzer/Views/Components	src/NetPanzer/Views/Game src/NetPanzer/Views/MainMenu	src/NetPanzer/Views/MainMenu/Multi
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/netpanzer-cvs/2013-February/index.html" >
   <LINK REL="made" HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1427%20-%20in%20trunk/netpanzer%3A%20.%20pics%20pics/backgrounds%0A%09pics/buttons%20src/Lib/2D%20src/Lib/Types%20src/Lib/Util%0A%09src/NetPanzer%20src/NetPanzer/Actions%20src/NetPanzer/Classes%0A%09src/NetPanzer/Classes/Network%20src/NetPanzer/Core%0A%09src/NetPanzer/Interfaces%20src/NetPanzer/Particles%0A%09src/NetPanzer/Scenes%20src/NetPanzer/System%20src/NetPanzer/Units%0A%09src/NetPanzer/Views%20src/NetPanzer/Views/Components%0A%09src/NetPanzer/Views/Game%20src/NetPanzer/Views/MainMenu%0A%09src/NetPanzer/Views/MainMenu/Multi&In-Reply-To=%3C20130219111136.DD8A655B0C%40scm.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000449.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Netpanzer-cvs] r1427 - in trunk/netpanzer: . pics pics/backgrounds	pics/buttons src/Lib/2D src/Lib/Types src/Lib/Util	src/NetPanzer src/NetPanzer/Actions src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Core	src/NetPanzer/Interfaces src/NetPanzer/Particles	src/NetPanzer/Scenes src/NetPanzer/System src/NetPanzer/Units	src/NetPanzer/Views src/NetPanzer/Views/Components	src/NetPanzer/Views/Game src/NetPanzer/Views/MainMenu	src/NetPanzer/Views/MainMenu/Multi</H1>
    <B>kromxp at scm.berlios.de</B> 
    <A HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1427%20-%20in%20trunk/netpanzer%3A%20.%20pics%20pics/backgrounds%0A%09pics/buttons%20src/Lib/2D%20src/Lib/Types%20src/Lib/Util%0A%09src/NetPanzer%20src/NetPanzer/Actions%20src/NetPanzer/Classes%0A%09src/NetPanzer/Classes/Network%20src/NetPanzer/Core%0A%09src/NetPanzer/Interfaces%20src/NetPanzer/Particles%0A%09src/NetPanzer/Scenes%20src/NetPanzer/System%20src/NetPanzer/Units%0A%09src/NetPanzer/Views%20src/NetPanzer/Views/Components%0A%09src/NetPanzer/Views/Game%20src/NetPanzer/Views/MainMenu%0A%09src/NetPanzer/Views/MainMenu/Multi&In-Reply-To=%3C20130219111136.DD8A655B0C%40scm.berlios.de%3E"
       TITLE="[Netpanzer-cvs] r1427 - in trunk/netpanzer: . pics pics/backgrounds	pics/buttons src/Lib/2D src/Lib/Types src/Lib/Util	src/NetPanzer src/NetPanzer/Actions src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Core	src/NetPanzer/Interfaces src/NetPanzer/Particles	src/NetPanzer/Scenes src/NetPanzer/System src/NetPanzer/Units	src/NetPanzer/Views src/NetPanzer/Views/Components	src/NetPanzer/Views/Game src/NetPanzer/Views/MainMenu	src/NetPanzer/Views/MainMenu/Multi">kromxp at scm.berlios.de
       </A><BR>
    <I>Tue Feb 19 12:11:36 CET 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000449.html">[Netpanzer-cvs] r1426 - trunk/netpanzer/pics/backgrounds
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#450">[ date ]</a>
              <a href="thread.html#450">[ thread ]</a>
              <a href="subject.html#450">[ subject ]</a>
              <a href="author.html#450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: kromxp
Date: 2013-02-19 12:11:34 +0100 (Tue, 19 Feb 2013)
New Revision: 1427

Added:
   trunk/netpanzer/pics/backgrounds/canon.bmp
   trunk/netpanzer/pics/backgrounds/defaultMB.bmp
   trunk/netpanzer/pics/backgrounds/vs.bmp
   trunk/netpanzer/pics/buttons/
   trunk/netpanzer/pics/buttons/b-black.bmp
   trunk/netpanzer/pics/buttons/page.bmp
   trunk/netpanzer/pics/buttons/scrollbutton.bmp
   trunk/netpanzer/src/Lib/2D/Layer.hpp
   trunk/netpanzer/src/Lib/2D/Scene.cpp
   trunk/netpanzer/src/Lib/2D/Scene.hpp
   trunk/netpanzer/src/Lib/2D/SceneManager.cpp
   trunk/netpanzer/src/Lib/2D/SceneManager.hpp
   trunk/netpanzer/src/NetPanzer/Core/main_ded.cpp
   trunk/netpanzer/src/NetPanzer/Scenes/
   trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.cpp
   trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.hpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp
   trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/ListBox.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/ListBox.hpp
Removed:
   trunk/netpanzer/src/Lib/Types/iRect.cpp
   trunk/netpanzer/src/Lib/Types/iXY.cpp
   trunk/netpanzer/src/NetPanzer/Actions/HideViewAction.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.hpp
   trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.hpp
   trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.hpp
   trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/RMouseHackView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/RMouseHackView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/SpecialButtonView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/SpecialButtonView.hpp
Modified:
   trunk/netpanzer/
   trunk/netpanzer/src/Lib/2D/Surface.cpp
   trunk/netpanzer/src/Lib/Types/iXY.hpp
   trunk/netpanzer/src/Lib/Util/FileSystem.cpp
   trunk/netpanzer/src/Lib/Util/FileSystem.hpp
   trunk/netpanzer/src/NetPanzer/Actions/ActionManagerGUIActions.cpp
   trunk/netpanzer/src/NetPanzer/Actions/ChatPageDownAction.hpp
   trunk/netpanzer/src/NetPanzer/Actions/ChatPageUpAction.hpp
   trunk/netpanzer/src/NetPanzer/Actions/DisconnectAction.hpp
   trunk/netpanzer/src/NetPanzer/Actions/QuitAction.hpp
   trunk/netpanzer/src/NetPanzer/Actions/StartSurrenderVoteAction.hpp
   trunk/netpanzer/src/NetPanzer/Classes/MapFile.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.cpp
   trunk/netpanzer/src/NetPanzer/Classes/WorldInputCmdProcessor.cpp
   trunk/netpanzer/src/NetPanzer/Core/main.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.hpp
   trunk/netpanzer/src/NetPanzer/Interfaces/ChatInterface.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/KeyboardInterface.hpp
   trunk/netpanzer/src/NetPanzer/Interfaces/MouseInterface.hpp
   trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/TeamManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/VoteManager.cpp
   trunk/netpanzer/src/NetPanzer/Particles/ParticleInterface.cpp
   trunk/netpanzer/src/NetPanzer/Particles/ParticleTweakView.cpp
   trunk/netpanzer/src/NetPanzer/System/SDLVideo.cpp
   trunk/netpanzer/src/NetPanzer/Units/UnitBase.hpp
   trunk/netpanzer/src/NetPanzer/Units/Vehicle.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/BoxedLabel.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Button.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Button.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/CheckBox.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/CheckBox.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Choice.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Choice.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Component.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Component.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/InputField.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/InputField.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Label.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Label.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/MiniMap.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/MiniMap.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Separator.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/View.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/View.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/tChatBox.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/tHScrollBar.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/tHScrollBar.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/tPlayerStateBox.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/tPlayerStateBox.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/tStringListBox.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/tStringListBox.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/tVScrollBar.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/tVScrollBar.hpp
   trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.hpp
   trunk/netpanzer/src/NetPanzer/Views/Game/EndRoundView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/GFlagSelectionView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/GameTemplateView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/GameView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/HelpScrollView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/HelpScrollView.hpp
   trunk/netpanzer/src/NetPanzer/Views/Game/LibView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/VehicleSelectionView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/VoteBox.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/MainMenuView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/MainMenuView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/ServerListView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.hpp
   trunk/netpanzer/src/NetPanzer/Views/Theme.hpp
Log:
Switching computers.

This version might not even compile!!!!


Property changes on: trunk/netpanzer
___________________________________________________________________
Modified: svn:ignore
   - LICENSE.mikmod.txt
LICENSE.smpeg.txt
SDL.dll
smpeg.dll
.sconsign.dblite
LICENSE.ogg-vorbis.txt
libvorbisfile-3.dll
libFLAC-8.dll
libvorbis-0.dll
build
SDL_mixer.dll
netpanzer-debug.exe
netpanzer
libmikmod-2.dll
.dep.inc
Makefile
stderr.txt
nb-netpanzer-debug-svn
releases
LICENSE.FLAC.txt
nb-netpanzer-debug
libogg-0.dll
stdout.txt
RELEASE_VERSION
nbproject

   + LICENSE.mikmod.txt
LICENSE.smpeg.txt
SDL.dll
smpeg.dll
.sconsign.dblite
LICENSE.ogg-vorbis.txt
libvorbisfile-3.dll
libFLAC-8.dll
libvorbis-0.dll
build
SDL_mixer.dll
netpanzer-debug.exe
netpanzer
libmikmod-2.dll
.dep.inc
Makefile
stderr.txt
nb-netpanzer-debug-svn
releases
LICENSE.FLAC.txt
nb-netpanzer-debug
libogg-0.dll
stdout.txt
RELEASE_VERSION
nbproject
netpanzer-debug
dist
netpanzer-ded-debug


Copied: trunk/netpanzer/pics/backgrounds/canon.bmp (from rev 1425, trunk/netpanzer/pics/backgrounds/menus/menu/canon.bmp)
===================================================================
(Binary files differ)

Copied: trunk/netpanzer/pics/backgrounds/defaultMB.bmp (from rev 1425, trunk/netpanzer/pics/backgrounds/menus/menu/defaultMB.bmp)
===================================================================
(Binary files differ)

Copied: trunk/netpanzer/pics/backgrounds/vs.bmp (from rev 1425, trunk/netpanzer/pics/backgrounds/menus/menu/vs.bmp)
===================================================================
(Binary files differ)

Copied: trunk/netpanzer/pics/buttons/b-black.bmp (from rev 1425, trunk/netpanzer/pics/backgrounds/menus/buttons/default/b-black.bmp)
===================================================================
(Binary files differ)

Copied: trunk/netpanzer/pics/buttons/page.bmp (from rev 1425, trunk/netpanzer/pics/backgrounds/menus/buttons/default/page.bmp)
===================================================================
(Binary files differ)

Copied: trunk/netpanzer/pics/buttons/scrollbutton.bmp (from rev 1425, trunk/netpanzer/pics/backgrounds/menus/buttons/default/scrollbutton.bmp)
===================================================================
(Binary files differ)

Added: trunk/netpanzer/src/Lib/2D/Layer.hpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/Layer.hpp	                        (rev 0)
+++ trunk/netpanzer/src/Lib/2D/Layer.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,26 @@
+/* 
+ * File:   Layer.hpp
+ * Author: krom
+ *
+ * Created on February 14, 2013, 11:35 PM
+ */
+
+#ifndef LAYER_HPP
+#define	LAYER_HPP
+
+class Layer
+{
+private:
+    friend class Scene;
+    Layer * next;
+    int z_index;
+    
+public:
+    Layer(const int z_index) : z_index(z_index) {}
+    virtual ~Layer() {}
+    
+    virtual void draw() = 0; // would like const
+    
+};
+
+#endif	/* LAYER_HPP */

Added: trunk/netpanzer/src/Lib/2D/Scene.cpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/Scene.cpp	                        (rev 0)
+++ trunk/netpanzer/src/Lib/2D/Scene.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,67 @@
+
+#include &quot;Scene.hpp&quot;
+#include &quot;Layer.hpp&quot;
+#include &quot;Interfaces/MouseInterface.hpp&quot;
+
+bool Scene::addLayer(Layer* layer)
+{
+    if ( ! layers )
+    {
+        layer-&gt;next = 0;
+        layers = layer;
+        return true;
+    }
+    
+    const int wanted_z = layer-&gt;z_index;
+    
+    if ( wanted_z &lt; layers-&gt;z_index )
+    {
+        layer-&gt;next = layers;
+        layers = layer;
+        return true;
+    }
+    
+    Layer * lay = layers;
+    
+    while ( lay-&gt;next &amp;&amp; (lay-&gt;next-&gt;z_index &lt; wanted_z) )
+    {
+        lay = lay-&gt;next;
+    }
+    
+    layer-&gt;next = lay-&gt;next;
+    lay-&gt;next = layer;
+    return true;
+}
+
+void Scene::draw() const
+{
+    Layer * lay = layers;
+    while ( lay )
+    {
+        lay-&gt;draw();
+        lay = lay-&gt;next;
+    }
+}
+
+void Scene::input()
+{
+    handleMouseLocation(MouseInterface::getMouseX(), MouseInterface::getMouseY());
+    
+    while( !MouseInterface::event_queue.empty() )
+    {
+        MouseEvent event = MouseInterface::event_queue.front();
+        MouseInterface::event_queue.pop_front();
+
+        switch ( event.event )
+        {
+            case MouseEvent::EVENT_DOWN:
+                handleMouseDown(event.pos.x, event.pos.y, event.button);
+                break;
+                
+            case MouseEvent::EVENT_UP:
+                handleMouseUp(event.pos.x, event.pos.y, event.button);
+                break;
+                
+        }
+    }
+}

Added: trunk/netpanzer/src/Lib/2D/Scene.hpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/Scene.hpp	                        (rev 0)
+++ trunk/netpanzer/src/Lib/2D/Scene.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,39 @@
+/* 
+ * File:   Scene.hpp
+ * Author: krom
+ *
+ * Created on February 15, 2013, 12:55 AM
+ */
+
+#ifndef SCENE_HPP
+#define	SCENE_HPP
+
+class Layer;
+
+class Scene
+{
+private:
+    Layer * layers;
+    
+protected:
+    bool addLayer(Layer * layer);
+    
+    virtual void handleMouseLocation(int x, int y) {}
+    virtual void handleMouseDown(int x, int y, int button) {}
+    virtual void handleMouseUp(int x, int y, int button) {}
+    
+public:
+    Scene() : layers(0) {}
+    virtual ~Scene() {}
+    
+    void draw() const;
+    
+    void input();
+    
+    virtual void logic() = 0;
+    
+};
+
+
+#endif	/* SCENE_HPP */
+

Added: trunk/netpanzer/src/Lib/2D/SceneManager.cpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/SceneManager.cpp	                        (rev 0)
+++ trunk/netpanzer/src/Lib/2D/SceneManager.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,68 @@
+
+#include &quot;SceneManager.hpp&quot;
+#include &quot;Scene.hpp&quot;
+
+
+
+#include &quot;System/SDLEvents.hpp&quot;
+#include &quot;SDL.h&quot;
+
+#define TIMEINTERVAL (20)
+static void loopSleep()
+{
+    static Uint32 nextTime = 0;
+
+    Uint32 now = SDL_GetTicks();
+    if (now &lt; nextTime)
+    {
+        SDL_Delay(nextTime - now);
+    }
+    nextTime += TIMEINTERVAL;
+}
+
+#include &quot;Classes/ScreenSurface.hpp&quot;
+#include &quot;Interfaces/MouseInterface.hpp&quot;
+
+static Scene * current_scene = 0;
+static bool shall_run = false;
+
+bool SceneManager::init(Scene* first_scene)
+{
+    current_scene = first_scene;
+    
+    shall_run = current_scene != 0;
+    
+    return shall_run;
+}
+
+bool SceneManager::run()
+{
+    handleSDLEvents();
+    
+    screen-&gt;lock();
+    
+    current_scene-&gt;draw();
+    
+    MouseInterface::draw(*screen);
+    
+    screen-&gt;unlock();
+    screen-&gt;copyToVideoFlip();
+    
+    current_scene-&gt;input();
+    
+    current_scene-&gt;logic();
+    
+    loopSleep();
+        
+    return shall_run;
+}
+
+void SceneManager::endLoop()
+{
+    shall_run = false;
+}
+
+void SceneManager::setNextScene(Scene* next_scene)
+{
+    current_scene = next_scene;
+}

Added: trunk/netpanzer/src/Lib/2D/SceneManager.hpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/SceneManager.hpp	                        (rev 0)
+++ trunk/netpanzer/src/Lib/2D/SceneManager.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,27 @@
+/* 
+ * File:   SceneManager.hpp
+ * Author: krom
+ *
+ * Created on February 15, 2013, 10:40 AM
+ */
+
+#ifndef SCENEMANAGER_HPP
+#define	SCENEMANAGER_HPP
+
+class Scene;
+
+class SceneManager
+{
+public:
+    static bool init( Scene * first_scene );
+    
+    static bool run();
+    
+    static void endLoop();
+    
+    static void setNextScene( Scene * next_scene );
+};
+
+
+#endif	/* SCENEMANAGER_HPP */
+

Modified: trunk/netpanzer/src/Lib/2D/Surface.cpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/Surface.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/Lib/2D/Surface.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1251,24 +1251,24 @@
   x = 0;
   y = radius;
 
-//  while (y &gt;= x) {
-//    putPixel(cx + x, cy + y, color);// down right corner
-//    putPixel(cx + y, cy + x, color);// down right corner
-//    putPixel(cx - x, cy + y, color);// up left corner
-//    putPixel(cx - y, cy + x, color);// up left corner
-//    putPixel(cx + x, cy - y, color);// up right corner
-//    putPixel(cx + y, cy - x, color);// up right corner
-//    putPixel(cx - x, cy - y, color);// down left corner
-//    putPixel(cx - y, cy - x, color);// down left corner
-//
-//    if (d &lt; 0)
-//      d = d + (4 * x) + 6;
-//    else {
-//      d = d + 4 * (x - y) + 10;
-//      y--;
-//    }
-//    x++;
-//  }
+  while (y &gt;= x) {
+    putPixel(cx + x, cy + y, color);// down right corner
+    putPixel(cx + y, cy + x, color);// down right corner
+    putPixel(cx - x, cy + y, color);// up left corner
+    putPixel(cx - y, cy + x, color);// up left corner
+    putPixel(cx + x, cy - y, color);// up right corner
+    putPixel(cx + y, cy - x, color);// up right corner
+    putPixel(cx - x, cy - y, color);// down left corner
+    putPixel(cx - y, cy - x, color);// down left corner
+
+    if (d &lt; 0)
+      d = d + (4 * x) + 6;
+    else {
+      d = d + 4 * (x - y) + 10;
+      y--;
+    }
+    x++;
+  }
 }
 
 void Surface::FillCircle(int cx, int cy, int radius, PIX color)
@@ -1279,20 +1279,20 @@
   x = 0;
   y = radius;
 
-//  while (y &gt;= x) {
-//    drawHLine(cx - x, cy - y, x , color);
-//    drawHLine(cx - x, cy + y, x, color);
-//    drawHLine(cx - y, cy - x, y, color);
-//    drawHLine(cx - y, cy + x, y, color);
-//
-//    if (d &lt; 0)
-//      d = d + (4 * x) + 6;
-//    else {
-//      d = d + 4 * (x - y) + 10;
-//      y--;
-//    }
-//    x++;
-//  }
+  while (y &gt;= x) {
+    drawHLine(cx - x, cy - y, x , color);
+    drawHLine(cx - x, cy + y, x, color);
+    drawHLine(cx - y, cy - x, y, color);
+    drawHLine(cx - y, cy + x, y, color);
+
+    if (d &lt; 0)
+      d = d + (4 * x) + 6;
+    else {
+      d = d + 4 * (x - y) + 10;
+      y--;
+    }
+    x++;
+  }
 }
 
 void Surface::BltCircle(int cx, int cy, int radius, const PIX table[])

Deleted: trunk/netpanzer/src/Lib/Types/iRect.cpp
===================================================================
--- trunk/netpanzer/src/Lib/Types/iRect.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/Lib/Types/iRect.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,17 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/

Deleted: trunk/netpanzer/src/Lib/Types/iXY.cpp
===================================================================
--- trunk/netpanzer/src/Lib/Types/iXY.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/Lib/Types/iXY.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,26 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &lt;math.h&gt;
-#include &quot;iXY.hpp&quot;
-
-double iXY::mag() const
-{
-    return sqrt(x * x + y * y);
-}

Modified: trunk/netpanzer/src/Lib/Types/iXY.hpp
===================================================================
--- trunk/netpanzer/src/Lib/Types/iXY.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/Lib/Types/iXY.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -108,34 +108,12 @@
     {
         x = y = 0;
     }
-
-    bool isZero() const
-    {
-        return x==0 &amp;&amp; y==0;
-    }
-
-    double mag() const;
+    
     float  mag2() const
     {
         return float(x * x + y * y);
     }
 
-    int getArea() const
-    {
-        return x * y;
-    }
 };
 
-//---------------------------------------------------------------------------
-static inline double distance(const iXY &amp;a, const iXY &amp;b)
-{
-    return (a - b).mag();
-}
-
-//---------------------------------------------------------------------------
-static inline float distance2(const iXY &amp;a, const iXY &amp;b)
-{
-    return (a - b).mag2();
-}
-
 #endif // __iXY_hpp__

Modified: trunk/netpanzer/src/Lib/Util/FileSystem.cpp
===================================================================
--- trunk/netpanzer/src/Lib/Util/FileSystem.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/Lib/Util/FileSystem.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -24,45 +24,46 @@
 #include &quot;FileSystem.hpp&quot;
 #include &quot;physfs/physfs.h&quot;
 
+#include &quot;Core/CoreTypes.hpp&quot;
+
 namespace filesystem
 {
 
-void initialize(const char* argv0, const char* ,
-                            const char* application)
+bool initialize( const char* argv0, const char* application )
 {
-    if(!PHYSFS_init(argv0))
+    if( !PHYSFS_init(argv0) )
         throw Exception(&quot;failure while initialising physfs: %s&quot;,
                         PHYSFS_getLastError());
 
     const char* basedir = PHYSFS_getBaseDir();
     const char* userdir = PHYSFS_getUserDir();
     const char* dirsep = PHYSFS_getDirSeparator();
-    char* writedir = new char[strlen(userdir) + strlen(application) + 2];
+    
+    NPString appdir(&quot;.&quot;);
+    appdir += application;
 
-    sprintf(writedir, &quot;%s.%s&quot;, userdir, application);
-    if(!PHYSFS_setWriteDir(writedir)) {
+    NPString writedir(userdir);
+    writedir += appdir;
+    
+    if ( ! PHYSFS_setWriteDir(writedir.c_str()) )
+    {
         // try to create the directory...
-        char* mkdir = new char[strlen(application)+2];
-        sprintf(mkdir, &quot;.%s&quot;, application);
-        if(!PHYSFS_setWriteDir(userdir) || ! PHYSFS_mkdir(mkdir)) {
-            delete[] writedir;
-            delete[] mkdir;
+        if ( ! PHYSFS_setWriteDir(userdir) || ! PHYSFS_mkdir(appdir.c_str()) )
+        {
             throw Exception(&quot;failed creating configuration directory: '%s': %s&quot;,
-                            writedir, PHYSFS_getLastError());
+                            writedir.c_str(), PHYSFS_getLastError());
         }
-        delete[] mkdir;
 
-        if (!PHYSFS_setWriteDir(writedir)) {
+        if ( ! PHYSFS_setWriteDir(writedir.c_str()) )
+        {
             throw Exception(&quot;couldn't set configuration directory to '%s': %s&quot;,
-                            writedir, PHYSFS_getLastError());
+                            writedir.c_str(), PHYSFS_getLastError());
         }
     }
 
-    PHYSFS_addToSearchPath(writedir, 0);
+    PHYSFS_addToSearchPath(writedir.c_str(), 0);
     PHYSFS_addToSearchPath(basedir, 1);
 
-
-
     /* Root out archives, and add them to search path... */
     const char* archiveExt = &quot;zip&quot;;
     if (archiveExt != NULL) {
@@ -89,10 +90,25 @@
         PHYSFS_freeList(rc);
     } /* if */
 
+#ifdef NP_DATADIR
+    try {
+	filesystem::addToSearchPath(NP_DATADIR);
+    } catch(...)
+    { }
+#endif
 
-    PHYSFS_removeFromSearchPath(writedir);
-    PHYSFS_addToSearchPath(writedir, 0);
-    delete[] writedir;
+#ifdef __APPLE__
+    // Mac OS X puts the data files into NetPanzer.app/Contents/Resources
+    try {
+      std::ostringstream dir;
+      dir &lt;&lt; PHYSFS_getBaseDir() &lt;&lt; &quot;/NetPanzer.app/Contents/Resources/&quot;;
+      filesystem::addToSearchPath(dir.str().c_str());
+    } catch(...)
+    { }
+#endif
+    
+    PHYSFS_removeFromSearchPath(writedir.c_str());
+    PHYSFS_addToSearchPath(writedir.c_str(), 0);
 }
 
 void shutdown()

Modified: trunk/netpanzer/src/Lib/Util/FileSystem.hpp
===================================================================
--- trunk/netpanzer/src/Lib/Util/FileSystem.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/Lib/Util/FileSystem.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -149,8 +149,7 @@
  * documentation for details about the functions here. Most function names are
  * exactly the same as in physfs
  */
-void initialize(const char* argv0, const char* company,
-        const char* applicationname);
+bool initialize( const char* argv0, const char* applicationname );
 void shutdown();
 
 void addToSearchPath(const char* dir, bool append = true);

Modified: trunk/netpanzer/src/NetPanzer/Actions/ActionManagerGUIActions.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Actions/ActionManagerGUIActions.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Actions/ActionManagerGUIActions.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -20,7 +20,6 @@
 #include &quot;ActionManager.hpp&quot;
 
 #include &quot;Interfaces/GameConfig.hpp&quot;
-#include &quot;HideViewAction.hpp&quot;
 #include &quot;DisconnectAction.hpp&quot;
 #include &quot;ChatPageUpAction.hpp&quot;
 #include &quot;ChatPageDownAction.hpp&quot;
@@ -38,10 +37,7 @@
         addAction(&quot;disconnect&quot;, new DisconnectAction());
         addAction(&quot;loaderror&quot;,  getAction(&quot;disconnect&quot;));
     }
-    
-    addAction(&quot;hide_confirmexit&quot;, new HideViewAction(&quot;AreYouSureExitView&quot;));
-    addAction(&quot;hide_confirmdisconnect&quot;, new HideViewAction(&quot;AreYouSureResignView&quot;));
-    
+        
     addAction(&quot;chat_pgup&quot;, new ChatPageUpAction());
     addAction(&quot;chat_pgdown&quot;, new ChatPageDownAction());
     

Modified: trunk/netpanzer/src/NetPanzer/Actions/ChatPageDownAction.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Actions/ChatPageDownAction.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Actions/ChatPageDownAction.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -23,7 +23,6 @@
 
 #include &quot;Action.hpp&quot;
 #include &quot;Views/Game/ChatView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/tChatBox.hpp&quot;
 #include &quot;Views/Components/tVScrollBar.hpp&quot;
 
@@ -35,7 +34,7 @@
     ChatPageDownAction() : Action(true) {}
     void execute()
     {
-        ChatView *v = (ChatView*)Desktop::getView(&quot;ChatView&quot;);
+        ChatView *v = 0; // (ChatView*)Desktop::getView(&quot;ChatView&quot;);
         if ( v )
         {
             tChatBox * cbox = v-&gt;getChatBox();

Modified: trunk/netpanzer/src/NetPanzer/Actions/ChatPageUpAction.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Actions/ChatPageUpAction.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Actions/ChatPageUpAction.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -23,7 +23,6 @@
 
 #include &quot;Action.hpp&quot;
 #include &quot;Views/Game/ChatView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/tChatBox.hpp&quot;
 #include &quot;Views/Components/tVScrollBar.hpp&quot;
 
@@ -35,7 +34,7 @@
     ChatPageUpAction() : Action(true) {}
     void execute()
     {
-        ChatView *v = (ChatView*)Desktop::getView(&quot;ChatView&quot;);
+        ChatView *v = 0; //(ChatView*)Desktop::getView(&quot;ChatView&quot;);
         if ( v )
         {
             tChatBox * cbox = v-&gt;getChatBox();

Modified: trunk/netpanzer/src/NetPanzer/Actions/DisconnectAction.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Actions/DisconnectAction.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Actions/DisconnectAction.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -23,9 +23,6 @@
 
 #include &quot;Action.hpp&quot;
 
-#include &quot;Views/Components/Desktop.hpp&quot;
-#include &quot;Views/MainMenu/MenuTemplateView.hpp&quot;
-#include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
 #include &quot;Interfaces/GameManager.hpp&quot;
 #include &quot;Interfaces/StrManager.hpp&quot;
 #include &quot;2D/Color.hpp&quot;
@@ -39,33 +36,12 @@
     DisconnectAction() : Action(true) {}
     void execute()
     {
-        MenuTemplateView * menuview = (MenuTemplateView*)Desktop::getView(&quot;MenuTemplateView&quot;);
-        OptionsTemplateView * optionsview  = (OptionsTemplateView*)Desktop::getView(&quot;OptionsView&quot;);
         
         GameManager::drawTextCenteredOnScreen(_(&quot;Loading Main View...&quot;), Color::white);
 
         GameManager::quitNetPanzerGame();
 
         GameManager::drawTextCenteredOnScreen(_(&quot;Loading Main View...&quot;), Color::white);
-
-        Desktop::setVisibilityAllWindows(false);
-
-        if ( menuview )
-        {
-            menuview-&gt;init();
-            menuview-&gt;setAlwaysOnBottom(true);
-            Desktop::remove(menuview);
-            Desktop::add(menuview, false);
-        }
-
-        Desktop::setVisibility(&quot;MenuTemplateView&quot;, true);
-        Desktop::setVisibility(&quot;MainView&quot;, true);
-
-        if ( optionsview )
-        {
-            optionsview-&gt;initButtons();
-            optionsview-&gt;setAlwaysOnBottom(true);
-        }
     }
 };
 

Deleted: trunk/netpanzer/src/NetPanzer/Actions/HideViewAction.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Actions/HideViewAction.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Actions/HideViewAction.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,40 +0,0 @@
-/*
-Copyright (C) 2012 Netpanzer Team. (www.netpanzer.org), Aaron Perez
-
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
-
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
-
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- * Created on September 4, 2012, 9:08 PM
- */
-
-#ifndef HIDEVIEWACTION_HPP
-#define	HIDEVIEWACTION_HPP
-
-#include &quot;Action.hpp&quot;
-
-#include &quot;Views/Components/Desktop.hpp&quot;
-
-class HideViewAction : public Action
-{
-public:
-    NPString name;
-    HideViewAction(const NPString&amp; name) : Action(true), name(name) {}
-    void execute()
-    {
-        Desktop::setVisibility(name.c_str(), false);
-    }
-};
-
-#endif	/* HIDEVIEWACTION_HPP */
-

Modified: trunk/netpanzer/src/NetPanzer/Actions/QuitAction.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Actions/QuitAction.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Actions/QuitAction.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -25,6 +25,8 @@
 #include &quot;Interfaces/GameManager.hpp&quot;
 #include &quot;Interfaces/BaseGameManager.hpp&quot;
 
+#include &quot;2D/SceneManager.hpp&quot;
+
 class QuitAction : public Action
 {
 public:
@@ -34,8 +36,10 @@
     {
 //        Desktop::setVisibilityAllWindows(false);
         
-        GameManager::quitNetPanzerGame();
-        gamemanager-&gt;stopMainLoop();
+        SceneManager::endLoop();
+        
+//        GameManager::quitNetPanzerGame();
+//        gamemanager-&gt;stopMainLoop();
     }
 };
 

Modified: trunk/netpanzer/src/NetPanzer/Actions/StartSurrenderVoteAction.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Actions/StartSurrenderVoteAction.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Actions/StartSurrenderVoteAction.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -24,7 +24,6 @@
 #include &quot;Action.hpp&quot;
 #include &quot;Network/PlayerRequests/StartSurrenderVoteRequest.hpp&quot;
 #include &quot;Classes/Network/NetworkClient.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 
 class StartSurrenderVoteAction : public Action
 {
@@ -33,11 +32,8 @@
     
     void execute()
     {
-        if ( !Desktop::getVisible(&quot;PrepareTeam&quot;) &amp;&amp; !Desktop::getVisible(&quot;GFlagSelectionView&quot;) )
-        {
-            StartSurrenderVoteRequest req;
-            CLIENT-&gt;sendMessage(&amp;req, sizeof(req));
-        }
+        StartSurrenderVoteRequest req;
+        CLIENT-&gt;sendMessage(&amp;req, sizeof(req));
     }
 };
 

Modified: trunk/netpanzer/src/NetPanzer/Classes/MapFile.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/MapFile.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Classes/MapFile.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -17,69 +17,70 @@
 */
 #ifndef _MAPFILE_HPP
 #define _MAPFILE_HPP
-
-#include &quot;Core/CoreTypes.hpp&quot;
-
+
+#include &quot;Core/CoreTypes.hpp&quot;
+#include &quot;2D/Surface.hpp&quot;
+
 class Surface;
 
-class MapFile
+class MapFile
 {
-public:
-    typedef uint16_t ElementType;
+public:
+    typedef uint16_t ElementType;
     enum { InvalidElement = 0xffff };
-
-    ~MapFile()
-    {
-        if ( data )
-        {
-            delete[] data;
-            data = 0;
-        }
-        
-        if ( thumbnail )
-        {
-            delete thumbnail;
-            thumbnail = 0;
-        }
-    }
-
-    inline bool hasData()       const { return data != 0; }
-    inline bool hasThumbnail()  const { return thumbnail != 0; }
-    
-    inline uint16_t getWidth()  const { return width; }
-    inline uint16_t getHeight() const { return height; }
-    
-    inline ElementType getValue( size_t offset ) const
-    {
-        return ( offset &lt; data_length ) ? data[offset] : InvalidElement;
-    }
-    
-    inline ElementType getValue( size_t x, size_t y ) const
-    {
-        return getValue( (y * getWidth()) + x );
-    }
-    
-    inline unsigned getOutpostCount() const { return outpost_count; }
-    
-    NPString filename;
-    NPString fullfilename;
+
+    ~MapFile()
+    {
+        if ( data )
+        {
+            delete[] data;
+            data = 0;
+        }
+        
+        if ( thumbnail )
+        {
+            delete thumbnail;
+            thumbnail = 0;
+        }
+    }
+
+    inline bool hasData()       const { return data != 0; }
+    inline bool hasThumbnail()  const { return thumbnail != 0; }
     
+    inline uint16_t getWidth()  const { return width; }
+    inline uint16_t getHeight() const { return height; }
+    
+    inline ElementType getValue( size_t offset ) const
+    {
+        return ( offset &lt; data_length ) ? data[offset] : InvalidElement;
+    }
+    
+    inline ElementType getValue( size_t x, size_t y ) const
+    {
+        return getValue( (y * getWidth()) + x );
+    }
+    
+    inline unsigned getOutpostCount() const { return outpost_count; }
+    
+    NPString filename;
+    NPString fullfilename;
+    
     char netp_id_header[64];
     uint16_t id;
     char name[256];
     char description[1024];
     uint16_t width;
     uint16_t height;
-    char tile_set[256];
-    
-    size_t data_length;
-    ElementType * data;
-    
+    char tile_set[256];
+    
+    size_t data_length;
+    ElementType * data;
+    
     Surface * thumbnail;
 
     uint16_t thumbnail_width;
-    uint16_t thumbnail_height;
-    
+    uint16_t thumbnail_height;
+    
     unsigned outpost_count;
 };
 

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -32,9 +32,7 @@
 
 #include &quot;Interfaces/ConsoleInterface.hpp&quot;
 
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Game/LoadingView.hpp&quot;
-#include &quot;Views/Game/DisconectedView.hpp&quot;
 
 NetworkClient *CLIENT = 0;
 
@@ -67,18 +65,7 @@
 void
 NetworkClient::onClientDisconected(ClientSocket *s, const char *msg)
 {
-    (void)s;
-    if ( ! Desktop::getVisible(&quot;LoadingView&quot;) )
-    {
-        DisconectedView *dv = (DisconectedView *)Desktop::getView(&quot;DisconectedView&quot;);
-        dv-&gt;setMsg(msg);
-
-        Desktop::setVisibility(&quot;DisconectedView&quot;, true);
-    }
-    else
-    {
-        ClientConnectDaemon::serverConnectionBroken();
-    }
+    ClientConnectDaemon::serverConnectionBroken();
     
     delete clientsocket;
     clientsocket=0;

Modified: trunk/netpanzer/src/NetPanzer/Classes/WorldInputCmdProcessor.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/WorldInputCmdProcessor.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Classes/WorldInputCmdProcessor.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -49,7 +49,6 @@
 #include &quot;Interfaces/GameConfig.hpp&quot;
 
 #include &quot;Views/Game/VehicleSelectionView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 
 #include &quot;Classes/Network/NetworkState.hpp&quot;
 
@@ -328,21 +327,21 @@
 void
 WorldInputCmdProcessor::evaluateKeyCommands()
 {
-    if (KeyboardInterface::getKeyPressed(SDLK_b)
-       &amp;&amp; ! Desktop::getVisible(&quot;HelpScrollView&quot;) )
+    if (KeyboardInterface::getKeyPressed(SDLK_b) )
+//       &amp;&amp; ! Desktop::getVisible(&quot;HelpScrollView&quot;) )
     {
         if ( PlayerInterface::getLocalPlayer()-&gt;isSelectingFlag()
             || GameConfig::game_changeflagtime == 0
             || Flagtimer.checkWithTimeOut(GameConfig::game_changeflagtime * 60000)
            )
         {
-            Desktop::toggleVisibility( &quot;GFlagSelectionView&quot; );
+//            Desktop::toggleVisibility( &quot;GFlagSelectionView&quot; );
         }
     }
 
     if ( KeyboardInterface::getKeyPressed(SDLK_m) )
     {
-        Desktop::toggleVisibility( &quot;MiniMapView&quot; );
+//        Desktop::toggleVisibility( &quot;MiniMapView&quot; );
     }
 
     if ( KeyboardInterface::getKeyPressed(SDLK_o) )
@@ -380,37 +379,24 @@
         }
     }
 
-    if ( KeyboardInterface::getKeyPressed(SDLK_F1)
-       &amp;&amp; ! Desktop::getVisible(&quot;GFlagSelectionView&quot;) ) {
-        Desktop::toggleVisibility( &quot;HelpScrollView&quot; );
-    }
+//    if ( KeyboardInterface::getKeyPressed(SDLK_F1)
+//       &amp;&amp; ! Desktop::getVisible(&quot;GFlagSelectionView&quot;) ) {
+//        Desktop::toggleVisibility( &quot;HelpScrollView&quot; );
+//    }
 
     if (KeyboardInterface::getKeyPressed(SDLK_TAB) )
     {
-        if (GameConfig::game_teammode)
-            Desktop::toggleVisibility( &quot;RankTeam&quot; );
-        else
-            Desktop::toggleVisibility( &quot;RankView&quot; );
+//        if (GameConfig::game_teammode)
+//            Desktop::toggleVisibility( &quot;RankTeam&quot; );
+//        else
+//            Desktop::toggleVisibility( &quot;RankView&quot; );
     }
 
-    if (KeyboardInterface::getKeyPressed(SDLK_F3)) {
-        Desktop::toggleVisibility( &quot;DesktopView&quot; );
-    }
-
-    if (KeyboardInterface::getKeyPressed(SDLK_F4)) {
-        Desktop::toggleVisibility( &quot;CodeStatsView&quot; );
-    }
-
-    if (KeyboardInterface::getKeyPressed( SDLK_F5 )) {
-        //  DEBUG VIEW
-        Desktop::toggleVisibility( &quot;LibView&quot; );
-    }
-
     if ( (KeyboardInterface::getKeyPressed( SDLK_RETURN ) == true)
             &amp;&amp; (KeyboardInterface::getKeyState( SDLK_LALT ) == false)
             &amp;&amp; (KeyboardInterface::getKeyState( SDLK_RALT ) == false))
     {
-        ChatView *v = (ChatView*)Desktop::getView(&quot;ChatView&quot;);
+        ChatView *v = 0; // (ChatView*)Desktop::getView(&quot;ChatView&quot;);
         if ( v )
         {
             v-&gt;openChat();
@@ -420,7 +406,7 @@
     if ( (KeyboardInterface::getKeyState(SDLK_LCTRL) || KeyboardInterface::getKeyState(SDLK_RCTRL))
         &amp;&amp; (KeyboardInterface::getKeyPressed(SDLK_RETURN) ))
     {
-        ChatView *v = (ChatView*)Desktop::getView(&quot;ChatView&quot;);
+        ChatView *v = 0; //(ChatView*)Desktop::getView(&quot;ChatView&quot;);
         if ( v )
         {
             v-&gt;openFriendsChat();
@@ -1098,10 +1084,6 @@
 bool
 WorldInputCmdProcessor::isObjectiveSelected()
 {
-    if (Desktop::getVisible(&quot;VehicleSelectionView&quot;) == true) {
-        return true;
-    }
-
     return false;
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Core/main.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Core/main.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Core/main.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -35,37 +35,32 @@
 #include &lt;optionmm/command_line.hpp&gt;
 
 #include &quot;Util/Log.hpp&quot;
-//#include &quot;Util/Exception.hpp&quot;
 #include &quot;Util/FileSystem.hpp&quot;
 #include &quot;Network/NetworkManager.hpp&quot;
 
 #include &quot;Scripts/ScriptManager.hpp&quot;
 #include &quot;Interfaces/BaseGameManager.hpp&quot;
 #include &quot;Interfaces/GameConfig.hpp&quot;
-#include &quot;Interfaces/DedicatedGameManager.hpp&quot;
-#include &quot;Interfaces/BotGameManager.hpp&quot;
 #include &quot;Interfaces/PlayerGameManager.hpp&quot;
 #include &quot;Core/NetworkGlobals.hpp&quot;
 #include &quot;Scripts/ScriptManager.hpp&quot;
 #include &quot;2D/Palette.hpp&quot;
 #include &quot;Actions/ActionManager.hpp&quot;
 
+#include &quot;2D/SceneManager.hpp&quot;
+#include &quot;Scenes/InitialScene.hpp&quot;
+
+#include &quot;Resources/ResourceManager.hpp&quot;
+#include &quot;Interfaces/StrManager.hpp&quot;
+
 #ifndef PACKAGE_VERSION
 	#define PACKAGE_VERSION &quot;testing&quot;
 #endif
 
 //---------------------------------------------------------------------------
 
-static std::string pidfile;
-
 void shutdown()
 {
-#ifndef WIN32
-    if(pidfile != &quot;&quot;) {
-        unlink(pidfile.c_str());
-    }
-#endif
-    
     SDL_Quit();
     if(gameconfig)
         gameconfig-&gt;saveConfig();
@@ -130,10 +125,6 @@
     option&lt;std::string, true, false&gt; connect_option('c', &quot;connect&quot;,
             &quot;Connect to the specified netpanzer server&quot;, &quot;&quot;);
     commandline.add(&amp;connect_option);
-    bool_option dedicated_option('d', &quot;dedicated&quot;, &quot;Run as dedicated server&quot;, false);
-    commandline.add(&amp;dedicated_option);
-    option&lt;std::string, true, false&gt; bot_option('b', &quot;bot&quot;, &quot;Connect as bot to specific server&quot;, &quot;&quot;);
-    commandline.add(&amp;bot_option);
 
     bool_option need_password(0, &quot;password&quot;, &quot;Ask for password when connecting, only usefull on quick connect&quot;, false);
     commandline.add(&amp;need_password);
@@ -151,23 +142,21 @@
     option&lt;bool, false, false&gt; protocol_option('\0', &quot;protocol&quot;,
             &quot;Show version of network protocol&quot;, false);
     commandline.add(&amp;protocol_option);
-    option&lt;std::string, true, false&gt; pidfile_option(0, &quot;pidfile&quot;,
-            &quot;Create a pidfile at the specified location&quot;, &quot;&quot;);
-    commandline.add(&amp;pidfile_option);
+    
 
     if(!commandline.process() || commandline.help() || commandline.version())
         exit(0);
 
-    if(protocol_option.value()) {
+    if(protocol_option.value())
+    {
         std::cout &lt;&lt; (int) NETPANZER_PROTOCOL_VERSION &lt;&lt; std::endl;
         exit(0);
     }
 
-    if (debug_option.value()) {
+    if (debug_option.value())
+    {
         LOGGER.setLogLevel(Logger::LEVEL_DEBUG);
         LOGGER.debug(&quot;debug option enabled&quot;);
-    } else if (dedicated_option.value()) {
-        LOGGER.setLogLevel(Logger::LEVEL_INFO);
     }
 
     // Initialize SDL (we have to start the video subsystem as well so that
@@ -177,53 +166,31 @@
         fprintf(stderr, &quot;SDL_Init error: %s.\n&quot;, SDL_GetError());
         exit(1);
     }
+    
     SDL_EnableUNICODE(1);
 
     // Initialize libphysfs
     try {
-        filesystem::initialize(argv[0], &quot;netpanzer&quot;, &quot;netpanzer&quot;);
+        filesystem::initialize(argv[0], &quot;netpanzer&quot;);
     } catch(std::exception&amp; e) {
         fprintf(stderr, &quot;%s&quot;, e.what());
         shutdown();
         exit(1);
     }
 
-#ifdef NP_DATADIR
-    try {
-	filesystem::addToSearchPath(NP_DATADIR);
-    } catch(...)
-    { }
-#endif
+    LOGGER.openLogFile(&quot;netpanzer&quot;);
 
-#ifdef __APPLE__
-    // Mac OS X puts the data files into NetPanzer.app/Contents/Resources
-    try {
-      std::ostringstream dir;
-      dir &lt;&lt; PHYSFS_getBaseDir() &lt;&lt; &quot;/NetPanzer.app/Contents/Resources/&quot;;
-      filesystem::addToSearchPath(dir.str().c_str());
-    } catch(...)
-    { }
-#endif
-
-    if(dedicated_option.value())
-        LOGGER.openLogFile(&quot;server&quot;);
-    else if(bot_option.value().size() &gt; 0)
-        LOGGER.openLogFile(&quot;bot&quot;);
-    else
-        LOGGER.openLogFile(&quot;netpanzer&quot;);
-
 #ifdef WIN32
-    // SDL redirects stdout and stderr to 2 textfiles, better open a new console
-    // for the dedicated server and the bot
-    
-    //if(dedicated_option.value() || bot_option.value().size() &gt; 0) {
+// some times used for debug
+#if 0
         AllocConsole();
         freopen(&quot;CON&quot;, &quot;w&quot;, stdout);
         freopen(&quot;CON&quot;, &quot;w&quot;, stderr);
 //        freopen(&quot;CON&quot;, &quot;r&quot;, stdin);
-    //}
 #endif
 
+#endif
+
     // Initialize random number generator
     srand(time(0));
     // the STL functions in gcc3 seem to use the 48er versions of the random
@@ -232,49 +199,45 @@
 #ifdef __USE_SVID
     srand48(time(0));
 #endif
-
-    // create a pidfile
-    pidfile = pidfile_option.value();
-#ifndef WIN32
-    if(pidfile != &quot;&quot;) {
-        std::ofstream out(pidfile.c_str());
-        if(!out.good()) {
-            fprintf(stderr, &quot;Couldn't create pidfile '%s'.\n&quot;, pidfile.c_str());
-            shutdown();
-            exit(1);
-        }
-        out &lt;&lt; getpid() &lt;&lt; std::endl;
-        out.close();
-    }
-#else
-    if(pidfile != &quot;&quot;) {
-        fprintf(stderr, &quot;Pidfiles not supported on win32.\n&quot;);
-    }
-#endif
     
     ScriptManager::initialize();
     
-    BaseGameManager *manager;
+    PlayerGameManager *manager;
     // finally initialize the game objects
     try {
-        if (dedicated_option.value()) {
-            manager = new DedicatedGameManager();
+        
+        if(!filesystem::exists(&quot;config&quot;))
+            filesystem::mkdir(&quot;config&quot;);
+        
+        if ( game_config_option.value().empty() )
+        {
+            gameconfig = new GameConfig(&quot;/config/client.cfg&quot;);
         }
-        else if (bot_option.value().size() &gt; 0) {
-            manager = new BotGameManager(bot_option.value());
-        } else {
-            manager = new PlayerGameManager();
+        else
+        {
+            gameconfig = new GameConfig(game_config_option.value(), false);
         }
+        
+        ResourceManager::initialize();
+        
+        manager = new PlayerGameManager();
+        manager-&gt;initialize();
+        
+        if (GameConfig::interface_language-&gt;length() != 0)
+        {
+            loadPOFile(*GameConfig::interface_language);
+        }
 
-        manager-&gt;initialize(game_config_option.value());
-
         // gameconfig exists now...
-        if(connect_option.value() != &quot;&quot;) {
+        if(connect_option.value() != &quot;&quot;)
+        {
             std::string connecthost = connect_option.value();
-            if(connecthost.find(&quot;<A HREF="netpanzer://">netpanzer://</A>&quot;) == 0) {
+            if(connecthost.find(&quot;<A HREF="netpanzer://">netpanzer://</A>&quot;) == 0)
+            {
                 connecthost = connecthost.substr(12, connecthost.size()-12);
                 std::string::size_type p = connecthost.find(&quot;/&quot;);
-                if(p != std::string::npos) {
+                if(p != std::string::npos)
+                {
                     if ( connecthost[p+1] == 'p' )
                     {
                         gameconfig-&gt;needPassword = true;
@@ -290,15 +253,20 @@
 
             gameconfig-&gt;serverConnect = connecthost;
             gameconfig-&gt;quickConnect = true;
-        }                                                               
-        if (master_server_option.value().size() &gt; 0) {
-            if (master_server_option.value() == &quot;none&quot;) {
+        }
+        
+        if (master_server_option.value().size() &gt; 0)
+        {
+            if (master_server_option.value() == &quot;none&quot;)
+            {
                 *GameConfig::server_masterservers = &quot;&quot;;
             }
-            else {
+            else
+            {
                 *GameConfig::server_masterservers = master_server_option.value();
             }
         }
+
         if ( port_option.value() )
         {
             GameConfig::server_port=port_option.value();
@@ -326,12 +294,18 @@
     // we'll catch every exception here, to be sure the user gets at least
     // a usefull error message and SDL has a chance to shutdown...
     try {
-        if (manager-&gt;launchNetPanzerGame()) {
-            while(manager-&gt;mainLoop())
+//        if (manager-&gt;launchNetPanzerGame()) {
+//            while(manager-&gt;mainLoop())
+//                ;
+//        }
+        
+        if ( SceneManager::init(new InitialScene()) )
+        {
+            while ( SceneManager::run() )
                 ;
         }
 
-        manager-&gt;shutdown();
+//        manager-&gt;shutdown();
         delete manager;
         LOGGER.info(&quot;successfull shutdown.&quot;);
         shutdown();

Added: trunk/netpanzer/src/NetPanzer/Core/main_ded.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Core/main_ded.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Core/main_ded.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,300 @@
+//
+//#ifdef WIN32
+//#include &lt;windows.h&gt;
+//#else
+//#include &lt;sys/types.h&gt;
+//#include &lt;unistd.h&gt;
+//#endif
+//
+//#include &lt;fstream&gt;
+//#include &lt;sstream&gt;
+//#include &lt;stdio.h&gt;
+//#include &lt;stdlib.h&gt;
+//#include &lt;time.h&gt;
+//#include &lt;ctype.h&gt;
+//#include &lt;signal.h&gt;
+//#include &quot;SDL.h&quot;
+//
+//#include &lt;optionmm/command_line.hpp&gt;
+//
+//#include &quot;Util/Log.hpp&quot;
+//#include &quot;Util/FileSystem.hpp&quot;
+//#include &quot;Network/NetworkManager.hpp&quot;
+//
+//#include &quot;Scripts/ScriptManager.hpp&quot;
+//#include &quot;Interfaces/BaseGameManager.hpp&quot;
+//#include &quot;Interfaces/GameConfig.hpp&quot;
+//#include &quot;Interfaces/DedicatedGameManager.hpp&quot;
+//#include &quot;Interfaces/PlayerGameManager.hpp&quot;
+//#include &quot;Core/NetworkGlobals.hpp&quot;
+//#include &quot;Scripts/ScriptManager.hpp&quot;
+//#include &quot;2D/Palette.hpp&quot;
+//#include &quot;Actions/ActionManager.hpp&quot;
+//
+//#include &quot;2D/SceneManager.hpp&quot;
+//#include &quot;Scenes/InitialScene.hpp&quot;
+//
+//#ifndef PACKAGE_VERSION
+//	#define PACKAGE_VERSION &quot;testing&quot;
+//#endif
+//
+////---------------------------------------------------------------------------
+//
+//static std::string pidfile;
+//
+//void shutdown()
+//{
+//#ifndef WIN32
+//    if(pidfile != &quot;&quot;) {
+//        unlink(pidfile.c_str());
+//    }
+//#endif
+//    
+//    SDL_Quit();
+//    if(gameconfig)
+//        gameconfig-&gt;saveConfig();
+//    LOGGER.closeLogFile();
+//    filesystem::shutdown();
+//}
+//
+//#ifndef WIN32
+//void signalhandler(int signum)
+//{
+//    // set signal handler back to default
+//    signal(signum, SIG_DFL);
+//    
+//    const char* sigtype;
+//    switch(signum) {
+//        case SIGINT: sigtype = &quot;SIGINT&quot;; break;
+//        case SIGHUP: sigtype = &quot;SIGHUP&quot;; break;
+//        case SIGTERM: sigtype = &quot;SIGTERM&quot;; break;
+//        case SIGFPE: sigtype = &quot;SIGFPE&quot;; break;
+//        case SIGILL: sigtype = &quot;SIGILL&quot;; break;
+//        case SIGSEGV: sigtype = &quot;SIGSEGV&quot;; break;
+//        case SIGBUS: sigtype = &quot;SIGBUS&quot;; break;
+//        case SIGABRT: sigtype = &quot;SIGABRT&quot;; break;
+//        case SIGTRAP: sigtype = &quot;SIGTRAP&quot;; break;
+//        case SIGSYS: sigtype = &quot;SIGSYS&quot;; break;
+//        default: sigtype = &quot;UNKNOWN&quot;; break;
+//    }
+//        
+//    std::cerr &lt;&lt; &quot;Received signal &quot; &lt;&lt; sigtype &lt;&lt; &quot;(&quot; &lt;&lt; signum &lt;&lt; &quot;)&quot;
+//        &lt;&lt; std::endl &lt;&lt; &quot;aborting and trying to shutdown.&quot; &lt;&lt; std::endl;
+//    shutdown();
+//    raise(signum);
+//}
+//#endif
+//
+////-----------------------------------------------------------------
+//BaseGameManager *initialise(int argc, char** argv)
+//{
+//#if !defined(WIN32) &amp;&amp; !defined(DEBUG)
+//    // Install signal handlers for a clean shutdown
+//    signal(SIGILL, signalhandler);
+//    signal(SIGINT, signalhandler);
+//    signal(SIGHUP, signalhandler);
+//    signal(SIGTERM, signalhandler);
+//    signal(SIGFPE, signalhandler);
+//    signal(SIGSEGV, signalhandler);
+//    signal(SIGBUS, signalhandler);
+//    signal(SIGABRT, signalhandler);
+//    signal(SIGTRAP, signalhandler);
+//    signal(SIGSYS, signalhandler);
+//#endif
+//#if !defined(WIN32)
+//    signal(SIGPIPE, SIG_IGN);
+//#endif
+//
+//    // Parse commandline
+//    using namespace optionmm;
+//    command_line commandline(&quot;NetPanzer dedicated&quot;, PACKAGE_VERSION,
+//            &quot;Copyright(c) 1998 Pyrosoft Inc. and nepanzer-devel team&quot;, &quot;&quot;,
+//            argc, argv);
+//
+//    option&lt;int&gt; port_option('p', &quot;port&quot;, &quot;Run server on specific port&quot;, 0);
+//    commandline.add(&amp;port_option);
+//    bool_option debug_option('g', &quot;debug&quot;, &quot;Enable debug output&quot;, false);
+//    commandline.add(&amp;debug_option);
+//
+//    option&lt;std::string, true, false&gt; master_server_option('\0', &quot;master_server&quot;, &quot;Use 'none' if you dont want to use the master server&quot;, &quot;&quot;);
+//    commandline.add(&amp;master_server_option);
+//
+//    option&lt;std::string, true, false&gt; game_config_option(0, &quot;game_config&quot;,
+//        &quot;Which config file should be used (only files inside config directory)&quot;,
+//        &quot;&quot;);
+//    commandline.add(&amp;game_config_option);
+//    
+//    option&lt;bool, false, false&gt; protocol_option('\0', &quot;protocol&quot;,
+//            &quot;Show version of network protocol&quot;, false);
+//    commandline.add(&amp;protocol_option);
+//    
+//    option&lt;std::string, true, false&gt; pidfile_option(0, &quot;pidfile&quot;,
+//            &quot;Create a pidfile at the specified location&quot;, &quot;&quot;);
+//    commandline.add(&amp;pidfile_option);
+//
+//    if(!commandline.process() || commandline.help() || commandline.version())
+//        exit(0);
+//
+//    if(protocol_option.value()) {
+//        std::cout &lt;&lt; (int) NETPANZER_PROTOCOL_VERSION &lt;&lt; std::endl;
+//        exit(0);
+//    }
+//
+//    if (debug_option.value())
+//    {
+//        LOGGER.setLogLevel(Logger::LEVEL_DEBUG);
+//        LOGGER.debug(&quot;debug option enabled&quot;);
+//    }
+//    else
+//    {
+//        LOGGER.setLogLevel(Logger::LEVEL_INFO);
+//    }
+//
+//    // Initialize SDL (we have to start the video subsystem as well so that
+//    // the eventloop is started, otherwise we'll have problems in dedicated
+//    // server)
+//    if (SDL_Init(SDL_INIT_NOPARACHUTE | SDL_INIT_TIMER) &lt; 0) {
+//        fprintf(stderr, &quot;SDL_Init error: %s.\n&quot;, SDL_GetError());
+//        exit(1);
+//    }
+//
+//    // Initialize libphysfs
+//    try
+//    {
+//        filesystem::initialize(argv[0], &quot;netpanzer&quot;);
+//    }
+//    catch(std::exception&amp; e)
+//    {
+//        fprintf(stderr, &quot;%s&quot;, e.what());
+//        shutdown();
+//        exit(1);
+//    }
+//
+//    LOGGER.openLogFile(&quot;server&quot;);
+//
+//#ifdef WIN32
+//    // SDL redirects stdout and stderr to 2 textfiles, better open a new console
+//    
+//    AllocConsole();
+//    freopen(&quot;CON&quot;, &quot;w&quot;, stdout);
+//    freopen(&quot;CON&quot;, &quot;w&quot;, stderr);
+////        freopen(&quot;CON&quot;, &quot;r&quot;, stdin);
+//#endif
+//
+//    // Initialize random number generator
+//    srand(time(0));
+//    // the STL functions in gcc3 seem to use the 48er versions of the random
+//    // generator instead of the default libc one, so we have todo a double srand
+//    // :-/
+//#ifdef __USE_SVID
+//    srand48(time(0));
+//#endif
+//
+//    // create a pidfile
+//    pidfile = pidfile_option.value();
+//    
+//#ifndef WIN32
+//    if(pidfile != &quot;&quot;) {
+//        std::ofstream out(pidfile.c_str());
+//        if(!out.good()) {
+//            fprintf(stderr, &quot;Couldn't create pidfile '%s'.\n&quot;, pidfile.c_str());
+//            shutdown();
+//            exit(1);
+//        }
+//        out &lt;&lt; getpid() &lt;&lt; std::endl;
+//        out.close();
+//    }
+//#else
+//    if(pidfile != &quot;&quot;) {
+//        fprintf(stderr, &quot;Pidfiles not supported on win32.\n&quot;);
+//    }
+//#endif
+//    
+//    ScriptManager::initialize();
+//    
+//    BaseGameManager *manager;
+//    // finally initialize the game objects
+//    try
+//    {
+//        manager = new DedicatedGameManager();
+//        manager-&gt;initialize();
+//
+//        if (master_server_option.value().size() &gt; 0)
+//        {
+//            if (master_server_option.value() == &quot;none&quot;) {
+//                *GameConfig::server_masterservers = &quot;&quot;;
+//            }
+//            else {
+//                *GameConfig::server_masterservers = master_server_option.value();
+//            }
+//        }
+//        
+//        if ( port_option.value() )
+//        {
+//            GameConfig::server_port=port_option.value();
+//        }
+//
+//        return manager;
+//    } catch(std::exception&amp; e) {
+//        LOGGER.warning(&quot;Couldn't initialize the game: %s&quot;, e.what());
+//        shutdown();
+//        exit(1);
+//    }
+//}
+//
+////-----------------------------------------------------------------
+//int netpanzer_main(int argc, char** argv)
+//{
+//    network::NetworkManager::initialize();
+//    
+//    ActionManager::initialize();
+//    
+//    BaseGameManager *manager = initialise(argc, argv);
+//
+//    ScriptManager::runFile(&quot;unused&quot;,&quot;scripts/initialize.lua&quot;);
+//
+//    // we'll catch every exception here, to be sure the user gets at least
+//    // a usefull error message and SDL has a chance to shutdown...
+//    try {
+//        if (manager-&gt;launchNetPanzerGame()) {
+//            while(manager-&gt;mainLoop())
+//                ;
+//        }
+//        
+//        manager-&gt;shutdown();
+//        delete manager;
+//        LOGGER.info(&quot;successfull shutdown.&quot;);
+//        shutdown();
+//    } 
+//// in debug mode we want the exception to abort, so that we have the original
+//// stack backtrace
+//#if !defined(DEBUG) || defined(WIN32)
+//    catch(std::exception&amp; e) {
+//        LOGGER.warning(&quot;An unexpected exception occured: '%s'\nShutdown needed.&quot;,
+//                e.what());
+//        shutdown();
+//        return 1;
+//    } catch(...) {
+//        LOGGER.warning(&quot;An unexpected exception occured.\nShutdown needed.&quot;);
+//        shutdown();
+//        return 1;
+//    }
+//#else
+//    catch(const float dummy) {
+//    }
+//#endif
+//    
+//    ScriptManager::close();
+//    ActionManager::deinitialize();
+//    network::NetworkManager::cleanUp();
+//    return 0;
+//}
+//
+//// XXX these tweaks are need for SDL on win32
+//extern &quot;C&quot; {
+//    int main(int argc, char** argv)
+//    {
+//        return netpanzer_main(argc, argv);
+//    }
+//}
+//

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -93,10 +93,7 @@
 //-----------------------------------------------------------------
 void BaseGameManager::initializeGameConfig(const std::string&amp; configfile)
 {
-    if(configfile == &quot;&quot;)
-        gameconfig = new GameConfig(&quot;/config/client.cfg&quot;);
-    else
-        gameconfig = new GameConfig(configfile, false);
+    // die!
 }
 //-----------------------------------------------------------------
 void BaseGameManager::shutdownGameConfig()
@@ -165,18 +162,14 @@
 }
 //-----------------------------------------------------------------
 // boots up netPanzer; initializes all subsystems, game objects etc.
-void BaseGameManager::initialize(const std::string&amp; configfile)
+void BaseGameManager::initialize()
 {
     try {
-        if(!filesystem::exists(&quot;config&quot;))
-            filesystem::mkdir(&quot;config&quot;);
-        initializeGameConfig(configfile);
-        ResourceManager::initialize();
 
         initializeSoundSubSystem();
         initializeVideoSubSystem();
-        initializeGameObjects();
-        initializeNetworkSubSystem();
+//        initializeGameObjects();
+//        initializeNetworkSubSystem();
         initializeInputDevices();
     } catch(std::exception&amp; e) {
         LOGGER.warning(&quot;Initialisation failed:\n%s&quot;, e.what());

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -53,7 +53,7 @@
 
     virtual void shutdown();
 
-    virtual void initialize(const std::string&amp; configfile = &quot;&quot;);
+    virtual void initialize();
 
     /// mainloop, return false if you want to quit
     virtual bool mainLoop();

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/ChatInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/ChatInterface.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/ChatInterface.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -27,7 +27,6 @@
 #include &quot;Classes/Network/NetworkClient.hpp&quot;
 #include &quot;Util/Log.hpp&quot;
 #include &quot;Views/Game/ChatView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 
 #include &quot;Scripts/ScriptManager.hpp&quot;
 
@@ -125,7 +124,7 @@
 
     LOGGER.debug(&quot;C: %s: %s&quot;, player_state-&gt;getName().c_str(), text.c_str());
 
-    ChatView *v = (ChatView*) Desktop::getView(&quot;ChatView&quot;);
+    ChatView *v = 0; // (ChatView*) Desktop::getView(&quot;ChatView&quot;);
     if (v)
         v-&gt;postMessage(color, true, player_state-&gt;getFlag(),
                        &quot;%s: %s&quot;, player_state-&gt;getName().c_str(), text.c_str());
@@ -231,7 +230,7 @@
         PlayerState *player_state = PlayerInterface::getPlayer(player_id);
         LOGGER.debug(&quot;C: %s: %s&quot;, player_state-&gt;getName().c_str(), text.c_str());
 
-        ChatView *v = (ChatView*) Desktop::getView(&quot;ChatView&quot;);
+        ChatView *v = 0; // (ChatView*) Desktop::getView(&quot;ChatView&quot;);
         if ( v )
         {
             v-&gt;postMessage(Color::white, true, player_state-&gt;getFlag(),
@@ -286,7 +285,7 @@
 
         LOGGER.debug(&quot;C: %s: %s&quot;, player_state-&gt;getName().c_str(), message.c_str());
         
-        ChatView *v = (ChatView*) Desktop::getView(&quot;ChatView&quot;);
+        ChatView *v = 0; // (ChatView*) Desktop::getView(&quot;ChatView&quot;);
         if (v)
             v-&gt;postMessage(Color::yellow, true, player_state-&gt;getFlag(),
                            &quot;%s: %s&quot;, player_state-&gt;getName().c_str(), message.c_str());

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -239,7 +239,8 @@
     ScriptManager::runFile(&quot;user_commands_load&quot;,&quot;scripts/usercommands.lua&quot;);
 
     GameConfig::game_map-&gt;assign(GameManager::getNextMapName(&quot;&quot;));
-
+    
+    ResourceManager::refreshMapList();
     GameManager::dedicatedLoadGameMap(GameConfig::game_map-&gt;c_str());
 
     UnitProfileInterface::loadUnitProfiles();

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -36,7 +36,6 @@
 
 #include &quot;Units/UnitProfileInterface.hpp&quot;
 
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Game/LoadingView.hpp&quot;
 
 #include &quot;Util/Log.hpp&quot;
@@ -170,20 +169,20 @@
 
     case _map_cycle_client_prepare_team :
     {
-        if (!Desktop::getVisible(&quot;PrepareTeam&quot;)&amp;&amp; !Desktop::getVisible(&quot;GFlagSelectionView&quot;))
-        {
-            Desktop::setVisibility(&quot;PrepareTeam&quot;, true);
-            TeamManager::reset();
-        }
-        if (Desktop::getVisible(&quot;PrepareTeam&quot;))
-            WorldViewInterface::MoveCamera();
+//        if (!Desktop::getVisible(&quot;PrepareTeam&quot;)&amp;&amp; !Desktop::getVisible(&quot;GFlagSelectionView&quot;))
+//        {
+//            Desktop::setVisibility(&quot;PrepareTeam&quot;, true);
+//            TeamManager::reset();
+//        }
+//        if (Desktop::getVisible(&quot;PrepareTeam&quot;))
+//            WorldViewInterface::MoveCamera();
         return;
     }
     break;
 
     case _map_cycle_client_team_start :
     {
-        Desktop::setVisibility(&quot;PrepareTeam&quot;, false);
+//        Desktop::setVisibility(&quot;PrepareTeam&quot;, false);
         map_cycle_fsm_client_state = _map_cycle_client_idle;
         setStateServerInProgress();
         GameManager::startGameTimer();
@@ -214,8 +213,8 @@
 
         if ( GameControlRulesDaemon::execution_mode == _execution_mode_loop_back_server )
         {
-            Desktop::setVisibility(&quot;GameView&quot;, true);
-            Desktop::setVisibility(&quot;EndRoundView&quot;, true );
+//            Desktop::setVisibility(&quot;GameView&quot;, true);
+//            Desktop::setVisibility(&quot;EndRoundView&quot;, true );
         }
 
         SERVER-&gt;broadcastMessage(&amp;view_control, sizeof(SystemViewControl));

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -63,21 +63,16 @@
 #include &quot;Units/UnitGlobals.hpp&quot;
 
 #include &quot;2D/Palette.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/ViewGlobals.hpp&quot;
 #include &quot;Views/MainMenu/MainMenuView.hpp&quot;
 #include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/HostOptionsView.hpp&quot;
 #include &quot;Views/MainMenu/Multi/MapSelectionView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/PlayerNameView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/IPAddressView.hpp&quot;
 #include &quot;Views/Game/RankView.hpp&quot;
 #include &quot;Views/Game/VehicleSelectionView.hpp&quot;
 #include &quot;Views/Game/CodeStatsView.hpp&quot;
 #include &quot;Views/Game/LibView.hpp&quot;
 #include &quot;Views/Game/HelpScrollView.hpp&quot;
-#include &quot;Views/Game/AreYouSureResignView.hpp&quot;
-#include &quot;Views/Game/AreYouSureExitView.hpp&quot;
 #include &quot;Views/Game/GameView.hpp&quot;
 #include &quot;Views/Game/MiniMapView.hpp&quot;
 
@@ -168,18 +163,15 @@
     WorldViewInterface::setCameraSize( mode_res.x, mode_res.y);
     delete screen;
     screen = new ScreenSurface(Screen, mode_res.x, mode_res.y);
-    Desktop::checkResolution(old_res, mode_res);
-    Desktop::checkViewPositions(mode_res);
+//    Desktop::checkResolution(old_res, mode_res);
+//    Desktop::checkViewPositions(mode_res);
     loadPalette(&quot;netp&quot;);
-    if (GameConfig::interface_language-&gt;length() != 0)
-    {
-        loadPOFile(*GameConfig::interface_language);
-    }
+    
     if(old_res == iXY(0,0)) {
         // users can get annoyed when they see a black screen for half a minute
         // so we display something here... (we're just hoping that palette1 is
         // not black)
-        drawTextCenteredOnScreen(_(&quot;Please wait... generating palettes&quot;), 255);
+//        drawTextCenteredOnScreen(_(&quot;Please wait... generating palettes&quot;), 255);
     }
 
 }
@@ -394,18 +386,18 @@
     const SystemViewControl *view_control
         = (const SystemViewControl*) message;
 
-    if ( view_control-&gt;action_flags &amp; _view_control_flag_close_all ) {
-        Desktop::setVisibilityAllWindows(false);
-        Desktop::setVisibility(&quot;GameView&quot;, true);
-    }
-
-    if ( view_control-&gt;action_flags &amp; _view_control_flag_visible_on ) {
-        Desktop::setVisibility( view_control-&gt;view_name, true );
-    }
-
-    if ( view_control-&gt;action_flags &amp; _view_control_flag_visible_off ) {
-        Desktop::setVisibility( view_control-&gt;view_name, false );
-    }
+//    if ( view_control-&gt;action_flags &amp; _view_control_flag_close_all ) {
+//        Desktop::setVisibilityAllWindows(false);
+//        Desktop::setVisibility(&quot;GameView&quot;, true);
+//    }
+//
+//    if ( view_control-&gt;action_flags &amp; _view_control_flag_visible_on ) {
+//        Desktop::setVisibility( view_control-&gt;view_name, true );
+//    }
+//
+//    if ( view_control-&gt;action_flags &amp; _view_control_flag_visible_off ) {
+//        Desktop::setVisibility( view_control-&gt;view_name, false );
+//    }
 }
 
 // ******************************************************************

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/KeyboardInterface.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/KeyboardInterface.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/KeyboardInterface.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -19,7 +19,6 @@
 #define _KEYBOARDINTERFACE_HPP
 
 #include &quot;SDL.h&quot;
-#include &quot;Util/Log.hpp&quot;
 #include &lt;string.h&gt;
 
 #define _CHAR_BUFFER_SIZE 256

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/MouseInterface.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/MouseInterface.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/MouseInterface.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -58,7 +58,7 @@
     static iXY mouse_offset;
 
     static unsigned char button_mask;
-
+    
 public:
     enum {
         left_button   = SDL_BUTTON_LEFT,
@@ -75,7 +75,7 @@
     };
 
     enum CursorType {
-        defaultcursor, noentry, move, select, target, allie, break_allie
+        defaultcursor, noentry, move, select, target, allie, break_allie, CURSOR_TYPE_MAX
     };
 
     static MouseEventQueue event_queue;

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -56,33 +56,8 @@
 #include &quot;Units/UnitGlobals.hpp&quot;
 
 #include &quot;2D/Palette.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/ViewGlobals.hpp&quot;
-#include &quot;Views/MainMenu/MenuTemplateView.hpp&quot;
-#include &quot;Views/MainMenu/MainMenuView.hpp&quot;
-#include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/HostOptionsView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/MapSelectionView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/PlayerNameView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/IPAddressView.hpp&quot;
-#include &quot;Views/MainMenu/Multi/ServerListView.hpp&quot;
-
-#include &quot;Views/Game/RankView.hpp&quot;
-#include &quot;Views/Game/RankTeam.hpp&quot;
-#include &quot;Views/Game/EndRoundView.hpp&quot;
-#include &quot;Views/Game/GFlagSelectionView.hpp&quot;
-#include &quot;Views/Game/PrepareTeam.hpp&quot;
-#include &quot;Views/Game/VehicleSelectionView.hpp&quot;
-#include &quot;Views/Game/CodeStatsView.hpp&quot;
-#include &quot;Views/Game/LibView.hpp&quot;
-#include &quot;Views/Game/HelpScrollView.hpp&quot;
-#include &quot;Views/Game/AreYouSureResignView.hpp&quot;
-#include &quot;Views/Game/AreYouSureExitView.hpp&quot;
-#include &quot;Views/Game/GameView.hpp&quot;
-#include &quot;Views/Game/MiniMapView.hpp&quot;
-#include &quot;Views/Game/DisconectedView.hpp&quot;
 #include &quot;Views/Game/LoadingView.hpp&quot;
-#include &quot;Views/Game/ChatView.hpp&quot;
 
 #include &quot;Particles/Particle2D.hpp&quot;
 #include &quot;Particles/ParticleSystem2D.hpp&quot;
@@ -166,61 +141,20 @@
 //-----------------------------------------------------------------
 void PlayerGameManager::initializeWindowSubSystem()
 {
-    Desktop::add(new GameView(), false);
-    Desktop::add(new RankView(), false);
-    Desktop::add(new RankTeam(), false);
-    Desktop::add(new EndRoundView(), false);
-    Desktop::add(new GFlagSelectionView(), false);
-    Desktop::add(new VehicleSelectionView(), false );
-    Desktop::add(new MiniMapView(), false);
-    Desktop::add(new CodeStatsView(), false);
-    Desktop::add(new LibView(), false);
-    Desktop::add(new HelpScrollView(), false);
 
-    Desktop::add(new ChatView(), false);
-    Desktop::add(new PrepareTeam(), false);
-
-    LoadingView *lv = new LoadingView();
-    Desktop::add(lv, false);
-
-
-    Desktop::add(new MapSelectionView(), false);
-    Desktop::add(new MainMenuView(), false);
-    Desktop::add(new OptionsTemplateView(), false);
-    Desktop::add(new HostOptionsView(), false);
-    Desktop::add(new PlayerNameView(), false);
-    Desktop::add(new AreYouSureResignView(), false);
-    Desktop::add(new AreYouSureExitView(), false);
-    Desktop::add(new DisconectedView(), false);
-
-    Desktop::add(new IPAddressView(), false);
-    Desktop::add(new ServerListView(), false);
-
-    Desktop::add(new MenuTemplateView(), false);
-
-    Desktop::setVisibilityAllWindows(false);
-    Desktop::setVisibility(&quot;MenuTemplateView&quot;, true);
-    Desktop::setVisibility(&quot;MainView&quot;, true);
-
-    Desktop::checkResolution(iXY(800,480), iXY(screen-&gt;getWidth(),screen-&gt;getHeight()));
-    Desktop::checkViewPositions(iXY(screen-&gt;getWidth(),screen-&gt;getHeight()));
-
-
     if ( gameconfig-&gt;quickConnect &amp;&amp; gameconfig-&gt;needPassword )
     {
-        lv-&gt;setNeedPassword(true);
+//        lv-&gt;setNeedPassword(true);
     }
 
-    //Test for new UI
-    //testpanel = new Panels::TestPanel(iXY(30, 60), &amp;fontManager);
 }
 //-----------------------------------------------------------------
 void PlayerGameManager::inputLoop()
 {
     processSystemKeys();
     MouseInterface::manageClickTimer();
-    Desktop::manage(MouseInterface::getMouseX(),
-               MouseInterface::getMouseY(), MouseInterface::getButtonMask());
+//    Desktop::manage(MouseInterface::getMouseX(),
+//               MouseInterface::getMouseY(), MouseInterface::getButtonMask());
 
     COMMAND_PROCESSOR.updateScrollStatus( MouseInterface::getMousePosition() );
 
@@ -229,16 +163,7 @@
 //-----------------------------------------------------------------
 void PlayerGameManager::graphicsLoop()
 {
-    screen-&gt;lock();
-
-    screen-&gt;fill(0);
-
-    Desktop::draw(*screen);
-
-    MouseInterface::draw(*screen);
-
-    screen-&gt;unlock();
-    screen-&gt;copyToVideoFlip();
+   // empty
 }
 //-----------------------------------------------------------------
 bool PlayerGameManager::launchNetPanzerGame()
@@ -459,13 +384,13 @@
     NetworkState::setNetworkStatus( _network_state_client );
 
     LoadingView::show();
-    LoadingView *lv = static_cast&lt;LoadingView*&gt;(Desktop::getView(&quot;LoadingView&quot;));
-    if ( ! lv-&gt;doesNeedPassword() )
-    {
-        CLIENT-&gt;joinServer(gameconfig-&gt;serverConnect, &quot;&quot;);
-        ClientConnectDaemon::startConnectionProcess();
-        sound-&gt;playTankIdle();
-    }
+//    LoadingView *lv = static_cast&lt;LoadingView*&gt;(Desktop::getView(&quot;LoadingView&quot;));
+//    if ( ! lv-&gt;doesNeedPassword() )
+//    {
+//        CLIENT-&gt;joinServer(gameconfig-&gt;serverConnect, &quot;&quot;);
+//        ClientConnectDaemon::startConnectionProcess();
+//        sound-&gt;playTankIdle();
+//    }
 
     ScriptManager::runFile(&quot;user_commands_load&quot;,&quot;scripts/usercommands.lua&quot;);
 }
@@ -523,8 +448,8 @@
 //-----------------------------------------------------------------
 void PlayerGameManager::processSystemKeys()
 {
-    if (Desktop::getVisible(&quot;GameView&quot;))
-    {
+//    if (Desktop::getVisible(&quot;GameView&quot;))
+//    {
         if (   KeyboardInterface::getKeyState( SDLK_LALT )
             || KeyboardInterface::getKeyState( SDLK_RALT ) )
         {
@@ -540,40 +465,40 @@
             Screen-&gt;doScreenshoot();
         }
 
-        if (KeyboardInterface::getKeyPressed(SDLK_ESCAPE))
-        {
-            if ( ! Desktop::getVisible(&quot;OptionsView&quot;) )
-            {
-                if ( Desktop::getVisible(&quot;HelpScrollView&quot;) )
-                {
-                    Desktop::toggleVisibility(&quot;HelpScrollView&quot;);
-                }
-                else if ( Desktop::getVisible(&quot;GFlagSelectionView&quot;) )
-                {
-                    Desktop::toggleVisibility(&quot;GFlagSelectionView&quot;);
-                }
-                else
-                {
-                    View *v = Desktop::getView(&quot;MenuTemplateView&quot;);
-                    assert(v != 0);
-                    ((MenuTemplateView *)v)-&gt;init();
-                    ((MenuTemplateView *)v)-&gt;setAlwaysOnBottom(false);
-                    
-                    v = Desktop::getView(&quot;OptionsView&quot;);
-                    assert(v != 0);
-                    ((OptionsTemplateView *)v)-&gt;initButtons();
-                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
-
-                    Desktop::setVisibility(&quot;MenuTemplateView&quot;, true);
-                    Desktop::setVisibility(&quot;OptionsView&quot;, true);
-                    Desktop::setActiveView(&quot;OptionsView&quot;);
-                }
-            }
-            else
-            {
-                Desktop::setVisibility(&quot;MenuTemplateView&quot;, false);
-                Desktop::setVisibility(&quot;OptionsView&quot;, false);
-            }
-        }
-    }
+//        if (KeyboardInterface::getKeyPressed(SDLK_ESCAPE))
+//        {
+//            if ( ! Desktop::getVisible(&quot;OptionsView&quot;) )
+//            {
+//                if ( Desktop::getVisible(&quot;HelpScrollView&quot;) )
+//                {
+//                    Desktop::toggleVisibility(&quot;HelpScrollView&quot;);
+//                }
+//                else if ( Desktop::getVisible(&quot;GFlagSelectionView&quot;) )
+//                {
+//                    Desktop::toggleVisibility(&quot;GFlagSelectionView&quot;);
+//                }
+//                else
+//                {
+//                    View *v = Desktop::getView(&quot;MenuTemplateView&quot;);
+//                    assert(v != 0);
+//                    ((MenuTemplateView *)v)-&gt;init();
+//                    ((MenuTemplateView *)v)-&gt;setAlwaysOnBottom(false);
+//                    
+//                    v = Desktop::getView(&quot;OptionsView&quot;);
+//                    assert(v != 0);
+//                    ((OptionsTemplateView *)v)-&gt;initButtons();
+//                    ((OptionsTemplateView *)v)-&gt;setAlwaysOnBottom(false);
+//
+//                    Desktop::setVisibility(&quot;MenuTemplateView&quot;, true);
+//                    Desktop::setVisibility(&quot;OptionsView&quot;, true);
+//                    Desktop::setActiveView(&quot;OptionsView&quot;);
+//                }
+//            }
+//            else
+//            {
+//                Desktop::setVisibility(&quot;MenuTemplateView&quot;, false);
+//                Desktop::setVisibility(&quot;OptionsView&quot;, false);
+//            }
+//        }
+//    }
 }

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -30,8 +30,6 @@
 #include &quot;Objectives/ObjectiveInterface.hpp&quot;
 #include &quot;Objectives/Objective.hpp&quot;
 
-#include &quot;Views/Components/Desktop.hpp&quot;
-
 #include &quot;Classes/Network/PlayerNetMessage.hpp&quot;
 #include &quot;Classes/Network/NetworkServer.hpp&quot;
 #include &quot;Util/Log.hpp&quot;
@@ -464,7 +462,7 @@
     }
     if ( player_id == local_player_index &amp;&amp; player_lists[player_id].isSelectingFlag() )
     {
-        Desktop::setVisibility(&quot;GFlagSelectionView&quot;, true);
+//        Desktop::setVisibility(&quot;GFlagSelectionView&quot;, true);
     }
     SDL_mutexV(mutex);
 }

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/TeamManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/TeamManager.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/TeamManager.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -34,7 +34,6 @@
 #include &quot;Util/StringUtil.hpp&quot;
 #include &quot;Objectives/ObjectiveInterface.hpp&quot;
 #include &quot;Objectives/Objective.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Game/PrepareTeam.hpp&quot;
 #include &quot;Network/PlayerRequests/PlayerReadyRequest.hpp&quot;
 
@@ -155,7 +154,7 @@
     resetTeamStats();
     if ( NetworkState::status == _network_state_client )
     {
-        PrepareTeam *v = (PrepareTeam*)Desktop::getView(&quot;PrepareTeam&quot;);
+        PrepareTeam *v = 0; //(PrepareTeam*)Desktop::getView(&quot;PrepareTeam&quot;);
         if ( v )
         {
             v-&gt;resetReady();

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/VoteManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/VoteManager.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/VoteManager.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -27,7 +27,6 @@
 #include &quot;Classes/Network/NetworkServer.hpp&quot;
 #include &quot;Classes/Network/NetworkClient.hpp&quot;
 #include &quot;Classes/Network/NetworkState.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Game/VoteBox.hpp&quot;
 
 bool   VoteManager::vote_in_progress = false;
@@ -60,8 +59,8 @@
     
     votebox = new VoteBox(VoteStrings[vote_request-&gt;vote_type]);
     
-    Desktop::add(votebox);
-    Desktop::setVisibility(&quot;votebox&quot;, true);
+//    Desktop::add(votebox);
+//    Desktop::setVisibility(&quot;votebox&quot;, true);
 }
 
 void VoteManager::resetVote()
@@ -72,7 +71,7 @@
     
     if (votebox)
     {
-        Desktop::remove(votebox);
+//        Desktop::remove(votebox);
     }
     
     player_vote = new Uint8 [PlayerInterface::getMaxPlayers()];
@@ -151,8 +150,8 @@
 
 void VoteManager::playerVote(Uint8 responce)
 {
-    Desktop::setVisibility(&quot;votebox&quot;, false);
-    Desktop::remove(votebox);
+//    Desktop::setVisibility(&quot;votebox&quot;, false);
+//    Desktop::remove(votebox);
 
     PlayerSendVote vote_player;
     vote_player.set(PlayerInterface::getLocalPlayerIndex(), responce);

Modified: trunk/netpanzer/src/NetPanzer/Particles/ParticleInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Particles/ParticleInterface.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Particles/ParticleInterface.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -24,7 +24,6 @@
 #include &quot;TemplateExplosionSystem.hpp&quot;
 #include &quot;CloudParticle2D.hpp&quot;
 #include &quot;Interfaces/MapInterface.hpp&quot;
-#include &quot;Interfaces/KeyboardInterface.hpp&quot;
 #include &quot;Physics.hpp&quot;
 #include &quot;VectorPuffParticle2D.hpp&quot;
 #include &quot;Units/UnitTypes.hpp&quot;
@@ -38,7 +37,9 @@
 #include &quot;Util/Exception.hpp&quot;
 #include &quot;System/Sound.hpp&quot;
 
+#include &quot;Util/Log.hpp&quot;
 
+
 std::vector&lt;UnitParticleInfo&gt; ParticleInterface::unitParticleInfo;
 int ParticleInterface::unitBodyMaxArea                   = 0;
 int ParticleInterface::gParticlesCanHaveSmoke            = 1;

Modified: trunk/netpanzer/src/NetPanzer/Particles/ParticleTweakView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Particles/ParticleTweakView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Particles/ParticleTweakView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -19,7 +19,7 @@
 
 #include &quot;ParticleTweakView.hpp&quot;
 
-#include &quot;Views/Components/Desktop.hpp&quot;
+#include &quot;2D/Color.hpp&quot;
 
 ParticleTweakView::ParticleTweakView() : View()
 {

Added: trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,38 @@
+
+#include &quot;InitialScene.hpp&quot;
+
+#include &quot;2D/Layer.hpp&quot;
+#include &quot;Classes/ScreenSurface.hpp&quot;
+#include &quot;2D/Color.hpp&quot;
+#include &quot;Interfaces/StrManager.hpp&quot;
+#include &quot;MainMenuScene.hpp&quot;
+#include &quot;2D/SceneManager.hpp&quot;
+
+class InitialLayer : public Layer
+{
+public:
+    InitialLayer() : Layer(0) {}
+    
+    void draw() // const
+    {
+        screen-&gt;fill(Color::black);
+        screen-&gt;bltStringCenter(_(&quot;Loading...&quot;), Color::white);
+    }
+    
+};
+
+InitialScene::InitialScene()
+{
+    addLayer( new InitialLayer() );
+}
+
+InitialScene::~InitialScene()
+{
+    
+}
+
+void InitialScene::logic()
+{
+    MainMenuScene * mms = new MainMenuScene();
+    SceneManager::setNextScene(mms);
+}
\ No newline at end of file

Added: trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.hpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Scenes/InitialScene.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,24 @@
+/* 
+ * File:   InitialScene.hpp
+ * Author: krom
+ *
+ * Created on February 15, 2013, 11:03 AM
+ */
+
+#ifndef INITIALSCENE_HPP
+#define	INITIALSCENE_HPP
+
+#include &quot;2D/Scene.hpp&quot;
+
+class InitialScene : public Scene
+{
+public:
+    InitialScene();
+    ~InitialScene();
+    
+    void logic();
+    
+};
+
+#endif	/* INITIALSCENE_HPP */
+

Added: trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,481 @@
+
+#include &quot;MainMenuScene.hpp&quot;
+
+#include &quot;2D/Layer.hpp&quot;
+#include &quot;2D/Color.hpp&quot;
+#include &quot;2D/Palette.hpp&quot;
+#include &quot;Classes/ScreenSurface.hpp&quot;
+
+#include &quot;ArrayUtil/PtrArray.hpp&quot;
+
+#include &quot;Interfaces/StrManager.hpp&quot;
+
+#include &quot;Views/Components/Button.hpp&quot;
+#include &quot;Views/Components/Label.hpp&quot;
+#include &quot;Views/Components/CheckBox.hpp&quot;
+#include &quot;Views/Components/Choice.hpp&quot;
+#include &quot;Views/Components/InputField.hpp&quot;
+#include &quot;Views/Components/MouseEvent.hpp&quot;
+#include &quot;2D/PackedSurface.hpp&quot;
+#include &quot;Actions/ActionManager.hpp&quot;
+#include &quot;Interfaces/MouseInterface.hpp&quot;
+
+#ifndef PACKAGE_VERSION
+	#define PACKAGE_VERSION &quot;testing&quot;
+#endif
+
+static const char npver[] = &quot;NetPanzer &quot; PACKAGE_VERSION;
+
+class BackgroundImageLayer : public Layer
+{
+private:
+    Surface image;
+    int hw;
+    int hh;
+    
+public:
+    BackgroundImageLayer() : Layer(-1)
+    {
+        image.loadBMP(&quot;pics/backgrounds/defaultMB.bmp&quot;);
+        hw = image.getWidth()/2;
+        hh = image.getHeight()/2;
+    }
+    
+    void draw()
+    {
+        screen-&gt;fill(0);
+        
+        int dx = (screen-&gt;getWidth()/2) - hw;
+        int dy = (screen-&gt;getHeight()/2) - hh;
+        image.blt(*screen, dx, dy);
+        
+        screen-&gt;bltString(10, screen-&gt;getHeight()-Surface::getFontHeight() - 4, npver, Color::yellow);
+        
+        char str[1024];
+        snprintf(str, sizeof(str), &quot;%dx%d&quot;, screen-&gt;getWidth(), screen-&gt;getHeight());
+        
+        screen-&gt;bltString(200, screen-&gt;getHeight()-Surface::getFontHeight() - 4, str, Color::yellow);
+        
+    }
+};
+
+static void config_button(Button&amp; b, const NPString&amp; label, bool inverted)
+{
+    Surface bitmap;
+    bitmap.loadBMP(&quot;pics/buttons/page.bmp&quot;);
+    if ( inverted )
+    {
+        bitmap.flipVertical();
+    }
+    
+    b.setLabel(label);
+    b.setSize(Surface::getTextLength(label)+20, 25);
+    b.setTextColors(Color::gray, Color::lightGray, Color::black, Color::darkGray);
+
+    b.setExtraBorder();
+    
+    b.borders[0] = Color::gray;
+    b.borders[1] = Color::gray;
+    b.borders[2] = Color::gray;
+    
+    PIX bcolor[] = { Color::black, Color::gray, Color::darkGray };
+
+    PtrArray&lt;Surface&gt; bg(3);
+    int bgsize = Surface::getTextLength(label)+20;
+    
+    for ( unsigned int n = 0; n &lt; 3; n++ )
+    {
+        Surface *s = new Surface( bgsize, 25);
+        s-&gt;FillRoundRect(s-&gt;getRect(), 2, bcolor[n]);
+        bitmap.bltTrans(*s, 0, 0);
+        bg.push_back(s);
+    }
+    
+    b.setImage(bg);
+}
+
+#define MENU_WIDTH  (640)
+#define MENU_HEIGHT (480)
+#define BUTTONS_START_X (8)
+#define BUTTONS_START_Y (0)
+
+enum
+{
+    CA_MAIN = 1,
+    CA_JOIN,
+    CA_HOST,
+    CA_OPTIONS,
+    CA_HELP,
+    CA_EXIT
+};
+
+class MainMenuLayer : public Layer
+{
+private:
+    Button button_main;
+    Button button_join;
+    Button button_host;
+    Button button_options;
+    Button button_help;
+    Button button_exit;
+    iRect  vrect;
+    iXY    prev_screen_size;
+    
+    PtrArray&lt;Component&gt; visible_components;
+    
+    CheckBox checkbox;
+    bool checkbox_data;
+    
+    Choice choice;
+    
+    InputField input_field;
+    
+public:
+    MainMenuLayer() : Layer(0), vrect(0, 26, MENU_WIDTH, MENU_HEIGHT-26-26), prev_screen_size(0,0),
+            checkbox(0,0,&quot;Checkbox&quot;, &amp;checkbox_data),
+            input_field(0)
+    {
+        config_button( button_main,     _(&quot;Main&quot;), false );
+        config_button( button_join,     _(&quot;Join&quot;), false );
+        config_button( button_host,     _(&quot;Host&quot;), false );
+        config_button( button_options,  _(&quot;Options&quot;), false );
+        config_button( button_help,     _(&quot;Help&quot;), false );
+        config_button( button_exit,     _(&quot;Exit netPanzer&quot;), false );
+        
+        button_main.setClickAction(CA_MAIN);
+        button_join.setClickAction(CA_JOIN);
+        button_host.setClickAction(CA_HOST);
+        button_options.setClickAction(CA_OPTIONS);
+        button_help.setClickAction(CA_HELP);
+        button_exit.setClickAction(CA_EXIT);
+        
+        visible_components.push_back(&amp;button_main);
+        visible_components.push_back(&amp;button_join);
+        visible_components.push_back(&amp;button_host);
+        visible_components.push_back(&amp;button_options);
+        visible_components.push_back(&amp;button_help);
+        visible_components.push_back(&amp;button_exit);
+        
+        mouse_over_component = 0;
+        mouse_down_component = 0;
+        mouse_down_button = 0;
+        
+        checkbox_data = false;
+        
+        choice.addItem(&quot;item 1&quot;);
+        choice.addItem(&quot;item 2&quot;);
+        choice.addItem(&quot;item 3&quot;);
+        choice.addItem(&quot;item 4&quot;);
+        choice.select(0);
+        
+        input_field.setSize(100,20);
+        input_field.setMaxTextLength(20);
+        input_field.setText(&quot;tteesstt&quot;);
+        
+        
+        visible_components.push_back(&amp;checkbox);
+        visible_components.push_back(&amp;choice);
+        visible_components.push_back(&amp;input_field);
+        
+        mouse_x = 0; //MouseInterface::getMouseX();
+        mouse_y = 0; //MouseInterface::getMouseY();
+    }
+    
+    ~MainMenuLayer()
+    {
+        
+    }
+    
+    void draw() // const
+    {
+        if ( (prev_screen_size.x != screen-&gt;getWidth())
+           ||(prev_screen_size.y != screen-&gt;getHeight()) )
+        {
+            recalculatePositions();
+        }
+        
+        screen-&gt;BltRoundRect(vrect, 10, Palette::darkGray256.getColorArray());
+        screen-&gt;RoundRect(vrect, 10, Color::gray);
+        
+        drawComponents();
+    }
+    
+    void logic()
+    {
+        
+    }
+    
+    void handleMouseLocation(int x, int y)
+    {
+        if ( (x == mouse_x) &amp;&amp; (y == mouse_y) )
+        {
+            return; // nothing to do
+        }
+        
+        Component * c = 0;
+        for ( size_t n = 0; n &lt; visible_components.size(); n++ )
+        {
+            if ( visible_components[n]-&gt;contains(x, y) )
+            {
+                c = visible_components[n];
+                break;
+            }
+        }
+        
+        if ( c != mouse_over_component )
+        {
+            if ( mouse_over_component )
+            {
+                mouse_over_component-&gt;actionPerformed(mMouseEvent(
+                        mouse_over_component,
+                        mMouseEvent::MOUSE_EVENT_EXITED, now(), 0, 
+                        x, y, 0, false) );
+            }
+            
+            mouse_over_component = c;
+            
+            if ( mouse_over_component )
+            {
+                mouse_over_component-&gt;actionPerformed(mMouseEvent(
+                        mouse_over_component,
+                        mMouseEvent::MOUSE_EVENT_ENTERED, now(), 0, 
+                        x, y, 0, false) );
+                
+                if ( mouse_over_component == mouse_down_component )
+                {
+                    int bmask = 0;
+                    switch ( mouse_down_button )
+                    {
+                        case 1: bmask = mMouseEvent::BUTTON1_MASK; break;
+                        case 2: bmask = mMouseEvent::BUTTON2_MASK; break;
+                        case 3: bmask = mMouseEvent::BUTTON3_MASK; break;
+                    }
+
+                    mouse_down_component-&gt;actionPerformed(mMouseEvent(
+                            c, mMouseEvent::MOUSE_EVENT_PRESSED, now(), bmask, 
+                            x, y, 0, false) );
+                }
+            }
+        }
+        else if ( c )
+        {
+            // same component but moved
+            if ( mouse_over_component == mouse_down_component )
+            {
+                int bmask = 0;
+                switch ( mouse_down_button )
+                {
+                    case 1: bmask = mMouseEvent::BUTTON1_MASK; break;
+                    case 2: bmask = mMouseEvent::BUTTON2_MASK; break;
+                    case 3: bmask = mMouseEvent::BUTTON3_MASK; break;
+                }
+
+                mouse_down_component-&gt;actionPerformed(mMouseEvent(
+                        c, mMouseEvent::MOUSE_EVENT_DRAGGED, now(), bmask, 
+                        x, y, 0, false) );
+            }
+        }
+        
+        mouse_x = x;
+        mouse_y = y;
+    }
+    
+    void handleMouseDown(int x, int y, int button)
+    {
+        if ( mouse_down_button )
+        {
+            return; // already one button down
+        }
+        
+        Component * c = 0;
+        for ( size_t n = 0; n &lt; visible_components.size(); n++ )
+        {
+            if ( visible_components[n]-&gt;contains(x, y) )
+            {
+                mouse_down_component = visible_components[n];
+                mouse_down_button = button;
+                
+                int bmask = 0;
+                switch ( button )
+                {
+                    case 1: bmask = mMouseEvent::BUTTON1_MASK; break;
+                    case 2: bmask = mMouseEvent::BUTTON2_MASK; break;
+                    case 3: bmask = mMouseEvent::BUTTON3_MASK; break;
+                }
+                
+                mouse_down_component-&gt;actionPerformed(mMouseEvent(
+                        c, mMouseEvent::MOUSE_EVENT_PRESSED, now(), bmask, 
+                        x, y, 0, false) );
+                
+                break;
+            }
+        }
+    }
+    
+    void handleMouseUp(int x, int y, int button)
+    {
+        if ( button != mouse_down_button )
+        {
+            return; // ignore other buttons
+        }
+        
+        if ( ! mouse_down_button || ! mouse_down_component )
+        {
+            mouse_down_button = 0;
+            mouse_down_component = 0;
+            return; // nothing down;
+        }
+        
+        Component * c = 0;
+        for ( size_t n = 0; n &lt; visible_components.size(); n++ )
+        {
+            if ( visible_components[n]-&gt;contains(x, y) )
+            {
+                Component * c = visible_components[n];
+                
+                if ( c != mouse_down_component )
+                {
+                    // ignore other component
+                    break;
+                }
+                    
+                int bmask = 0;
+                switch ( button )
+                {
+                    case 1: bmask = mMouseEvent::BUTTON1_MASK; break;
+                    case 2: bmask = mMouseEvent::BUTTON2_MASK; break;
+                    case 3: bmask = mMouseEvent::BUTTON3_MASK; break;
+                }
+                
+                c-&gt;actionPerformed(mMouseEvent(
+                        c, mMouseEvent::MOUSE_EVENT_CLICKED, now(), bmask, 
+                        x, y, 0, false) );
+                
+                c-&gt;actionPerformed(mMouseEvent(
+                        c, mMouseEvent::MOUSE_EVENT_RELEASED, now(), bmask, 
+                        x, y, 0, false) );
+                
+                if ( c-&gt;getClickAction() )
+                {
+                    handleClickAction( c-&gt;getClickAction() );
+                }
+                
+                break;
+            }
+        }
+        
+        mouse_down_button = 0;
+        mouse_down_component = 0;
+    }
+    
+private:
+    Component * mouse_over_component;
+    Component * mouse_down_component;
+    int         mouse_down_button;
+    int         mouse_x;
+    int         mouse_y;
+    
+    void recalculatePositions()
+    {
+        int sw = screen-&gt;getWidth();
+        int sh = screen-&gt;getHeight();
+        
+        vrect.setLocation((sw/2) - (vrect.getWidth()/2), (sh/2) - (vrect.getHeight()/2));
+        
+        int bx = vrect.getLocationX() + BUTTONS_START_X;
+        int by = vrect.getLocationY() + BUTTONS_START_Y - 26;
+        
+        button_main.setLocation( bx, by);
+        bx += button_main.getWidth();
+        
+        button_join.setLocation( bx, by);
+        bx += button_join.getWidth();
+        
+        button_host.setLocation( bx, by);
+        bx += button_host.getWidth();
+        
+        button_options.setLocation( bx, by);
+        bx += button_options.getWidth();
+        
+        button_help.setLocation( bx, by);
+        
+        bx = vrect.getLocationX() + MENU_WIDTH - button_exit.getWidth() - 8;
+        button_exit.setLocation( bx, by);
+        
+        checkbox.setLocation(vrect.getLocationX() + 10, vrect.getLocationY()+20);
+        choice.setLocation(vrect.getLocationX() + 10, vrect.getLocationY()+40);
+        input_field.setLocation(vrect.getLocationX() + 10, vrect.getLocationY()+60);
+        
+        prev_screen_size.x = screen-&gt;getWidth();
+        prev_screen_size.y = screen-&gt;getHeight();
+    }
+    
+    void drawComponents()
+    {
+        for ( size_t n = 0; n &lt; visible_components.size(); n++ )
+        {
+            visible_components[n]-&gt;draw(*screen);
+        }
+    }
+    
+    void handleClickAction( int action )
+    {
+        switch ( action )
+        {
+            case CA_MAIN:
+                break;
+            
+            case CA_JOIN:
+                break;
+                
+            case CA_HOST:
+                break;
+                
+            case CA_OPTIONS:
+                break;
+                
+            case CA_HELP:
+                break;
+                
+            case CA_EXIT:
+                ActionManager::runAction(&quot;quit&quot;);
+                break;
+        }
+
+    }
+};
+
+
+MainMenuScene::MainMenuScene()
+{
+    addLayer( new BackgroundImageLayer() );
+    
+    menu_layer = new MainMenuLayer();
+    addLayer( menu_layer );
+}
+
+MainMenuScene::~MainMenuScene()
+{
+    
+}
+
+void MainMenuScene::logic()
+{
+    
+}
+
+void MainMenuScene::handleMouseLocation(int x, int y)
+{
+    menu_layer-&gt;handleMouseLocation(x, y);
+}
+
+void MainMenuScene::handleMouseDown(int x, int y, int button)
+{
+    menu_layer-&gt;handleMouseDown(x, y, button);
+}
+
+void MainMenuScene::handleMouseUp(int x, int y, int button)
+{
+    menu_layer-&gt;handleMouseUp(x, y, button);
+    
+}
\ No newline at end of file

Added: trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.hpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Scenes/MainMenuScene.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,34 @@
+/* 
+ * File:   MainMenuScene.hpp
+ * Author: krom
+ *
+ * Created on February 16, 2013, 10:29 PM
+ */
+
+#ifndef MAINMENUSCENE_HPP
+#define	MAINMENUSCENE_HPP
+
+#include &quot;2D/Scene.hpp&quot;
+
+class MainMenuLayer;
+
+class MainMenuScene : public Scene
+{
+public:
+    MainMenuScene();
+    ~MainMenuScene();
+    
+    void logic();
+    
+private:
+    
+    MainMenuLayer * menu_layer;
+    
+    void handleMouseLocation(int x, int y);
+    void handleMouseDown(int x, int y, int button);
+    void handleMouseUp(int x, int y, int button);
+    
+};
+
+#endif	/* MAINMENUSCENE_HPP */
+

Modified: trunk/netpanzer/src/NetPanzer/System/SDLVideo.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/System/SDLVideo.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/System/SDLVideo.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -195,7 +195,6 @@
  
 void SDLVideo::doScreenshoot()
 {
-    // this is called blind faith
     static NTimer timer(1000);
  
     if ( ! timer.isTimeOut() )

Modified: trunk/netpanzer/src/NetPanzer/Units/UnitBase.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Units/UnitBase.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Units/UnitBase.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -69,9 +69,6 @@
     {
         return id;
     }
-
-protected:
-    UnitBase *groupLinkNext;
 };
 
 #endif // ** _UNITBASE_HPP

Modified: trunk/netpanzer/src/NetPanzer/Units/Vehicle.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Units/Vehicle.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Units/Vehicle.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -17,8 +17,9 @@
 */
 #ifndef _VEHICLE_HPP
 #define _VEHICLE_HPP
-#include &lt;string&gt;
 
+#include &quot;Core/CoreTypes.hpp&quot;
+
 #include &quot;Units/UnitBase.hpp&quot;
 #include &quot;Util/Timer.hpp&quot;
 #include &quot;Units/UnitOpcodes.hpp&quot;
@@ -75,8 +76,8 @@
 
     UnitSelectionBox select_info_box;
     
-    std::string soundSelect;
-    std::string fireSound;
+    NPString soundSelect;
+    NPString fireSound;
     unsigned short weaponType;
 
     Timer unit_state_timer;

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/BoxedLabel.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/BoxedLabel.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/BoxedLabel.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -30,8 +30,8 @@
      BoxedLabel(int x, int y, int w, const NPString&amp; t, PIX color, PIX bgcolor, bool hasBorder = false)
     {
         text = t;
-        background = bgcolor;
-        foreground = color;
+        background_color = bgcolor;
+        text_color = color;
         position.x = x;
         position.y = y;
         setSize(w, 16);
@@ -41,12 +41,12 @@
     void draw(Surface &amp;dest)
     {
         iRect r(position.x, position.y, size.x, size.y);
-        dest.FillRoundRect(r, 3, background);
+        dest.FillRoundRect(r, 3, background_color);
         if ( bordered )
         {
             dest.RoundRect(r, 3, Color::lightGray);
         }
-        dest.bltStringCenteredInRect(r, getText().c_str(), foreground );
+        dest.bltStringCenteredInRect(r, getText().c_str(), text_color);
     }
     
     void render()
@@ -65,6 +65,8 @@
 private:
     NPString text;
     bool bordered;
+    PIX background_color;
+    PIX text_color;
 };
 
 #endif	/* BOXEDLABEL_HPP */

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Button.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Button.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Button.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -31,10 +31,10 @@
     position.zero();
     label.clear();
     bstate = BNORMAL;
+    painted_bstate = BMAX_STATE;
     memset(borders, 0, sizeof(borders));
     extraBorder = 0;
     clickAction = 0;
-    dirty = true;
 }
 
 Button::~Button()
@@ -57,13 +57,147 @@
     clickAction = action;
 }
 
+void Button::setTextColors(PIX normal, PIX over, PIX pressed, PIX disabled)
+{
+    textColors[BNORMAL] = normal;
+    textColors[BOVER] = over;
+    textColors[BPRESSED] = pressed;
+    textColors[BDISABLED] = disabled;
+    painted_bstate = BMAX_STATE;
+}
+
+void Button::setLabel(const NPString&amp; l)
+{
+    label = l;
+    painted_bstate = BMAX_STATE;
+}
+
+void Button::setImage( PtrArray&lt;Surface&gt;&amp; sl )
+{
+    background_images.deleteAll();
+    background_images.clear();
+
+    for ( size_t n = 0; n &lt; sl.size(); n++ )
+    {
+        background_images.push_back(sl[n]);
+    }
+
+    sl.clear();
+
+    setSize(background_images[0]-&gt;getWidth(), background_images[0]-&gt;getHeight());
+    painted_bstate = BMAX_STATE;
+}
+
+void Button::enable()
+{
+    if ( bstate == BDISABLED )
+    {
+        bstate = BNORMAL;
+    }
+}
+
+void Button::disable()
+{
+    if ( bstate != BDISABLED )
+    {
+        bstate = BDISABLED;
+    }
+}
+
+void Button::setExtraBorder()
+{
+    if ( !extraBorder )
+    {
+        extraBorder = 1;
+        setSize( size.x, size.y);
+        painted_bstate = BMAX_STATE;
+    }
+}
+
+void Button::clearExtraBorder()
+{
+    if ( extraBorder )
+    {
+        extraBorder = 0;
+        setSize( size.x, size.y);
+        painted_bstate = BMAX_STATE;
+    }
+}
+
+
+void Button::setUnitSelectionBorder()
+{
+    setExtraBorder();
+    borders[BNORMAL]   = Color::darkGray;
+    borders[BOVER]     = Color::red;
+    borders[BPRESSED]  = Color::darkGray;
+    borders[BDISABLED] = Color::darkGray;
+    painted_bstate = BMAX_STATE;
+}
+
+void Button::setNormalBorder()
+{
+    setExtraBorder();
+    borders[BNORMAL]   = topLeftBorderColor;
+    borders[BOVER]     = topLeftBorderColor;
+    borders[BPRESSED]  = bottomRightBorderColor;
+    borders[BDISABLED] = Color::darkGray;
+    painted_bstate = BMAX_STATE;
+}
+
+void Button::setRedGreenBorder()
+{
+    setExtraBorder();
+    borders[BNORMAL]   = 0;
+    borders[BOVER]     = Color::red;
+    borders[BPRESSED]  = Color::green;
+    borders[BDISABLED] = Color::darkGray;
+    painted_bstate = BMAX_STATE;
+}
+
+void Button::clearBorder()
+{
+    memset(borders, 0, sizeof(borders));
+    painted_bstate = BMAX_STATE;
+}
+
+void Button::setStateOffset(ButtonState state, int x, int y)
+{
+    state_offset[state].x = x;
+    state_offset[state].y = y;
+    painted_bstate = BMAX_STATE;
+}
+
+void Button::setSize(int x, int y)
+{
+    Component::setSize(x+(extraBorder*2), y+(extraBorder*2));
+    painted_bstate = BMAX_STATE;
+}
+
+void Button::setTextButtonSize(int xsize)
+{
+    Component::setSize(xsize+(extraBorder*2), Surface::getFontHeight() + 4 + (extraBorder*2));
+    painted_bstate = BMAX_STATE;
+}
+
+void Button::draw(Surface&amp; dest)
+{
+    if ( painted_bstate != bstate )
+    {
+        render();
+        painted_bstate = bstate;
+    }
+    
+    surface.bltTrans(dest, position.x, position.y);
+}
+
+
 // render
 void
 Button::render()
 {
     surface.fill(0);
-    dirty = false;
-    if (!visible) return;
+
     if ( background_images.size() == 1 )
     {
         background_images[0]-&gt;bltTrans(surface, extraBorder + state_offset[bstate].x, extraBorder + state_offset[bstate].y); // blit full
@@ -74,14 +208,12 @@
     }
     else
     {
-//        surface.fill(componentBodyColor);
         surface.FillRoundRect(surface.getRect(), 3, componentBodyColor);
     }
 
-    if ( borders[bstate][0]|extraBorder ) // only 1 | (binary or)
+    if ( borders[bstate] &amp;&amp; extraBorder )
     {
-        surface.RoundRect(surface.getRect(), 3, borders[bstate][0]);
-//        surface.drawButtonBorder(borders[bstate][0], borders[bstate][1]);
+        surface.RoundRect(surface.getRect(), 3, borders[bstate]);
     }
 
     if ( ! label.empty() )
@@ -96,7 +228,7 @@
 void
 Button::actionPerformed(const mMouseEvent &amp;me)
 {
-    if ( bstate == BDISABLED || !visible)
+    if ( bstate == BDISABLED )
     {
         return;
     }
@@ -105,17 +237,14 @@
                 || me.getID() == mMouseEvent::MOUSE_EVENT_RELEASED)
     {
         bstate = BOVER;
-        dirty = true; // draw text in red
     }
     else if (me.getID() == mMouseEvent::MOUSE_EVENT_EXITED)
     {
         bstate = BNORMAL;
-        dirty = true; // draw defaults;
     }
     else if (me.getID() == mMouseEvent::MOUSE_EVENT_PRESSED)
     {
         bstate = BPRESSED;
-        dirty = true;
     }
     else if (me.getID() == mMouseEvent::MOUSE_EVENT_CLICKED)
     {
@@ -148,22 +277,6 @@
     return b;
 }
 
-void Button::setImage( PtrArray&lt;Surface&gt;&amp; sl )
-{
-    background_images.deleteAll();
-    background_images.clear();
-
-    for ( size_t n = 0; n &lt; sl.size(); n++ )
-    {
-        background_images.push_back(sl[n]);
-    }
-
-    sl.clear();
-
-    setSize(background_images[0]-&gt;getWidth(), background_images[0]-&gt;getHeight());
-    dirty = true;
-}
-
 Button *
 Button::createNewSpecialButton(    const NPString&amp; label,
                                    const iXY&amp; loc,

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Button.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Button.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Button.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -45,13 +45,6 @@
     
 protected:
     
-    typedef enum
-    {
-        BORDER_TOP_LEFT    = 0,
-        BORDER_BOTTOM_RIGHT = 1,
-        BORDER_COLOR_MAX
-    } BorderColorDef;
-    
     std::string label;
        
     PIX textColors[BMAX_STATE];
@@ -61,19 +54,22 @@
    
     void render();
     ButtonState bstate;
+    ButtonState painted_bstate;
    
     void resetState()
     {
         bstate = BNORMAL;
-        dirty = true;
+        painted_bstate = BMAX_STATE;
     }
 
 public:
-    PIX borders[BMAX_STATE][BORDER_COLOR_MAX];
+    PIX borders[BMAX_STATE];
     
     Button();
 
     virtual ~Button();
+    
+    virtual void draw(Surface&amp; dest);
 
     static Button * createTextButton(   const NPString&amp; label,
                                         const iXY&amp; loc,
@@ -87,132 +83,30 @@
 
     void setAction( Action * action );
     
-    void setTextColors( PIX normal, PIX over, PIX pressed, PIX disabled)
-    {
-        textColors[BNORMAL] = normal;
-        textColors[BOVER] = over;
-        textColors[BPRESSED] = pressed;
-        textColors[BDISABLED] = disabled;
-    }
-
-    void setLabel(const std::string&amp; l)
-    {
-        label = l;
-        dirty = true;
-    }
-   
+    void setTextColors( PIX normal, PIX over, PIX pressed, PIX disabled);
+    void setLabel(const NPString&amp; l);
+    const std::string&amp; getLabel() const { return label; }
     void setImage( PtrArray&lt;Surface&gt;&amp; sl );
     
-    void enable()
-    {
-        if ( bstate == BDISABLED )
-        {
-            bstate = BNORMAL;
-            dirty = true;
-        }
-    }
+    void enable();
+    void disable();
+    bool isEnabled() const { return bstate != BDISABLED; }
     
-    void disable()
-    {
-        if ( bstate != BDISABLED )
-        {
-            bstate = BDISABLED;
-            dirty = true;
-        }
-    }
-    
-    bool isEnabled()
-    {
-        return bstate != BDISABLED;
-    }
-    
-    void setUnitSelectionBorder()
-    {
-        setExtraBorder();
-        borders[BNORMAL][BORDER_TOP_LEFT]       = Color::darkGray;
-        borders[BNORMAL][BORDER_BOTTOM_RIGHT]   = Color::darkGray;
-        borders[BOVER][BORDER_TOP_LEFT]         = Color::red;
-        borders[BOVER][BORDER_BOTTOM_RIGHT]     = Color::red;
-        borders[BPRESSED][BORDER_TOP_LEFT]      = Color::darkGray;
-        borders[BPRESSED][BORDER_BOTTOM_RIGHT]  = Color::darkGray;
-        borders[BDISABLED][BORDER_TOP_LEFT]     = Color::darkGray;
-        borders[BDISABLED][BORDER_BOTTOM_RIGHT] = Color::darkGray;
-        dirty = true;
-    }
-   
-    void setNormalBorder()
-    {
-        setExtraBorder();
-        borders[BNORMAL][BORDER_TOP_LEFT]       = topLeftBorderColor;
-        borders[BNORMAL][BORDER_BOTTOM_RIGHT]   = bottomRightBorderColor;
-        borders[BOVER][BORDER_TOP_LEFT]         = topLeftBorderColor;
-        borders[BOVER][BORDER_BOTTOM_RIGHT]     = bottomRightBorderColor;
-        borders[BPRESSED][BORDER_TOP_LEFT]      = bottomRightBorderColor;
-        borders[BPRESSED][BORDER_BOTTOM_RIGHT]  = topLeftBorderColor;
-        borders[BDISABLED][BORDER_TOP_LEFT]     = Color::darkGray;
-        borders[BDISABLED][BORDER_BOTTOM_RIGHT] = Color::darkGray;
-        dirty = true;
-    }
+    void setExtraBorder();
+    void clearExtraBorder();
+    void setUnitSelectionBorder();   
+    void setNormalBorder();
+    void setRedGreenBorder();
+    void clearBorder();
 
-    void setRedGreenBorder()
-    {
-        setExtraBorder();
-        borders[BNORMAL][BORDER_TOP_LEFT]       = 0;
-        borders[BNORMAL][BORDER_BOTTOM_RIGHT]   = 0;
-        borders[BOVER][BORDER_TOP_LEFT]         = Color::red;
-        borders[BOVER][BORDER_BOTTOM_RIGHT]     = Color::darkRed;
-        borders[BPRESSED][BORDER_TOP_LEFT]      = Color::green;
-        borders[BPRESSED][BORDER_BOTTOM_RIGHT]  = Color::darkGreen;
-        borders[BDISABLED][BORDER_TOP_LEFT]     = Color::darkGray;
-        borders[BDISABLED][BORDER_BOTTOM_RIGHT] = Color::darkGray;
-        dirty = true;
-    }
-
-    void setStateOffset(ButtonState state, int x, int y)
-    {
-        state_offset[state].x = x;
-        state_offset[state].y = y;
-    }
+    void setStateOffset(ButtonState state, int x, int y);
+       
+    void setSize(int x, int y);
+    void setTextButtonSize(int xsize);
     
-    void clearBorder()
-    {
-        memset(borders, 0, sizeof(borders));
-        dirty = true;
-    }
-   
-    void setSize(int x, int y)
-    {
-        Component::setSize(x+(extraBorder*2), y+(extraBorder*2));
-    }
-
-    void setTextButtonSize(int xsize)
-    {
-        Component::setSize(xsize+(extraBorder*2), Surface::getFontHeight() + 4 + (extraBorder*2));
-    }
-   
-    void setExtraBorder()
-    {
-        if ( !extraBorder )
-        {
-            extraBorder = 1;
-            setSize( size.x, size.y);
-        }
-    }
-   
-    void clearExtraBorder()
-    {
-        if ( extraBorder )
-        {
-            extraBorder = 0;
-            setSize( size.x, size.y);
-        }
-    }
-
-    const std::string&amp; getLabel() const
-    {
-        return label;
-    }
-
+    unsigned getWidth() const { return size.x; }
+    unsigned getHeight() const { return size.y; }
+    
     virtual void actionPerformed(const mMouseEvent &amp;me);
 }; // end Button
 

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/CheckBox.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/CheckBox.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/CheckBox.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -15,3 +15,58 @@
 along with this program; if not, write to the Free Software
 Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
+
+#include &quot;CheckBox.hpp&quot;
+#include &quot;2D/Color.hpp&quot;
+#include &quot;ViewGlobals.hpp&quot;
+
+CheckBox::CheckBox(const int x, const int y, const NPString&amp; label, bool* state)
+    : Component(), label(label), state(state)
+{
+    setSize( 20+label.length()*8, 14);
+    setLocation(x, y);
+    textColor = componentActiveTextColor;
+}
+
+void CheckBox::draw(Surface&amp; s)
+{
+    iRect r(position.x, position.y, 14, 14);
+    s.FillRoundRect( r,2,  componentBodyColor);
+
+    r.grow(-1,-1);
+    s.RoundRect( r, 2, textColor);
+
+    s.bltString(r.getLocationX() + 17, r.getLocationY() + 1, label.c_str(), textColor);
+
+    if ( *state )
+    {
+        int x = r.getLocationX() + 2;
+        int y = r.getLocationY() + 5;
+        s.drawLine(x, y, x+3, y+3, textColor);
+        y += 1;
+        s.drawLine(x, y, x+3, y+3, textColor);
+        y+=3;
+        x+=3;
+        s.drawLine(x, y, x+3, y-6, textColor);
+        y -= 1;
+        s.drawLine(x, y, x+3, y-6, textColor);
+    }
+}
+
+void CheckBox::actionPerformed(const mMouseEvent&amp; me)
+{
+    if (    ( me.getID() == mMouseEvent::MOUSE_EVENT_CLICKED )
+         &amp;&amp; ( me.getModifiers() &amp; InputEvent::BUTTON1_MASK) )
+    {
+        *state = !(*state);
+        onStateChanged();
+    }
+    else if ( me.getID() == mMouseEvent::MOUSE_EVENT_ENTERED )
+    {
+        textColor = componentFocusTextColor;
+    }
+    else if ( me.getID() == mMouseEvent::MOUSE_EVENT_EXITED )
+    {
+        textColor = componentActiveTextColor;
+    }
+}
\ No newline at end of file

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/CheckBox.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/CheckBox.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/CheckBox.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -21,105 +21,37 @@
 
 #include &quot;Component.hpp&quot;
 #include &quot;MouseEvent.hpp&quot;
-#include &quot;ViewGlobals.hpp&quot;
-#include &quot;Actions/Action.hpp&quot;
+#include &quot;Core/CoreTypes.hpp&quot;
 
+
 //--------------------------------------------------------------------------
 class CheckBox : public Component
 {
 public:
-    CheckBox(const int x, const int y, const NPString&amp; label, bool* state, Action * a = 0)
-            : Component(), label(label), state(state), action(a)
-    {
-        setSize( 20+label.length()*8, 14);
-        setLocation(x, y);
-        textColor = componentActiveTextColor;
-    }
+    CheckBox(const int x, const int y, const NPString&amp; label, bool* state);
 
-    virtual ~CheckBox()
-    {
-        if ( action &amp;&amp; ! action-&gt;isShared() )
-        {
-            delete action;
-            action = 0;
-        }
-    }
-
-    const std::string&amp; getLabel() const
-    {
-        return label;
-    }
+    const NPString&amp; getLabel() const { return label; }
     
-    void setLabel(const std::string&amp; label)
+    void setLabel(const NPString&amp; label)
     {
         CheckBox::label = label;
         setSize( 20+label.length()*8, 14);
     }
-    
-    void setAction(Action * a)
-    {
-        if ( action &amp;&amp; ! action-&gt;isShared() )
-        {
-            delete action;
-        }
-        action = a;
-    }
-    
+
+protected:
+    virtual void onStateChanged() {}
+        
 private:
-    std::string label;
+    NPString label;
     bool*   state;
 
     PIX textColor;
-
-    Action * action;
     
     void render() {}
     
-    void draw(Surface&amp; s)
-    {
-        iRect r(position.x, position.y, 14, 14);
-        s.FillRoundRect( r,2,  componentBodyColor);
-        
-        r.grow(-1,-1);
-        s.RoundRect( r, 2, textColor);
-        
-        s.bltString(r.getLocationX() + 17, r.getLocationY() + 1, label.c_str(), textColor);
-        
-        if ( *state )
-        {
-            int x = r.getLocationX() + 2;
-            int y = r.getLocationY() + 5;
-            s.drawLine(x, y, x+3, y+3, textColor);
-            y += 1;
-            s.drawLine(x, y, x+3, y+3, textColor);
-            y+=3;
-            x+=3;
-            s.drawLine(x, y, x+3, y-6, textColor);
-            y -= 1;
-            s.drawLine(x, y, x+3, y-6, textColor);
-        }
-    }
+    void draw(Surface&amp; s);
     
-    void actionPerformed(const mMouseEvent &amp;me)
-    {
-        if (    ( me.getID() == mMouseEvent::MOUSE_EVENT_CLICKED )
-             &amp;&amp; ( me.getModifiers() &amp; InputEvent::BUTTON1_MASK) )
-        {
-            *state = !(*state);
-            if ( action )
-            {
-                action-&gt;execute();
-            }
-        }
-        else if ( me.getID() == mMouseEvent::MOUSE_EVENT_ENTERED )
-        {
-            textColor = componentFocusTextColor;
-        }
-        else if ( me.getID() == mMouseEvent::MOUSE_EVENT_EXITED )
-        {
-            textColor = componentActiveTextColor;
-        }
-    }
+    void actionPerformed(const mMouseEvent &amp;me);
     
 };
 

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Choice.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Choice.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Choice.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -17,11 +17,11 @@
 */
 
 #include &lt;algorithm&gt;
-#include &quot;Views/Components/Choice.hpp&quot;
-#include &quot;Views/Components/View.hpp&quot;
-#include &quot;Views/Components/StateChangedCallback.hpp&quot;
+#include &quot;Choice.hpp&quot;
 #include &quot;ViewGlobals.hpp&quot;
 
+#include &quot;2D/Color.hpp&quot;
+
 enum { ChoiceItemHeight = 14 };
 
 //---------------------------------------------------------------------------
@@ -47,24 +47,6 @@
 }
 
 //---------------------------------------------------------------------------
-void Choice::select(const std::string&amp; item)
-{
-    for(size_t i = 0; i &lt; choiceList.size(); i++) {
-        if(choiceList[i] == item) {
-            if(index == i)
-                return;
-
-            mouseover = index = i;
-            onSelectionChanged();
-            if(callback)
-                callback-&gt;stateChanged(this);
-
-            return;
-        }
-    }
-}
-
-//---------------------------------------------------------------------------
 void Choice::select(size_t index)
 {
     assert(index &lt; choiceList.size());
@@ -74,8 +56,6 @@
 
     Choice::index = mouseover = index;
     onSelectionChanged();
-    if(callback)
-        callback-&gt;stateChanged(this);
 }
 
 //---------------------------------------------------------------------------
@@ -122,8 +102,6 @@
 
         index = mouseover;
         onSelectionChanged();
-        if(callback)
-            callback-&gt;stateChanged(this);
     }
     else if ( me.getID() == mMouseEvent::MOUSE_EVENT_EXITED )
     {

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Choice.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Choice.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Choice.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -23,9 +23,8 @@
 
 #include &quot;Component.hpp&quot;
 #include &quot;MouseEvent.hpp&quot;
+#include &quot;Core/CoreTypes.hpp&quot;
 
-class StateChangedCallback;
-
 //--------------------------------------------------------------------------
 class Choice : public Component
 {
@@ -36,7 +35,6 @@
     bool                isOpen;
     size_t              mouseover;
     int                 real_y;
-    StateChangedCallback* callback;
 
     NPString label;
     
@@ -44,8 +42,7 @@
     virtual void onSelectionChanged() {}
 
 public:
-    Choice(StateChangedCallback* newcallback = 0)
-            : callback(newcallback)
+    Choice()
     {
         reset();
     }
@@ -67,16 +64,10 @@
         return index;
     }
 
-    void   select(const std::string&amp; item);
     void   select(size_t index);
     void   setMinWidth(int minWidth);
 
     void   setLabel(const NPString&amp; label) { this-&gt;label = label; }
-    
-    void setStateChangedCallback(StateChangedCallback* newcallback)
-    {
-        callback = newcallback;
-    }
 
     virtual void draw(Surface &amp;dest);
     virtual void render()

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Component.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Component.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Component.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -27,12 +27,8 @@
 //---------------------------------------------------------------------------
 void Component::reset()
 {
-    foreground = gForeground;
-    background = gBackground;
     size.zero();
     position.zero();
-    enabled    = true;
-    visible    = true;
     surface.free();
 
 } // end Component::reset

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Component.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Component.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Component.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -15,31 +15,23 @@
 along with this program; if not, write to the Free Software
 Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
+
 #ifndef __Component_hpp__
 #define __Component_hpp__
 
-#include &lt;string&gt;
-
-#include &quot;2D/Color.hpp&quot;
 #include &quot;2D/Surface.hpp&quot;
 #include &quot;Types/iXY.hpp&quot;
 #include &quot;Types/iRect.hpp&quot;
-#include &quot;Util/Log.hpp&quot;
 
 class mMouseEvent;
-class View;
 
 //--------------------------------------------------------------------------
 class Component
 {
 protected:
-    PIX     background;
-    PIX     foreground;
-    iXY     size;
     iXY     position;
+    iXY     size;
     Surface surface;
-    bool    enabled;
-    bool    visible;
     bool    dirty;
 
     static int borderSize;
@@ -47,7 +39,7 @@
     void reset();
 
 public:
-    Component()
+    Component() : clickAction(0)
     {
         reset();
     }
@@ -87,24 +79,6 @@
         setLocation(p.x, p.y);
     }
 
-    void show()
-    {
-        if (!visible)
-        {
-            visible = true;
-            dirty=true;
-        }
-    }
-
-    void hide()
-    {
-        if (visible)
-        {
-            visible = false;
-            dirty=true;
-        }
-    }
-
     virtual void draw(Surface &amp;dest)
     {
         if ( dirty )
@@ -116,10 +90,15 @@
     virtual void render() = 0;
     virtual void actionPerformed(const mMouseEvent &amp;me) = 0;
     virtual void handleKeyboard() {}
+    
+    inline void setClickAction(int ca) { clickAction = ca; }
+    inline int getClickAction() const { return clickAction; }
 
 private:
     Component(const Component&amp;);
     void operator=(const Component&amp;);
+    
+    int clickAction;
 }; // end Component
 
 #endif // end __Component_hpp__

Deleted: trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,554 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &lt;algorithm&gt;
-#include &quot;Views/Components/Desktop.hpp&quot;
-#include &quot;Interfaces/KeyboardInterface.hpp&quot;
-#include &quot;Util/TimerInterface.hpp&quot;
-#include &quot;Interfaces/MouseInterface.hpp&quot;
-
-#include &quot;Views/Components/Label.hpp&quot;
-
-using std::min;
-using std::max;
-
-PtrArray&lt;View&gt; Desktop::views;
-View     *Desktop::focus;
-Component *Desktop::keyboardFocusComponent = 0;
-iXY       Desktop::lMouseDownPos;
-iXY       Desktop::rMouseDownPos;
-iXY       Desktop::prevMousePos;
-int       Desktop::prevButton;
-View     *Desktop::prevMouseView;
-View     *Desktop::lMouseView;
-View     *Desktop::rMouseView;
-
-
-/////////////////////////////////////////////////////////////////////////////
-// Class definitions.
-/////////////////////////////////////////////////////////////////////////////
-
-// Desktop constructor
-//--------------------------------------------------------------------------
-// Purpose:
-//--------------------------------------------------------------------------
-Desktop::Desktop()
-{
-    focus         = 0;
-    prevButton    = 0;
-    prevMouseView = 0;
-} // end Desktop constructor
-
-// manage
-//--------------------------------------------------------------------------
-// Purpose: Manages the window manager.  Check for button presses, actions
-//          occur, which window to occur in, etc.
-//--------------------------------------------------------------------------
-void Desktop::manage(int mouseX, int mouseY, int curButton)
-{
-    iXY mousePos(mouseX, mouseY);
-    View * mouseView = findViewContaining(mousePos);
-
-    MouseInterface::setCursor(&quot;default.bmp&quot;);
-
-    // Check for mouseEnter and mouseExit.
-    if (mouseView != prevMouseView)
-    {
-        if ( prevMouseView )
-        {
-            prevMouseView-&gt;mouseExit(prevMouseView-&gt;getScreenToClientPos(mousePos));
-        }
-        
-        if ( mouseView )
-        {
-            mouseView-&gt;mouseEnter(mouseView-&gt;getScreenToClientPos(mousePos));
-        }
-    }
-
-    if (mouseView != 0)
-    {
-        mouseView-&gt;mouseMove(mouseView-&gt;getScreenToClientPos(prevMousePos), mouseView-&gt;getScreenToClientPos(mousePos));
-    }
-
-    //////////////////////////////////////////////////////////////////////////
-    //
-    // handle left mouse button
-    //
-    //////////////////////////////////////////////////////////////////////////
-
-    if ( curButton &amp; MouseInterface::left_button_mask )
-    {
-        // The button is down.  See if it just got pressed, or if it was pressed
-        // before and is being dragged.
-        if (!(prevButton &amp; MouseInterface::left_button_mask))
-        {
-            // The mouse button just got pressed. Remember the initial place
-            // where it got pressed.
-            lMouseDownPos = mousePos;
-
-            if ( ! lMouseView )
-            {
-                lMouseView = mouseView;
-                if (lMouseView != 0)
-                {
-                    lMouseView-&gt;lMouseDown(lMouseView-&gt;getScreenToClientPos(mousePos));
-                    if (focus != lMouseView)
-                    {
-                        activate(lMouseView);
-                    }
-                }
-            }
-        }
-        else
-        {
-            if (lMouseView != 0)
-            {
-                lMouseView-&gt;lMouseDrag(lMouseView-&gt;getScreenToClientPos(lMouseDownPos), lMouseView-&gt;getScreenToClientPos(prevMousePos), lMouseView-&gt;getScreenToClientPos(mousePos));
-            }
-        }
-    }
-    else
-    {
-        // The mouse button is up.
-        //See if it just got released, or if it was up before.
-        if (prevButton &amp; MouseInterface::left_button_mask)
-        {
-            // The mouse button just got released.  If it was on top of a window
-            // before, then tell the window that the button was released
-            if ( lMouseView )
-            {
-                lMouseView-&gt;lMouseUp(lMouseView-&gt;getScreenToClientPos(lMouseDownPos), lMouseView-&gt;getScreenToClientPos(mousePos));
-            }
-        }
-
-        lMouseView = 0;
-    }
-
-    //////////////////////////////////////////////////////////////////////////
-    //
-    // Handle right mouse button.
-    //
-    //////////////////////////////////////////////////////////////////////////
-
-    if (curButton &amp; MouseInterface::right_button_mask)
-    {
-        // The button is down.  See if it just got pressed, or if it was pressed
-        // before and is being dragged.
-        if (!(prevButton &amp; MouseInterface::right_button_mask))
-        {
-            // The mouse button just got pressed. Remember the initial place
-            // where it got pressed.
-            rMouseDownPos = mousePos;
-
-            rMouseView = mouseView;
-            if (rMouseView != 0)
-            {
-                // No standard mouse actions.  Tell the window that the mouse
-                // just got pressed.
-                rMouseView-&gt;rMouseDown(rMouseView-&gt;getScreenToClientPos(mousePos));
-            }
-        }
-        else
-        {
-            // The mouse was down before and is still down.
-
-            if (rMouseView != 0)
-            {
-                rMouseView-&gt;rMouseDrag(rMouseView-&gt;getScreenToClientPos(rMouseDownPos), rMouseView-&gt;getScreenToClientPos(prevMousePos), rMouseView-&gt;getScreenToClientPos(mousePos));
-            }
-        }
-    }
-    else
-    {
-        // The mouse button is up.
-        //See if it just got released, or if it was up before.
-        if (prevButton &amp; MouseInterface::right_button_mask)
-        {
-            // The mouse button just got released.  If it was on top of a window
-            // before, then tell the window that the button was released
-            if (rMouseView != 0)
-            {
-                rMouseView-&gt;rMouseUp(rMouseView-&gt;getScreenToClientPos(rMouseDownPos), rMouseView-&gt;getScreenToClientPos(mousePos));
-            }
-        }
-        rMouseView = 0;
-    }
-
-    prevButton   = curButton;
-    prevMousePos = mousePos;
-
-    if ( keyboardFocusComponent )
-    {
-        keyboardFocusComponent-&gt;handleKeyboard();
-        KeyboardInterface::flushCharBuffer();
-    }
-    else if (focus != 0)
-    {
-        focus-&gt;processEvents();
-        KeyboardInterface::flushCharBuffer();
-    }
-    
-    prevMouseView = mouseView;
-
-} // end manage
-
-// draw
-//--------------------------------------------------------------------------
-// Purpose:
-//--------------------------------------------------------------------------
-void Desktop::draw(Surface&amp; surface)
-{
-    for ( size_t n = views.getLastIndex()-1; n &lt; views.getLastIndex(); n-- )
-    {
-        views[n]-&gt;draw(surface);
-    }
-} // end draw
-
-// add
-//--------------------------------------------------------------------------
-// Purpose: Adds a new window to the end of the current window list.
-//--------------------------------------------------------------------------
-void Desktop::add(View *view, bool autoActivate)
-{
-    views.push_back(view);
-    if (autoActivate)
-        activate(view);
-} // end add
-
-// remove
-//--------------------------------------------------------------------------
-// Purpose: Removes a window from the list.
-//--------------------------------------------------------------------------
-void Desktop::remove(View *view)
-{
-    for ( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-    {
-        if ( views[n] == view )
-        {
-            LOGGER.warning(&quot;Erasing view '%s'&quot;, view-&gt;searchName);
-            views.stableErase(n);
-            break;
-        }
-    }
-    // XXX shall delete it?
-} // end add
-
-
-// activate
-//--------------------------------------------------------------------------
-// Purpose:
-//---------------------------------------------------------------------------
-void Desktop::activate(View *view)
-{
-    assert(view != 0);
-
-    // If the top window equals the window to activate, then nothing needs to
-    // be done.
-    if (focus != view) {
-        if (focus != 0)	{
-            focus-&gt;deactivate();
-        }
-
-         if ( ! view-&gt;isAlwaysOnBottom() )
-         {
-            for(size_t i = 0; i&lt;views.size(); i++)
-            {
-                if(views[i] == view)
-                {
-                    for(size_t i2 = i; i2 &gt;= 1; i2--)
-                    {
-                        views[i2] = views[i2-1];
-                    }
-                    views[0] = view;
-                    break;
-                }
-            }
-        }
-        focus = view;
-        view-&gt;activate();
-    }
-} // end activate
-
-// findViewContaining
-//--------------------------------------------------------------------------
-View *Desktop::findViewContaining(iXY pos)
-{
-    for ( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-    {
-        View* view = views[n];
-        if( view-&gt;isVisible()  &amp;&amp; view-&gt;contains(pos) )
-        {
-            return view;
-        }
-    }
-    return 0;
-} // end findViewContaining
-
-// toggleVisibility
-//--------------------------------------------------------------------------
-// Purpose:
-//--------------------------------------------------------------------------
-void Desktop::toggleVisibility(const char *searchName)
-{
-    for ( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-    {
-        View* view = views[n];
-        if (strcmp(view-&gt;searchName, searchName) == 0)
-        {
-            bool newVis = ! view-&gt;isVisible();
-
-            if ( newVis )
-            {
-                view-&gt;show();
-                view-&gt;onShow();
-                view-&gt;doActivate();
-            }
-            else
-            {
-                view-&gt;hide();
-                view-&gt;onHide();
-                view-&gt;doDeactivate();
-            }
-            break;
-        }
-    }
-} // end toggleVisibility
-
-// checkViewPositions
-//--------------------------------------------------------------------------
-// Purpose: Makes sure all the views are on the screen.
-//--------------------------------------------------------------------------
-void Desktop::checkViewPositions(iXY viewarea)
-{
-    for ( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-    {
-        views[n]-&gt;checkArea(viewarea);
-    }
-} // end Desktop::checkViewPositions
-
-// checkResolution
-//--------------------------------------------------------------------------
-// Purpose: Makes sure all the view are on the position.
-//--------------------------------------------------------------------------
-void Desktop::checkResolution(iXY oldResolution, iXY newResolution)
-{
-    for ( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-    {
-        views[n]-&gt;onDesktopResized(oldResolution, newResolution);
-    }
-} // end Desktop::checkResolution
-
-// setActiveView
-//--------------------------------------------------------------------------
-// Purpose:
-//--------------------------------------------------------------------------
-void Desktop::setActiveView(const char *searchName)
-{
-    for ( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-    {
-        View* view = views[n];
-        if (strcmp(view-&gt;searchName, searchName) == 0)
-        {
-            // If the view is not active set the view active.
-            if ( ! view-&gt;isActive() )
-            {
-                activate(view);
-            }
-
-            return;
-        }
-    }
-
-} // end setActiveView
-
-//--------------------------------------------------------------------------
-void Desktop::setActiveView(View *v)
-{
-    for ( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-    {
-        View* view = views[n];
-
-        if (v == view) {
-            // If the view is not active set the view active.
-            if ( ! view-&gt;isActive() )
-            {
-                activate(view);
-            }
-
-            return;
-        }
-    }
-
-}
-
-// getViewCount
-//--------------------------------------------------------------------------
-// Purpose: Returns the number of windows in the window manager.
-//--------------------------------------------------------------------------
-int Desktop::getViewCount()
-{
-    return views.size();
-} // end getViewCount
-
-// getViewSearchName
-//--------------------------------------------------------------------------
-// Purpose: Returns the searchName of the specified window.
-//--------------------------------------------------------------------------
-const char *Desktop::getViewSearchName(int winNum)
-{
-    assert(winNum &lt; getViewCount());
-
-    // Returnthe requested windows searchName.
-    return views[winNum]-&gt;searchName;
-} // end getViewSearchName
-
-// getViewStatus
-//--------------------------------------------------------------------------
-// Purpose: Returns the status of the specified window.
-//--------------------------------------------------------------------------
-int Desktop::getViewStatus(const char *searchName)
-{
-    for ( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-    {
-        View* view = views[n];
-
-        if (strcmp(view-&gt;searchName, searchName) == 0) {
-            return view-&gt;status;
-        }
-    }
-
-    return 0;
-} // end getViewStatus
-
-// setVisibility
-//--------------------------------------------------------------------------
-// Purpose:
-//--------------------------------------------------------------------------
-void Desktop::setVisibility(const char *searchName, int isVisible)
-{
-    for ( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-    {
-        View* view = views[n];
-
-        if (strcmp(view-&gt;searchName, searchName) == 0)
-        {
-            if ( isVisible != view-&gt;isVisible() )
-            {
-                if (isVisible)
-                {
-                    view-&gt;show();
-                    view-&gt;onShow();
-                    view-&gt;doActivate();
-                }
-                else
-                {
-                    view-&gt;hide();
-                    view-&gt;onHide();
-                    view-&gt;doDeactivate();
-                }
-            }
-            break;
-        }
-    }
-} // end setVisibility
-
-// setVisibilityNoDoAnything
-//--------------------------------------------------------------------------
-// Purpose: Only changes whether a visibility of the view, no activate or
-//          deactivate calls.
-//--------------------------------------------------------------------------
-void Desktop::setVisibilityNoDoAnything(const char *searchName, int isVisible)
-{
-    for ( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-    {
-        View* view = views[n];
-
-        if (strcmp(view-&gt;searchName, searchName) == 0)
-        {
-            if ( isVisible )
-            {
-                view-&gt;show();
-            }
-            else
-            {
-                view-&gt;hide();
-            }
-            
-            break;
-        }
-    }
-} // end setVisibilityNoDoAnything
-
-// DesktopView
-//---------------------------------------------------------------------------
-DesktopView::DesktopView() : View()
-{
-    setSearchName(&quot;DesktopView&quot;);
-
-    resizeClientArea(iXY(800, 600));
-    moveTo(iXY(0, 0));
-
-    add( new Label( 0, 0,   &quot;Name&quot;, Color::white) );
-    add( new Label( 200, 0, &quot;Status&quot;, Color::white) );
-
-} // end DesktopView::DesktopView
-
-// doDraw
-//---------------------------------------------------------------------------
-void DesktopView::doDraw( Surface &amp;dest )
-{
-    dest.fill(Color::black);
-
-    int yOffset = 10;
-    char strBuf[256];
-
-    for (int i = 0; i &lt; Desktop::getViewCount(); i++) {
-        dest.bltString(0, yOffset, Desktop::getViewSearchName(i), Color::white);
-
-        if ( Desktop::getVisible(Desktop::getViewSearchName(i)) )
-        {
-            sprintf(strBuf, &quot;STATUS_VISIBLE&quot;);
-        }
-        else
-        {
-            sprintf(strBuf, &quot;INVISIBLE&quot;);
-        }
-
-        dest.bltString(200, yOffset, strBuf, Color::white);
-
-        yOffset += Surface::getFontHeight();
-    }
-
-    View::doDraw( dest );
-
-} // end doDraw
-
-// rMouseDrag
-//---------------------------------------------------------------------------
-void DesktopView::rMouseDrag(const iXY&amp;, const iXY &amp;prevPos, const iXY &amp;newPos)
-{
-    moveTo(getLocation() + newPos - prevPos);
-} // end DesktopView::rMouseDrag
-
-// doActivate
-//---------------------------------------------------------------------------
-void DesktopView::doActivate()
-{
-    Desktop::setActiveView(this);
-} // end DesktopView::doActivate

Deleted: trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,154 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-//---------------------------------------------------------------------------
-
-#ifndef __Desktop_hpp__
-#define __Desktop_hpp__
-
-#include &quot;ArrayUtil/PtrArray.hpp&quot;
-#include &quot;Views/Components/View.hpp&quot;
-#include &quot;Util/TimeStamp.hpp&quot;
-#include &quot;Util/Log.hpp&quot;
-
-class Surface;
-class Component;
-
-class Desktop
-{
-private: // Variables
-    static PtrArray&lt;View&gt; views;
-    static View      *focus;
-    static Component *keyboardFocusComponent;
-    static iXY        lMouseDownPos;
-    static iXY        rMouseDownPos;
-    static iXY        prevMousePos;
-    static int        prevButton;
-    static View      *lMouseView;
-    static View      *rMouseView;
-    static View      *prevMouseView;
-
-private: // Functions
-    static void isMouseInBox(int mouseX, int mouseY, int x1, int y1, int x2, int y2);
-
-    static unsigned isMouseOverResizeArea(int mouseX, int mouseY);
-    static bool     isMouseOverMoveArea  (int mouseX, int mouseY);
-
-    static bool   isMouseInView(int mouseX, int mouseY);
-    static View *findViewContaining(iXY p);
-
-public:
-    Desktop();
-
-    static void manage(int mouseX, int mouseY, int curButton);
-    static void activate(View *view);
-    static void toggleVisibility(const char *viewName);
-    static void setVisibility(const char *viewName, int isVisible);
-    static void setVisibilityNoDoAnything(const char *viewName, int isVisible);
-    static void add(View *view, bool autoActivate = true);
-    static void remove(View *view);
-    static void draw(Surface&amp; surface);
-
-    static int         getViewCount();
-    static const char *getViewTitle(int viewNum);
-    static const char *getViewSearchName(int viewNum);
-    static int         getViewStatus(const char *searchName);
-    static void        setActiveView(const char *viewitle);
-    static void        setActiveView(View *view);
-
-    static void toggleVisibility(View *view)
-    {
-        toggleVisibility(view-&gt;getSearchName());
-    }
-
-    static void setVisibility(View *view, int isVisible)
-    {
-        setVisibility(view-&gt;getSearchName(), isVisible);
-    }
-
-    static void setVisibilityAllWindows(int isVisible)
-    {
-        int viewCount = getViewCount();
-
-        for (int i = 0; i &lt; viewCount; i++) {
-            setVisibility(getViewSearchName(i), isVisible);
-        }
-    }
-
-    static void setVisibilityNoDoAnything(View *view, int isVisible)
-    {
-        setVisibilityNoDoAnything(view-&gt;getSearchName(), isVisible);
-    }
-
-    static bool getVisible(const char *searchName)
-    {
-        if (getViewStatus(searchName) &amp; View::STATUS_VISIBLE) {
-            return true;
-        }
-
-        return false;
-    }
-
-    static View *getView(const char *searchName)
-    {
-        for( size_t n = 0; n &lt; views.getLastIndex(); n++ )
-        {
-            if ( ! strcmp(views[n]-&gt;searchName, searchName) )
-            {
-                return views[n];
-            }
-        }
-
-        return 0;
-    }
-
-    static void checkViewPositions(iXY viewarea);
-    static void checkResolution(iXY oldResolution, iXY newResolution);
-
-    static const View *getFocus()
-    {
-        return focus;
-    }
-    
-    static void setFocusView(View *view)
-    {
-        activate(view);
-    }
-    
-    static void setKeyboardFocusComponent(Component *c)
-    {
-        keyboardFocusComponent = c;
-    }
-
-    static Component * getKeyboardFocusComponent() { return keyboardFocusComponent; }
-}
-; // end Desktop
-
-class DesktopView : public View
-{
-public:
-    DesktopView();
-
-    virtual void doDraw( Surface&amp; dest );
-    virtual void rMouseDrag(const iXY &amp;downPos, const iXY &amp;prevPos, const iXY &amp;newPos);
-    virtual void doActivate();
-
-}
-; // end DesktopView
-
-
-#endif // end __Desktop_hpp__

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/InputField.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/InputField.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/InputField.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -21,7 +21,6 @@
 #include &quot;InputField.hpp&quot;
 #include &quot;View.hpp&quot;
 #include &quot;2D/Color.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Interfaces/KeyboardInterface.hpp&quot;
 #include &quot;SDL.h&quot;
 #include &quot;Actions/ActionManager.hpp&quot;
@@ -46,11 +45,6 @@
     
 }
 
-void InputField::render()
-{
-    draw(surface);
-}
-
 void InputField::draw(Surface &amp;dest)
 {
     iRect r;
@@ -58,7 +52,7 @@
 
     dest.FillRoundRect(r, 3, Color::black);
 
-    bool inFocus = Desktop::getKeyboardFocusComponent() == this;
+    bool inFocus = has_focus; // Desktop::getKeyboardFocusComponent() == this;
 
     if ( inFocus )
     {
@@ -92,7 +86,8 @@
 {
     if ( me.getID() == mMouseEvent::MOUSE_EVENT_PRESSED )
     {
-        Desktop::setKeyboardFocusComponent(this);
+        has_focus = true;
+//        Desktop::setKeyboardFocusComponent(this);
     }
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/InputField.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/InputField.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/InputField.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -32,9 +32,8 @@
 protected:
     virtual void draw(Surface &amp;dest);
     virtual void actionPerformed(const mMouseEvent &amp;me);
+    void render() {}
 
-    void render();
-
 public:
     InputField(View * view = 0);
     virtual ~InputField() {}

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Label.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Label.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Label.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -17,18 +17,18 @@
  */
 
 #include &quot;Label.hpp&quot;
-#include &quot;ViewGlobals.hpp&quot;
+#include &quot;ViewGlobals.hpp&quot;
 
 void
 Label::draw(Surface &amp;dest)
 {    
     if ( shadowed )
     {
-        dest.bltStringShadowed(position.x, position.y, text.c_str(), foreground, componentBodyColor);
+        dest.bltStringShadowed(position.x, position.y, text.c_str(), text_color, shadow_color);
     }
     else
     {
-        dest.bltString(position.x, position.y, text.c_str(), foreground);
+        dest.bltString(position.x, position.y, text.c_str(), text_color);
     }
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Label.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Label.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Label.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -21,15 +21,16 @@
 
 #include &quot;Component.hpp&quot;
 #include &quot;Core/CoreTypes.hpp&quot;
+#include &quot;2D/Color.hpp&quot;
 
 class Label:public Component
 {
 public:
-    Label(int x, int y, const NPString&amp; t, PIX color, PIX bgcolor=Color::black, bool shadow=false)
+    Label(int x, int y, const NPString&amp; t, PIX color, PIX shadow_color=Color::black, bool shadow=false)
     {
         text = t;
-        background = bgcolor;
-        foreground = color;
+        this-&gt;shadow_color = shadow_color;
+        text_color = color;
         shadowed = shadow;
         position.x = x;
         position.y = y;
@@ -52,6 +53,8 @@
 private:
     NPString text;
     bool shadowed;
+    PIX shadow_color;
+    PIX text_color;
 };
 
 #endif

Added: trunk/netpanzer/src/NetPanzer/Views/Components/ListBox.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/ListBox.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/ListBox.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,19 @@
+
+#include &quot;ListBox.hpp&quot;
+
+ListBox::ListBox(ListBoxDataSource* data_source)
+    : Component(), data_source(data_source)
+{
+    
+}
+
+ListBox::~ListBox()
+{
+    delete data_source;
+    data_source = 0;
+}
+
+void ListBox::draw(Surface&amp; dest)
+{
+    
+}

Added: trunk/netpanzer/src/NetPanzer/Views/Components/ListBox.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/ListBox.hpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/ListBox.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -0,0 +1,41 @@
+/* 
+ * File:   ListBox.hpp
+ * Author: krom
+ *
+ * Created on February 8, 2013, 5:59 PM
+ */
+
+#ifndef LISTBOX_HPP
+#define	LISTBOX_HPP
+
+#include &quot;Component.hpp&quot;
+#include &quot;Types/iRect.hpp&quot;
+
+class ListBoxDataSource
+{
+public:
+    virtual ~ListBoxDataSource() {}
+    
+    virtual void getElementCount() = 0;
+    virtual void paintRow(size_t row, Surface&amp; dest) = 0;
+    virtual void setSelectedRow(size_t row) = 0;
+};
+
+class ListBox : public Component
+{
+public:
+    ListBox(ListBoxDataSource * data_source);
+    ~ListBox();
+    
+    void draw(Surface&amp; dest);
+    
+private:
+    ListBoxDataSource * data_source;
+    
+    iRect rows_area;
+    
+};
+
+
+#endif	/* LISTBOX_HPP */
+

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/MiniMap.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/MiniMap.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/MiniMap.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -59,7 +59,7 @@
 MiniMap::draw(Surface &amp;dest)
 {
     //regenerate();
-    surface.blt(dest,position.x, position.y); // full blit
+    mapimage.blt(dest,position.x, position.y); // full blit
     drawObjectives(dest);
     drawUnits(dest);
     drawWorldAndMouseBox(dest);
@@ -118,22 +118,22 @@
 MiniMap::regenerate()
 {
     LOGGER.warning(&quot;Regenerating minimap....&quot;);
-    PIX *ptr = surface.getFrame0();
+    PIX *ptr = mapimage.getMem();
     if ( !ptr )
         return;
     
-    xratio = (float)MapInterface::getWidth() / surface.getWidth();    
-    yratio = (float)MapInterface::getHeight() / surface.getHeight();
+    xratio = (float)MapInterface::getWidth() / mapimage.getWidth();    
+    yratio = (float)MapInterface::getHeight() / mapimage.getHeight();
     float mapx;
     float mapy = 0.0f;
     
     PIX *curline = ptr;
     PIX *curptr;
-    for ( int y=0; y&lt;(int)surface.getHeight(); y++)
+    for ( int y=0; y&lt;(int)mapimage.getHeight(); y++)
     {
         curptr = curline;
         mapx = 0.0f;
-        for ( int x=0; x&lt;(int)surface.getWidth(); x++)
+        for ( int x=0; x&lt;(int)mapimage.getWidth(); x++)
         {
             iXY pos(mapx,mapy);
             // XXX Beware, no check for limits, could raise assert and quit the game.
@@ -141,7 +141,7 @@
             curptr++;
             mapx += xratio;
         }
-        curline += surface.getPitch();
+        curline += mapimage.getPitch();
         mapy += yratio;
     }
 }

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/MiniMap.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/MiniMap.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/MiniMap.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -33,6 +33,12 @@
     
     void draw(Surface &amp;dest);
     
+    void setSize(const int x, const int y)
+    {
+        Component::setSize(x, y);
+        mapimage.create(x,y);
+    }
+    
     virtual void render()
     {
         // nothing
@@ -43,7 +49,6 @@
 protected:
     void onMapLoadedEvent()
     {
-        LOGGER.warning(&quot;onMapLoadedEvent received........&quot;);
         regenerate();
     }
     
@@ -60,6 +65,7 @@
     float yratio;
     NTimer blinktimer;
     bool blinkstatus;
+    Surface mapimage;
 };
 
 #endif	/* _MINIMAP_HPP */

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Separator.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Separator.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Separator.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -31,7 +31,7 @@
     Separator(int x, int y, int endx, const NPString&amp; t, PIX color)
     {
         text = t;
-        foreground = color;
+        this-&gt;color = color;
         position.x = x;
         position.y = y;
         xend = endx - x;
@@ -39,11 +39,11 @@
     
     void draw(Surface &amp;dest)
     {
-        dest.drawHLine(position.x, position.y+5, 19, foreground);
+        dest.drawHLine(position.x, position.y+5, 19, color);
         dest.drawHLine(position.x+1, position.y+6, 19, Color::black);
-        dest.bltStringShadowed(position.x+25,position.y, text.c_str(),  foreground, Color::black);
+        dest.bltStringShadowed(position.x+25,position.y, text.c_str(),  color, Color::black);
         int lentxt = 30+dest.getTextLength(text);
-        dest.drawHLine(position.x+lentxt,   position.y+5, xend - lentxt - 1, foreground);
+        dest.drawHLine(position.x+lentxt,   position.y+5, xend - lentxt - 1, color);
         dest.drawHLine(position.x+lentxt+1, position.y+6, xend - lentxt - 1, Color::black);
     }
     
@@ -60,6 +60,7 @@
 private:
     NPString text;
     int xend;
+    PIX color;
 };
 
 #endif	/* SEPARATOR_HPP */

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/View.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/View.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/View.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -18,7 +18,6 @@
 
 
 #include &quot;Views/Components/View.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/Label.hpp&quot;
 #include &quot;Interfaces/MouseInterface.hpp&quot;
 #include &quot;Interfaces/KeyboardInterface.hpp&quot;
@@ -268,7 +267,7 @@
 void View::lMouseDown(const iXY &amp;pos)
 {
     focusComponent = 0;
-    Desktop::setKeyboardFocusComponent(0);
+//    Desktop::setKeyboardFocusComponent(0);
 
     // Check all components for a pressed event.
     for ( size_t n = 0; n != components.getLastIndex(); n++)
@@ -348,7 +347,7 @@
 void View::rMouseDown(const iXY &amp;pos)
 {
     focusComponent = 0;
-    Desktop::setKeyboardFocusComponent(0);
+//    Desktop::setKeyboardFocusComponent(0);
 
     // Check all components for a pressed event.
     for ( size_t n = 0; n != components.getLastIndex(); n++)

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/View.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/View.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/View.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -27,12 +27,11 @@
 #include &quot;MouseEvent.hpp&quot;
 
 #include &lt;algorithm&gt;
-#include &quot;Views/Components/StateChangedCallback.hpp&quot;
 #include &quot;ArrayUtil/PtrArray.hpp&quot;
 
 using namespace std;
 
-class View : public iRect, public StateChangedCallback
+class View : public iRect
 {
 private:
     friend class Desktop;
@@ -94,7 +93,11 @@
     /////////////////////////////////
 
     // These options can be modified on a per View type basis
+public:
     virtual void doDraw( Surface&amp; dest );
+    
+protected:
+    
     virtual void doActivate();
     virtual void doDeactivate();
     virtual void mouseMove(const iXY &amp;prevPos, const iXY &amp;newPos);

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/tChatBox.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/tChatBox.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/tChatBox.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -18,9 +18,10 @@
 #ifndef __tChatBox_hpp__
 #define __tChatBox_hpp__
 
-#include &quot;Views/Components/tVScrollBar.hpp&quot;
 #include &quot;Views/Components/tStringListBox.hpp&quot;
 
+#include &quot;Core/CoreTypes.hpp&quot;
+
 class ChatMessage
 {
 public:
@@ -32,8 +33,8 @@
 class tChatBox : public tStringListBox
 {
 public:
-    tChatBox(iRect rect, StateChangedCallback* newcallback)
-        : tStringListBox(rect, newcallback)
+    tChatBox(iRect rect)
+        : tStringListBox(rect)
     {
         setAutoWrap(true);
     }

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/tHScrollBar.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/tHScrollBar.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/tHScrollBar.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -45,7 +45,7 @@
     bRisestate = NORMAL;
     bLeftstate = NORMAL;
     bRightstate = NORMAL;
-    background = ctWindowsbackground;
+    background_color = ctWindowsbackground;
     SmallChange = 1;
     LargeChange = 10;
 }
@@ -65,7 +65,7 @@
 
 void tHScrollBar::actionPerformed(const mMouseEvent &amp;me)
 {
-    if (!enabled) return;
+    if ( Max &lt; 1 ) return;
     iRect rect_button_Left(position.x, position.y, position.x+bSize, position.y+bSize);
     iRect rect_button_Right(position.x+size.x-bSize, position.y, position.x+size.x, position.y+size.y);
     
@@ -146,7 +146,7 @@
 
 void tHScrollBar::render()
 {
-    surface.fill(background);
+    surface.fill(background_color);
     surface.drawRect(surface.getRect(), ctWindowsBorder);
     if (bLeftstate == PRESSED)
     {
@@ -173,6 +173,7 @@
     {
         bRightNormal.bltTrans(surface, size.x-bSize, 0); // blit full
     }
+    
     if (bRisestate == OVER)
     {
         bRiseOver.bltTrans(surface, bSize+RisePos, 0); // blit full
@@ -196,8 +197,6 @@
 void tHScrollBar::setMax(int newMax)
 {
     Max = newMax;
-    if (Max &lt; 1) enabled = false;
-    else enabled = true;
 }
 
 void tHScrollBar::setMin(int newMin)
@@ -207,7 +206,7 @@
 
 void tHScrollBar::setColor(PIX newColor)
 {
-    background = newColor;
+    background_color = newColor;
     dirty = true;
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/tHScrollBar.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/tHScrollBar.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/tHScrollBar.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -55,6 +55,8 @@
     int LargeChange;
     int SmallChange;
     
+    PIX background_color;
+    
     virtual void render();
     virtual void actionPerformed(const mMouseEvent &amp;me);
     void initScrollBar();

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/tPlayerStateBox.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/tPlayerStateBox.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/tPlayerStateBox.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -25,8 +25,8 @@
 #include &quot;Interfaces/GameConfig.hpp&quot;
 #include &quot;Resources/ResourceManager.hpp&quot;
 
-tPlayerStateBox::tPlayerStateBox(iRect rect, StateChangedCallback* newcallback)
-        : tStringListBox(rect, newcallback)
+tPlayerStateBox::tPlayerStateBox(iRect rect)
+        : tStringListBox(rect)
 {
     DrawFlags = true;
     UpdateState(true);

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/tPlayerStateBox.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/tPlayerStateBox.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/tPlayerStateBox.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -20,7 +20,6 @@
 
 #include &quot;Component.hpp&quot;
 #include &quot;MouseEvent.hpp&quot;
-#include &quot;Views/Components/tVScrollBar.hpp&quot;
 #include &quot;Views/Components/tStringListBox.hpp&quot;
 
 class tPlayerStateBox : public tStringListBox
@@ -30,7 +29,7 @@
     bool ShowTeam;
     Uint8 TeamNumber;
 public:
-    tPlayerStateBox(iRect rect, StateChangedCallback* newcallback);
+    tPlayerStateBox(iRect rect);
 
     virtual int getMaxItemWidth(const DataItem&amp; data);
     virtual void onPaint(Surface &amp;dst, const DataItem&amp; data);

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/tStringListBox.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/tStringListBox.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/tStringListBox.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -18,21 +18,24 @@
 
 
 #include &quot;Views/Components/tStringListBox.hpp&quot;
+#include &quot;Views/Components/tVScrollBar.hpp&quot;
+#include &quot;Views/Components/tHScrollBar.hpp&quot;
 #include &quot;Views/Components/View.hpp&quot;
 #include &quot;Views/Theme.hpp&quot;
 
 #include &quot;Util/StringTokenizer.hpp&quot;
 
+#include &quot;2D/Color.hpp&quot;
+
 #define MAX_CHAT_LINES (2000)
 
-tStringListBox::tStringListBox(iRect rect, StateChangedCallback* newcallback)
+tStringListBox::tStringListBox(iRect rect)
 {
     VScrollBar = 0;
     HScrollBar = 0;
-    callback = newcallback;
     setLocation(rect.getLocation());
     setSize(rect.getWidth(), rect.getHeight());
-    background = ctWindowsbackground;
+    background_color = ctWindowsbackground;
     StartItem = List.end();
     StartSubLine = 0;
     StartWidth = 0;
@@ -229,7 +232,7 @@
 
 void tStringListBox::render()
 {
-    surface.fill(background);
+    surface.fill(background_color);
     if ( Bordered )
     {
         surface.drawRect(surface.getRect(), ctWindowsBorder);
@@ -263,7 +266,7 @@
     
     while ( (row &lt; max_size_y) &amp;&amp; (item != List.end()) )
     {
-        RowPaint.fill(background);
+        RowPaint.fill(background_color);
         if ( SelectedItem == item )
         {
             RowPaint.fill(ctTexteOver);
@@ -292,7 +295,7 @@
 
 void tStringListBox::setColor(PIX newColor)
 {
-    background = newColor;
+    background_color = newColor;
     dirty = true;
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/tStringListBox.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/tStringListBox.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/tStringListBox.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -24,10 +24,9 @@
 #include &quot;Component.hpp&quot;
 #include &quot;MouseEvent.hpp&quot;
 #include &quot;Views/Components/StateChangedCallback.hpp&quot;
-#include &quot;Views/Components/tVScrollBar.hpp&quot;
-#include &quot;Views/Components/tHScrollBar.hpp&quot;
 
-class StateChangedCallback;
+class tVScrollBar;
+class tHScrollBar;
 
 class DataItem
 {
@@ -44,8 +43,6 @@
     void setHasHeader(bool b) { hasHeader = b; dirty = true; }
 
 private:
-    StateChangedCallback* callback;
-    
     enum { ItemHeight = 14 };
     
     tVScrollBar *VScrollBar;
@@ -67,21 +64,19 @@
     bool Bordered;
     bool hasHeader;
     
+    PIX background_color;
+    
     virtual void render();
     virtual void actionPerformed(const mMouseEvent &amp;me);
 public:
 
-    tStringListBox(iRect rect, StateChangedCallback* newcallback = 0);
+    tStringListBox(iRect rect);
     virtual ~tStringListBox() {}
 
     void setSelectable( bool b ) { Selectable = b; SelectedItem = List.end(); dirty = true;}
     void setBordered( bool b ) { Bordered = b; dirty = true; }
     
     virtual void setColor(PIX newColor);
-    virtual void setStateChangedCallback(StateChangedCallback* newcallback)
-    {
-        callback = newcallback;
-    }
     virtual void setVscrollBar(tVScrollBar *newVScrollBar);
     tVScrollBar * getVscrollBar() { return VScrollBar; }
     

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/tVScrollBar.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/tVScrollBar.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/tVScrollBar.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -42,7 +42,7 @@
     bRisestate = NORMAL;
     bUpstate = NORMAL;
     bDownstate = NORMAL;
-    background = ctWindowsbackground;
+    background_color = ctWindowsbackground;
     SmallChange = 1;
     LargeChange = 10;
 }
@@ -62,7 +62,7 @@
 
 void tVScrollBar::actionPerformed(const mMouseEvent &amp;me)
 {
-    if (!enabled) return;
+    if ( Max &lt; 1 ) return;
     iRect rect_button_up(position.x, position.y, position.x+bSize, position.y+bSize);
     iRect rect_button_Down(position.x, position.y+size.y-bSize, position.x+bSize, position.y+size.y);
     
@@ -189,9 +189,20 @@
     }
 }
 
+void tVScrollBar::draw(Surface&amp; dest)
+{
+    if ( dirty )
+    {
+        render();
+        dirty = false;
+    }
+    
+    dest.bltTrans(surface, position.x, position.y);
+}
+
 void tVScrollBar::render()
 {
-    surface.fill(background);
+    surface.fill(background_color);
     surface.drawRect(surface.getRect(), ctWindowsBorder);
     if (bUpstate == PRESSED)
     {
@@ -251,8 +262,6 @@
 void tVScrollBar::setMax(int newMax)
 {
     Max = newMax;
-    if (Max &lt; 1) enabled = false;
-    else enabled = true;
 }
 
 void tVScrollBar::setMin(int newMin)
@@ -262,7 +271,7 @@
 
 void tVScrollBar::setColor(PIX newColor)
 {
-    background = newColor;
+    background_color = newColor;
     dirty = true;
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/tVScrollBar.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/tVScrollBar.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/tVScrollBar.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -55,9 +55,14 @@
     int LargeChange;
     int SmallChange;
     
+    PIX background_color;
+    
     virtual void render();
     virtual void actionPerformed(const mMouseEvent &amp;me);
     void initScrollBar();
+    
+    void draw(Surface&amp; dest);
+    
 public:
 
     tVScrollBar();

Deleted: trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,75 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;AreYouSureExitView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
-#include &quot;Views/Components/Button.hpp&quot;
-#include &quot;2D/Palette.hpp&quot;
-#include &quot;Classes/ScreenSurface.hpp&quot;
-#include &quot;Interfaces/GameManager.hpp&quot;
-#include &quot;Interfaces/StrManager.hpp&quot;
-
-#include &quot;Actions/ActionManager.hpp&quot;
-
-// AreYouSureExitView
-//---------------------------------------------------------------------------
-AreYouSureExitView::AreYouSureExitView() : SpecialButtonView()
-{
-    setSearchName(&quot;AreYouSureExitView&quot;);
-    loaded = false;
-	} // end AreYouSureExitView::AreYouSureExitView
-
-// init
-//---------------------------------------------------------------------------
-void AreYouSureExitView::init()
-{
-    moveTo(iXY(0, 0));
-    resize(iXY(800, 480));
-
-    int x = (getClientRect().getWidth() - (141 * 2 + 20)) / 2;
-    int y = getClientRect().getHeight()/2 + 30;
-    add( Button::createTextButton( _(&quot;YES&quot;), iXY(x, y), 137, ActionManager::getAction(&quot;quit&quot;)));
-    x += 141 + 10;
-    add( Button::createTextButton( _(&quot;NO&quot;), iXY(x, y), 137, ActionManager::getAction(&quot;hide_confirmexit&quot;)));
-    loaded = true;
-} // end AreYouSureExitView::init
-
-// doDraw
-//---------------------------------------------------------------------------
-void AreYouSureExitView::doDraw( Surface&amp; dest )
-{
-    dest.bltLookup(getClientRect(), Palette::darkGray256.getColorArray());
-    //viewArea.drawButtonBorder(r, Color::lightGreen, Color::darkGreen);
-
-    dest.bltStringCenter(_(&quot;Are you sure you wish to exit netPanzer?&quot;), Color::white);
-
-    View::doDraw( dest );
-} // end AreYouSureExitView::doDraw
-
-// doActivate
-//---------------------------------------------------------------------------
-void AreYouSureExitView::doActivate()
-{
-    if ( ! loaded )
-    {
-	init();
-    }
-    Desktop::setActiveView(this);
-
-} // end AreYouSureExitView::doActivate

Deleted: trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureExitView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,38 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __AreYouSureExitView_hpp__
-#define __AreYouSureExitView_hpp__
-
-#include &quot;Views/MainMenu/SpecialButtonView.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-
-//---------------------------------------------------------------------------
-class AreYouSureExitView : public SpecialButtonView
-{
-private:
-    void init();
-    bool loaded;
-	
-public:
-    AreYouSureExitView();
-
-    virtual void doDraw( Surface&amp; dest );
-    virtual void doActivate();
-}; // end AreYouSureExitView
-
-#endif // end __AreYouSureExitView_hpp__

Deleted: trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,79 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
-
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
-
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
-
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;AreYouSureResignView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
-#include &quot;Views/Components/Button.hpp&quot;
-#include &quot;Interfaces/GameManager.hpp&quot;
-#include &quot;Interfaces/StrManager.hpp&quot;
-#include &quot;Particles/ParticleSystem2D.hpp&quot;
-#include &quot;Particles/Particle2D.hpp&quot;
-#include &quot;System/Sound.hpp&quot;
-#include &quot;Classes/ScreenSurface.hpp&quot;
-#include &quot;2D/Palette.hpp&quot;
-#include &quot;Interfaces/GameConfig.hpp&quot;
-#include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
-
-#include &quot;Actions/ActionManager.hpp&quot;
-
-// AreYouSureResignView
-//---------------------------------------------------------------------------
-AreYouSureResignView::AreYouSureResignView() : SpecialButtonView()
-{
-    setSearchName(&quot;AreYouSureResignView&quot;);
-    loaded = false;
-	} // end AreYouSureResignView::AreYouSureResignView
-
-// init
-//---------------------------------------------------------------------------
-void AreYouSureResignView::init()
-{
-    moveTo(iXY(0, 0));
-    resize(iXY(800, 480));
-
-    int x = (getClientRect().getWidth() - (141 * 2 + 20)) / 2;
-    int y = getClientRect().getHeight()/2 + 30;
-    add( Button::createTextButton( _(&quot;YES&quot;), iXY(x, y), 137, ActionManager::getAction(&quot;disconnect&quot;)));
-    x += 141 + 10;
-    add( Button::createTextButton( _(&quot;NO&quot;), iXY(x, y), 137, ActionManager::getAction(&quot;hide_confirmdisconnect&quot;)));
-    loaded = true;
-} // end AreYouSureResignView::init
-
-// doDraw
-//---------------------------------------------------------------------------
-void AreYouSureResignView::doDraw( Surface&amp; dest )
-{
-    dest.bltLookup(getClientRect(), Palette::darkGray256.getColorArray());
-    //viewArea.drawButtonBorder(r, Color::lightGreen, Color::darkGreen);
-
-    dest.bltStringCenter(_(&quot;Are you sure you wish to Resign?&quot;), Color::white);
-
-    View::doDraw( dest );
-} // end AreYouSureResignView::doDraw
-
-// doActivate
-//---------------------------------------------------------------------------
-void AreYouSureResignView::doActivate()
-{
-    if ( ! loaded )
-    {
-	init();
-    }
-    Desktop::setActiveView(this);
-} // end AreYouSureResignView::doActivate

Deleted: trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/AreYouSureResignView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,38 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __AreYouSureResignView_hpp__
-#define __AreYouSureResignView_hpp__
-
-#include &quot;Views/MainMenu/SpecialButtonView.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-
-//---------------------------------------------------------------------------
-class AreYouSureResignView : public SpecialButtonView
-{
-private:
-    void init();
-    bool loaded;
-	
-public:
-    AreYouSureResignView();
-
-    virtual void doDraw( Surface&amp; dest );
-    virtual void doActivate();
-}; // end AreYouSureResignView
-
-#endif // end __AreYouSureResignView_hpp__

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -21,11 +21,14 @@
 #include &quot;Classes/ScreenSurface.hpp&quot;
 #include &quot;Interfaces/KeyboardInterface.hpp&quot;
 #include &quot;Interfaces/ChatInterface.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
+#include &quot;Views/Theme.hpp&quot;
 #include &quot;Views/Components/View.hpp&quot;
-#include &quot;Views/Theme.hpp&quot;
 #include &quot;Views/Components/Button.hpp&quot;
+#include &quot;Views/Components/tVScrollBar.hpp&quot;
+#include &quot;Views/Components/tChatBox.hpp&quot;
+#include &quot;Views/Components/InputField.hpp&quot;
 
+
 #include &quot;Actions/Action.hpp&quot;
 
 #include &quot;Scripts/ScriptManager.hpp&quot;
@@ -140,7 +143,7 @@
     HideWindow = false;
 
     iRect r(0, 15, getWidth()-15, getHeight()-17);
-    ChatList = new tChatBox(r, 0);
+    ChatList = new tChatBox(r);
     vsbChat = new tVScrollBar();
     add(vsbChat);
     vsbChat-&gt;setLargeChange(ChatList-&gt;getNumVisibleLines() -1);
@@ -190,7 +193,8 @@
 
 void ChatView::processEvents()
 {
-    if ( Desktop::getKeyboardFocusComponent() == input )
+//    if ( Desktop::getKeyboardFocusComponent() == input )
+    if ( false )
     {
         if ( (KeyboardInterface::getKeyPressed(SDLK_RETURN) || KeyboardInterface::getKeyPressed(SDLK_KP_ENTER) ) )
         {
@@ -248,10 +252,10 @@
     bHideWindow-&gt;disable();
     bShowWindow-&gt;enable();
     
-    if ( Desktop::getKeyboardFocusComponent() == input )
-    {
-        Desktop::setKeyboardFocusComponent(0);
-    }
+//    if ( Desktop::getKeyboardFocusComponent() == input )
+//    {
+//        Desktop::setKeyboardFocusComponent(0);
+//    }
     
     removeComponent(input);
     removeComponent(switchModeButton);
@@ -331,7 +335,7 @@
         restoreChat();
     }
     
-    Desktop::setKeyboardFocusComponent(input);
+//    Desktop::setKeyboardFocusComponent(input);
 }
 
 void ChatView::openFriendsChat()
@@ -343,7 +347,7 @@
     
     setChatFriends();
     
-    Desktop::setKeyboardFocusComponent(input);
+//    Desktop::setKeyboardFocusComponent(input);
 }
 
 void ChatView::switchChatMode()

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/ChatView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -19,13 +19,14 @@
 #ifndef __CHATVIEW_HPP__
 #define __CHATVIEW_HPP__
 
-#include &quot;Views/Components/tChatBox.hpp&quot;
-#include &quot;Views/Components/InputField.hpp&quot;
-#include &quot;Views/Components/tVScrollBar.hpp&quot;
-#include &quot;Views/Components/tHScrollBar.hpp&quot;
 #include &quot;Views/Game/GameTemplateView.hpp&quot;
 
+#include &quot;Core/CoreTypes.hpp&quot;
+
 class Button;
+class tVScrollBar;
+class tChatBox;
+class InputField;
 
 class ChatView : public GameTemplateView
 {

Deleted: trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,63 +0,0 @@
-/*
-Copyright (C) 2007 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
-
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
-
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
-
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-#include &quot;DisconectedView.hpp&quot;
-
-#include &quot;Interfaces/GameManager.hpp&quot;
-#include &quot;Interfaces/GameConfig.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
-#include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
-#include &quot;Classes/ScreenSurface.hpp&quot;
-
-#include &quot;Util/Log.hpp&quot;
-
-#include &quot;Views/Components/Button.hpp&quot;
-#include &quot;Actions/ActionManager.hpp&quot;
-
-DisconectedView::DisconectedView() : SpecialButtonView()
-{
-    setSearchName(&quot;DisconectedView&quot;);
-}
-
-void
-DisconectedView::init()
-{
-    resize(screen-&gt;getWidth(),screen-&gt;getHeight());
-    moveTo(0,0);
-
-    int bsize = Surface::getTextLength(&quot; &quot;) * 8;
-    
-    add( Button::createTextButton(&quot;Ok&quot;, iXY((getClientRect().getWidth()/2)-(bsize/2), (getClientRect().getHeight()/2)+(Surface::getFontHeight() * 2)),
-                                  bsize, ActionManager::getAction(&quot;disconnect&quot;)));
-}
-
-void
-DisconectedView::doDraw( Surface&amp; dest )
-{
-    dest.bltLookup(*this, Palette::darkGray256.getColorArray());
-    dest.bltStringCenter(disconectMsg.c_str(), Color::white);
-
-    View::doDraw( dest );
-}
-
-void
-DisconectedView::doActivate()
-{
-    init();
-    Desktop::setActiveView(this);
-}

Deleted: trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/DisconectedView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,41 +0,0 @@
-/*
-Copyright (C) 2007 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
-
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
-
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
-
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-#ifndef _DISCONECTEDVIEW_HPP
-#define _DISCONECTEDVIEW_HPP
-
-#include &quot;Views/MainMenu/SpecialButtonView.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-#include &lt;string&gt;
-
-//---------------------------------------------------------------------------
-class DisconectedView : public SpecialButtonView
-{
-private:
-    void init();
-    std::string disconectMsg;
-
-public:
-    DisconectedView();
-
-    virtual void doDraw( Surface&amp; dest );
-    virtual void doActivate();
-    void setMsg(const char * msg) { disconectMsg=msg; }
-};
-
-#endif

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/EndRoundView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/EndRoundView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/EndRoundView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -20,7 +20,6 @@
 #include &quot;EndRoundView.hpp&quot;
 #include &quot;Classes/ScreenSurface.hpp&quot;
 #include &quot;Classes/WorldInputCmdProcessor.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;2D/Palette.hpp&quot;
 #include &quot;Interfaces/PlayerInterface.hpp&quot;
 #include &quot;Interfaces/TeamManager.hpp&quot;

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/GFlagSelectionView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/GFlagSelectionView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/GFlagSelectionView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -28,7 +28,6 @@
 #include &quot;Resources/ResourceManager.hpp&quot;
 #include &quot;Views/Components/Button.hpp&quot;
 #include &quot;Views/Components/Label.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 
 #include &quot;2D/Palette.hpp&quot;
 #include &quot;Network/PlayerRequests/ChangeFlagRequest.hpp&quot;
@@ -48,10 +47,8 @@
         background_images.push_back(s);
 
         setExtraBorder();
-        borders[1][0] = Color::red;
-        borders[1][1] = Color::darkRed;
-        borders[2][0] = Color::green;
-        borders[2][1] = Color::darkGreen;
+        borders[1] = Color::red;
+        borders[2] = Color::green;
     }
 
     void actionPerformed( const mMouseEvent &amp;e)
@@ -68,7 +65,7 @@
 
             CLIENT-&gt;sendMessage(&amp;req, sizeof(req));
 
-            Desktop::setVisibility(&quot;GFlagSelectionView&quot;, false);
+//            Desktop::setVisibility(&quot;GFlagSelectionView&quot;, false);
             COMMAND_PROCESSOR.Flagtimer.reset();
 //            PlayerInterface::getLocalPlayer()-&gt;setStateActive();
         }
@@ -147,7 +144,6 @@
     {
         init();
     }
-    Desktop::setActiveView(this);
 }
 
 void GFlagSelectionView::doDeactivate()

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/GameTemplateView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/GameTemplateView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/GameTemplateView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -18,7 +18,6 @@
 
 
 #include &quot;GameTemplateView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/GameViewGlobals.hpp&quot;
 #include &quot;Interfaces/KeyboardInterface.hpp&quot;
 #include &quot;Classes/ScreenSurface.hpp&quot;
@@ -51,8 +50,7 @@
 {
     View::doActivate();
 
-    Desktop::setFocusView(this);
-
+    
 } // end VehicleSelectionView::doActivate
 
 // mouseMove
@@ -61,12 +59,12 @@
 {
     View::mouseMove(prevPos, newPos);
 
-    if (!MouseInterface::getButtonMask() &amp;&amp; Desktop::getFocus() != this) {
-        Desktop::setFocusView(this);
+//    if (!MouseInterface::getButtonMask() &amp;&amp; Desktop::getFocus() != this) {
+//        Desktop::setFocusView(this);
+//
+//        COMMAND_PROCESSOR.closeSelectionBox();
+//    }
 
-        COMMAND_PROCESSOR.closeSelectionBox();
-    }
-
 } // end GameTemplateView::mouseMove
 
 // doDeactivate

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/GameView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/GameView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/GameView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -24,7 +24,6 @@
 
 
 #include &quot;GameView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Units/UnitInterface.hpp&quot;
 #include &quot;Weapons/ProjectileInterface.hpp&quot;
 #include &quot;Interfaces/MouseInterface.hpp&quot;
@@ -153,11 +152,11 @@
 {
     View::mouseMove(prevPos, newPos);
 
-    if (!MouseInterface::getButtonMask() &amp;&amp; Desktop::getFocus() != this)
-    {
-        Desktop::setFocusView(this);
-        MouseInterface::setCursor(&quot;default.bmp&quot;);
-    }
+//    if (!MouseInterface::getButtonMask() &amp;&amp; Desktop::getFocus() != this)
+//    {
+//        Desktop::setFocusView(this);
+//        MouseInterface::setCursor(&quot;default.bmp&quot;);
+//    }
 
 } // end GameView::mouseMove
 

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/HelpScrollView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/HelpScrollView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/HelpScrollView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -19,7 +19,6 @@
 #include &quot;HelpScrollView.hpp&quot;
 #include &quot;GameView.hpp&quot;
 #include &quot;Views/GameViewGlobals.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Classes/WorldInputCmdProcessor.hpp&quot;
 #include &quot;Interfaces/StrManager.hpp&quot;
 
@@ -30,7 +29,7 @@
     HelpBox-&gt;Add(helpBuf);
 }
 
-HelpScrollView::HelpScrollView() : SpecialButtonView()
+HelpScrollView::HelpScrollView() : View()
 {
     setSearchName(&quot;HelpScrollView&quot;);
 //    setTitle(_(&quot;Help Information&quot;));
@@ -39,7 +38,7 @@
     moveTo(bodyTextRect.getLocation());
     resize(bodyTextRect.getSize());
     iRect r(0, 0, bodyTextRect.getWidth()-20, bodyTextRect.getHeight()-33);
-    HelpBox = new tStringListBox(r, 0);
+    HelpBox = new tStringListBox(r);
     VscrollBar = new tVScrollBar();
     add(VscrollBar);
     HscrollBar = new tHScrollBar();
@@ -147,9 +146,6 @@
 
 void HelpScrollView::doDraw( Surface&amp; dest )
 {
-    if (Desktop::getVisible(&quot;GameView&quot;)) {
-        bltViewBackground(dest);
-    }
 
     View::doDraw( dest );
 } // end HelpScrollView::doDraw
@@ -161,7 +157,7 @@
 
 void HelpScrollView::processEvents()
 {
-    if ( Desktop::getVisible(&quot;GameView&quot;) )
-        COMMAND_PROCESSOR.process(false);
+//    if ( Desktop::getVisible(&quot;GameView&quot;) )
+//        COMMAND_PROCESSOR.process(false);
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/HelpScrollView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/HelpScrollView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/HelpScrollView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -22,7 +22,7 @@
 #include &lt;vector&gt;
 #include &lt;string&gt;
 
-#include &quot;Views/MainMenu/SpecialButtonView.hpp&quot;
+#include &quot;Views/Components/View.hpp&quot;
 #include &quot;2D/Surface.hpp&quot;
 #include &quot;Views/Components/Button.hpp&quot;
 #include &quot;Views/Components/tStringListBox.hpp&quot;
@@ -30,7 +30,7 @@
 #include &quot;Views/Components/tHScrollBar.hpp&quot;
 
 //---------------------------------------------------------------------------
-class HelpScrollView : public SpecialButtonView
+class HelpScrollView : public View
 {
 protected:
     tVScrollBar *VscrollBar;

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/LibView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/LibView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/LibView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -18,7 +18,6 @@
 
 
 #include &quot;LibView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Particles/ParticleSystem2D.hpp&quot;
 #include &quot;Particles/Particle2D.hpp&quot;
 #include &quot;Interfaces/GameConfig.hpp&quot;
@@ -229,7 +228,7 @@
 //---------------------------------------------------------------------------
 void LibView::doActivate()
 {
-    Desktop::setActiveView(this);
+//    Desktop::setActiveView(this);
 } // end LibView::doActivate
 
 // drawEnvironmentInfo

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/LoadingView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -17,7 +17,6 @@
 #include &quot;Interfaces/PlayerInterface.hpp&quot;
 #include &quot;Interfaces/StrManager.hpp&quot;
 
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/Label.hpp&quot;
 #include &quot;Views/Game/VehicleSelectionView.hpp&quot;
 #include &quot;Views/Game/ChatView.hpp&quot;
@@ -28,6 +27,8 @@
 #include &quot;Views/Components/InputField.hpp&quot;
 #include &quot;Actions/ActionManager.hpp&quot;
 
+#include &quot;Util/Log.hpp&quot;
+
 list&lt;string&gt; LoadingView::lines;
 bool LoadingView::dirty = true;
 
@@ -110,7 +111,7 @@
 void
 LoadingView::doActivate()
 {
-    backgroundSurface.loadBMP(&quot;pics/backgrounds/menus/menu/defaultMB.bmp&quot;);
+    backgroundSurface.loadBMP(&quot;pics/backgrounds/defaultMB.bmp&quot;);
     surface.create(455, 175);
     dirty=true;
 }
@@ -168,48 +169,46 @@
 void
 LoadingView::loadFinish()
 {
-    Desktop::setVisibilityAllWindows(false);
-
     // XXX rebuild the particle stuff here for units...
     ParticleInterface::rebuildUnitParticleData();
 
     // XXX this needed because has to create the special buttons for the
     // defined units, has to be here because it has to be the &quot;netp&quot; palette
     // and after loading the unit profiles
-    View * v = Desktop::getView(&quot;VehicleSelectionView&quot;);
+    View * v = 0; //Desktop::getView(&quot;VehicleSelectionView&quot;);
     if ( v )
     {
-        Desktop::remove(v);
+//        Desktop::remove(v);
         delete v;
     }
 
-    Desktop::add(new VehicleSelectionView());
+//    Desktop::add(new VehicleSelectionView());
 
     GameManager::setNetPanzerGameOptions();
-    Desktop::setVisibility(&quot;MiniMapView&quot;, true);
-    Desktop::setVisibility(&quot;GameView&quot;, true);
-    Desktop::setVisibility(&quot;ChatView&quot;, true);
-    ChatView *cv = (ChatView*) Desktop::getView(&quot;ChatView&quot;);
+//    Desktop::setVisibility(&quot;MiniMapView&quot;, true);
+//    Desktop::setVisibility(&quot;GameView&quot;, true);
+//    Desktop::setVisibility(&quot;ChatView&quot;, true);
+    ChatView *cv = 0; // (ChatView*) Desktop::getView(&quot;ChatView&quot;);
     if (cv) cv-&gt;clear();
     
     if ( PlayerInterface::getLocalPlayer()-&gt;isSelectingFlag() )
     {
-        Desktop::setVisibility(&quot;GFlagSelectionView&quot;, true);
-        Desktop::setActiveView(&quot;GFlagSelectionView&quot;);
+//        Desktop::setVisibility(&quot;GFlagSelectionView&quot;, true);
+//        Desktop::setActiveView(&quot;GFlagSelectionView&quot;);
     }
 }
 
 void
 LoadingView::show()
 {
-    Desktop::setVisibilityAllWindows(false);
-    Desktop::setVisibility(&quot;LoadingView&quot;, true);
-    View *v = Desktop::getView(&quot;LoadingView&quot;);
-    Desktop::setFocusView(v);
+//    Desktop::setVisibilityAllWindows(false);
+//    Desktop::setVisibility(&quot;LoadingView&quot;, true);
+//    View *v = Desktop::getView(&quot;LoadingView&quot;);
+//    Desktop::setFocusView(v);
 }
 
 void
 LoadingView::hide()
 {
-    Desktop::setVisibility(&quot;LoadingView&quot;, false);
+//    Desktop::setVisibility(&quot;LoadingView&quot;, false);
 }

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -19,7 +19,6 @@
 #include &quot;PrepareTeam.hpp&quot;
 #include &quot;Classes/ScreenSurface.hpp&quot;
 #include &quot;Classes/WorldInputCmdProcessor.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/Button.hpp&quot;
 #include &quot;Views/Theme.hpp&quot;
 #include &quot;2D/Palette.hpp&quot;
@@ -66,8 +65,8 @@
 //    setTitle(_(&quot;Prepare Team&quot;));
 
     setAllowMove(false);
-    menuImage.loadBMP(&quot;pics/backgrounds/menus/menu/canon.bmp&quot;);
-    vsImage.loadBMP(&quot;pics/backgrounds/menus/menu/vs.bmp&quot;);
+    menuImage.loadBMP(&quot;pics/backgrounds/canon.bmp&quot;);
+    vsImage.loadBMP(&quot;pics/backgrounds/vs.bmp&quot;);
 
     moveTo((screen-&gt;getWidth()/2) - (menuImage.getWidth()/2),
            (screen-&gt;getHeight()/2) - ( menuImage.getHeight()/1.5));
@@ -259,7 +258,6 @@
     {
         init();
     }
-    Desktop::setActiveView(this);
 }
 
 void PrepareTeam::doDeactivate()

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/VehicleSelectionView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/VehicleSelectionView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/VehicleSelectionView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -40,7 +40,6 @@
 #include &quot;Units/UnitTypes.hpp&quot;
 
 #include &quot;Views/GameViewGlobals.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/ViewGlobals.hpp&quot;
 #include &quot;Views/Components/Label.hpp&quot;
 #include &quot;Views/Components/BoxedLabel.hpp&quot;
@@ -70,7 +69,7 @@
 
 static void bOK()
 {
-    Desktop::setVisibilityNoDoAnything(&quot;VehicleSelectionView&quot;, false);
+//    Desktop::setVisibilityNoDoAnything(&quot;VehicleSelectionView&quot;, false);
     sendOutpostStatus();
     changeMade = false;
 }
@@ -106,7 +105,7 @@
         {
             resetState();
             if (vsvSelectedUnit == unitType &amp;&amp; vsvUnitGenOn) {
-                Desktop::setVisibilityNoDoAnything(&quot;VehicleSelectionView&quot;, false);
+//                Desktop::setVisibilityNoDoAnything(&quot;VehicleSelectionView&quot;, false);
                 return;
             }
             
@@ -155,7 +154,7 @@
         VehicleSelectionView::setPowerOff();
     }
 
-    Desktop::setVisibility( &quot;VehicleSelectionView&quot;, true);
+//    Desktop::setVisibility( &quot;VehicleSelectionView&quot;, true);
 }
 
 void toggleDisplayOutpostNames( void )
@@ -313,7 +312,7 @@
     Objective* obj = ObjectiveInterface::getObjective(CURRENT_SELECTED_OUTPOST_ID);
     if ( !obj || obj-&gt;occupying_player != PlayerInterface::getLocalPlayer() )
     {
-        Desktop::setVisibilityNoDoAnything(&quot;VehicleSelectionView&quot;, false);
+//        Desktop::setVisibilityNoDoAnything(&quot;VehicleSelectionView&quot;, false);
         changeMade = false;
         return;
     }
@@ -629,15 +628,15 @@
 //---------------------------------------------------------------------------
 void VehicleSelectionView::doActivate()
 {
-    if (Desktop::getFocus() != this) {
-        iXY pos;
+//    if (Desktop::getFocus() != this) {
+//        iXY pos;
+//
+//        pos = MouseInterface::getMousePosition() - getSize() / 2;
+//
+//        moveTo(pos);
+//        checkArea(iXY(screen-&gt;getWidth(),screen-&gt;getHeight()));
+//    }
 
-        pos = MouseInterface::getMousePosition() - getSize() / 2;
-
-        moveTo(pos);
-        checkArea(iXY(screen-&gt;getWidth(),screen-&gt;getHeight()));
-    }
-
     GameTemplateView::doActivate();
 
 } // end VehicleSelectionView::doActivate
@@ -755,7 +754,7 @@
         }
 
         if (me.getSource()==buttonOk) {
-            Desktop::setVisibilityNoDoAnything(&quot;VehicleSelectionView&quot;, false);
+//            Desktop::setVisibilityNoDoAnything(&quot;VehicleSelectionView&quot;, false);
             sendOutpostStatus();
             changeMade = false;
         }

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/VoteBox.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/VoteBox.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/VoteBox.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -24,6 +24,7 @@
 #include &quot;Interfaces/VoteManager.hpp&quot;
 #include &quot;2D/Surface.hpp&quot;
 #include &quot;Actions/Action.hpp&quot;
+#include &quot;Util/Log.hpp&quot;
 
 class YesNoAction : public Action
 {

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/MainMenuView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/MainMenuView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/MainMenuView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -18,7 +18,6 @@
 
 
 #include &quot;MainMenuView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/tStringListBox.hpp&quot;
 #include &quot;Views/Components/tVScrollBar.hpp&quot;
 #include &quot;Interfaces/GameManager.hpp&quot;
@@ -37,7 +36,7 @@
 
 void MainMenuView::setNews(const std::string &amp;news)
 {
-    MainMenuView * mmv = (MainMenuView*)Desktop::getView(&quot;MainView&quot;);
+    MainMenuView * mmv = 0; //(MainMenuView*)Desktop::getView(&quot;MainView&quot;);
     mmv-&gt;news_text-&gt;Clear();
     mmv-&gt;news_text-&gt;Add(_(&quot;NetPanzer news:&quot;));
     mmv-&gt;news_text-&gt;AddBlock(news);
@@ -47,7 +46,7 @@
 
 // MainMenuView
 //---------------------------------------------------------------------------
-MainMenuView::MainMenuView() : RMouseHackView()
+MainMenuView::MainMenuView() : View()
 {
     setSearchName(&quot;MainView&quot;);
     
@@ -86,7 +85,7 @@
     add(news_text);
     add(sbar);
 
-//    xxx.loadBMP(&quot;pics/backgrounds/menus/buttons/default/page.bmp&quot;);
+//    xxx.loadBMP(&quot;pics/buttons/page.bmp&quot;);
     
 } // end MainMenuView::MainMenuView
 

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/MainMenuView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/MainMenuView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/MainMenuView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -19,16 +19,15 @@
 #define __MainMenuView_hpp__
 
 #include &quot;Views/Components/View.hpp&quot;
-#include &quot;RMouseHackView.hpp&quot;
 #include &quot;Network/NewsGetter.hpp&quot;
 
 class tStringListBox;
 
 //--------------------------------------------------------------------------
-class MainMenuView : public RMouseHackView
+class MainMenuView : public View
 {
 private:
-    NewsGetter news_getter;
+//    NewsGetter news_getter;
     tStringListBox * intro_text;
     tStringListBox * news_text;
 

Deleted: trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,424 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-#include &quot;2D/Palette.hpp&quot;
-#include &quot;2D/PackedSurface.hpp&quot;
-#include &quot;Views/MainMenu/MenuTemplateView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
-#include &quot;Views/Components/Button.hpp&quot;
-#include &quot;Views/GameViewGlobals.hpp&quot;
-#include &quot;Views/Components/ViewGlobals.hpp&quot;
-#include &quot;Interfaces/GameConfig.hpp&quot;
-#include &quot;Interfaces/GameManager.hpp&quot;
-#include &quot;Interfaces/StrManager.hpp&quot;
-#include &quot;Interfaces/PlayerGameManager.hpp&quot;
-#include &quot;System/Sound.hpp&quot;
-#include &quot;Classes/ScreenSurface.hpp&quot;
-#include &quot;Particles/Particle2D.hpp&quot;
-#include &quot;Particles/ParticleSystem2D.hpp&quot;
-#include &quot;Util/Exception.hpp&quot;
-#include &quot;Multi/ServerListView.hpp&quot;
-#include &quot;Multi/MapSelectionView.hpp&quot;
-#include &quot;Multi/IPAddressView.hpp&quot;
-#include &quot;Multi/PlayerNameView.hpp&quot;
-#include &quot;Resources/ResourceManager.hpp&quot;
-
-#include &quot;Actions/Action.hpp&quot;
-#include &quot;Actions/ActionManager.hpp&quot;
-
-#ifndef PACKAGE_VERSION
-	#define PACKAGE_VERSION &quot;testing&quot;
-#endif
-
-Surface       MenuTemplateView::backgroundSurface;
-
-// &lt;editor-fold desc=&quot;actions&quot; defaultstate=&quot;collapsed&quot;&gt;
-
-class ShowMainViewAction : public Action
-{
-public:
-    ShowMainViewAction() : Action(false) {}
-    
-    void execute()
-    {
-        Desktop::setVisibilityAllWindows(false);
-        Desktop::setVisibility(&quot;MenuTemplateView&quot;, true);
-        Desktop::setVisibility(&quot;MainView&quot;, true);
-        ((MenuTemplateView*)Desktop::getView(&quot;MenuTemplateView&quot;))-&gt;hidePlayButton();
-    }
-};
-
-class ShowHostViewAction : public Action
-{
-public:
-    ShowHostViewAction() : Action(false) {}
-    
-    void execute()
-    {
-        gameconfig-&gt;hostorjoin = _game_session_host;
-        Desktop::setVisibilityAllWindows(false);
-        Desktop::setVisibility(&quot;MenuTemplateView&quot;, true);
-        Desktop::setVisibility(&quot;HostOptionsView&quot;, true);
-        Desktop::setVisibility(&quot;MapSelectionView&quot;, true);
-        Desktop::setVisibility(&quot;PlayerNameView&quot;, true);
-        ((MenuTemplateView*)Desktop::getView(&quot;MenuTemplateView&quot;))-&gt;showPlayButton();
-        // TODO: do doLoadTitleSurface(&quot;hostTitle&quot;);
-    }
-};
-
-class ShowJoinViewAction : public Action
-{
-public:
-    ShowJoinViewAction() : Action(false) {}
-    
-    void execute()
-    {
-        gameconfig-&gt;hostorjoin = _game_session_join;
-        Desktop::setVisibilityAllWindows(false);
-        Desktop::setVisibility(&quot;MenuTemplateView&quot;, true);
-        Desktop::setVisibility(&quot;PlayerNameView&quot;, true);
-        Desktop::setVisibility(&quot;IPAddressView&quot;, true);
-        Desktop::setVisibility(&quot;ServerListView&quot;, true);
-//        serverlistview-&gt;refresh();
-        ((MenuTemplateView*)Desktop::getView(&quot;MenuTemplateView&quot;))-&gt;showPlayButton();
-        // TODO: do doLoadTitleSurface(&quot;joinTitle&quot;);
-    }
-};
-
-class ShowOptionsViewAction : public Action
-{
-public:
-    ShowOptionsViewAction() : Action(false) {}
-    
-    void execute()
-    {
-        Desktop::setVisibilityAllWindows(false);
-        Desktop::setVisibility(&quot;MenuTemplateView&quot;, true);
-        Desktop::setVisibility(&quot;OptionsView&quot;, true);
-        ((MenuTemplateView*)Desktop::getView(&quot;MenuTemplateView&quot;))-&gt;hidePlayButton();
-    }
-};
-
-class ShowHelpViewAction : public Action
-{
-public:
-    ShowHelpViewAction() : Action(false) {}
-    
-    void execute()
-    {
-        Desktop::setVisibilityAllWindows(false);
-        // TODO: should doLoadTitleSurface(&quot;helpTitle&quot;);
-        Desktop::setVisibility(&quot;MenuTemplateView&quot;, true);
-        Desktop::setVisibilityNoDoAnything(&quot;HelpScrollView&quot;, true);
-        ((MenuTemplateView*)Desktop::getView(&quot;MenuTemplateView&quot;))-&gt;hidePlayButton();
-    }
-};
-
-class OpenResignGameViewAction : public Action
-{
-public:
-    OpenResignGameViewAction() : Action(false) {}
-    
-    void execute()
-    {
-        Desktop::setVisibility(&quot;OptionsView&quot;, false);
-        Desktop::setVisibility(&quot;AreYouSureResignView&quot;, true);
-    }
-};
-
-class CloseOptionsWindowAction : public Action
-{
-public:
-    CloseOptionsWindowAction() : Action(false) {}
-    
-    void execute()
-    {
-        GameManager::setNetPanzerGameOptions();
-        Desktop::setVisibility(&quot;OptionsView&quot;, false);
-    }
-};
-
-class OpenExitConfirmWindowAction : public Action
-{
-public:
-    OpenExitConfirmWindowAction() : Action(false) {}
-    
-    void execute()
-    {
-        Desktop::setVisibility(&quot;OptionsView&quot;, false);
-        Desktop::setVisibility(&quot;AreYouSureExitView&quot;, true);
-    }
-};
-
-class PlayButtonClickedAction : public Action
-{
-public:
-    PlayButtonClickedAction() : Action(false) {}
-    
-    void execute()
-    {
-        GameConfig::player_name-&gt;assign(((PlayerNameView*)Desktop::getView(&quot;PlayerNameView&quot;))-&gt;getSelectedName());
-        
-        if ( GameConfig::player_name-&gt;length() == 0 )
-            return;
-
-        // Check a few things which should be ok.
-
-        if ( ((MapSelectionView*)Desktop::getView(&quot;MapSelectionView&quot;))-&gt;getCurrentSelectedMapNumber() == -1 )
-        {
-            return;
-        }
-
-        const NPString&amp; serv_ip = ((IPAddressView*)Desktop::getView(&quot;IPAddressView&quot;))-&gt;getSelectedServerIp();
-        
-        if ( (gameconfig-&gt;hostorjoin == _game_session_join) &amp;&amp; serv_ip.empty() )
-        {
-            return;
-        }
-
-        // Close all menu views.
-        Desktop::setVisibilityAllWindows(false);
-
-        if ( gameconfig-&gt;hostorjoin == _game_session_join )
-        {
-            gameconfig-&gt;serverConnect = serv_ip;
-        }
-
-        serverlistview-&gt;endQuery();
-
-        // TODO: do it?
-    //    MenuTemplateView::backgroundSurface.free();
-
-        ResourceManager::updateFlagData( 0,
-                                         GameConfig::player_flag_data,
-                                         sizeof(GameConfig::player_flag_data) );
-
-        PlayerGameManager* manager = (PlayerGameManager*) gamemanager;
-        manager-&gt;launchMultiPlayerGame();
-    }
-};
-
-// &lt;/editor-fold&gt;
-
-static Button * createMenuButton(   const NPString&amp; label,
-                                    iXY loc,
-                                    bool inverted,
-                                    Action * action)
-{
-    Surface bitmap;
-    bitmap.loadBMP(&quot;pics/backgrounds/menus/buttons/default/page.bmp&quot;);
-    if ( inverted )
-    {
-        bitmap.flipVertical();
-    }
-    
-    Button *b = new Button();
-    b-&gt;setLocation(loc);
-    b-&gt;setLabel(label);
-    b-&gt;setSize(Surface::getTextLength(label)+20, 25);
-    b-&gt;setTextColors(Color::gray, Color::lightGray, Color::black, Color::darkGray);
-
-    b-&gt;setExtraBorder();
-    
-    b-&gt;borders[0][0] = Color::gray;
-    b-&gt;borders[0][1] = Color::black;
-    b-&gt;borders[1][0] = Color::gray;
-    b-&gt;borders[1][1] = Color::gray;
-    b-&gt;borders[2][0] = Color::gray;
-    b-&gt;borders[2][1] = Color::darkGray;
-
-    PtrArray&lt;Surface&gt; bg(3);
-    int bgsize = Surface::getTextLength(label)+20;
-    
-    for ( unsigned int n = 0; n &lt; 3; n++ )
-    {
-        Surface *s = new Surface( bgsize, 25);
-        s-&gt;FillRoundRect(s-&gt;getRect(), 2, b-&gt;borders[n][1]);
-        bitmap.bltTrans(*s, 0, 0);
-        bg.push_back(s);
-    }
-    
-    b-&gt;setImage(bg);
-    
-    b-&gt;setAction(action);
-
-    return b;
-}
-
-// MenuTemplateView
-//---------------------------------------------------------------------------
-MenuTemplateView::MenuTemplateView() : RMouseHackView()
-{
-    setSearchName(&quot;MenuTemplateView&quot;);
-
-    setAllowMove(false);
-    setAlwaysOnBottom(true);
-
-    moveTo(iXY(0, 0));
-    resize(iXY(800, 480));
-
-    init();
-    
-} // end MenuTemplateView constructor
-
-void MenuTemplateView::onDesktopResized(const iXY&amp; oldResolution, const iXY&amp; newResolution)
-{
-    (void)oldResolution;
-    
-    if ( newResolution.y &lt; 600 )
-    {
-        resize(800,480);
-    }
-    else
-    {
-        resize(800,480);
-    }
-    
-    removeComponents();
-    View::onDesktopResized(oldResolution, newResolution);
-    init();
-}
-
-//---------------------------------------------------------------------------
-// initPreGameOptionButtons
-void MenuTemplateView::initPreGameOptionButtons()
-{
-    add( createMenuButton( _(&quot;Main&quot;),           mainPos,    false, new ShowMainViewAction()) );
-    joinPos.x = mainPos.x + Surface::getTextLength(_(&quot;Main&quot;))+22;
-    add( createMenuButton( _(&quot;Join&quot;),           joinPos,    false, new ShowJoinViewAction()) );
-    hostPos.x = joinPos.x + Surface::getTextLength(_(&quot;Join&quot;))+22;
-    add( createMenuButton( _(&quot;Host&quot;),           hostPos,    false, new ShowHostViewAction()) );
-    optionsPos.x = hostPos.x + Surface::getTextLength(_(&quot;Host&quot;))+22;
-    add( createMenuButton( _(&quot;Options&quot;),        optionsPos, false, new ShowOptionsViewAction()) );
-    helpPos.x = optionsPos.x + Surface::getTextLength(_(&quot;Options&quot;))+22;
-    add( createMenuButton( _(&quot;Help&quot;),           helpPos,    false, new ShowHelpViewAction()) );
-    exitPos.x = MenuRect.getEndX() - Surface::getTextLength(_(&quot;Exit netPanzer&quot;))-30;
-    add( createMenuButton( _(&quot;Exit netPanzer&quot;), exitPos,    false, ActionManager::getAction(&quot;quit&quot;)) );
-
-    playButton = createMenuButton( _(&quot;Play&quot;), iXY(-150, 0), true, new PlayButtonClickedAction());
-    add( playButton );
-} // end MenuTemplateView::initPreGameOptionButtons
-
-// initInGameOptionButtons
-//---------------------------------------------------------------------------
-void MenuTemplateView::initInGameOptionButtons()
-{
-    playButton = 0;
-    if(!gameconfig-&gt;quickConnect)
-    {
-        add( createMenuButton( _(&quot;Resign&quot;),          resignPos, false, new OpenResignGameViewAction()) );
-        add( createMenuButton( _(&quot;Exit netPanzer&quot;),  exitPos,   false, new OpenExitConfirmWindowAction()) );
-    }
-    else
-    {
-        add( createMenuButton( _(&quot;Resign&quot;),          exitPos,   false, new OpenResignGameViewAction()) );
-    }
-
-    add( createMenuButton( _(&quot;Close Options&quot;), returnToGamePos, false, new CloseOptionsWindowAction()) );
-} // end MenuTemplateView::initInGameOptionButtons
-
-void MenuTemplateView::init()
-{
-    removeComponents();
-    
-    if ( Desktop::getVisible(&quot;GameView&quot;) )
-    {
-        initInGameOptionButtons();
-    }
-    else
-    {
-        initPreGameOptionButtons();
-    }
-}
-
-// doDraw
-//---------------------------------------------------------------------------
-void MenuTemplateView::doDraw( Surface&amp; dest )
-{
-    if (Desktop::getVisible(&quot;GameView&quot;))
-    {
-	// When ingame, tint the game into gray
-        dest.BltRoundRect(getClientRect(), 10, Palette::darkGray256.getColorArray());
-        dest.RoundRect(MenuRect, 10, Color::gray);
-        dest.drawWindowsBorder();
-
-    }
-    else
-    {        
-        int dx = (dest.getWidth()/2) - (backgroundSurface.getWidth()/2);
-        int dy = (dest.getHeight()/2) - (backgroundSurface.getHeight()/2);
-        backgroundSurface.blt(dest, dx, dy); // full blit
-        
-        dest.BltRoundRect(MenuRect, 10, Palette::darkGray256.getColorArray());
-        dest.RoundRect(MenuRect, 10, Color::gray);
-    }
-
-    static char text[] = &quot;NetPanzer &quot; PACKAGE_VERSION;
-
-    dest.bltString(10, dest.getHeight()-Surface::getFontHeight() - 4, text, Color::yellow);
-
-    View::doDraw( dest );
-} // end doDraw
-
-// doActivate
-//---------------------------------------------------------------------------
-void MenuTemplateView::doActivate()
-{
-    // Make the activating view active, redo this please!
-    Desktop::setActiveView(&quot;MenuTemplateView&quot;);
-
-    loadBackgroundSurface();
-} // end doActivate
-
-// loadBackgroundSurface
-//---------------------------------------------------------------------------
-void MenuTemplateView::loadBackgroundSurface()
-{
-    doLoadBackgroundSurface(&quot;pics/backgrounds/menus/menu/defaultMB.bmp&quot;);
-} // end MenuTemplateView::loadBackgroundSurface
-
-// doLoadBackgroundSurface
-//---------------------------------------------------------------------------
-void MenuTemplateView::doLoadBackgroundSurface(const std::string&amp; string)
-{
-    backgroundSurface.loadBMP(string.c_str());
-} // end MenuTemplateView::doLoadBackgroundSurface
-
-// doDeactivate
-//---------------------------------------------------------------------------
-void MenuTemplateView::doDeactivate()
-{
-} // end doDeactivate
-
-// processEvents
-//---------------------------------------------------------------------------
-void MenuTemplateView::processEvents()
-{
-} // end MenuTemplateView::processEvents
-
-void
-MenuTemplateView::showPlayButton()
-{
-    playButton-&gt;setLocation(playPos);
-}
-
-void
-MenuTemplateView::hidePlayButton()
-{
-    playButton-&gt;setLocation(-100,-100);
-}

Deleted: trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/MenuTemplateView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,64 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __MenuTemplateView_hpp__
-#define __MenuTemplateView_hpp__
-
-#include &quot;Views/MainMenu/SpecialButtonView.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-#include &quot;2D/PackedSurface.hpp&quot;
-#include &quot;Types/iRect.hpp&quot;
-#include &quot;Types/iXY.hpp&quot;
-
-class Button;
-
-//--------------------------------------------------------------------------
-class MenuTemplateView : public RMouseHackView
-{
-private:
-    Button * playButton;
-    
-    void onDesktopResized( const iXY&amp; oldResolution, const iXY&amp; newResolution);
-    
-protected:
-    virtual void loadBackgroundSurface();
-
-    void doLoadBackgroundSurface(const std::string&amp; string);
-
-public:
-    MenuTemplateView();
-
-    virtual void doDraw( Surface&amp; dest );
-    virtual void doActivate();
-    virtual void doDeactivate();
-    virtual void processEvents();
-
-    void initInGameOptionButtons();
-    void initPreGameOptionButtons();
-
-    virtual void init();
-    
-    void showPlayButton();
-    void hidePlayButton();
-
-    //static PackedSurface netPanzerLogo;
-    static bool          firstTimeInMenu;
-    //static PackedSurface globeSurface;
-    static Surface       backgroundSurface;
-}; // end MenuTemplateView
-
-#endif // end __MenuTemplateView_hpp__

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -24,7 +24,6 @@
 #include &quot;Views/GameViewGlobals.hpp&quot;
 #include &quot;Views/Components/Label.hpp&quot;
 #include &quot;Views/Components/Button.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/Separator.hpp&quot;
 #include &quot;Actions/Action.hpp&quot;
 #include &quot;Actions/ChangeIntVarAction.hpp&quot;
@@ -79,7 +78,7 @@
     {
         char strBuf[256];
         // XXX WARNING note efficient
-        const MapFile * m = ResourceManager::getMap(((MapSelectionView*)Desktop::getView(&quot;MapSelectionView&quot;))-&gt;getCurrentSelectedMapName(), 0);
+        const MapFile * m = 0; //ResourceManager::getMap(((MapSelectionView*)Desktop::getView(&quot;MapSelectionView&quot;))-&gt;getCurrentSelectedMapName(), 0);
         if ( m )
         {
             int objectiveCount = m-&gt;getOutpostCount();
@@ -232,7 +231,7 @@
 
 // HostOptionsView
 //---------------------------------------------------------------------------
-HostOptionsView::HostOptionsView() : RMouseHackView()
+HostOptionsView::HostOptionsView() : View()
 {
     setSearchName(&quot;HostOptionsView&quot;);
 

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/HostOptionsView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -18,13 +18,14 @@
 #ifndef __HostOptionsView_hpp__
 #define __HostOptionsView_hpp__
 
-#include &quot;Views/MainMenu/RMouseHackView.hpp&quot;
+#include &quot;Views/Components/View.hpp&quot;
 #include &quot;2D/Surface.hpp&quot;
+#include &quot;Core/CoreTypes.hpp&quot;
 
 class Action;
 
 //---------------------------------------------------------------------------
-class HostOptionsView : public RMouseHackView
+class HostOptionsView : public View
 {
 private:
     void addMeterButtons(const iXY &amp;pos);

Deleted: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,54 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;IPAddressView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
-#include &quot;Views/Components/Label.hpp&quot;
-#include &quot;Views/GameViewGlobals.hpp&quot;
-#include &quot;Interfaces/StrManager.hpp&quot;
-
-// IPAddressView
-//---------------------------------------------------------------------------
-IPAddressView::IPAddressView() : View()
-{
-    setSearchName(&quot;IPAddressView&quot;);
-//    setTitle(_(&quot;Server IP Address&quot;));
-
-    setAllowMove(false);
-
-    moveTo(iXY(bodyTextRect.getLocationX(), bodyTextRect.getLocationY() + 24));
-
-    iXY  area_size = iXY(
-            31 * 8 + 16 + 100,
-            Surface::getFontHeight() + 4 + 8);
-    
-    resize(area_size);
-
-    Label *c = new Label(0,4,_(&quot;Server IP Address&quot;), Color::white);
-    add(c);
-    
-    serverIP = new InputField();
-    serverIP-&gt;setLocation(iXY(150, 0));
-    serverIP-&gt;setSize(getWidth()-160, 16);
-    serverIP-&gt;setMaxTextLength(255);
-    serverIP-&gt;setText(&quot;&quot;);
-
-    add(serverIP);
-    
-} // end IPAddressView constructor

Deleted: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/IPAddressView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,39 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
-
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
-
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
-
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __IPAddressView_h__
-#define __IPAddressView_h__
-
-#include &quot;Views/Components/View.hpp&quot;
-#include &quot;Views/Components/InputField.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-
-//---------------------------------------------------------------------------
-class IPAddressView : public View
-{
-public:
-    IPAddressView();
-
-    const NPString&amp; getSelectedServerIp() const { return serverIP-&gt;getText(); }
-    void setSelectedServerIp(const NPString&amp; ip) { serverIP-&gt;setText(ip); }
-    
-private:
-    InputField * serverIP;
-    
-}; // end IPAddressView
-
-#endif // end __IPAddressView_h__

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -66,6 +66,8 @@
 
 class MapThumbnailComponent : public Component
 {
+private:
+    Surface mapimage;
 public:
     MapThumbnailComponent(int x, int y, int w, int h)
     {
@@ -73,7 +75,7 @@
         position.y = y;
         size.x = w;
         size.y = h;
-        surface.create(w - 2, h - 2);
+        mapimage.create(w - 2, h - 2);
     }
     
     void draw(Surface &amp;dest)
@@ -81,13 +83,13 @@
         iRect r;
         getBounds(r);
         dest.drawRect(r, Color::lightGray);
-        surface.blt(dest, position.x+1, position.y+1); // full blit
+        mapimage.blt(dest, position.x+1, position.y+1); // full blit
     }
     
     void setImage(const Surface&amp; from)
     {
         iRect r(0,0, size.x-2, size.y-2);
-        surface.bltScale(from, r);
+        mapimage.bltScale(from, r);
     }
     
     virtual void render()
@@ -103,7 +105,7 @@
 
 // MapSelectionView
 //---------------------------------------------------------------------------
-MapSelectionView::MapSelectionView() : RMouseHackView()
+MapSelectionView::MapSelectionView() : View()
 {
     setSearchName(&quot;MapSelectionView&quot;);
 

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -21,7 +21,7 @@
 #include &lt;vector&gt;
 #include &lt;string.h&gt;
 
-#include &quot;Views/MainMenu/RMouseHackView.hpp&quot;
+#include &quot;Views/Components/View.hpp&quot;
 #include &quot;2D/Surface.hpp&quot;
 #include &quot;Core/CoreTypes.hpp&quot;
 
@@ -44,7 +44,7 @@
 class Label;
 
 //---------------------------------------------------------------------------
-class MapSelectionView : public RMouseHackView
+class MapSelectionView : public View
 {
 private:
     enum { BORDER_SPACE =   4 };

Deleted: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,63 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;SDL.h&quot;
-
-#include &quot;PlayerNameView.hpp&quot;
-#include &quot;Views/GameViewGlobals.hpp&quot;
-#include &quot;Interfaces/GameConfig.hpp&quot;
-#include &quot;Interfaces/StrManager.hpp&quot;
-#include &quot;Views/Components/InputField.hpp&quot;
-#include &quot;Views/Components/Label.hpp&quot;
-
-enum { BORDER_SPACE           =  4 };    
-// irc nick is 16 chars max, 2 = &quot;np&quot;, 1 spare for digit if nick is taken
-enum { INPUT_FIELD_CHARACTERS = 15 };
-
-// PlayerNameView
-//---------------------------------------------------------------------------
-PlayerNameView::PlayerNameView() : View()
-{
-    setSearchName(&quot;PlayerNameView&quot;);
-
-    setAllowMove(false);
-
-    moveTo(bodyTextRect.getLocation());
-
-    int CHAR_XPIX = 8; // XXX hardcoded :-/
-    resizeClientArea((INPUT_FIELD_CHARACTERS+1) * CHAR_XPIX + 8 + BORDER_SPACE * 2 + 200, 32 );
-
-    init();
-} // end PlayerNameView::PlayerNameView
-
-// init
-//---------------------------------------------------------------------------
-void PlayerNameView::init()
-{
-    add( new Label(0,6, _(&quot;Player Name&quot;), Color::white) );
-    
-    playerName = new InputField();
-    playerName-&gt;setLocation(iXY(150, 2));
-    playerName-&gt;setSize(getWidth()-160, 16);
-    playerName-&gt;setMaxTextLength(INPUT_FIELD_CHARACTERS * 2); // XXX *2 for testing only
-    playerName-&gt;setExcludedChars(&quot;\\&quot;);
-    playerName-&gt;setText(*GameConfig::player_name);
-
-    add(playerName);
-} // end PlayerNameView::init

Deleted: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/PlayerNameView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,38 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __PlayerNameView_hpp__
-#define __PlayerNameView_hpp__
-
-#include &quot;Views/Components/View.hpp&quot;
-#include &quot;Views/Components/InputField.hpp&quot;
-
-//---------------------------------------------------------------------------
-class PlayerNameView : public View
-{
-public:
-    PlayerNameView();
-
-    void init();
-    
-    const NPString&amp; getSelectedName() { return playerName-&gt;getText(); }
-
-private:
-    InputField* playerName;
-}; // end PlayerNameView
-
-#endif // end __PlayerNameView_hpp__

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/ServerListView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/ServerListView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/ServerListView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -21,12 +21,10 @@
 
 #include &lt;iostream&gt;
 #include &lt;sstream&gt;
-#include &quot;IPAddressView.hpp&quot;
 #include &quot;Views/GameViewGlobals.hpp&quot;
 #include &quot;MasterServer/ServerInfo.hpp&quot;
 #include &quot;Core/NetworkGlobals.hpp&quot;
 
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Interfaces/StrManager.hpp&quot;
 #include &quot;Views/Game/LoadingView.hpp&quot;
 #include &quot;Actions/Action.hpp&quot;
@@ -43,6 +41,8 @@
 
 #include &quot;Classes/GameServerInfo.hpp&quot;
 
+#include &quot;Util/Log.hpp&quot;
+
 ServerListView* serverlistview = 0;
 
 #define COL1_CHARS 30
@@ -61,8 +61,8 @@
 class ServerListBox : public tStringListBox
 {
 public:
-    ServerListBox(iRect rect, StateChangedCallback* newcallback)
-        : tStringListBox(rect, newcallback)
+    ServerListBox(iRect rect)
+        : tStringListBox(rect)
     {
         setAutoWrap(false);
         setHasHeader(true);
@@ -164,6 +164,13 @@
         return 1;
     }
     
+    void draw( Surface&amp; dest )
+    {
+        dest.fillRect(iRect(position.x, position.y, size.x, size.y), Color::cyan);
+//        render();
+//        surface.bltTrans(dest, position.x, position.y );
+    }
+    
 };
 
 class ServerListQuery : public network::TCPSocketObserver
@@ -395,8 +402,8 @@
     lock_image.loadBMP(&quot;pics/default/lock.bmp&quot;);
     
     
-    iRect r(0, 0, bodyTextRect.getWidth()-20, 200);
-    ServerListBox * table = new ServerListBox(r, 0);
+    iRect r(0, 0, bodyTextRect.getWidth(), 200);
+    ServerListBox * table = new ServerListBox(r);
     tVScrollBar * sbar = new tVScrollBar();
     table-&gt;setVscrollBar(sbar);
     add(sbar);

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -17,7 +17,6 @@
 */
 
 #include &quot;Views/MainMenu/OptionsTemplateView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
 #include &quot;Views/Components/Button.hpp&quot;
 #include &quot;Views/Components/Label.hpp&quot;
 #include &quot;Views/Components/BoxedLabel.hpp&quot;
@@ -34,71 +33,6 @@
 #include &quot;Actions/Action.hpp&quot;
 #include &quot;Actions/ChangeIntVarAction.hpp&quot;
 
-class FullScreenModifiedAction : public Action
-{
-public:
-    FullScreenModifiedAction() : Action(false) {}
-    
-    void execute()
-    {
-        GameManager::setVideoMode();
-    }
-};
-
-class SoundModifiedAction : public Action
-{
-    CheckBox * cb;
-public:
-    SoundModifiedAction(CheckBox* cb) : Action(false), cb(cb) {}
-    
-    void execute()
-    {
-        delete sound;
-
-        if ( GameConfig::sound_enable )
-        {
-            sound = new SDLSound();
-            cb-&gt;setLabel(_(&quot;Enabled&quot;));
-            
-            if ( GameControlRulesDaemon::getGameState() )
-            {
-                sound-&gt;playTankIdle();
-            }
-            
-            if ( GameConfig::sound_music )
-            {
-                sound-&gt;playMusic(&quot;sound/music/&quot;);
-            }
-        }
-        else
-        {
-            sound = new DummySound();
-            cb-&gt;setLabel(_(&quot;Disabled&quot;));
-        }
-    }
-};
-
-class MusicModifiedAction : public Action
-{
-    CheckBox * cb;
-public:
-    MusicModifiedAction(CheckBox* cb) : Action(false), cb(cb) {}
-    
-    void execute()
-    {
-        if ( GameConfig::sound_music )
-        {
-            sound-&gt;playMusic(&quot;sound/music/&quot;);
-            cb-&gt;setLabel(_(&quot;Enabled&quot;));
-        }
-        else
-        {
-            sound-&gt;stopMusic();
-            cb-&gt;setLabel(_(&quot;Disabled&quot;));
-        }
-    }
-};
-
 class ScrollRateBoxedLabel : public BoxedLabel
 {
 public:
@@ -273,9 +207,78 @@
 };
 
 
+class FullScreenCheckBox : public CheckBox
+{
+public:
+    FullScreenCheckBox(const int x, const int y, const NPString&amp; label, bool* state)
+        : CheckBox(x, y, label, state)
+    { }
+    
+    void onStateChanged()
+    {
+        GameManager::setVideoMode();
+    }
+};
+
+class SoundCheckBox : public CheckBox
+{
+public:
+    SoundCheckBox(const int x, const int y, const NPString&amp; label, bool* state)
+        : CheckBox(x, y, label, state)
+    { }
+    
+    void onStateChanged()
+    {
+        delete sound;
+
+        if ( GameConfig::sound_enable )
+        {
+            sound = new SDLSound();
+            setLabel(_(&quot;Enabled&quot;));
+            
+            if ( GameControlRulesDaemon::getGameState() )
+            {
+                sound-&gt;playTankIdle();
+            }
+            
+            if ( GameConfig::sound_music )
+            {
+                sound-&gt;playMusic(&quot;sound/music/&quot;);
+            }
+        }
+        else
+        {
+            sound = new DummySound();
+            setLabel(_(&quot;Disabled&quot;));
+        }
+    }
+};
+
+class MusicCheckBox : public CheckBox
+{
+public:
+    MusicCheckBox(const int x, const int y, const NPString&amp; label, bool* state)
+        : CheckBox(x, y, label, state)
+    { }
+    
+    void onStateChanged()
+    {
+        if ( GameConfig::sound_music )
+        {
+            sound-&gt;playMusic(&quot;sound/music/&quot;);
+            setLabel(_(&quot;Enabled&quot;));
+        }
+        else
+        {
+            sound-&gt;stopMusic();
+            setLabel(_(&quot;Disabled&quot;));
+        }
+    }
+};
+
 // OptionsTemplateView
 //---------------------------------------------------------------------------
-OptionsTemplateView::OptionsTemplateView() : RMouseHackView()
+OptionsTemplateView::OptionsTemplateView() : View()
 {
     setSearchName(&quot;OptionsView&quot;);
 
@@ -308,7 +311,7 @@
     add( new Separator( xTextStart, y, xTextEnd,  _(&quot;VISUAL&quot;), componentActiveTextColor) );
     
     y += yOffset;
-    add( new CheckBox( xTextStart+col, y, _(&quot;Full screen&quot;), &amp;GameConfig::video_fullscreen, new FullScreenModifiedAction()) );
+    add( new FullScreenCheckBox( xTextStart+col, y, _(&quot;Full screen&quot;), &amp;GameConfig::video_fullscreen) );
     
     y += yOffset;
     add( new CheckBox( xTextStart+col, y, _(&quot;Draw All Shadows&quot;), &amp;GameConfig::video_shadows) );
@@ -339,11 +342,6 @@
                new ChangeIntVarAction&lt;GameConfig::interface_scrollrate, 500, 1000&gt;(100),
                new ScrollRateBoxedLabel() );
     
-//    add( new Label( x, y+3, _(&quot;Scroll Rate:&quot;), windowTextColor) );
-//    x += optionsMeterStartX;
-//    add( Button::createTextButton( &quot;&lt;&quot;, iXY(x - 1, y), arrowButtonWidth, new ChangeIntVarAction&lt;GameConfig::interface_scrollrate, 500, 1000&gt;(-100)) );
-//    x += optionsMeterWidth + arrowButtonWidth;
-//    add( Button::createTextButton( &quot;&gt;&quot;, iXY(x - 1, y), arrowButtonWidth, new ChangeIntVarAction&lt;GameConfig::interface_scrollrate, 500, 1000&gt;(100)) );
     y += yOffset*3;
 
 // SOUND OPTIONS
@@ -355,9 +353,7 @@
     add( new Label( x, y, _(&quot;Sound Status:&quot;), windowTextColor) );
     x += optionsMeterStartX;
     
-    CheckBox * checkBoxSoundEnabled = new CheckBox( x, y-2, GameConfig::sound_enable?_(&quot;Enabled&quot;):_(&quot;Disabled&quot;), &amp;GameConfig::sound_enable);
-    checkBoxSoundEnabled-&gt;setAction(new SoundModifiedAction(checkBoxSoundEnabled));
-    add(checkBoxSoundEnabled);
+    add( new SoundCheckBox( x, y-2, GameConfig::sound_enable?_(&quot;Enabled&quot;):_(&quot;Disabled&quot;), &amp;GameConfig::sound_enable) );
     y += yOffset;
 
     x = xTextStart;
@@ -374,9 +370,7 @@
     add( new Label( x, y, _(&quot;Music Status:&quot;), windowTextColor) );
     x += optionsMeterStartX;
     
-    CheckBox * checkBoxMusicEnabled = new CheckBox( x, y-2, GameConfig::sound_music?_(&quot;Enabled&quot;):_(&quot;Disabled&quot;), &amp;GameConfig::sound_music);
-    checkBoxMusicEnabled-&gt;setAction(new MusicModifiedAction(checkBoxMusicEnabled));
-    add(checkBoxMusicEnabled);
+    add( new MusicCheckBox( x, y-2, GameConfig::sound_music?_(&quot;Enabled&quot;):_(&quot;Disabled&quot;), &amp;GameConfig::sound_music) );
     y += yOffset;
     
     addConfRow(iXY(xTextStart, y), _(&quot;Music Volume:&quot;),

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/OptionsTemplateView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -19,11 +19,11 @@
 #define __OptionsTemplateView_hpp__
 
 #include &quot;Views/Components/View.hpp&quot;
-#include &quot;RMouseHackView.hpp&quot;
+#include &quot;Core/CoreTypes.hpp&quot;
 
 class Action;
 //--------------------------------------------------------------------------
-class OptionsTemplateView : public RMouseHackView
+class OptionsTemplateView : public View
 {
 private:
     void addConfRow(const iXY pos,

Deleted: trunk/netpanzer/src/NetPanzer/Views/MainMenu/RMouseHackView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/RMouseHackView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/RMouseHackView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,30 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;Views/MainMenu/RMouseHackView.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
-
-// rMouseDrag
-//---------------------------------------------------------------------------
-void RMouseHackView::rMouseDrag(const iXY &amp;downPos, const iXY&amp;,
-                                const iXY &amp;newPos)
-{
-    lMouseDown(newPos);
-    lMouseUp(downPos, newPos);
-} // end RMouseHackView::rMouseDrag

Deleted: trunk/netpanzer/src/NetPanzer/Views/MainMenu/RMouseHackView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/RMouseHackView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/RMouseHackView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,34 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __RMouseHackView_hpp__
-#define __RMouseHackView_hpp__
-
-#include &quot;Views/Components/View.hpp&quot;
-
-//--------------------------------------------------------------------------
-class RMouseHackView : public View
-{
-public:
-    RMouseHackView()
-    {}
-
-    virtual void rMouseDrag(const iXY &amp;downPos, const iXY &amp;prevPos,
-                            const iXY &amp;newPos);
-}; // end RMouseHackView
-
-#endif // end __RMouseHackView_hpp__

Deleted: trunk/netpanzer/src/NetPanzer/Views/MainMenu/SpecialButtonView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/SpecialButtonView.cpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/SpecialButtonView.cpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,47 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-
-
-#include &quot;Views/MainMenu/SpecialButtonView.hpp&quot;
-#include &quot;2D/Surface.hpp&quot;
-#include &quot;2D/PackedSurface.hpp&quot;
-#include &quot;Views/Components/Desktop.hpp&quot;
-#include &quot;Util/Exception.hpp&quot;
-#include &quot;Classes/WorldInputCmdProcessor.hpp&quot;
-
-// mouseMove
-//--------------------------------------------------------------------------
-void SpecialButtonView::mouseMove(const iXY &amp; prevPos, const iXY &amp;newPos)
-{
-    RMouseHackView::mouseMove(prevPos, newPos);
-
-    if (!MouseInterface::getButtonMask() &amp;&amp; Desktop::getFocus() != this)
-    {
-        //Desktop::setFocusView(this);
-
-        //COMMAND_PROCESSOR.closeSelectionBox();
-    }
-
-} // end SpecialButtonView::mouseMove
-
-// doActivate
-//--------------------------------------------------------------------------
-void SpecialButtonView::doActivate()
-{
-} // end SpecialButtonView::doActivate
-

Deleted: trunk/netpanzer/src/NetPanzer/Views/MainMenu/SpecialButtonView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/SpecialButtonView.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/SpecialButtonView.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -1,34 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef __SpecialButtonView_hpp__
-#define __SpecialButtonView_hpp__
-
-#include &quot;Views/MainMenu/RMouseHackView.hpp&quot;
-
-//--------------------------------------------------------------------------
-class SpecialButtonView : public RMouseHackView
-{
-public:
-    SpecialButtonView() : RMouseHackView()
-    {}
-    virtual void mouseMove(const iXY &amp; prevPos, const iXY &amp;newPos);
-    virtual void doActivate();
-}
-; // end SpecialButtonView
-
-#endif // end __SpecialButtonView_hpp__

Modified: trunk/netpanzer/src/NetPanzer/Views/Theme.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Theme.hpp	2013-02-19 11:07:28 UTC (rev 1426)
+++ trunk/netpanzer/src/NetPanzer/Views/Theme.hpp	2013-02-19 11:11:34 UTC (rev 1427)
@@ -28,8 +28,8 @@
 #define ctTexteDisable              (15)
 
 // Image theme
-#define itButton                    (&quot;pics/backgrounds/menus/buttons/default/b-black.bmp&quot;)
-#define itScroll                    (&quot;pics/backgrounds/menus/buttons/default/scrollbutton.bmp&quot;)
+#define itButton                    (&quot;pics/buttons/b-black.bmp&quot;)
+#define itScroll                    (&quot;pics/buttons/scrollbutton.bmp&quot;)
 
     //TODO: Load theme from ini file
 //void LoadNPTheme();

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000449.html">[Netpanzer-cvs] r1426 - trunk/netpanzer/pics/backgrounds
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#450">[ date ]</a>
              <a href="thread.html#450">[ thread ]</a>
              <a href="subject.html#450">[ subject ]</a>
              <a href="author.html#450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">More information about the Netpanzer-cvs
mailing list</a><br>
</body></html>
