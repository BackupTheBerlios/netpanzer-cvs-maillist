<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Netpanzer-cvs] r1039 - in trunk/netpanzer: nbproject	src/NetPanzer/Bot src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Interfaces	src/NetPanzer/Network
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/netpanzer-cvs/2008-September/index.html" >
   <LINK REL="made" HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1039%20-%20in%20trunk/netpanzer%3A%20nbproject%0A%09src/NetPanzer/Bot%20src/NetPanzer/Classes%0A%09src/NetPanzer/Classes/Network%20src/NetPanzer/Interfaces%0A%09src/NetPanzer/Network&In-Reply-To=%3C200809011640.m81GeNnC016806%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000078.html">
   <LINK REL="Next"  HREF="000080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Netpanzer-cvs] r1039 - in trunk/netpanzer: nbproject	src/NetPanzer/Bot src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Interfaces	src/NetPanzer/Network</H1>
    <B>kromxp at mail.berlios.de</B> 
    <A HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1039%20-%20in%20trunk/netpanzer%3A%20nbproject%0A%09src/NetPanzer/Bot%20src/NetPanzer/Classes%0A%09src/NetPanzer/Classes/Network%20src/NetPanzer/Interfaces%0A%09src/NetPanzer/Network&In-Reply-To=%3C200809011640.m81GeNnC016806%40sheep.berlios.de%3E"
       TITLE="[Netpanzer-cvs] r1039 - in trunk/netpanzer: nbproject	src/NetPanzer/Bot src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Interfaces	src/NetPanzer/Network">kromxp at mail.berlios.de
       </A><BR>
    <I>Mon Sep  1 18:40:23 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000078.html">[Netpanzer-cvs] r1037 - trunk/netpanzer/src/NetPanzer/Interfaces
</A></li>
        <LI>Next message: <A HREF="000080.html">[Netpanzer-cvs] r1040 - in trunk/netpanzer/src/NetPanzer:	Classes/Network Interfaces Network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#79">[ date ]</a>
              <a href="thread.html#79">[ thread ]</a>
              <a href="subject.html#79">[ subject ]</a>
              <a href="author.html#79">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: kromxp
Date: 2008-09-01 18:39:08 +0200 (Mon, 01 Sep 2008)
New Revision: 1039

Removed:
   trunk/netpanzer/src/NetPanzer/Classes/PlayerID.cpp
   trunk/netpanzer/src/NetPanzer/Classes/PlayerID.hpp
Modified:
   trunk/netpanzer/nbproject/Makefile-mac-debug.mk
   trunk/netpanzer/nbproject/Makefile-mac-release.mk
   trunk/netpanzer/nbproject/configurations.xml
   trunk/netpanzer/src/NetPanzer/Bot/BotPlayer.cpp
   trunk/netpanzer/src/NetPanzer/Classes/BonusUnitPowerUp.cpp
   trunk/netpanzer/src/NetPanzer/Classes/EnemyRadarPowerUp.cpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/ClientServerNetMessage.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageDecoder.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageEncoder.cpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageEncoder.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetPacket.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.cpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkInterface.cpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkInterface.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.cpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/PowerUpNetMessage.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/ServerMessageRouter.cpp
   trunk/netpanzer/src/NetPanzer/Classes/Outpost.cpp
   trunk/netpanzer/src/NetPanzer/Classes/PlayerState.cpp
   trunk/netpanzer/src/NetPanzer/Classes/PlayerState.hpp
   trunk/netpanzer/src/NetPanzer/Classes/UnitOpcodeEncoder.cpp
   trunk/netpanzer/src/NetPanzer/Classes/UnitPowerUp.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/ChatInterface.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.hpp
   trunk/netpanzer/src/NetPanzer/Interfaces/ObjectiveInterface.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/ObjectiveInterface.hpp
   trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.hpp
   trunk/netpanzer/src/NetPanzer/Interfaces/PowerUpInterface.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/PowerUpInterface.hpp
   trunk/netpanzer/src/NetPanzer/Interfaces/UnitInterface.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/UnitInterface.hpp
   trunk/netpanzer/src/NetPanzer/Network/ClientSocket.cpp
   trunk/netpanzer/src/NetPanzer/Network/ClientSocket.hpp
Log:
These changes i wanted to do long ago, it is still not finished and some bugs
remain (new because of the change), like if a player hosts a game, wont be
able to move.
- Removed PlayerID class, only use the player index
- Renamed NetworkServer::sendMessage to broadcastMessage
- Removed NetClientID type and its use
- Fixed bug of time limit game type, it was finishing when the time is over or
  when the frag limit is over (missing break)


Modified: trunk/netpanzer/nbproject/Makefile-mac-debug.mk
===================================================================
--- trunk/netpanzer/nbproject/Makefile-mac-debug.mk	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/nbproject/Makefile-mac-debug.mk	2008-09-01 16:39:08 UTC (rev 1039)
@@ -232,7 +232,6 @@
 	${OBJECTDIR}/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.o \
 	${OBJECTDIR}/src/NetPanzer/Views/Components/Label.o \
 	${OBJECTDIR}/src/NetPanzer/Views/Components/Component.o \
-	${OBJECTDIR}/src/NetPanzer/Classes/PlayerID.o \
 	${OBJECTDIR}/src/NetPanzer/Interfaces/Heartbeat.o \
 	${OBJECTDIR}/src/NetPanzer/Particles/TemplateMuzzleSystem.o \
 	${OBJECTDIR}/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.o \
@@ -1141,10 +1140,6 @@
 	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Views/Components
 	$(COMPILE.cc) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Views/Components/Component.o src/NetPanzer/Views/Components/Component.cpp
 
-${OBJECTDIR}/src/NetPanzer/Classes/PlayerID.o: src/NetPanzer/Classes/PlayerID.cpp 
-	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Classes
-	$(COMPILE.cc) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Classes/PlayerID.o src/NetPanzer/Classes/PlayerID.cpp
-
 ${OBJECTDIR}/src/NetPanzer/Interfaces/Heartbeat.o: src/NetPanzer/Interfaces/Heartbeat.cpp 
 	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Interfaces
 	$(COMPILE.cc) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Interfaces/Heartbeat.o src/NetPanzer/Interfaces/Heartbeat.cpp

Modified: trunk/netpanzer/nbproject/Makefile-mac-release.mk
===================================================================
--- trunk/netpanzer/nbproject/Makefile-mac-release.mk	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/nbproject/Makefile-mac-release.mk	2008-09-01 16:39:08 UTC (rev 1039)
@@ -232,7 +232,6 @@
 	${OBJECTDIR}/src/NetPanzer/Views/MainMenu/Multi/MapSelectionView.o \
 	${OBJECTDIR}/src/NetPanzer/Views/Components/Label.o \
 	${OBJECTDIR}/src/NetPanzer/Views/Components/Component.o \
-	${OBJECTDIR}/src/NetPanzer/Classes/PlayerID.o \
 	${OBJECTDIR}/src/NetPanzer/Interfaces/Heartbeat.o \
 	${OBJECTDIR}/src/NetPanzer/Particles/TemplateMuzzleSystem.o \
 	${OBJECTDIR}/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.o \
@@ -1141,10 +1140,6 @@
 	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Views/Components
 	$(COMPILE.cc) -O2 -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Views/Components/Component.o src/NetPanzer/Views/Components/Component.cpp
 
-${OBJECTDIR}/src/NetPanzer/Classes/PlayerID.o: src/NetPanzer/Classes/PlayerID.cpp 
-	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Classes
-	$(COMPILE.cc) -O2 -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Classes/PlayerID.o src/NetPanzer/Classes/PlayerID.cpp
-
 ${OBJECTDIR}/src/NetPanzer/Interfaces/Heartbeat.o: src/NetPanzer/Interfaces/Heartbeat.cpp 
 	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Interfaces
 	$(COMPILE.cc) -O2 -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Interfaces/Heartbeat.o src/NetPanzer/Interfaces/Heartbeat.cpp

Modified: trunk/netpanzer/nbproject/configurations.xml
===================================================================
--- trunk/netpanzer/nbproject/configurations.xml	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/nbproject/configurations.xml	2008-09-01 16:39:08 UTC (rev 1039)
@@ -306,8 +306,6 @@
           &lt;itemPath&gt;src/NetPanzer/Classes/Outpost.hpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/Classes/PlacementMatrix.cpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/Classes/PlacementMatrix.hpp&lt;/itemPath&gt;
-          &lt;itemPath&gt;src/NetPanzer/Classes/PlayerID.cpp&lt;/itemPath&gt;
-          &lt;itemPath&gt;src/NetPanzer/Classes/PlayerID.hpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/Classes/PlayerState.cpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/Classes/PlayerState.hpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/Classes/PlayerUnitConfig.cpp&lt;/itemPath&gt;
@@ -1437,12 +1435,6 @@
       &lt;item path=&quot;src/NetPanzer/Classes/PlacementMatrix.hpp&quot;&gt;
         &lt;itemTool&gt;3&lt;/itemTool&gt;
       &lt;/item&gt;
-      &lt;item path=&quot;src/NetPanzer/Classes/PlayerID.cpp&quot;&gt;
-        &lt;itemTool&gt;1&lt;/itemTool&gt;
-      &lt;/item&gt;
-      &lt;item path=&quot;src/NetPanzer/Classes/PlayerID.hpp&quot;&gt;
-        &lt;itemTool&gt;3&lt;/itemTool&gt;
-      &lt;/item&gt;
       &lt;item path=&quot;src/NetPanzer/Classes/PlayerState.cpp&quot;&gt;
         &lt;itemTool&gt;1&lt;/itemTool&gt;
       &lt;/item&gt;
@@ -3172,12 +3164,6 @@
       &lt;item path=&quot;src/NetPanzer/Classes/PlacementMatrix.hpp&quot;&gt;
         &lt;itemTool&gt;3&lt;/itemTool&gt;
       &lt;/item&gt;
-      &lt;item path=&quot;src/NetPanzer/Classes/PlayerID.cpp&quot;&gt;
-        &lt;itemTool&gt;1&lt;/itemTool&gt;
-      &lt;/item&gt;
-      &lt;item path=&quot;src/NetPanzer/Classes/PlayerID.hpp&quot;&gt;
-        &lt;itemTool&gt;3&lt;/itemTool&gt;
-      &lt;/item&gt;
       &lt;item path=&quot;src/NetPanzer/Classes/PlayerState.cpp&quot;&gt;
         &lt;itemTool&gt;1&lt;/itemTool&gt;
       &lt;/item&gt;

Modified: trunk/netpanzer/src/NetPanzer/Bot/BotPlayer.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Bot/BotPlayer.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Bot/BotPlayer.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -27,7 +27,6 @@
 
 #include &quot;Interfaces/PlayerInterface.hpp&quot;
 #include &quot;Interfaces/UnitProfileInterface.hpp&quot;
-#include &quot;Classes/PlayerID.hpp&quot;
 #include &quot;Interfaces/UnitInterface.hpp&quot;
 #include &quot;Interfaces/MapInterface.hpp&quot;
 #include &quot;Classes/UnitBase.hpp&quot;

Modified: trunk/netpanzer/src/NetPanzer/Classes/BonusUnitPowerUp.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/BonusUnitPowerUp.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/BonusUnitPowerUp.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -79,14 +79,14 @@
         if ( new_unit != 0 ) {
             UnitRemoteCreate create_mesg(new_unit-&gt;player-&gt;getID(),
                     new_unit-&gt;id, spawn_loc.x, spawn_loc.y, bonus_unit_type);
-            SERVER-&gt;sendMessage( &amp;create_mesg, sizeof( UnitRemoteCreate ));
+            SERVER-&gt;broadcastMessage( &amp;create_mesg, sizeof( UnitRemoteCreate ));
         }
 
     }
 
     PowerUpHitMesg hit_mesg;
     hit_mesg.set( powerup_state.ID, unit-&gt;player-&gt;getID() );
-    SERVER-&gt;sendMessage( &amp;hit_mesg, sizeof( PowerUpHitMesg ));
+    SERVER-&gt;broadcastMessage( &amp;hit_mesg, sizeof( PowerUpHitMesg ));
 
     powerup_state.life_cycle_state = _power_up_lifecycle_state_inactive;
 
@@ -119,15 +119,11 @@
 
 void BonusUnitPowerUp::onHit( PowerUpHitMesg *message  )
 {
-    PlayerID local_player_id;
-
     sound-&gt;playPowerUpSound();
     powerup_state.life_cycle_state = _power_up_lifecycle_state_inactive;
 
-    local_player_id = PlayerInterface::getLocalPlayerID();
-
-    if( local_player_id.getIndex() == message-&gt;getPlayerID() ) {
+    if( PlayerInterface::getLocalPlayerIndex() == message-&gt;getPlayerID() )
+    {
         ConsoleInterface::postMessage( Color::unitAqua, &quot;YOU GOT A BONUS UNITS POWERUP&quot; );
     }
-
 }

Modified: trunk/netpanzer/src/NetPanzer/Classes/EnemyRadarPowerUp.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/EnemyRadarPowerUp.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/EnemyRadarPowerUp.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -63,7 +63,7 @@
 
     PowerUpHitMesg hit_mesg;
     hit_mesg.set(powerup_state.ID, unit-&gt;player-&gt;getID());
-    SERVER-&gt;sendMessage( &amp;hit_mesg, sizeof( PowerUpHitMesg ));
+    SERVER-&gt;broadcastMessage( &amp;hit_mesg, sizeof( PowerUpHitMesg ));
 
     powerup_state.life_cycle_state = _power_up_lifecycle_state_inactive;
 }
@@ -97,11 +97,9 @@
 EnemyRadarPowerUp::onHit( PowerUpHitMesg *message  )
 {
     sound-&gt;playPowerUpSound();
-    PlayerID local_player_id;
 
-    local_player_id = PlayerInterface::getLocalPlayerID();
-
-    if( local_player_id.getIndex() == message-&gt;getPlayerID() ) {
+    if( PlayerInterface::getLocalPlayerIndex() == message-&gt;getPlayerID() )
+    {
         MiniMapInterface::setShowEnemyRadar( 180 );
         ConsoleInterface::postMessage(Color::unitAqua, &quot;YOU GOT AN ENEMY RADAR POWERUP&quot; );
     }

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/ClientServerNetMessage.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/ClientServerNetMessage.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/ClientServerNetMessage.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -19,7 +19,6 @@
 #define _CLIENT_SERVER_NETMESSAGE_HPP
 
 #include &quot;NetMessage.hpp&quot;
-#include &quot;Classes/PlayerID.hpp&quot;
 
 enum { _net_message_id_transport_client_accept,
        _net_message_id_client_connect_ack,

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageDecoder.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageDecoder.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageDecoder.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -19,7 +19,6 @@
 #define __NETMESSAGEDECODER_HPP__
 
 #include &quot;Classes/Network/NetPacket.hpp&quot;
-#include &quot;Classes/PlayerID.hpp&quot;
 
 class NetMessageDecoder
 {

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageEncoder.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageEncoder.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageEncoder.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -31,11 +31,11 @@
     resetEncoder();
 }
 
-NetMessageEncoder::NetMessageEncoder(const PlayerID&amp; id)
+NetMessageEncoder::NetMessageEncoder(Uint16 player_index)
 {
     usePlayerID = true;
     sendAsClient = false;
-    playerID = id;
+    player = player_index;
     resetEncoder();
 }
 
@@ -73,11 +73,11 @@
     if (encode_message.message_count &gt; 0) {
         size_t size = encode_message_index + encode_message.getHeaderSize();
         if(usePlayerID) {
-            SERVER-&gt;sendMessage(playerID, &amp;encode_message, size);
+            SERVER-&gt;sendMessage(player, &amp;encode_message, size);
         } else if(sendAsClient) {
             CLIENT-&gt;sendMessage(&amp;encode_message, size);
         } else if(NetworkState::status == _network_state_server) {
-            SERVER-&gt;sendMessage(&amp;encode_message, size);
+            SERVER-&gt;broadcastMessage(&amp;encode_message, size);
         } else {
             CLIENT-&gt;sendMessage(&amp;encode_message, size);
         }

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageEncoder.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageEncoder.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetMessageEncoder.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -19,20 +19,19 @@
 #define _NETMESSAGEENCODER_HPP
 
 #include &quot;Classes/Network/NetPacket.hpp&quot;
-#include &quot;Classes/PlayerID.hpp&quot;
 
 class NetMessageEncoder
 {
 private:
     bool sendAsClient;
     bool usePlayerID;
-    PlayerID playerID;
+    Uint16 player;
     MultiMessage encode_message;
     unsigned long encode_message_index;
 
 public:
     NetMessageEncoder(bool sendAsClient = false);
-    NetMessageEncoder(const PlayerID&amp; id);
+    NetMessageEncoder(Uint16 player_index);
     ~NetMessageEncoder();
     
     void resetEncoder();

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetPacket.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetPacket.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetPacket.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -24,7 +24,6 @@
 #include &quot;NetMessage.hpp&quot;
 
 static const Uint16 _MAX_NET_PACKET_SIZE=512;
-typedef Uint32 NetClientID;
 class ClientSocket;
 
 #ifdef MSVC
@@ -33,8 +32,6 @@
 class NetPacket
 {
 public:
-    NetClientID toID;
-    NetClientID fromID;
     ClientSocket *fromClient;
 
     Uint8  data[ _MAX_NET_PACKET_SIZE ];
@@ -46,7 +43,7 @@
 
     size_t getSize() const
     {
-        return sizeof(NetClientID) * 2 + getNetMessage()-&gt;getSize();
+        return sizeof(ClientSocket *) + getNetMessage()-&gt;getSize();
     }
 }
 __attribute__((packed));

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -162,8 +162,7 @@
     
     if (connection_type == _connection_loop_back)
     {
-        net_packet.fromID = 0;
-        net_packet.toID = 0;
+        net_packet.fromClient = clientsocket;
         memcpy(net_packet.data, message, size);
         loop_back_recv_queue.enqueue(net_packet);
 #ifdef NETWORKDEBUG

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkClient.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -25,7 +25,6 @@
 #include &quot;Network/ClientSocket.hpp&quot;
 
 #include &quot;Util/Timer.hpp&quot;
-#include &quot;Classes/PlayerID.hpp&quot;
 #include &quot;ArrayUtil/ArrayTemplate.hpp&quot;
 
 enum { _connection_loop_back,

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkInterface.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkInterface.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -21,14 +21,10 @@
 #include &quot;Util/Log.hpp&quot;
 #include &quot;NetworkInterface.hpp&quot;
 
-void EnqueueIncomingPacket(const void *message, Uint16 message_size,
-                           NetClientID toID, NetClientID fromID,
-                           ClientSocket *fromClient)
+void EnqueueIncomingPacket(const void *message, Uint16 message_size, ClientSocket *fromClient)
 {
     static NetPacket TEMP_PACKET;
 
-    TEMP_PACKET.toID = toID;
-    TEMP_PACKET.fromID = fromID;
     TEMP_PACKET.fromClient = fromClient;
     assert(message_size &lt;= _MAX_NET_PACKET_SIZE);
 

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkInterface.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkInterface.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkInterface.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -21,7 +21,6 @@
 #include &quot;NetPacketQueues.hpp&quot;
 
 void EnqueueIncomingPacket(const void *message, Uint16 message_size,
-                           NetClientID toID, NetClientID fromID,
                            ClientSocket *fromClient);
 
 class NetworkInterface

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -139,7 +139,7 @@
 }
 
 void
-NetworkServer::sendMessage(NetMessage *message, size_t size)
+NetworkServer::broadcastMessage(NetMessage *message, size_t size)
 {
     ClientList::iterator i = client_list.begin();
     while ( i != client_list.end() )
@@ -167,14 +167,14 @@
 }
 
 void
-NetworkServer::sendMessage(NetClientID network_id, NetMessage* message,
+NetworkServer::sendMessage(Uint16 player_index, NetMessage* message,
         size_t size)
 {
     if( socket == 0 )
         return;
     
     ClientList::iterator i = client_list.begin();
-    while ( i != client_list.end() &amp;&amp; (*i)-&gt;client_socket-&gt;getId() != network_id )
+    while ( i != client_list.end() &amp;&amp; (*i)-&gt;client_socket-&gt;getPlayerIndex() != player_index )
     {
         ++i;
     }
@@ -195,14 +195,14 @@
         }
         catch (NetworkException e)
         {
-            LOG ( (&quot;Network send error when sending to client %d: %s&quot;,
-                   network_id, e.what()) );
+            LOG ( (&quot;Network send error when sending to client (index) %d: %s&quot;,
+                   player_index, e.what()) );
             dropClient((*i)-&gt;client_socket);
         }
     }
     else
     {
-        LOGGER.warning(&quot;NetworkServer: sendMessage to unknown client: %d&quot;, network_id);
+        LOGGER.warning(&quot;NetworkServer: sendMessage to unknown client: (index) %d&quot;, player_index);
     }
 }
 
@@ -262,7 +262,7 @@
     {
         if ( (*i)-&gt;client_socket == client )
         {
-            LOGGER.warning(&quot;NetworkServer: disconnecting client [%d]&quot;, client-&gt;getId());
+            LOGGER.warning(&quot;NetworkServer: disconnecting client [%d]&quot;, client-&gt;getPlayerIndex());
             client_list.erase(i);
             delete (*i)-&gt;client_socket;
             delete *i;
@@ -310,12 +310,12 @@
 }
 
 std::string
-NetworkServer::getIP(NetClientID id)
+NetworkServer::getIP(Uint16 player_index)
 {
     ClientList::iterator i = client_list.begin();
     while ( i != client_list.end() )
     {
-        if ( (*i)-&gt;client_socket-&gt;getId() == id )
+        if ( (*i)-&gt;client_socket-&gt;getPlayerIndex() == player_index )
         {
             return (*i)-&gt;client_socket-&gt;getIPAddress();
         }
@@ -345,7 +345,7 @@
 void
 NetworkServer::onClientConnected(ClientSocket *s)
 {
-    NetClientID id = s-&gt;getId();
+    int id = s-&gt;getId();
     LOGGER.debug(&quot;NetworkServer: client connected [%d]&quot;, id);
     //clients[id] = s;
     

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -25,7 +25,6 @@
 #include &quot;Network/ClientSocket.hpp&quot;
 
 #include &quot;Util/Timer.hpp&quot;
-#include &quot;Classes/PlayerID.hpp&quot;
 
 using namespace network;
 
@@ -75,17 +74,11 @@
     
     void closeSession();
 
-    void sendMessage(NetMessage *message, size_t size);
+    void broadcastMessage(NetMessage *message, size_t size);
     
-    void sendMessage(NetClientID network_id, NetMessage* message,
+    void sendMessage(Uint16 player_index, NetMessage* message,
             size_t size);
-    
-    void sendMessage(const PlayerID&amp; player_id, NetMessage *message,
-            size_t size)
-    {
-        sendMessage(player_id.getNetworkID(), message, size);
-    }
-    
+        
     void sendRemaining();
 
     bool getPacket(NetPacket* packet);
@@ -96,7 +89,7 @@
     ClientSocket * getClientSocketByPlayerIndex ( Uint16 index );
 
     void checkIncoming();
-    std::string getIP(NetClientID network_id);
+    std::string getIP(Uint16 player_index);
 
 protected:
     TCPSocketObserver * onNewConnection(TCPListenSocket *so,const Address &amp;fromaddr);

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/PowerUpNetMessage.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/PowerUpNetMessage.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/PowerUpNetMessage.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -20,7 +20,6 @@
 
 #include &quot;NetMessage.hpp&quot;
 
-#include &quot;Classes/PlayerID.hpp&quot;
 #include &quot;Classes/UnitBase.hpp&quot;
 
 enum { _net_message_id_powerup_create,

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -78,7 +78,7 @@
     connect_unit_sync = 0;
     ConnectMesgNetPanzerServerDisconnect server_disconnect;
 
-    SERVER-&gt;sendMessage( &amp;server_disconnect,
+    SERVER-&gt;broadcastMessage( &amp;server_disconnect,
                          sizeof(ConnectMesgNetPanzerServerDisconnect));
 }
 
@@ -208,7 +208,7 @@
         client-&gt;sendMessage( &amp;chat_mesg, sizeof(chat_mesg));
     }
 
-    SERVER-&gt;sendMessage( &amp;connect_alert, sizeof(SystemConnectAlert));
+    SERVER-&gt;broadcastMessage( &amp;connect_alert, sizeof(SystemConnectAlert));
 }
 
 void ServerConnectDaemon::resetConnectFsm()
@@ -297,7 +297,7 @@
             Uint8 flag = (Uint8) client_setting-&gt;getPlayerFlag();
             player-&gt;setFlag(flag);
 
-            player-&gt;setID( connect_client-&gt;getId() );
+            player-&gt;setID( connect_client-&gt;getPlayerIndex() );
             player-&gt;setStatus( _player_state_connecting );
 
             // ** send server game setting map, units, player, etc.
@@ -416,7 +416,7 @@
         PlayerState *p = PlayerInterface::getPlayer(connect_client-&gt;getPlayerIndex());
         PlayerStateSync player_state_update( p-&gt;getNetworkPlayerState() );
         player_state_update.setSize(sizeof(PlayerStateSync));
-        SERVER-&gt;sendMessage(&amp;player_state_update, sizeof(PlayerStateSync));
+        SERVER-&gt;broadcastMessage(&amp;player_state_update, sizeof(PlayerStateSync));
         
         if(connection_state != connect_state_idle)
         {
@@ -465,15 +465,16 @@
 
     PowerUpInterface::syncPowerUps( connect_client );
 
+    GameManager::spawnPlayer( connect_client-&gt;getPlayerIndex() );
+
     PlayerState * player = PlayerInterface::getPlayer(connect_client-&gt;getPlayerIndex());
-    GameManager::spawnPlayer( player );
 
     player-&gt;setStatus( _player_state_active );
 
     PlayerStateSync player_state_update
         (player-&gt;getNetworkPlayerState());
 
-    SERVER-&gt;sendMessage( &amp;player_state_update, sizeof(PlayerStateSync));
+    SERVER-&gt;broadcastMessage( &amp;player_state_update, sizeof(PlayerStateSync));
 
     state_mesg.setMessageEnum(_connect_state_sync_complete);
     // size already set
@@ -568,7 +569,7 @@
     ConsoleInterface::postMessage(Color::cyan, &quot;'%s' has left the game.&quot;,
                                   (player)?player-&gt;getName().c_str():&quot;&quot;);
 
-    SERVER-&gt;sendMessage(&amp;msg, sizeof(msg));
+    SERVER-&gt;broadcastMessage(&amp;msg, sizeof(msg));
 }
 
 void ServerConnectDaemon::startClientDropProcess( ClientSocket * client )
@@ -583,7 +584,7 @@
     ConsoleInterface::postMessage(Color::cyan, &quot;'%s' has left the game for some reason.&quot;,
                                   (player)?player-&gt;getName().c_str():&quot;&quot;);
 
-    SERVER-&gt;sendMessage(&amp;msg, sizeof(msg));
+    SERVER-&gt;broadcastMessage(&amp;msg, sizeof(msg));
 
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/ServerMessageRouter.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/ServerMessageRouter.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/ServerMessageRouter.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -67,7 +67,7 @@
         }
         default:
             LOGGER.warning(&quot;unnown Terminal Message (id %d, player %u)&quot;,
-                    message-&gt;message_id, packet-&gt;fromID);
+                    message-&gt;message_id, packet-&gt;fromClient-&gt;getPlayerIndex());
     }
 }
 
@@ -116,8 +116,6 @@
             message_decoder.setDecodeMessage((const MultiMessage *) message);
 
             NetPacket packet;
-            packet.toID = temp_packet.toID;
-            packet.fromID = temp_packet.fromID;
             packet.fromClient = temp_packet.fromClient;
             
             NetMessage* mmessage;

Modified: trunk/netpanzer/src/NetPanzer/Classes/Outpost.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Outpost.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/Outpost.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -74,7 +74,7 @@
                         unit_generation_on_flag,
                         unit_generation_type,
                         Uint32(unit_generation_timer.getTimeLeft() * 128.0));
-            SERVER-&gt;sendMessage(&amp;update_mesg, sizeof(ObjectiveOccupationUpdate));
+            SERVER-&gt;broadcastMessage(&amp;update_mesg, sizeof(ObjectiveOccupationUpdate));
 
             const PlayerState *player_state = objective_state.occupying_player;
             ConsoleInterface::postMessage(Color::cyan, &quot;'%s' has been occupied by '%s'&quot;,
@@ -92,7 +92,7 @@
                         unit_generation_on_flag,
                         unit_generation_type,
                         Uint32(unit_generation_timer.getTimeLeft() * 128));
-                SERVER-&gt;sendMessage(&amp;update_mesg,
+                SERVER-&gt;broadcastMessage(&amp;update_mesg,
                         sizeof(ObjectiveOccupationUpdate));
                 const PlayerState *player = objective_state.occupying_player;
                 ConsoleInterface::postMessage(Color::cyan, &quot;'%s' has been occupied by '%s'&quot;,
@@ -156,7 +156,7 @@
                     UnitRemoteCreate create_mesg(unit-&gt;player-&gt;getID(),
                             unit-&gt;id, gen_loc.x, gen_loc.y,
                             unit_generation_type);
-                    SERVER-&gt;sendMessage(&amp;create_mesg, sizeof(UnitRemoteCreate));
+                    SERVER-&gt;broadcastMessage(&amp;create_mesg, sizeof(UnitRemoteCreate));
 
                     UMesgAICommand ai_command;
                     PlacementMatrix placement_matrix;
@@ -240,7 +240,7 @@
                                            0,
                                            0);
 
-            SERVER-&gt;sendMessage(&amp;update_mesg, sizeof(ObjectiveOccupationUpdate));
+            SERVER-&gt;broadcastMessage(&amp;update_mesg, sizeof(ObjectiveOccupationUpdate));
 
             unit_generation_type = 0;
             UnitProfile *profile

Deleted: trunk/netpanzer/src/NetPanzer/Classes/PlayerID.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/PlayerID.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/PlayerID.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -1,19 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#include &lt;config.h&gt;
-#include &quot;Classes/PlayerID.hpp&quot;

Deleted: trunk/netpanzer/src/NetPanzer/Classes/PlayerID.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/PlayerID.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/PlayerID.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -1,77 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef _PLAYERID_HPP
-#define _PLAYERID_HPP
-
-#include &quot;Classes/Network/NetPacket.hpp&quot;
-
-class PlayerID
-{
-public:
-    PlayerID( )
-            : index_id(0xFFFF), networkid(0xFFFFFFFF)
-    { }
-
-    PlayerID(Uint16 index, NetClientID newid)
-            : index_id(index), networkid(newid)
-    { }
-
-    PlayerID(const PlayerID&amp; other)
-            : index_id(other.index_id), networkid(other.networkid)
-    { }
-
-    void operator = (const PlayerID&amp; other)
-    {
-        index_id = other.index_id;
-        networkid = other.networkid;
-    }
-
-    void setIndex(Uint16 index)
-    {
-        index_id = index;
-    }
-
-    Uint16 getIndex() const
-    {
-        return index_id;
-    }
-
-    void setNetworkID(NetClientID newid)
-    {
-        networkid = newid;
-    }
-
-    NetClientID getNetworkID() const
-    {
-        return networkid;
-    }
-
-    bool operator==(const PlayerID &amp;rhs) const
-    {
-        if ( (index_id == rhs.index_id) &amp;&amp; (networkid == rhs.networkid) )
-            return true;
-
-        return false;
-    }
-
-private:
-    Uint16 index_id;
-    NetClientID networkid;
-};
-
-#endif // ** _PLAYERID_HPP

Modified: trunk/netpanzer/src/NetPanzer/Classes/PlayerState.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/PlayerState.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/PlayerState.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -94,11 +94,15 @@
 static const size_t playerColorCount 
     = sizeof(playerColorArray) / sizeof(Uint8*);
 
-void PlayerState::setColor(Uint32 index) {
+void
+PlayerState::setColor(Uint32 index)
+{
     colorIndex = index % playerColorCount;
 }
 
-Uint8 PlayerState::getColor() const {
+Uint8
+PlayerState::getColor() const
+{
     assert(colorIndex &lt; playerColorCount);
     return ( *playerColorArray[ colorIndex ] );
 }
@@ -111,8 +115,8 @@
 }
 
 PlayerState::PlayerState(const PlayerState&amp; other)
-    : name(other.name), flag(other.flag), status(other.status),
-      kills(other.kills), kill_points(other.kill_points),
+    : name(other.name), flag(other.flag), player_index(other.player_index),
+      status(other.status), kills(other.kills), kill_points(other.kill_points),
       losses(other.losses), loss_points(other.loss_points),
       total(other.total), objectives_held(other.objectives_held),
       stats_locked(other.stats_locked), unit_config(other.unit_config)
@@ -132,33 +136,43 @@
     objectives_held = other.objectives_held;
     stats_locked = other.stats_locked;
     unit_config = other.unit_config;
+    player_index = other.player_index;
 }
 
 void PlayerState::setName(const std::string&amp; newname)
 {
     if ( newname.length() &gt; 63 )
+    {
         name = newname.substr(0,63);
+    }
     else
+    {
         name = newname;
+    }
 
     int namenum=1;
     bool recheck;
-    do {
+    do
+    {
         recheck = false;
-        for (Uint16 p=0; p&lt;PlayerInterface::getMaxPlayers(); p++) {
-            if ( p == ID.getIndex() )
+        for (Uint16 p=0; p&lt;PlayerInterface::getMaxPlayers(); p++)
+        {
+            if ( p == player_index )
                 continue;
                 
             PlayerState *ps=PlayerInterface::getPlayer(p);
-            if ( (ps-&gt;status==_player_state_connecting 
-                    || ps-&gt;status==_player_state_active )
-                    &amp;&amp; ps-&gt;name == name ) {
+            if (   (ps-&gt;status==_player_state_connecting 
+                   || ps-&gt;status==_player_state_active )
+                  &amp;&amp; ps-&gt;name == name
+               )
+            {
                 std::stringstream ssnamenum;
                 ssnamenum &lt;&lt; &quot;(&quot; &lt;&lt; namenum++ &lt;&lt; &quot;)&quot;;
                 std::string strnum=ssnamenum.str();
                 
                 std::string::size_type newlen = newname.length();
-                if ( newlen+strnum.length() &gt; 63 ) {
+                if ( newlen+strnum.length() &gt; 63 )
+                {
                     newlen -= strnum.length() - (63 - newlen);  
                 }
                 
@@ -170,11 +184,6 @@
     } while (recheck);
 }
 
-void PlayerState::setPlayerID(PlayerID player_id)
-{
-    ID = player_id;
-}
-
 void PlayerState::resetStats()
 {
     kills  = 0;
@@ -213,7 +222,8 @@
 
 void PlayerState::incKills(UnitType unit_type)
 {
-    if ( stats_locked == true ) return;
+    if ( stats_locked == true )
+        return;
     kills++;
     //kill_points += 2 * unit_config.getUnitPointValue(unit_type);
 }
@@ -221,13 +231,15 @@
 void PlayerState::decKills(UnitType unit_type)
 {
     (void) unit_type;
-    if ( stats_locked == true ) return;
+    if ( stats_locked == true )
+        return;
     kills--;
 }
 
 void PlayerState::incLosses(UnitType unit_type)
 {
-    if ( stats_locked == true ) return;
+    if ( stats_locked == true )
+        return;
     losses++;
     //loss_points += unit_config.getUnitPointValue(unit_type);
 }
@@ -235,19 +247,22 @@
 void PlayerState::decLosses(UnitType unit_type)
 {
     (void) unit_type;
-    if ( stats_locked == true ) return;
+    if ( stats_locked == true )
+        return;
     losses--;
 }
 
 void PlayerState::incObjectivesHeld()
 {
-    if ( stats_locked == true ) return;
+    if ( stats_locked == true )
+        return;
     objectives_held++;
 }
 
 void PlayerState::decObjectivesHeld()
 {
-    if ( stats_locked == true ) return;
+    if ( stats_locked == true )
+        return;
     objectives_held++;
 }
 
@@ -258,31 +273,16 @@
 
 void PlayerState::setObjectivesHeld( short objectives )
 {
-    if ( stats_locked == true ) return;
+    if ( stats_locked == true )
+        return;
     objectives_held = objectives;
 }
 
-void PlayerState::setID( unsigned short index, NetClientID networkid  )
-{
-    ID.setIndex(index);
-    ID.setNetworkID(networkid);
-}
-
 void PlayerState::setID( unsigned short index )
 {
-    ID.setIndex( index );
+    player_index = index;
 }
 
-void PlayerState::setID( NetClientID networkid )
-{
-    ID.setNetworkID(networkid);
-}
-
-PlayerID PlayerState::getPlayerID() const
-{
-    return ID;
-}
-
 void PlayerState::setStatus( unsigned char status )
 {
     PlayerState::status = status;
@@ -296,29 +296,39 @@
 void PlayerState::setFlag(unsigned char newflag)
 {
     if ( newflag &gt;= UNIT_FLAGS_SURFACE.getNumFrames() )
+    {
         newflag=0;
+    }
+    
     flag = newflag;
     
     bool recheck;
-    do {
+    do
+    {
         recheck = false;
-        for (Uint16 p=0; p&lt;PlayerInterface::getMaxPlayers(); p++) {
-            if ( p == ID.getIndex() )
+        for (Uint16 p=0; p&lt;PlayerInterface::getMaxPlayers(); p++)
+        {
+            if ( p == player_index )
                 continue;
                 
             PlayerState *ps=PlayerInterface::getPlayer(p);
-            if ( (ps-&gt;status==_player_state_connecting 
-                    || ps-&gt;status==_player_state_active )
-                    &amp;&amp; ps-&gt;flag == flag ) {
+            if (  (ps-&gt;status==_player_state_connecting 
+                  || ps-&gt;status==_player_state_active )
+                 &amp;&amp; ps-&gt;flag == flag
+               )
+            {
                 flag++;
                 if ( flag &gt;= UNIT_FLAGS_SURFACE.getNumFrames() )
                     flag = 0;
                     
                 if ( flag != newflag ) // there are no free flags if it is ==
+                {
                     recheck = true;
+                }
                 else
+                {
                     LOGGER.warning(&quot;No more free flags&quot;);
-                    
+                }   
                 break;
             }
         }
@@ -342,7 +352,7 @@
     memset(state.name, 0, sizeof(state.name));
     strncpy(state.name, name.c_str(), sizeof(state.name)-1);
     state.flag = flag;
-    state.playerindex_id = htol16(ID.getIndex());
+    state.playerindex_id = htol16(player_index);
     state.status = status;
     state.kills = htol16(kills);
     state.kill_points = htol16(kill_points);
@@ -361,13 +371,16 @@
     memcpy(tmp, state-&gt;name, 64); 
     tmp[63] = 0;
     name = tmp;
-	if(state-&gt;flag &lt; UNIT_FLAGS_SURFACE.getNumFrames()) {
+	if(state-&gt;flag &lt; UNIT_FLAGS_SURFACE.getNumFrames())
+        {
 		flag = state-&gt;flag;
-	} else {
+	}
+        else
+        {
 		flag = 0;
 		LOGGER.warning(&quot;Invalid flag number received&quot;);
 	}
-    ID.setIndex(ltoh16(state-&gt;playerindex_id));
+    player_index = ltoh16(state-&gt;playerindex_id);
     status = state-&gt;status;
     kills = ltoh16(state-&gt;kills);
     kill_points = ltoh16(state-&gt;kill_points);
@@ -377,4 +390,3 @@
     objectives_held = ltoh16(state-&gt;objectives_held);
     colorIndex = ltoh32(state-&gt;colorIndex);
 }
-

Modified: trunk/netpanzer/src/NetPanzer/Classes/PlayerState.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/PlayerState.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/PlayerState.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -20,7 +20,6 @@
 
 #include &lt;string&gt;
 #include &lt;string.h&gt;
-#include &quot;Classes/PlayerID.hpp&quot;
 #include &quot;Classes/PlayerUnitConfig.hpp&quot;
 #include &quot;2D/Palette.hpp&quot;
 
@@ -68,7 +67,7 @@
 private:
     std::string name;
     unsigned char flag;
-    PlayerID ID;
+    Uint16 player_index;
     unsigned char status;
     short kills;
     short kill_points;
@@ -88,10 +87,10 @@
     void operator= (const PlayerState&amp; other);
 
     void setName(const std::string&amp; newname);
-    void setPlayerID( PlayerID player_id );
+
     Uint16 getID() const
     {
-        return ID.getIndex();
+        return player_index;
     }
 
     void resetStats();
@@ -108,18 +107,7 @@
     void decObjectivesHeld();
     short getObjectivesHeld() const;
     void setObjectivesHeld( short objectives );
-    void setID( unsigned short index, NetClientID networkid  );
     void setID( unsigned short index );
-    void setID( NetClientID networkid );
-    PlayerID getPlayerID() const;
-    NetClientID getNetworkID() const
-    {
-        return ID.getNetworkID();
-    }
-    void setNetworkID(NetClientID id)
-    {
-        ID.setNetworkID(id);
-    }
     void setStatus( unsigned char status );
     unsigned char getStatus() const;
     void setFlag(unsigned char newflag);

Modified: trunk/netpanzer/src/NetPanzer/Classes/UnitOpcodeEncoder.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/UnitOpcodeEncoder.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/UnitOpcodeEncoder.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -58,7 +58,7 @@
         return;
 
     size_t size = opcode_message.getHeaderSize() + opcode_index;
-    SERVER-&gt;sendMessage(&amp;opcode_message, size);
+    SERVER-&gt;broadcastMessage(&amp;opcode_message, size);
 
     reset();
     NetworkState::incOpcodesSent();

Modified: trunk/netpanzer/src/NetPanzer/Classes/UnitPowerUp.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/UnitPowerUp.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Classes/UnitPowerUp.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -167,7 +167,7 @@
 
     PowerUpHitMesg hit_mesg;
     hit_mesg.set(powerup_state.ID, unit-&gt;player-&gt;getID(), unit_powerup_type);
-    SERVER-&gt;sendMessage(&amp;hit_mesg, sizeof(PowerUpHitMesg));
+    SERVER-&gt;broadcastMessage(&amp;hit_mesg, sizeof(PowerUpHitMesg));
 
     powerup_state.life_cycle_state = _power_up_lifecycle_state_inactive;
 
@@ -229,15 +229,13 @@
 
 void UnitPowerUp::onHit( PowerUpHitMesg *message  )
 {
-    PlayerID local_player_id;
-
     sound-&gt;playPowerUpSound();
     powerup_state.life_cycle_state = _power_up_lifecycle_state_inactive;
 
-    local_player_id = PlayerInterface::getLocalPlayerID();
-
-    if( local_player_id.getIndex() == message-&gt;getPlayerID() ) {
-        ConsoleInterface::postMessage(Color::unitAqua, &quot;YOU GOT A %s POWERUP&quot;, powerupTypeToString( message-&gt;getUnitPowerupType() ) );
+    if( PlayerInterface::getLocalPlayerIndex() == message-&gt;getPlayerID() )
+    {
+        ConsoleInterface::postMessage(Color::unitAqua, &quot;YOU GOT A %s POWERUP&quot;,
+                        powerupTypeToString( message-&gt;getUnitPowerupType() ) );
     }
 
 }

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/ChatInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/ChatInterface.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/ChatInterface.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -52,40 +52,48 @@
              chat_request-&gt;message_text);
 
     if( chat_request-&gt;message_scope == _chat_mesg_scope_all ) {
-        SERVER-&gt;sendMessage(&amp;chat_mesg, sizeof(ChatMesg));
+        SERVER-&gt;broadcastMessage(&amp;chat_mesg, sizeof(ChatMesg));
         post_on_server = true;
     } else if( chat_request-&gt;message_scope == _chat_mesg_scope_alliance ) {
         unsigned long max_players;
         unsigned short local_player_index;
-        PlayerID player_id;
+        PlayerState * player = 0;
 
         local_player_index = PlayerInterface::getLocalPlayerIndex();
 
         max_players = PlayerInterface::getMaxPlayers();
-        for( unsigned long i = 0; i &lt; max_players; i++ ) {
-            player_id = PlayerInterface::getPlayerID( i );
+        for( unsigned long i = 0; i &lt; max_players; i++ )
+        {
+            player = PlayerInterface::getPlayer( (unsigned short)i );
 
-            if ( (PlayerInterface::getPlayer(i)-&gt;getStatus() == _player_state_active) ) {
-                if( PlayerInterface::isAllied( chat_request-&gt;getSourcePlayerIndex(), i ) == true ) {
-                    if ( (local_player_index != i) ) {
-                        SERVER-&gt;sendMessage(player_id, &amp;chat_mesg,
+            if ( player-&gt;getStatus() == _player_state_active )
+            {
+                if( PlayerInterface::isAllied( chat_request-&gt;getSourcePlayerIndex(), i ) == true )
+                {
+                    if ( local_player_index != i )
+                    {
+                        SERVER-&gt;sendMessage((unsigned short)i, &amp;chat_mesg,
                                 sizeof(ChatMesg));
-                    } else {
+                    }
+                    else
+                    {
                         post_on_server = true;
                     }
                 }
             }
         }
 
-        if( chat_request-&gt;getSourcePlayerIndex() == PlayerInterface::getLocalPlayerIndex() ) {
+        if( chat_request-&gt;getSourcePlayerIndex() == PlayerInterface::getLocalPlayerIndex() )
+        {
             post_on_server = true;
-        } else {
-            SERVER-&gt;sendMessage(
-                    PlayerInterface::getPlayerID(chat_request-&gt;getSourcePlayerIndex()),
-                    &amp;chat_mesg, sizeof(ChatMesg));
         }
+        else
+        {
+            SERVER-&gt;sendMessage( chat_request-&gt;getSourcePlayerIndex(),
+                                 &amp;chat_mesg, sizeof(ChatMesg));
+        }
     } else if( chat_request-&gt;message_scope == _chat_mesg_scope_server ) {
-        SERVER-&gt;sendMessage(&amp;chat_mesg, sizeof(ChatMesg));
+        SERVER-&gt;broadcastMessage(&amp;chat_mesg, sizeof(ChatMesg));
         ConsoleInterface::postMessage(Color::unitAqua, &quot;Server: %s&quot;,
                 chat_mesg.message_text );
         return;

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -138,7 +138,7 @@
                         &lt;&lt; std::setw(4) &lt;&lt; playerstate-&gt;getLosses() &lt;&lt; &quot; &quot;
                         &lt;&lt; std::setw(5) &lt;&lt; playerstate-&gt;getTotal() &lt;&lt; &quot; &quot;
                         &lt;&lt; std::setw(21) 
-                        &lt;&lt; SERVER-&gt;getIP(playerstate-&gt;getNetworkID())
+                        &lt;&lt; SERVER-&gt;getIP(playerstate-&gt;getID())
                         &lt;&lt; &quot;\n&quot;;
                 }
                 //*Console::server &lt;&lt; std::flush;
@@ -163,7 +163,6 @@
                     std::cout &lt;&lt; &quot;Unknown player.&quot; &lt;&lt; std::endl;
                     break;
                 }
-                PlayerState* playerstate = PlayerInterface::getPlayer(id);
                 SERVER-&gt;shutdownClientTransport(SERVER-&gt;getClientSocketByPlayerIndex(id));
                 PlayerInterface::disconnectPlayerCleanup(id);
                 break;

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -181,7 +181,7 @@
                     Desktop::setVisibility(&quot;RankView&quot;, true );
                 }
 
-                SERVER-&gt;sendMessage(&amp;view_control, sizeof(SystemViewControl));
+                SERVER-&gt;broadcastMessage(&amp;view_control, sizeof(SystemViewControl));
 
                 map_cycle_fsm_server_endgame_timer.changePeriod( _MAP_CYCLE_ENDGAME_WAIT_PERIOD );
                 map_cycle_fsm_server_endgame_timer.reset();
@@ -210,7 +210,7 @@
                     GameControlCycleMap cycle_map_mesg;
                     cycle_map_mesg.set( gameconfig-&gt;map.c_str() );
 
-                    SERVER-&gt;sendMessage( &amp;cycle_map_mesg, sizeof( GameControlCycleMap ));
+                    SERVER-&gt;broadcastMessage( &amp;cycle_map_mesg, sizeof( GameControlCycleMap ));
 
                     if ( GameControlRulesDaemon::execution_mode == _execution_mode_dedicated_server ) {
                         ObjectiveInterface::resetLogic();
@@ -274,7 +274,7 @@
                 SystemResetGameLogic reset_game_logic_mesg;
 
                 GameManager::resetGameLogic();
-                SERVER-&gt;sendMessage( &amp;reset_game_logic_mesg, sizeof(SystemResetGameLogic));
+                SERVER-&gt;broadcastMessage( &amp;reset_game_logic_mesg, sizeof(SystemResetGameLogic));
 
                 GameManager::respawnAllPlayers();
 
@@ -284,7 +284,7 @@
                 LoadingView::loadFinish();
 
                 GameControlCycleRespawnAck respawn_ack_mesg;
-                SERVER-&gt;sendMessage( &amp;respawn_ack_mesg, sizeof(GameControlCycleRespawnAck));
+                SERVER-&gt;broadcastMessage( &amp;respawn_ack_mesg, sizeof(GameControlCycleRespawnAck));
 
                 map_cycle_fsm_server_state = _map_cycle_server_state_idle;
 
@@ -335,44 +335,50 @@
 
     if ( (GameControlRulesDaemon::game_state == _game_state_in_progress) &amp;&amp;
             (NetworkState::status == _network_state_server)
-       ) {
+       )
+    {
         unsigned char game_type;
         game_type = gameconfig-&gt;gametype;
 
-        switch( game_type ) {
-        case  _gametype_timelimit : {
+        switch( game_type )
+        {
+            case  _gametype_timelimit:
                 int game_minutes = GameManager::getGameTime() / 60;
-                if( game_minutes &gt;= gameconfig-&gt;timelimit ) {
+                if( game_minutes &gt;= gameconfig-&gt;timelimit )
+                {
                     onTimelimitGameCompleted();
                 }
-            }
-
-        case _gametype_fraglimit : {
-                if ( PlayerInterface::testRuleScoreLimit( gameconfig-&gt;fraglimit, &amp;player_state ) == true ) {
+                break;
+                
+            case _gametype_fraglimit:
+                if ( PlayerInterface::testRuleScoreLimit( gameconfig-&gt;fraglimit, &amp;player_state ) == true )
+                {
                     onFraglimitGameCompleted();
                 }
-            }
-            break;
+                break;
 
-        case _gametype_objective:
-                float ratio 
-                    = (float) gameconfig-&gt;objectiveoccupationpercentage / 100.0;
-                if (PlayerInterface::testRuleObjectiveRatio(
-                            ratio, &amp;player_state)) {
+            case _gametype_objective:
+                float ratio = (float) gameconfig-&gt;objectiveoccupationpercentage / 100.0;
+                if (PlayerInterface::testRuleObjectiveRatio( ratio, &amp;player_state))
+                {
                     onObjectiveGameCompleted( );
                 }
-            break;
-        } // ** switch
+                break;
+            default:
+                // nothing
+                ;
+        }
 
         // ** Check for Player Respawns **
         bool respawn_rule_complete = false;
-        while( respawn_rule_complete == false ) {
-            if ( PlayerInterface::testRulePlayerRespawn( &amp;respawn_rule_complete, &amp;player_state ) ) {
-                GameManager::spawnPlayer( player_state );
-            } // ** if testRulePlayerRespawn
+        while( respawn_rule_complete == false )
+        {
+            if ( PlayerInterface::testRulePlayerRespawn( &amp;respawn_rule_complete, &amp;player_state ) )
+            {
+                GameManager::spawnPlayer( player_state-&gt;getID() );
+            }
+        }
 
-        } // ** while
-
     }
 
 }

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -331,20 +331,23 @@
 }
 
 // ******************************************************************
-void GameManager::spawnPlayer( const PlayerID &amp;player )
+void GameManager::spawnPlayer( Uint16 player )
 {
     sound-&gt;stopTankIdle();
 
     // ** Get a new spawn point and spawn the player **
     iXY spawn_point = MapInterface::getFreeSpawnPoint();
-    PlayerInterface::spawnPlayer( player.getIndex(), spawn_point );
+    PlayerInterface::spawnPlayer( player, spawn_point );
 
     //** Change the location of the view camera to the spawn point **
     iXY world_loc;
     MapInterface::mapXYtoPointXY( spawn_point, &amp;world_loc );
-    if ( PlayerInterface::getLocalPlayerIndex() == player.getIndex() ) {
+    if ( PlayerInterface::getLocalPlayerIndex() == player )
+    {
         WorldViewInterface::setCameraPosition( world_loc );
-    } else {
+    }
+    else
+    {
         SystemSetPlayerView set_view(world_loc.x, world_loc.y);
         SERVER-&gt;sendMessage(player, &amp;set_view, sizeof(SystemSetPlayerView));
     }
@@ -360,22 +363,18 @@
 
     max_players = PlayerInterface::getMaxPlayers();
 
-    for( player_index = 0; player_index &lt; max_players; player_index++ ) {
+    for( player_index = 0; player_index &lt; max_players; player_index++ )
+    {
         player_state = PlayerInterface::getPlayer( player_index );
-        if ( player_state-&gt;getStatus() == _player_state_active ) {
-            spawnPlayer( player_state-&gt;getPlayerID() );
+        if ( player_state-&gt;getStatus() == _player_state_active )
+        {
+            spawnPlayer( player_index );
         }
     }
 }
 
 // ******************************************************************
-void GameManager::spawnPlayer( PlayerState *player_state )
-{
-    spawnPlayer( player_state-&gt;getPlayerID() );
-}
 
-// ******************************************************************
-
 void GameManager::netMessageSetView(const NetMessage* message)
 {
     const SystemSetPlayerView* set_view
@@ -475,23 +474,25 @@
 
 void GameManager::netMessagePingRequest(const NetMessage* message)
 {
-    PlayerID player_id;
     const SystemPingRequest *ping_request
         = (const SystemPingRequest*) message;
 
-    if(ping_request-&gt;getClientPlayerIndex() &gt;= PlayerInterface::getMaxPlayers()) {
+    if(ping_request-&gt;getClientPlayerIndex() &gt;= PlayerInterface::getMaxPlayers())
+    {
         LOGGER.warning(&quot;Invalid pingRequest message&quot;);
         return;
     }
 
-    player_id = PlayerInterface::getPlayerID( ping_request-&gt;getClientPlayerIndex() );
+    PlayerState * player;
+    player = PlayerInterface::getPlayer( ping_request-&gt;getClientPlayerIndex() );
 
     SystemPingAcknowledge ping_ack;
 
-    if ( (PlayerInterface::getPlayer(player_id.getIndex())-&gt;getStatus() == _player_state_active) &amp;&amp;
-            (ping_request-&gt;getClientPlayerIndex() != 0)
-       ) {
-        SERVER-&gt;sendMessage(player_id, &amp;ping_ack, sizeof(SystemPingAcknowledge));
+    if ( player-&gt;getStatus() == _player_state_active
+         &amp;&amp; ping_request-&gt;getClientPlayerIndex() != 0
+       )
+    {
+        SERVER-&gt;sendMessage(player-&gt;getID(), &amp;ping_ack, sizeof(SystemPingAcknowledge));
     }
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -66,8 +66,7 @@
     static bool gameMapLoad( int *percent_complete );
 
     // ** Game Rules Methods
-    static void spawnPlayer( const PlayerID &amp;player );
-    static void spawnPlayer( PlayerState *player_state );
+    static void spawnPlayer( Uint16 player );
     static void respawnAllPlayers();
 
     static void initializeGameLogic();

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/ObjectiveInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/ObjectiveInterface.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/ObjectiveInterface.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -43,7 +43,7 @@
 
 unsigned long ObjectiveInterface::objective_position_enum_list_size;
 unsigned long ObjectiveInterface::objective_position_enum_index;
-PlayerID      ObjectiveInterface::objective_position_enum_player_id;
+Uint16        ObjectiveInterface::objective_position_enum_player_id;
 
 NetMessageEncoder ObjectiveInterface::message_encoder;
 
@@ -207,15 +207,15 @@
         default:
             LOGGER.warning(
                     &quot;Unknown objective terminal message (id %u, player %u)&quot;,
-                    message-&gt;message_id, packet-&gt;fromID);
+                    message-&gt;message_id, packet-&gt;fromClient-&gt;getPlayerIndex());
             return;
     }                                       
 
     const PlayerState* player 
-        = PlayerInterface::getPlayerByNetworkID(packet-&gt;fromID);
+        = PlayerInterface::getPlayer(packet-&gt;fromClient-&gt;getPlayerIndex());
     if(!player) {
-        LOGGER.warning(&quot;Couldn't find player for packet from NetworkID %u.&quot;,
-                packet-&gt;fromID);
+        LOGGER.warning(&quot;Couldn't find player for packet %u.&quot;,
+                packet-&gt;fromClient-&gt;getPlayerIndex());
         return;
     }
     
@@ -357,7 +357,7 @@
 {
     objective_position_enum_index	= 0;
     objective_position_enum_list_size = objective_list.size();
-    objective_position_enum_player_id = PlayerInterface::getLocalPlayerID();
+    objective_position_enum_player_id = PlayerInterface::getLocalPlayerIndex();
 }
 
 bool
@@ -366,25 +366,36 @@
 {
     ObjectiveState *objective_state;
 
-    if( objective_position_enum_index &lt;  objective_position_enum_list_size ) {
+    if( objective_position_enum_index &lt;  objective_position_enum_list_size )
+    {
         objective_state = &amp;(objective_list[ objective_position_enum_index ]-&gt;objective_state);
 
         (*objective_rect) = objective_state-&gt;area.getAbsRect( objective_state-&gt;location );
-        if( objective_id != 0 ) {
+        if( objective_id != 0 )
+        {
             (*objective_id) = objective_position_enum_index;
         }
 
-        if ( objective_state-&gt;occupation_status == _occupation_status_occupied ) {
-            if ( objective_position_enum_player_id.getIndex() != objective_state-&gt;occupying_player-&gt;getID() ) {
-                if (PlayerInterface::isAllied(objective_state-&gt;occupying_player-&gt;getID() , objective_position_enum_player_id.getIndex())  ) {
+        if ( objective_state-&gt;occupation_status == _occupation_status_occupied )
+        {
+            if ( objective_position_enum_player_id != objective_state-&gt;occupying_player-&gt;getID() )
+            {
+                if (PlayerInterface::isAllied(objective_state-&gt;occupying_player-&gt;getID() , objective_position_enum_player_id)  )
+                {
                     (*objective_disposition) = _objective_disposition_allie;
-                } else {
+                }
+                else
+                {
                     (*objective_disposition) = _objective_disposition_enemy;
                 }
-            } else {
+            }
+            else
+            {
                 (*objective_disposition) = _objective_disposition_player;
             }
-        } else {
+        }
+        else
+        {
             (*objective_disposition) = _objective_disposition_unoccupied;
         }
 

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/ObjectiveInterface.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/ObjectiveInterface.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/ObjectiveInterface.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -97,7 +97,7 @@
 protected:
     static unsigned long objective_position_enum_index;
     static unsigned long objective_position_enum_list_size;
-    static PlayerID      objective_position_enum_player_id;
+    static Uint16        objective_position_enum_player_id;
 
 public:
     static void    startObjectivePositionEnumeration();

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -283,7 +283,6 @@
 //-----------------------------------------------------------------
 void PlayerGameManager::hostMultiPlayerGame()
 {
-    PlayerID player;
     PlayerState *player_state;
     Timer wait;
 
@@ -381,13 +380,14 @@
     graphicsLoop();
     
     player_state = PlayerInterface::allocateLoopBackPlayer();
-    player_state-&gt;setNetworkID(0);
     const char* playername = gameconfig-&gt;playername.c_str();
     player_state-&gt;setName(playername);
     player_state-&gt;setFlag((unsigned char) gameconfig-&gt;playerflag);
-    player = PlayerInterface::getLocalPlayerID();
-    GameManager::spawnPlayer( player );
+    
+    GameManager::spawnPlayer( PlayerInterface::getLocalPlayerIndex() );
+    
     LoadingView::update( &quot;Spawning Player ... (100%)&quot; );
+    
     graphicsLoop();
 
     wait.changePeriod( 3 );

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -47,21 +47,20 @@
 void PlayerInterface::initialize(unsigned short maxPlayers)
 {
     char temp_str[64];
-    PlayerID player_id;
-    unsigned long player_index;
+    Uint16 player_index;
     max_players = maxPlayers;
 
     delete[] player_lists;
     player_lists = new PlayerState[max_players];
 
-    for ( player_index = 0; player_index &lt; max_players; player_index++ ) {
-        player_id.setIndex( player_index );
-        player_lists[player_index].setPlayerID( player_id );
+    for ( player_index = 0; player_index &lt; max_players; player_index++ )
+    {
+        player_lists[ player_index ].setID( player_index );
         player_lists[ player_index ].resetStats();
         player_lists[ player_index ].setStatus( _player_state_free );
         player_lists[ player_index ].setFlag( 0 );
         player_lists[ player_index ].unit_config.initialize();
-        sprintf( temp_str, &quot;Player %lu&quot;, player_index );
+        sprintf( temp_str, &quot;Player %u&quot;, player_index );
         player_lists[ player_index ].setName( temp_str );
     }
 
@@ -70,7 +69,8 @@
     resetAllianceMatrix();
 
     mutex = SDL_CreateMutex();
-    if(!mutex) {
+    if(!mutex)
+    {
         throw std::runtime_error(&quot;Couldn't create PlayerInterface mutex.&quot;);
     }
 }
@@ -112,17 +112,6 @@
     SDL_mutexV(mutex);
 }
 
-void PlayerInterface::setAlliance( const PlayerID&amp; by_player, const PlayerID&amp; with_player )
-{
-    assert( (by_player.getIndex() &lt; max_players) &amp;&amp; (with_player.getIndex() &lt; max_players) );
-
-    SDL_mutexP(mutex);
-    *(alliance_matrix + (with_player.getIndex() * max_players) + by_player.getIndex() ) = true;
-    //*(alliance_matrix + (by_player.getIndex() * max_players) + with_player.getIndex() ) = true;
-    SDL_mutexV(mutex);
-}
-
-
 void PlayerInterface::setAlliance( unsigned short by_player, unsigned short with_player )
 {
     assert( (by_player &lt; max_players) &amp;&amp; (with_player &lt; max_players) );
@@ -142,18 +131,6 @@
     SDL_mutexV(mutex);
 }
 
-bool PlayerInterface::isAllied( const PlayerID&amp; player, const PlayerID&amp; with_player )
-{
-    bool val;
-
-    assert( (player.getIndex() &lt; max_players) &amp;&amp; (with_player.getIndex() &lt; max_players) );
-
-    val = *(alliance_matrix + (with_player.getIndex() * max_players) + player.getIndex() );
-
-    return( val );
-
-}
-
 bool PlayerInterface::isAllied( unsigned short player, unsigned short with_player )
 {
     bool val;
@@ -321,19 +298,20 @@
 
 bool PlayerInterface::testRulePlayerRespawn( bool *completed, PlayerState **player_state )
 {
-    PlayerID player;
-
-    if ( respawn_rule_player_index == max_players ) {
+    if ( respawn_rule_player_index == max_players )
+    {
         respawn_rule_player_index = 0;
         *completed = true;
         return( false );
-    } else {
+    }
+    else
+    {
         *completed = false;
     }
-    player = player_lists[ respawn_rule_player_index ].getPlayerID();
-
+    
     if ( player_lists[ respawn_rule_player_index ].getStatus() == _player_state_active )
-        if ( UnitInterface::getUnitCount( player.getIndex() ) == 0 ) {
+        if ( UnitInterface::getUnitCount( respawn_rule_player_index ) == 0 )
+        {
             *player_state = &amp;player_lists[ respawn_rule_player_index ];
             respawn_rule_player_index++;
             return( true );
@@ -493,7 +471,7 @@
     allie_update.set(allie_request-&gt;getAllieByPlayerIndex(),
                      allie_request-&gt;getAllieWithPlayerIndex(),
                      allie_request-&gt;alliance_request_type);
-    SERVER-&gt;sendMessage(&amp;allie_update, sizeof(PlayerAllianceUpdate));
+    SERVER-&gt;broadcastMessage(&amp;allie_update, sizeof(PlayerAllianceUpdate));
 }
 
 void PlayerInterface::netMessageAllianceUpdate(const NetMessage* message)
@@ -594,13 +572,13 @@
             if ( isAllied( disconnect_player_index, player_index ) == true )
             {
                 allie_update.set( disconnect_player_index, player_index, _player_break_alliance );
-                SERVER-&gt;sendMessage(&amp;allie_update, sizeof(PlayerAllianceUpdate));
+                SERVER-&gt;broadcastMessage(&amp;allie_update, sizeof(PlayerAllianceUpdate));
             }
 
             if ( isAllied( player_index, disconnect_player_index ) == true )
             {
                 allie_update.set( player_index, disconnect_player_index, _player_break_alliance );
-                SERVER-&gt;sendMessage(&amp;allie_update, sizeof(PlayerAllianceUpdate));
+                SERVER-&gt;broadcastMessage(&amp;allie_update, sizeof(PlayerAllianceUpdate));
             }
         }
 
@@ -609,20 +587,6 @@
         PlayerStateSync player_state_update(player_state-&gt;getNetworkPlayerState());
         SDL_mutexV(mutex);
 
-        SERVER-&gt;sendMessage(&amp;player_state_update, sizeof(PlayerStateSync));
+        SERVER-&gt;broadcastMessage(&amp;player_state_update, sizeof(PlayerStateSync));
     }
 }
-PlayerState*
-PlayerInterface::getPlayerByNetworkID(NetClientID id)
-{
-    for(int i = 0; i &lt; max_players; ++i) {
-        PlayerState* state = &amp;player_lists[i];
-        if(state-&gt;getStatus() != _player_state_active)
-            continue;
-        if(state-&gt;getNetworkID() == id)
-            return state;
-    }
-
-    return 0;
-}
-

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -49,13 +49,10 @@
     static void setKill(PlayerState* by_player, PlayerState* on_player,
             UnitType unit_type );
 
-    static void setAlliance( const PlayerID&amp; by_player, const PlayerID&amp; with_player );
-
     static void setAlliance( unsigned short by_player, unsigned short with_player );
 
     static void clearAlliance( unsigned short by_player, unsigned short with_player );
 
-    static bool isAllied(const PlayerID&amp; player, const PlayerID&amp; with_player);
     static bool isAllied(unsigned short player, unsigned short with_player);
 
     static void lockPlayerStats();
@@ -66,12 +63,6 @@
         return max_players;
     }
 
-    static PlayerState* getPlayerState(const PlayerID&amp; player)
-    {
-        assert(player.getIndex() &lt; max_players);
-        return &amp;player_lists[ player.getIndex() ];
-    }
-
     static PlayerState* getPlayer(Uint16 player_index)
     {
         if ( player_index &lt; max_players )
@@ -81,29 +72,16 @@
         return NULL;
     }
 
-    static PlayerState* getPlayerByNetworkID(NetClientID id);
-
     static PlayerState* getLocalPlayer()
     {
         return &amp;player_lists[ local_player_index ];
     }
 
-    static PlayerID getLocalPlayerID()
-    {
-        return player_lists[ local_player_index ].getPlayerID();
-    }
-
     static Uint16 getLocalPlayerIndex()
     {
         return local_player_index;
     }
 
-    static PlayerID getPlayerID(Uint16 player_index )
-    {
-        assert( player_index &lt; max_players );
-        return player_lists[ player_index ].getPlayerID();
-    }
-
     static void resetPlayerStats();
 
     static int getActivePlayerCount();

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PowerUpInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PowerUpInterface.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PowerUpInterface.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -149,7 +149,7 @@
                          power_up-&gt;powerup_state.type
                        );
 
-        SERVER-&gt;sendMessage(&amp;create_mesg, sizeof(PowerUpCreateMesg));
+        SERVER-&gt;broadcastMessage(&amp;create_mesg, sizeof(PowerUpCreateMesg));
 
         do {
             next_regen_interval = rand() % (power_up_regen_time_upper_bound + 1);

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PowerUpInterface.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PowerUpInterface.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PowerUpInterface.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -22,7 +22,6 @@
 
 #include &quot;Classes/PowerUp.hpp&quot;
 #include &quot;Util/Timer.hpp&quot;
-#include &quot;Classes/PlayerID.hpp&quot;
 #include &quot;Classes/Network/NetPacket.hpp&quot;
 #include &quot;Network/ClientSocket.hpp&quot;
 

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/UnitInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/UnitInterface.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/UnitInterface.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -68,7 +68,6 @@
 unsigned long   UnitInterface::sync_units_in_sync_partial_count;
 size_t          UnitInterface::units_per_player;
 Timer		UnitInterface::sync_units_packet_timer;
-//PlayerID	UnitInterface::sync_units_remote_player;
 
 
 // ******************************************************************
@@ -124,10 +123,11 @@
         (const TerminalUnitCmdRequest*) message;
 
     const PlayerState* player 
-        = PlayerInterface::getPlayerByNetworkID(packet-&gt;fromID);
-    if(player == 0) {
-        LOGGER.warning(&quot;No player found for Network ID '%u'?!?&quot;,
-                packet-&gt;fromID);
+        = PlayerInterface::getPlayer(packet-&gt;fromClient-&gt;getPlayerIndex());
+    if(player == 0)
+    {
+        LOGGER.warning(&quot;UnitInterface: Player not found '%u'?!?&quot;,
+                packet-&gt;fromClient-&gt;getPlayerIndex());
         return;
     }
     
@@ -697,7 +697,7 @@
         PlayerScoreUpdate score_update;
         score_update.set(player1-&gt;getID(), player2-&gt;getID(),
                 (UnitType) lifecycle_update-&gt;unit_type);
-        SERVER-&gt;sendMessage(&amp;score_update, sizeof(PlayerScoreUpdate));
+        SERVER-&gt;broadcastMessage(&amp;score_update, sizeof(PlayerScoreUpdate));
     }
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/UnitInterface.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/UnitInterface.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/UnitInterface.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -174,7 +174,6 @@
     static bool	      sync_units_complete_flag;
     static unsigned short sync_units_list_index;
     static Timer	  sync_units_packet_timer;
-//    static PlayerID	  sync_units_remote_player;
     static unsigned long  sync_units_in_sync_count;
     static unsigned long  sync_units_in_sync_partial_count;
     static unsigned long  sync_units_total_units;

Modified: trunk/netpanzer/src/NetPanzer/Network/ClientSocket.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Network/ClientSocket.cpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Network/ClientSocket.cpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -80,7 +80,7 @@
 void
 ClientSocket::initId()
 {
-    static NetClientID curid=1;
+    static int curid=1;
     id=curid++;
 }
 
@@ -168,7 +168,7 @@
             }
             
             if ( remaining &gt;= packetsize ) {
-                EnqueueIncomingPacket(data+dataptr, packetsize, 0, id, this);
+                EnqueueIncomingPacket(data+dataptr, packetsize, this);
                 remaining -= packetsize;
                 dataptr   += packetsize;
             } else {
@@ -216,7 +216,7 @@
             }
             
             if ( tempoffset == packetsize ) {
-                EnqueueIncomingPacket(tempbuffer, packetsize, 0, id, this);
+                EnqueueIncomingPacket(tempbuffer, packetsize, this);
                 tempoffset = 0;
             }
         }

Modified: trunk/netpanzer/src/NetPanzer/Network/ClientSocket.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Network/ClientSocket.hpp	2008-09-01 12:58:10 UTC (rev 1038)
+++ trunk/netpanzer/src/NetPanzer/Network/ClientSocket.hpp	2008-09-01 16:39:08 UTC (rev 1039)
@@ -50,7 +50,7 @@
     void sendRemaining();
     ProxyServer proxy;
 
-    NetClientID getId() { return id; };
+    int getId() { return id; };
     std::string getIPAddress();
     
     int getPlayerIndex()
@@ -66,6 +66,7 @@
 
 private:
     friend class ServerConnectDaemon;
+    friend class NetworkClient;
     void initId();
     ClientSocketObserver * observer;
     network::TCPSocket* socket;
@@ -74,7 +75,7 @@
     unsigned int sendpos;
     char tempbuffer[_MAX_NET_PACKET_SIZE];
     Uint16 tempoffset;
-    NetClientID id;
+    int id;
     int playerIndex;
 };
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000078.html">[Netpanzer-cvs] r1037 - trunk/netpanzer/src/NetPanzer/Interfaces
</A></li>
	<LI>Next message: <A HREF="000080.html">[Netpanzer-cvs] r1040 - in trunk/netpanzer/src/NetPanzer:	Classes/Network Interfaces Network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#79">[ date ]</a>
              <a href="thread.html#79">[ thread ]</a>
              <a href="subject.html#79">[ subject ]</a>
              <a href="author.html#79">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">More information about the Netpanzer-cvs
mailing list</a><br>
</body></html>
