<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Netpanzer-cvs] r1053 - in trunk/netpanzer: nbproject src/Lib/2D	src/NetPanzer src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Core	src/NetPanzer/Interfaces src/NetPanzer/Objectives	src/NetPanzer/Resources src/NetPanzer/Views/Game	src/NetPanzer/Views/MainMenu/Multi
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/netpanzer-cvs/2008-September/index.html" >
   <LINK REL="made" HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1053%20-%20in%20trunk/netpanzer%3A%20nbproject%20src/Lib/2D%0A%09src/NetPanzer%20src/NetPanzer/Classes%0A%09src/NetPanzer/Classes/Network%20src/NetPanzer/Core%0A%09src/NetPanzer/Interfaces%20src/NetPanzer/Objectives%0A%09src/NetPanzer/Resources%20src/NetPanzer/Views/Game%0A%09src/NetPanzer/Views/MainMenu/Multi&In-Reply-To=%3C200809111345.m8BDjYP7014697%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000091.html">
   <LINK REL="Next"  HREF="000093.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Netpanzer-cvs] r1053 - in trunk/netpanzer: nbproject src/Lib/2D	src/NetPanzer src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Core	src/NetPanzer/Interfaces src/NetPanzer/Objectives	src/NetPanzer/Resources src/NetPanzer/Views/Game	src/NetPanzer/Views/MainMenu/Multi</H1>
    <B>kromxp at mail.berlios.de</B> 
    <A HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1053%20-%20in%20trunk/netpanzer%3A%20nbproject%20src/Lib/2D%0A%09src/NetPanzer%20src/NetPanzer/Classes%0A%09src/NetPanzer/Classes/Network%20src/NetPanzer/Core%0A%09src/NetPanzer/Interfaces%20src/NetPanzer/Objectives%0A%09src/NetPanzer/Resources%20src/NetPanzer/Views/Game%0A%09src/NetPanzer/Views/MainMenu/Multi&In-Reply-To=%3C200809111345.m8BDjYP7014697%40sheep.berlios.de%3E"
       TITLE="[Netpanzer-cvs] r1053 - in trunk/netpanzer: nbproject src/Lib/2D	src/NetPanzer src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Core	src/NetPanzer/Interfaces src/NetPanzer/Objectives	src/NetPanzer/Resources src/NetPanzer/Views/Game	src/NetPanzer/Views/MainMenu/Multi">kromxp at mail.berlios.de
       </A><BR>
    <I>Thu Sep 11 15:45:34 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000091.html">[Netpanzer-cvs] r1052 - in trunk/netpanzer: nbproject	src/NetPanzer/Classes src/NetPanzer/Interfaces	src/NetPanzer/Particles src/NetPanzer/Units	src/NetPanzer/Views/Game src/NetPanzer/Weapons
</A></li>
        <LI>Next message: <A HREF="000093.html">[Netpanzer-cvs] r1054 - in trunk/netpanzer/src/NetPanzer: Classes	Classes/Network Interfaces Objectives Particles PowerUps	Resources Units
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#92">[ date ]</a>
              <a href="thread.html#92">[ thread ]</a>
              <a href="subject.html#92">[ subject ]</a>
              <a href="author.html#92">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: kromxp
Date: 2008-09-11 15:44:12 +0200 (Thu, 11 Sep 2008)
New Revision: 1053

Added:
   trunk/netpanzer/src/NetPanzer/Resources/
   trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.cpp
   trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.hpp
Removed:
   trunk/netpanzer/src/NetPanzer/Classes/SurfaceDesc.hpp
Modified:
   trunk/netpanzer/nbproject/Makefile-mac-debug.mk
   trunk/netpanzer/nbproject/configurations.xml
   trunk/netpanzer/src/Lib/2D/FontSystem2D.hpp
   trunk/netpanzer/src/Lib/2D/Surface.cpp
   trunk/netpanzer/src/Lib/2D/Surface.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp
   trunk/netpanzer/src/NetPanzer/Classes/PlayerState.cpp
   trunk/netpanzer/src/NetPanzer/Classes/PlayerState.hpp
   trunk/netpanzer/src/NetPanzer/Classes/SelectionBoxSprite.cpp
   trunk/netpanzer/src/NetPanzer/Classes/SelectionBoxSprite.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Sprite.cpp
   trunk/netpanzer/src/NetPanzer/Classes/Sprite.hpp
   trunk/netpanzer/src/NetPanzer/Core/CoreTypes.hpp
   trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp
   trunk/netpanzer/src/NetPanzer/Objectives/Objective.cpp
   trunk/netpanzer/src/NetPanzer/Objectives/Objective.hpp
   trunk/netpanzer/src/NetPanzer/Objectives/Outpost.cpp
   trunk/netpanzer/src/NetPanzer/Objectives/Outpost.hpp
   trunk/netpanzer/src/NetPanzer/Views/Game/RankView.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/RankView.hpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.cpp
   trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.hpp
Log:
- Added FlagID type
- Added a ResourceManager, it handles the flags of the game now.



Modified: trunk/netpanzer/nbproject/Makefile-mac-debug.mk
===================================================================
--- trunk/netpanzer/nbproject/Makefile-mac-debug.mk	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/nbproject/Makefile-mac-debug.mk	2008-09-11 13:44:12 UTC (rev 1053)
@@ -100,6 +100,7 @@
 	${OBJECTDIR}/src/NetPanzer/Classes/OpcodeDebugger.o \
 	${OBJECTDIR}/src/NetPanzer/System/DummySound.o \
 	${OBJECTDIR}/src/Lib/lua/lfunc.o \
+	${OBJECTDIR}/src/NetPanzer/Resources/ResourceManager.o \
 	${OBJECTDIR}/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.o \
 	${OBJECTDIR}/src/NetPanzer/Units/UnitState.o \
 	${OBJECTDIR}/src/NetPanzer/Particles/SmolderParticleSystem2D.o \
@@ -271,8 +272,8 @@
 	${OBJECTDIR}/src/Lib/Network/UDPSocket.o \
 	${OBJECTDIR}/src/NetPanzer/Interfaces/PathScheduler.o \
 	${OBJECTDIR}/src/NetPanzer/Classes/TipOfDay.o \
+	${OBJECTDIR}/src/Lib/physfs/platform/unix.o \
 	${OBJECTDIR}/src/NetPanzer/Particles/TemplateExplosionSystem.o \
-	${OBJECTDIR}/src/Lib/physfs/platform/unix.o \
 	${OBJECTDIR}/src/NetPanzer/Classes/SpawnList.o \
 	${OBJECTDIR}/src/Lib/lua/ldebug.o \
 	${OBJECTDIR}/src/Lib/ArrayUtil/BitArray.o \
@@ -612,6 +613,10 @@
 	${MKDIR} -p ${OBJECTDIR}/src/Lib/lua
 	$(COMPILE.c) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/Lib/lua/lfunc.o src/Lib/lua/lfunc.c
 
+${OBJECTDIR}/src/NetPanzer/Resources/ResourceManager.o: src/NetPanzer/Resources/ResourceManager.cpp 
+	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Resources
+	$(COMPILE.cc) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Resources/ResourceManager.o src/NetPanzer/Resources/ResourceManager.cpp
+
 ${OBJECTDIR}/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.o: src/NetPanzer/Views/MainMenu/Multi/UnitColorView.cpp 
 	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Views/MainMenu/Multi
 	$(COMPILE.cc) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Views/MainMenu/Multi/UnitColorView.o src/NetPanzer/Views/MainMenu/Multi/UnitColorView.cpp
@@ -1296,14 +1301,14 @@
 	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Classes
 	$(COMPILE.cc) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Classes/TipOfDay.o src/NetPanzer/Classes/TipOfDay.cpp
 
+${OBJECTDIR}/src/Lib/physfs/platform/unix.o: src/Lib/physfs/platform/unix.c 
+	${MKDIR} -p ${OBJECTDIR}/src/Lib/physfs/platform
+	$(COMPILE.c) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/Lib/physfs/platform/unix.o src/Lib/physfs/platform/unix.c
+
 ${OBJECTDIR}/src/NetPanzer/Particles/TemplateExplosionSystem.o: src/NetPanzer/Particles/TemplateExplosionSystem.cpp 
 	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Particles
 	$(COMPILE.cc) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Particles/TemplateExplosionSystem.o src/NetPanzer/Particles/TemplateExplosionSystem.cpp
 
-${OBJECTDIR}/src/Lib/physfs/platform/unix.o: src/Lib/physfs/platform/unix.c 
-	${MKDIR} -p ${OBJECTDIR}/src/Lib/physfs/platform
-	$(COMPILE.c) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/Lib/physfs/platform/unix.o src/Lib/physfs/platform/unix.c
-
 ${OBJECTDIR}/src/NetPanzer/Classes/SpawnList.o: src/NetPanzer/Classes/SpawnList.cpp 
 	${MKDIR} -p ${OBJECTDIR}/src/NetPanzer/Classes
 	$(COMPILE.cc) -g -Wall -DPHYSFS_SUPPORTS_ZIP=1 -DZ_PREFIX=1 -I. -Isrc/Lib -Isrc/NetPanzer -Isrc/Lib/physfs -Isrc/Lib/physfs/zlib123 -I/Library/Frameworks/SDL.framework/Versions/A/Headers -I/Library/Frameworks/SDL_mixer.framework/Versions/A/Headers -o ${OBJECTDIR}/src/NetPanzer/Classes/SpawnList.o src/NetPanzer/Classes/SpawnList.cpp

Modified: trunk/netpanzer/nbproject/configurations.xml
===================================================================
--- trunk/netpanzer/nbproject/configurations.xml	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/nbproject/configurations.xml	2008-09-11 13:44:12 UTC (rev 1053)
@@ -296,7 +296,6 @@
           &lt;itemPath&gt;src/NetPanzer/Classes/Sprite.hpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/Classes/SpriteSorter.cpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/Classes/SpriteSorter.hpp&lt;/itemPath&gt;
-          &lt;itemPath&gt;src/NetPanzer/Classes/SurfaceDesc.hpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/Classes/TileEngine.cpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/Classes/TileEngine.hpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/Classes/TileSet.cpp&lt;/itemPath&gt;
@@ -459,6 +458,10 @@
           &lt;itemPath&gt;src/NetPanzer/PowerUps/UnitPowerUp.cpp&lt;/itemPath&gt;
           &lt;itemPath&gt;src/NetPanzer/PowerUps/UnitPowerUp.hpp&lt;/itemPath&gt;
         &lt;/logicalFolder&gt;
+        &lt;logicalFolder name=&quot;Resources&quot; displayName=&quot;Resources&quot; projectFiles=&quot;true&quot;&gt;
+          &lt;itemPath&gt;src/NetPanzer/Resources/ResourceManager.cpp&lt;/itemPath&gt;
+          &lt;itemPath&gt;src/NetPanzer/Resources/ResourceManager.hpp&lt;/itemPath&gt;
+        &lt;/logicalFolder&gt;
         &lt;logicalFolder name=&quot;Structs&quot; displayName=&quot;Structs&quot; projectFiles=&quot;true&quot;&gt;
           &lt;itemPath&gt;src/NetPanzer/Structs/TileSetStruct.hpp&lt;/itemPath&gt;
         &lt;/logicalFolder&gt;
@@ -1464,9 +1467,6 @@
       &lt;item path=&quot;src/NetPanzer/Classes/SpriteSorter.hpp&quot;&gt;
         &lt;itemTool&gt;3&lt;/itemTool&gt;
       &lt;/item&gt;
-      &lt;item path=&quot;src/NetPanzer/Classes/SurfaceDesc.hpp&quot;&gt;
-        &lt;itemTool&gt;3&lt;/itemTool&gt;
-      &lt;/item&gt;
       &lt;item path=&quot;src/NetPanzer/Classes/TileEngine.cpp&quot;&gt;
         &lt;itemTool&gt;1&lt;/itemTool&gt;
       &lt;/item&gt;
@@ -1908,6 +1908,12 @@
       &lt;item path=&quot;src/NetPanzer/PowerUps/UnitPowerUp.hpp&quot;&gt;
         &lt;itemTool&gt;3&lt;/itemTool&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;src/NetPanzer/Resources/ResourceManager.cpp&quot;&gt;
+        &lt;itemTool&gt;1&lt;/itemTool&gt;
+      &lt;/item&gt;
+      &lt;item path=&quot;src/NetPanzer/Resources/ResourceManager.hpp&quot;&gt;
+        &lt;itemTool&gt;3&lt;/itemTool&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;src/NetPanzer/Structs/TileSetStruct.hpp&quot;&gt;
         &lt;itemTool&gt;3&lt;/itemTool&gt;
       &lt;/item&gt;
@@ -3196,9 +3202,6 @@
       &lt;item path=&quot;src/NetPanzer/Classes/SpriteSorter.hpp&quot;&gt;
         &lt;itemTool&gt;3&lt;/itemTool&gt;
       &lt;/item&gt;
-      &lt;item path=&quot;src/NetPanzer/Classes/SurfaceDesc.hpp&quot;&gt;
-        &lt;itemTool&gt;3&lt;/itemTool&gt;
-      &lt;/item&gt;
       &lt;item path=&quot;src/NetPanzer/Classes/TileEngine.cpp&quot;&gt;
         &lt;itemTool&gt;1&lt;/itemTool&gt;
       &lt;/item&gt;
@@ -3640,6 +3643,12 @@
       &lt;item path=&quot;src/NetPanzer/PowerUps/UnitPowerUp.hpp&quot;&gt;
         &lt;itemTool&gt;3&lt;/itemTool&gt;
       &lt;/item&gt;
+      &lt;item path=&quot;src/NetPanzer/Resources/ResourceManager.cpp&quot;&gt;
+        &lt;itemTool&gt;1&lt;/itemTool&gt;
+      &lt;/item&gt;
+      &lt;item path=&quot;src/NetPanzer/Resources/ResourceManager.hpp&quot;&gt;
+        &lt;itemTool&gt;3&lt;/itemTool&gt;
+      &lt;/item&gt;
       &lt;item path=&quot;src/NetPanzer/Structs/TileSetStruct.hpp&quot;&gt;
         &lt;itemTool&gt;3&lt;/itemTool&gt;
       &lt;/item&gt;

Modified: trunk/netpanzer/src/Lib/2D/FontSystem2D.hpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/FontSystem2D.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/Lib/2D/FontSystem2D.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -18,7 +18,7 @@
 #ifndef __FontSystem2D_hpp__
 #define __FontSystem2D_hpp__
 
-#include &quot;iXY.hpp&quot;
+#include &quot;Types/iXY.hpp&quot;
 #include &quot;Surface.hpp&quot;
 
 //--------------------------------------------------------------------------

Modified: trunk/netpanzer/src/Lib/2D/Surface.cpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/Surface.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/Lib/2D/Surface.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -1283,57 +1283,6 @@
     return Palette::findNearestColor(avgR, avgG, avgB);
 } // end Surface::getAverageColor
 
-// loadAllBMPInDirectory
-//---------------------------------------------------------------------------
-int Surface::loadAllBMPInDirectory(const char *path)
-{
-    char** list = filesystem::enumerateFiles(path);
-    
-    std::vector&lt;std::string&gt; filenames;
-    Surface tempSurface(8, 8, 1);
-    iXY maxSize(0, 0);
-    for(char** file = list; *file != 0; file++) {
-        std::string name = path;
-        name += *file;
-        if(name.find(&quot;.bmp&quot;) != std::string::npos) {
-            filenames.push_back(name);
-
-            // Get the max image size.
-            tempSurface.loadBMP(name.c_str());
-            if (maxSize.x &lt; (int)tempSurface.getWidth()) {
-                maxSize.x = tempSurface.getWidth();
-            }
-            if (maxSize.y &lt; (int)tempSurface.getHeight()) {
-                maxSize.y = tempSurface.getHeight();
-            }
-        }
-    }
-
-    filesystem::freeList(list);
-
-    std::sort(filenames.begin(), filenames.end());
-
-    // Create the Surface to have the size of the largest image in the
-    // diRectory.  All other images will be centered based off the
-    // largest size.
-    create(maxSize.x, maxSize.y, filenames.size());
-
-    // Now load in the sorted BMP names.
-    for (size_t i = 0; i &lt; filenames.size(); i++) {
-        setFrame(i);
-
-        tempSurface.loadBMP(filenames[i].c_str());
-        iXY myOffset=maxSize;
-        myOffset.x-=tempSurface.getWidth();
-        myOffset.y-=tempSurface.getHeight();
-
-        fill(Color::black);
-        tempSurface.blt(*this, myOffset.x, myOffset.y);
-    }
-
-    return 1;
-} // end loadAllBMPInDirectory
-
 // initFont
 //---------------------------------------------------------------------------
 // Purpose: Load all the characters into a surface of 128 frames.  Then the

Modified: trunk/netpanzer/src/Lib/2D/Surface.hpp
===================================================================
--- trunk/netpanzer/src/Lib/2D/Surface.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/Lib/2D/Surface.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -195,8 +195,6 @@
 
     void shrinkWrap();
 
-    int  loadAllBMPInDirectory(const char *path);
-
     // Text rendering functions
     void renderText(const char *str, PIX color, PIX bgcolor);
     

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -31,7 +31,6 @@
 #include &quot;Classes/Network/NetworkServer.hpp&quot;
 #include &quot;Interfaces/GameManager.hpp&quot;
 #include &quot;Interfaces/GameConfig.hpp&quot;
-#include &quot;Classes/SelectionBoxSprite.hpp&quot;
 
 #include &quot;PlayerNetMessage.hpp&quot;
 #include &quot;ConnectNetMessage.hpp&quot;

Modified: trunk/netpanzer/src/NetPanzer/Classes/PlayerState.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/PlayerState.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Classes/PlayerState.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -20,8 +20,8 @@
 #include &quot;Util/Endian.hpp&quot;
 #include &quot;Util/Log.hpp&quot;
 #include &quot;Classes/PlayerState.hpp&quot;
-#include &quot;Classes/SelectionBoxSprite.hpp&quot;
 #include &quot;Interfaces/PlayerInterface.hpp&quot;
+#include &quot;Resources/ResourceManager.hpp&quot;
 #include &lt;sstream&gt;
 
 Uint16 NetworkPlayerState::getPlayerIndex() const
@@ -293,13 +293,8 @@
     return status;
 }
 
-void PlayerState::setFlag(unsigned char newflag)
+void PlayerState::setFlag(FlagID newflag)
 {
-    if ( newflag &gt;= UNIT_FLAGS_SURFACE.getNumFrames() )
-    {
-        newflag=0;
-    }
-    
     flag = newflag;
     
     bool recheck;
@@ -312,15 +307,18 @@
                 continue;
                 
             PlayerState *ps=PlayerInterface::getPlayer(p);
+            
             if (  (ps-&gt;status==_player_state_connecting 
                   || ps-&gt;status==_player_state_active )
                  &amp;&amp; ps-&gt;flag == flag
                )
             {
-                flag++;
-                if ( flag &gt;= UNIT_FLAGS_SURFACE.getNumFrames() )
-                    flag = 0;
-                    
+                // will autorotate because it is a byte
+                do
+                {
+                    flag++;
+                } while ( ! ResourceManager::isFlagActive(flag) );
+                                    
                 if ( flag != newflag ) // there are no free flags if it is ==
                 {
                     recheck = true;
@@ -335,7 +333,7 @@
     } while (recheck);
 }
 
-unsigned char PlayerState::getFlag() const
+FlagID PlayerState::getFlag() const
 {
     return flag;
 }
@@ -371,15 +369,12 @@
     memcpy(tmp, state-&gt;name, 64); 
     tmp[63] = 0;
     name = tmp;
-	if(state-&gt;flag &lt; UNIT_FLAGS_SURFACE.getNumFrames())
-        {
-		flag = state-&gt;flag;
-	}
-        else
-        {
-		flag = 0;
-		LOGGER.warning(&quot;Invalid flag number received&quot;);
-	}
+    flag = state-&gt;flag;
+    if ( ! ResourceManager::isFlagActive(flag) ) 
+    {
+        LOGGER.warning(&quot;Received flag is not registered: %u&quot;, flag);
+    }
+    
     player_index = ltoh16(state-&gt;playerindex_id);
     status = state-&gt;status;
     kills = ltoh16(state-&gt;kills);

Modified: trunk/netpanzer/src/NetPanzer/Classes/PlayerState.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/PlayerState.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Classes/PlayerState.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -20,6 +20,7 @@
 
 #include &lt;string&gt;
 #include &lt;string.h&gt;
+#include &quot;Core/CoreTypes.hpp&quot;
 #include &quot;Classes/PlayerUnitConfig.hpp&quot;
 #include &quot;2D/Palette.hpp&quot;
 
@@ -45,7 +46,7 @@
     friend class PlayerStateSync;
     
     char name[64];
-    Uint8 flag;
+    FlagID flag;
     Uint16 playerindex_id;
     Uint8 status;
     Sint16 kills;
@@ -66,7 +67,7 @@
 {
 private:
     std::string name;
-    unsigned char flag;
+    FlagID flag;
     Uint16 player_index;
     unsigned char status;
     short kills;
@@ -110,8 +111,8 @@
     void setID( unsigned short index );
     void setStatus( unsigned char status );
     unsigned char getStatus() const;
-    void setFlag(unsigned char newflag);
-    unsigned char getFlag() const;
+    void setFlag(FlagID newflag);
+    FlagID getFlag() const;
     short getTotal() const;
     NetworkPlayerState getNetworkPlayerState() const;
     void setFromNetworkPlayerState(const NetworkPlayerState* state);

Modified: trunk/netpanzer/src/NetPanzer/Classes/SelectionBoxSprite.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/SelectionBoxSprite.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Classes/SelectionBoxSprite.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -20,9 +20,8 @@
 #include &quot;Classes/SelectionBoxSprite.hpp&quot;
 #include &quot;2D/Palette.hpp&quot;
 #include &quot;Interfaces/GameConfig.hpp&quot;
+#include &quot;Resources/ResourceManager.hpp&quot;
 
-Surface UNIT_FLAGS_SURFACE;
-
 bool SelectionBoxSprite::isVisible(const iRect &amp;world_win) const
 {
     if (
@@ -68,7 +67,7 @@
     allied_visiblity_state = false;
     allie_state = false;
     flag_visibility_state = false;
-    unit_flag.setTo( UNIT_FLAGS_SURFACE );
+    unit_flag = ResourceManager::getEmptyImage();
 }
 
 
@@ -136,7 +135,7 @@
     if ( gameconfig-&gt;drawunitflags == true ) {
         //unit_flag.blt( *surface, iXY( min_abs.x, min_abs.y - unit_flag.getPix().y ) );
         //surface-&gt;bltString(min_abs.x + 2, min_abs.y - 6, &quot;Panther1&quot;, Color::white);
-        unit_flag.blt( *surface, min_abs.x, min_abs.y-unit_flag.getHeight()-1 );
+        unit_flag-&gt;blt( *surface, min_abs.x, min_abs.y-unit_flag-&gt;getHeight()-1 );
     }
 
     /*

Modified: trunk/netpanzer/src/NetPanzer/Classes/SelectionBoxSprite.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/SelectionBoxSprite.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Classes/SelectionBoxSprite.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -18,11 +18,11 @@
 #ifndef _SELECTION_BOX_SPRITE_HPP
 #define _SELECTION_BOX_SPRITE_HPP
 
+#include &quot;Core/CoreTypes.hpp&quot;
+#include &quot;Resources/ResourceManager.hpp&quot;
 #include &quot;ArrayUtil/BoundBox.hpp&quot;
 #include &quot;Classes/Sprite.hpp&quot;
 
-extern Surface UNIT_FLAGS_SURFACE;
-
 class SelectionBoxSprite : public Sprite
 {
 protected:
@@ -57,11 +57,10 @@
     bool allied_visiblity_state;
     bool allie_state;
     bool flag_visibility_state;
+    
+    Surface * unit_flag;
 
 public:
-    Surface unit_flag;
-    Surface allie_flag;
-
     UnitSelectionBox( );
 
     virtual ~UnitSelectionBox()
@@ -80,9 +79,9 @@
             hit_points = 0;
     }
 
-    inline void setFlag( int flag_enum )
+    inline void setFlag( FlagID flag_enum )
     {
-        unit_flag.setFrame( flag_enum );
+        unit_flag = ResourceManager::getFlag( flag_enum );
     }
 
     inline void setFlagIcon( bool flag_state )

Modified: trunk/netpanzer/src/NetPanzer/Classes/Sprite.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Sprite.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Classes/Sprite.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -27,57 +27,6 @@
 
 }
 
-
-SpriteSurface::SpriteSurface()
-        : Sprite()
-{
-}
-
-bool SpriteSurface::isVisible(const iRect &amp;world_win ) const
-{
-    long min_x;
-    long min_y;
-    long max_x;
-    long max_y;
-    long pix_x;
-    long pix_y;
-
-    pix_x = getWidth() &gt;&gt; 1;
-    pix_y = getHeight() &gt;&gt; 1;
-
-    min_x = world_pos.x - pix_x;
-    min_y = world_pos.y - pix_y;
-
-    max_x = world_pos.x + pix_x;
-    max_y = world_pos.y + pix_y;
-
-    if ( (min_y &gt;= world_win.max.y) || (max_y &lt;= world_win.min.y)	||
-            (min_x &gt;= world_win.max.x) || (max_x &lt;= world_win.min.x)
-       )
-        return( false );
-
-    return( true );
-
-    /*
-    iXY temp_pix = pix;
-    temp_pix.x = temp_pix.x/2;
-    temp_pix.y = temp_pix.y/2;
-       
-    if ( world_win.clip( iRect( world_pos - temp_pix, world_pos + temp_pix) ) )  
-     return( false );
-
-    return( true );
-    */
-}
-
-void SpriteSurface::blit( Surface *surface, const iRect &amp;world_win )
-{
-    iXY blit_offset;
-
-    blit_offset = (world_pos + attach_offset) - world_win.min;
-    bltTrans( *surface, blit_offset.x, blit_offset.y );
-}
-
 SpritePacked::SpritePacked()
         : Sprite()
 {

Modified: trunk/netpanzer/src/NetPanzer/Classes/Sprite.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Sprite.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Classes/Sprite.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -117,49 +117,6 @@
 
 };
 
-class SpriteSurface : public Surface, public Sprite
-{
-public:
-
-    SpriteSurface();
-
-    inline void setData( Surface &amp;surface )
-    {
-        setTo(surface);
-        setOffsetCenter();
-    }
-
-    inline void setAttrib( iXY &amp;worldPos, iXY &amp;attach, unsigned char height, int frame )
-    {
-        world_pos = worldPos;
-        attach_offset = attach;
-        assert( height &lt; _MAX_HEIGHT_LEVELS );
-        Sprite::height = height;
-        setFrame( frame );
-    }
-
-    inline void setAttrib( iXY &amp;worldPos, iXY &amp;attach, unsigned char height )
-    {
-        world_pos = worldPos;
-        attach_offset = attach;
-        assert( height &lt; _MAX_HEIGHT_LEVELS );
-        Sprite::height = height;
-    }
-
-    inline void setAttrib( const iXY &amp;worldPos, unsigned char height )
-    {
-        world_pos = worldPos;
-        assert( height &lt; _MAX_HEIGHT_LEVELS );
-        Sprite::height = height;
-        attach_offset.x = 0;
-        attach_offset.y = 0;
-    }
-
-    virtual bool isVisible(const iRect &amp;world_win ) const;
-
-    virtual void blit( Surface *surface, const iRect &amp;world_win );
-};
-
 class SpritePacked : public PackedSurface, public Sprite
 {
 private:

Deleted: trunk/netpanzer/src/NetPanzer/Classes/SurfaceDesc.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/SurfaceDesc.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Classes/SurfaceDesc.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -1,44 +0,0 @@
-/*
-Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
- 
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
- 
-You should have received a copy of the GNU General Public License
-along with this program; if not, write to the Free Software
-Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-*/
-#ifndef _SURFACEDESC_HPP
-#define _SURFACEDESC_HPP
-
-#include &quot;PObject.hpp&quot;
-
-enum { _surfdesc_system_mem = 0x01, _surfdesc_hardware_mem = 0x02 };
-enum { _surfdesc_double_buffer = 0x01, _surfdesc_page_flipped = 0x02,
-       _surfdesc_writeable = 0x04, _surfdesc_readable = 0x08 };
-
-class SurfaceDesc : virtual PObject
-{
-public:
-    iXY size;
-    iRect    viewable;
-    iXY clipOffset;
-    unsigned int      bpp;
-
-    unsigned long offset_to_view;
-    unsigned long offset_to_screen_start;
-
-    unsigned char type;
-    unsigned char attributes;
-
-}
-;  // ** end SurfaceDesc
-
-#endif // ** _SURFACEDESC_HPP

Modified: trunk/netpanzer/src/NetPanzer/Core/CoreTypes.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Core/CoreTypes.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Core/CoreTypes.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -36,5 +36,7 @@
 
 typedef Uint16 UnitID;
 
+typedef Uint8 FlagID;
+
 #endif	/* _CORETYPES_HPP */
 

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/BaseGameManager.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -48,8 +48,7 @@
 #include &quot;Interfaces/GameControlRulesDaemon.hpp&quot;
 #include &quot;Util/Exception.hpp&quot;
 #include &quot;Util/FileSystem.hpp&quot;
-#include &quot;Classes/SelectionBoxSprite.hpp&quot;
-
+#include &quot;Resources/ResourceManager.hpp&quot;
 #include &quot;Units/UnitGlobals.hpp&quot;
 #include &quot;2D/ColorTable.hpp&quot;
 #include &quot;2D/Palette.hpp&quot;
@@ -133,12 +132,16 @@
 void BaseGameManager::loadGameData()
 {
     UnitProfileInterface::loadUnitProfiles();
-    UNIT_FLAGS_SURFACE.loadAllBMPInDirectory(&quot;pics/flags/&quot;);
-    if(UNIT_FLAGS_SURFACE.getNumFrames() == 0) {
+    
+    int numflags = ResourceManager::loadDefaultFlags();
+    if ( numflags &lt;= 0 )
+    {
         throw Exception(&quot;Couldn't find any flag in pics/flags/.&quot;);
     }
-    if(gameconfig-&gt;playerflag.isDefaultValue()) {
-        gameconfig-&gt;playerflag=rand()%UNIT_FLAGS_SURFACE.getNumFrames();
+
+    if(gameconfig-&gt;playerflag.isDefaultValue())
+    {
+        gameconfig-&gt;playerflag=rand()%numflags;
     }
 }
 //-----------------------------------------------------------------

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/GameManager.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -51,7 +51,6 @@
 #include &quot;Classes/TileEngine.hpp&quot;
 #include &quot;Units/UnitBlackBoard.hpp&quot;
 #include &quot;Classes/WorldInputCmdProcessor.hpp&quot;
-#include &quot;Classes/SelectionBoxSprite.hpp&quot;
 #include &quot;Classes/SpriteSorter.hpp&quot;
 #include &quot;Classes/Network/ClientMessageRouter.hpp&quot;
 #include &quot;Classes/Network/ClientConnectDaemon.hpp&quot;

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -46,7 +46,6 @@
 #include &quot;Classes/TileEngine.hpp&quot;
 #include &quot;Units/UnitBlackBoard.hpp&quot;
 #include &quot;Classes/WorldInputCmdProcessor.hpp&quot;
-#include &quot;Classes/SelectionBoxSprite.hpp&quot;
 #include &quot;Classes/SpriteSorter.hpp&quot;
 #include &quot;Classes/Network/ClientMessageRouter.hpp&quot;
 #include &quot;Classes/Network/ClientConnectDaemon.hpp&quot;

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PlayerInterface.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -25,7 +25,6 @@
 
 #include &quot;Classes/Network/PlayerNetMessage.hpp&quot;
 #include &quot;Classes/Network/NetworkServer.hpp&quot;
-#include &quot;Classes/SelectionBoxSprite.hpp&quot;
 #include &quot;Util/Log.hpp&quot;
 
 // for UNIT_FLAGS_SURFACE

Modified: trunk/netpanzer/src/NetPanzer/Objectives/Objective.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Objectives/Objective.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Objectives/Objective.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -26,7 +26,6 @@
 Objective::Objective(ObjectiveID ID, iXY location, BoundBox area)
 {
     objective_state.ID = ID;
-    objective_state.selection_state = false;
     objective_state.location = location;
     objective_state.capture_area = area;
     objective_state.objective_status = _objective_status_null;

Modified: trunk/netpanzer/src/NetPanzer/Objectives/Objective.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Objectives/Objective.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Objectives/Objective.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -35,7 +35,6 @@
 {
 public:
     ObjectiveID   ID;
-    bool          selection_state;
     iRect         selection_box;
     unsigned char outpost_type;
     char          name[64];

Modified: trunk/netpanzer/src/NetPanzer/Objectives/Outpost.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Objectives/Outpost.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Objectives/Outpost.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -48,9 +48,6 @@
     unit_generation_loc = iXY( 1, 3 );
     occupation_pad_offset = iXY( 224, 48 );
     unit_generation_on_flag = false;
-
-    select_box.setAttrib( location, 3 );
-    select_box.setBoxAttributes( area, 252 );
 }
 
 void
@@ -297,7 +294,4 @@
 void
 Outpost::offloadGraphics( SpriteSorter &amp;sorter )
 {
-    if( objective_state.selection_state == true ) {
-        sorter.addSprite( &amp;select_box );
-    }
 }

Modified: trunk/netpanzer/src/NetPanzer/Objectives/Outpost.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Objectives/Outpost.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Objectives/Outpost.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -20,7 +20,6 @@
 
 #include &quot;Objectives/Objective.hpp&quot;
 #include &quot;Util/Timer.hpp&quot;
-#include &quot;Classes/SelectionBoxSprite.hpp&quot;
 #include &quot;Units/UnitBase.hpp&quot;
 
 class Outpost : public Objective
@@ -35,9 +34,6 @@
     unsigned short unit_generation_type;
     bool unit_generation_on_flag;
 
-private:
-    SelectionBoxSprite select_box;
-
 public:
     Timer occupation_status_timer;
     Timer unit_generation_timer;

Added: trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -0,0 +1,105 @@
+/* 
+Copyright (C) 2008 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * Created on September 11, 2008, 7:05 PM
+ */
+
+#include &lt;vector&gt;
+#include &lt;algorithm&gt;
+
+#include &quot;ResourceManager.hpp&quot;
+#include &quot;2D/Surface.hpp&quot;
+#include &quot;Util/FileSystem.hpp&quot;
+
+using namespace std;
+
+#define DEFAULT_FLAGS_PATH &quot;pics/flags/&quot;
+
+
+
+Surface noimage;
+
+class _RMan
+{
+public:
+    _RMan()
+    {
+        for (int n = 0; n &lt; 256; n++)
+        {
+            flagList[n]=&noimage;
+        }
+    }
+    
+    Surface * flagList[256];
+};
+
+_RMan RMan;
+
+Surface *
+ResourceManager::getEmptyImage()
+{
+    return &noimage;
+}
+        
+// actually loads all the flags.
+int
+ResourceManager::loadDefaultFlags()
+{
+    char** list = filesystem::enumerateFiles(DEFAULT_FLAGS_PATH);
+    
+    vector&lt;string&gt; filenames;
+    string flagname;
+    
+    for(char** file = list; *file != 0; file++)
+    {
+        flagname = DEFAULT_FLAGS_PATH;
+        flagname += *file;
+        if(flagname.find(&quot;.bmp&quot;) != string::npos)
+        {
+            filenames.push_back(flagname);
+        }
+    }
+
+    filesystem::freeList(list);
+
+    sort(filenames.begin(), filenames.end());
+
+    // Now load in the sorted BMP names.
+    for (unsigned int i = 0; i &lt; filenames.size(); i++)
+    {
+        if ( RMan.flagList[i] != &amp;noimage )
+            delete RMan.flagList[i];
+        
+        RMan.flagList[i] = new Surface();
+        // XXX check for null man
+        RMan.flagList[i]-&gt;loadBMP(filenames[i].c_str());
+    }
+    
+    return filenames.size();
+}
+
+Surface *
+ResourceManager::getFlag(FlagID flag)
+{
+    return RMan.flagList[flag];
+}
+
+bool
+ResourceManager::isFlagActive(FlagID flag)
+{
+    return RMan.flagList[flag] != &noimage;
+}

Added: trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Resources/ResourceManager.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -0,0 +1,39 @@
+/* 
+Copyright (C) 2008 by Aaron Perez &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">aaronps at gmail.com</A>&gt;
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * Created on September 11, 2008, 6:55 PM
+ */
+
+#ifndef _RESOURCEMANAGER_HPP
+#define	_RESOURCEMANAGER_HPP
+
+#include &quot;Core/CoreTypes.hpp&quot;
+
+// forward declarations
+class Surface;
+
+class ResourceManager
+{
+public:
+    static Surface * getEmptyImage();
+    static int loadDefaultFlags();
+    static Surface * getFlag(FlagID flag);
+    static bool isFlagActive(FlagID flag);
+};
+
+#endif	/* _RESOURCEMANAGER_HPP */
+

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/RankView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/RankView.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/RankView.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -17,6 +17,8 @@
 */
 #include &lt;config.h&gt;
 
+#include &quot;Resources/ResourceManager.hpp&quot;
+
 #include &lt;vector&gt;
 #include &lt;algorithm&gt;
 
@@ -30,8 +32,6 @@
 
 #include &quot;Views/Components/Label.hpp&quot;
 
-#include &quot;Classes/SelectionBoxSprite.hpp&quot;
-
 // RankView
 //---------------------------------------------------------------------------
 RankView::RankView() : GameTemplateView()
@@ -82,7 +82,8 @@
 {
     // make sure the window is big enough for all players
     unsigned int CHAR_YPIX = Surface::getFontHeight();
-    unsigned int entryheight = std::max(CHAR_YPIX, UNIT_FLAGS_SURFACE.getHeight()) + 2;
+    unsigned int flagHeight = ResourceManager::getFlag(0)-&gt;getHeight();
+    unsigned int entryheight = std::max(CHAR_YPIX, flagHeight) + 2;
     unsigned int newheight = 60 + entryheight * PlayerInterface::countPlayers();
     
     if ( newheight != (unsigned int)getSizeY() ) {
@@ -96,7 +97,7 @@
             iRect(0, 26, getClientRect().getSize().x - 1,
                 getClientRect().getSize().y - 1), Color::gray64, Color::white);
 
-    drawPlayerStats(clientArea);
+    drawPlayerStats(clientArea, flagHeight);
 
     View::doDraw(viewArea, clientArea);
 } // end doDraw
@@ -128,7 +129,7 @@
 //---------------------------------------------------------------------------
 // Purpose:
 //---------------------------------------------------------------------------
-void RankView::drawPlayerStats(Surface &amp;dest)
+void RankView::drawPlayerStats(Surface &amp;dest, unsigned int flagHeight)
 {
     char statBuf[256];
 
@@ -153,9 +154,10 @@
     }
 
     unsigned int CHAR_YPIX = Surface::getFontHeight();
-    unsigned int entryHeight = std::max(CHAR_YPIX, UNIT_FLAGS_SURFACE.getHeight()) + 2;
+    unsigned int entryHeight = std::max(CHAR_YPIX, flagHeight) + 2;
     iXY offset(2, 40);
-    iXY flagOffset(162, 40 + (int(CHAR_YPIX - UNIT_FLAGS_SURFACE.getHeight()))/2);
+    iXY flagOffset(162, 40 + (int(CHAR_YPIX - flagHeight))/2);
+    Surface * flag = 0;
 
     for(std::vector&lt;const PlayerState*&gt;::iterator i = states.begin();
             i != states.end(); ++i) {
@@ -166,8 +168,9 @@
                 state-&gt;getKills(), state-&gt;getLosses(), state-&gt;getTotal(),
                 state-&gt;getObjectivesHeld());
         dest.bltString(offset.x, offset.y, statBuf, state-&gt;getColor());
-        UNIT_FLAGS_SURFACE.setFrame(state-&gt;getFlag());
-        UNIT_FLAGS_SURFACE.blt( dest, flagOffset.x, flagOffset.y );
+        
+        flag = ResourceManager::getFlag(state-&gt;getFlag());
+        flag-&gt;blt( dest, flagOffset.x, flagOffset.y );
 
         offset.y += entryHeight;
         flagOffset.y += entryHeight;        

Modified: trunk/netpanzer/src/NetPanzer/Views/Game/RankView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/RankView.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/RankView.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -32,7 +32,7 @@
 private:
     int viewableMessageCount;
     enum { ITEM_GAP_SPACE = 10 };
-    void drawPlayerStats(Surface &amp;dest);
+    void drawPlayerStats(Surface &amp;dest, unsigned int flagHeight);
 
     ScrollBar *scrollBar;
 

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.cpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.cpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -17,6 +17,8 @@
 */
 #include &lt;config.h&gt;
 
+#include &quot;Resources/ResourceManager.hpp&quot;
+
 #include &quot;FlagSelectionView.hpp&quot;
 #include &quot;Views/Game/GameView.hpp&quot;
 #include &quot;Views/GameViewGlobals.hpp&quot;
@@ -26,7 +28,8 @@
 #include &quot;Views/Components/MouseEvent.hpp&quot;
 #include &quot;2D/Color.hpp&quot;
 
-unsigned char FlagSelectionView::playerFlagSelected = 0;
+FlagID FlagSelectionView::playerFlagSelected = 0;
+Surface FlagSelectionView::playerFlag;
 
 class FlagButton : public Button
 {
@@ -88,42 +91,55 @@
 //---------------------------------------------------------------------------
 void FlagSelectionView::init()
 {
-    if (flags.loadAllBMPInDirectory(&quot;pics/flags/&quot;) &lt;= 0)
-        throw Exception(&quot;Couldn't find flags for menu in '%s'.&quot;,
-                        &quot;pics/flags/&quot;);
-    flags.mapFromPalette(&quot;netp&quot;);
+    Surface flag;
+    // XXX we suppose all the flags has the same size
+    Surface * curFlag = ResourceManager::getFlag(0);
+    
+    //flags.mapFromPalette(&quot;netp&quot;);
 
-    iXY flagStartOffset(BORDER_SPACE, BORDER_SPACE * 2 + flags.getHeight());
+    iXY flagStartOffset(BORDER_SPACE, BORDER_SPACE * 2 + curFlag-&gt;getHeight());
 
-    int xOffset = flags.getWidth() + 2;
-    int yOffset = flags.getHeight() + 2;
+    int yOffset = curFlag-&gt;getHeight() + 2;
 
     int x = flagStartOffset.x;
     int y = flagStartOffset.y;
 
-    for (unsigned int i = 0; i &lt; flags.getNumFrames(); i++) {
-        flags.setFrame(i);
+    // XXX to be able to do the loop we need int
+    // but it should be FlagID
+    // also, the 256 should be MAX_FLAG or similiar.
+    for (unsigned int i = 0; i &lt; 256; i++)
+    {
+        if ( ! ResourceManager::isFlagActive(i) )
+            continue;
+        
+        // XXX we have to copy the flag because of different palettes
+        curFlag = ResourceManager::getFlag(i);
+        flag.create(curFlag-&gt;getWidth(), curFlag-&gt;getHeight(), 1);
+        curFlag-&gt;blt(flag, 0, 0);
+        flag.mapFromPalette(&quot;netp&quot;);
+        
+        add( new FlagButton( x, y, flag, i) );
 
-        add( new FlagButton( x, y, flags, i) );
+        x += flag.getWidth() + 2;
 
-        x += xOffset;
-
-        if (x &gt; flagStartOffset.x + getClientRect().getSizeX() - BORDER_SPACE - (int)flags.getWidth()) {
+        if (x &gt; flagStartOffset.x + getClientRect().getSizeX() - BORDER_SPACE - (int)flag.getWidth()) {
             x = flagStartOffset.x;
             y += yOffset;
         }
     }
 
-    if(gameconfig-&gt;playerflag.isDefaultValue()) {
+    if(gameconfig-&gt;playerflag.isDefaultValue())
+    {
         // new player, no flag...
-        gameconfig-&gt;playerflag=rand()%flags.getNumFrames();
+        gameconfig-&gt;playerflag=rand()%255; // XXX be lucky, no check for flags.
     }
     
     playerFlagSelected = gameconfig-&gt;playerflag;
-    if ( playerFlagSelected &gt;= flags.getNumFrames() )
+    if ( ! ResourceManager::isFlagActive(playerFlagSelected) )
         playerFlagSelected = 0;
     
-    flags.setFrame(playerFlagSelected);
+    setSelectedFlag(playerFlagSelected);
+    
 } // end FlagSelectionView::init
 
 // doDraw
@@ -136,13 +152,28 @@
     char strBuf[256];
     sprintf(strBuf, &quot;Current:&quot;);
     int CHAR_XPIX = 8; // XXX hardcoded
+    
     clientArea.bltStringShadowed(
             BORDER_SPACE,
-            BORDER_SPACE + (flags.getHeight() - Surface::getFontHeight()) / 2,
+            BORDER_SPACE + (playerFlag.getHeight() - Surface::getFontHeight()) / 2,
             strBuf, windowTextColor, windowTextColorShadow);
-    flags.setFrame(playerFlagSelected);
-    flags.blt(clientArea, BORDER_SPACE + strlen(strBuf) * CHAR_XPIX + BORDER_SPACE, BORDER_SPACE);
+    
+    playerFlag.blt(clientArea, BORDER_SPACE + strlen(strBuf) * CHAR_XPIX + BORDER_SPACE, BORDER_SPACE);
 
     View::doDraw(viewArea, clientArea);
 
 } // end FlagSelectionView::doDraw
+void
+FlagSelectionView::setSelectedFlag(FlagID code)
+{
+    if ( ResourceManager::isFlagActive(code) )
+    {
+        // XXX have to map because of different palettes.
+        Surface * rflag = ResourceManager::getFlag(code);
+        playerFlag.create(rflag-&gt;getWidth(), rflag-&gt;getHeight(), 1);
+        rflag-&gt;blt(playerFlag, 0, 0);
+        playerFlag.mapFromPalette(&quot;netp&quot;);
+        
+        playerFlagSelected = code;    
+    }
+}
\ No newline at end of file

Modified: trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.hpp	2008-09-10 15:27:30 UTC (rev 1052)
+++ trunk/netpanzer/src/NetPanzer/Views/MainMenu/Multi/FlagSelectionView.hpp	2008-09-11 13:44:12 UTC (rev 1053)
@@ -18,6 +18,7 @@
 #ifndef __FlagSelectionView_hpp__
 #define __FlagSelectionView_hpp__
 
+#include &quot;Core/CoreTypes.hpp&quot;
 #include &quot;Views/MainMenu/RMouseHackView.hpp&quot;
 #include &quot;2D/Surface.hpp&quot;
 
@@ -25,8 +26,8 @@
 class FlagSelectionView : public RMouseHackView
 {
 private:
-    Surface    flags;
-    static unsigned char playerFlagSelected;
+    static FlagID playerFlagSelected;
+    static Surface playerFlag;
     
     enum { BORDER_SPACE = 4 };
 
@@ -35,12 +36,9 @@
     virtual ~FlagSelectionView()
     {}
     
-    static void setSelectedFlag(unsigned char code)
-    {
-        playerFlagSelected = code;
-    }
+    static void setSelectedFlag(FlagID code);
     
-    static unsigned char getSelectedFlag()
+    static FlagID getSelectedFlag()
     {
         return playerFlagSelected;
     }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000091.html">[Netpanzer-cvs] r1052 - in trunk/netpanzer: nbproject	src/NetPanzer/Classes src/NetPanzer/Interfaces	src/NetPanzer/Particles src/NetPanzer/Units	src/NetPanzer/Views/Game src/NetPanzer/Weapons
</A></li>
	<LI>Next message: <A HREF="000093.html">[Netpanzer-cvs] r1054 - in trunk/netpanzer/src/NetPanzer: Classes	Classes/Network Interfaces Objectives Particles PowerUps	Resources Units
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#92">[ date ]</a>
              <a href="thread.html#92">[ thread ]</a>
              <a href="subject.html#92">[ subject ]</a>
              <a href="author.html#92">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">More information about the Netpanzer-cvs
mailing list</a><br>
</body></html>
