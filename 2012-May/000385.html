<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Netpanzer-cvs] r1361 - in trunk/netpanzer:	pics/backgrounds/menus/buttons/default	pics/backgrounds/menus/menu src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Interfaces	src/NetPanzer/Views/Components src/NetPanzer/Views/Game
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/netpanzer-cvs/2012-May/index.html" >
   <LINK REL="made" HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1361%20-%20in%20trunk/netpanzer%3A%0A%09pics/backgrounds/menus/buttons/default%0A%09pics/backgrounds/menus/menu%20src/NetPanzer/Classes%0A%09src/NetPanzer/Classes/Network%20src/NetPanzer/Interfaces%0A%09src/NetPanzer/Views/Components%20src/NetPanzer/Views/Game&In-Reply-To=%3C20120511153021.2CD6555B0C%40scm.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000384.html">
   <LINK REL="Next"  HREF="000386.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Netpanzer-cvs] r1361 - in trunk/netpanzer:	pics/backgrounds/menus/buttons/default	pics/backgrounds/menus/menu src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Interfaces	src/NetPanzer/Views/Components src/NetPanzer/Views/Game</H1>
    <B>wile64 at scm.berlios.de</B> 
    <A HREF="mailto:netpanzer-cvs%40lists.berlios.de?Subject=Re%3A%20%5BNetpanzer-cvs%5D%20r1361%20-%20in%20trunk/netpanzer%3A%0A%09pics/backgrounds/menus/buttons/default%0A%09pics/backgrounds/menus/menu%20src/NetPanzer/Classes%0A%09src/NetPanzer/Classes/Network%20src/NetPanzer/Interfaces%0A%09src/NetPanzer/Views/Components%20src/NetPanzer/Views/Game&In-Reply-To=%3C20120511153021.2CD6555B0C%40scm.berlios.de%3E"
       TITLE="[Netpanzer-cvs] r1361 - in trunk/netpanzer:	pics/backgrounds/menus/buttons/default	pics/backgrounds/menus/menu src/NetPanzer/Classes	src/NetPanzer/Classes/Network src/NetPanzer/Interfaces	src/NetPanzer/Views/Components src/NetPanzer/Views/Game">wile64 at scm.berlios.de
       </A><BR>
    <I>Fri May 11 17:30:20 CEST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000384.html">[Netpanzer-cvs] r1360 - in trunk/netpanzer/src/NetPanzer: Classes	Interfaces Views/Game
</A></li>
        <LI>Next message: <A HREF="000386.html">[Netpanzer-cvs] r1362 - in trunk/netpanzer/src/NetPanzer:	Classes/Network Interfaces Views/Game
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#385">[ date ]</a>
              <a href="thread.html#385">[ thread ]</a>
              <a href="subject.html#385">[ subject ]</a>
              <a href="author.html#385">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: wile64
Date: 2012-05-11 17:30:20 +0200 (Fri, 11 May 2012)
New Revision: 1361

Added:
   trunk/netpanzer/pics/backgrounds/menus/buttons/default/be-black.bmp
   trunk/netpanzer/pics/backgrounds/menus/buttons/default/bs-black.bmp
   trunk/netpanzer/pics/backgrounds/menus/menu/canon.bmp
   trunk/netpanzer/src/NetPanzer/Views/Components/cssButton.cpp
   trunk/netpanzer/src/NetPanzer/Views/Components/cssButton.hpp
   trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.cpp
   trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.hpp
Modified:
   trunk/netpanzer/src/NetPanzer/Classes/Network/GameControlNetMessage.hpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.cpp
   trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp
   trunk/netpanzer/src/NetPanzer/Classes/ViewCamera.cpp
   trunk/netpanzer/src/NetPanzer/Classes/ViewCamera.hpp
   trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.hpp
   trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/TeamManager.cpp
   trunk/netpanzer/src/NetPanzer/Interfaces/WorldViewInterface.hpp
   trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.cpp
Log:
TeamMode : 
 - some bugs change
 - Add screen for prepare team 
   Not finish, please try for report error

Added: trunk/netpanzer/pics/backgrounds/menus/buttons/default/be-black.bmp
===================================================================
(Binary files differ)


Property changes on: trunk/netpanzer/pics/backgrounds/menus/buttons/default/be-black.bmp
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: trunk/netpanzer/pics/backgrounds/menus/buttons/default/bs-black.bmp
===================================================================
(Binary files differ)


Property changes on: trunk/netpanzer/pics/backgrounds/menus/buttons/default/bs-black.bmp
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Added: trunk/netpanzer/pics/backgrounds/menus/menu/canon.bmp
===================================================================
(Binary files differ)


Property changes on: trunk/netpanzer/pics/backgrounds/menus/menu/canon.bmp
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/GameControlNetMessage.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/GameControlNetMessage.hpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/GameControlNetMessage.hpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -20,11 +20,14 @@
 
 #include &lt;stdio.h&gt;
 #include &lt;string.h&gt;
+#include &quot;Interfaces/GameControlRulesDaemon.hpp&quot;
 
 #include &quot;NetMessage.hpp&quot;
 
 enum { _net_message_id_game_control_cycle_map,
-       _net_message_id_game_control_cycle_respawn_ack
+       _net_message_id_game_control_cycle_respawn_ack,
+       _net_message_id_game_control_cycle_prepare_team,
+       _net_message_id_game_control_cycle_team_start
      };
 
 #ifdef MSVC
@@ -62,6 +65,30 @@
 }
 __attribute__((packed));
 
+class GameControlCyclePrepareTeam : public NetMessage
+{
+public:
+    Uint16 Cooldown;
+    GameControlCyclePrepareTeam()
+    {
+        message_class = _net_message_class_game_control;
+        message_id = _net_message_id_game_control_cycle_prepare_team;
+        Cooldown = GameControlRulesDaemon::getTeamCD();
+    }
+}
+__attribute__((packed));
+
+class GameControlCycleTeamStart : public NetMessage
+{
+public:
+    GameControlCycleTeamStart()
+    {
+        message_class = _net_message_class_game_control;
+        message_id = _net_message_id_game_control_cycle_team_start;
+    }
+}
+__attribute__((packed));
+
 #ifdef MSVC
 #pragma pack()
 #endif

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.cpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/NetworkServer.cpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -394,10 +394,7 @@
 
         if ( player &amp;&amp; sendalert &amp;&amp; ! kicked)
         {
-            if (GameConfig::game_teammode)
-            {
-                TeamManager::removePlayer(player-&gt;getID(), player-&gt;getTeamID());
-            }
+            if (GameConfig::game_teammode == true)
             ConsoleInterface::postMessage(Color::cyan, true, player-&gt;getFlag(),
                                       &quot;'%s' has left.&quot;,
                                       player-&gt;getName().c_str());
@@ -424,6 +421,11 @@
             }
             SERVER-&gt;broadcastMessage(&amp;scmsg, sizeof(scmsg));
         }
+        if (GameConfig::game_teammode == true)
+        {
+            TeamManager::removePlayer(player-&gt;getID(), player-&gt;getTeamID());
+            TeamManager::BalancedTeam();
+        }
     }
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Classes/Network/ServerConnectDaemon.cpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -21,6 +21,7 @@
 #include &quot;NetworkServer.hpp&quot;
 #include &quot;NetMessage.hpp&quot;
 #include &quot;NetMessageEncoder.hpp&quot;
+#include &quot;GameControlNetMessage.hpp&quot;
 
 #include &quot;Classes/PlayerState.hpp&quot;
 #include &quot;PlayerNetMessage.hpp&quot;
@@ -723,6 +724,12 @@
 
         PowerUpInterface::syncPowerUps( connect_client );
 
+        if (GameControlRulesDaemon::getGameState() == _game_state_prepare_team)
+        {
+            GameControlCyclePrepareTeam prepare_team_mesg;
+            SERVER-&gt;sendMessage(connect_client-&gt;player_id, &amp;prepare_team_mesg, sizeof(GameControlCyclePrepareTeam));
+        }
+        
         PlayerState * player = PlayerInterface::getPlayer(connect_client-&gt;getPlayerIndex());
 
         player-&gt;setStateSelectingFlag();
@@ -741,8 +748,9 @@
         state_mesg.setMessageEnum(_connect_state_sync_complete);
         connect_client-&gt;sendMessage( &amp;state_mesg,
                                      sizeof(ConnectProcessStateMessage));
+
+
         sendConnectionAlert( connect_client );
-        
         return connect_state_idle;
     }
 };

Modified: trunk/netpanzer/src/NetPanzer/Classes/ViewCamera.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/ViewCamera.cpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Classes/ViewCamera.cpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -1,27 +1,30 @@
 /*
 Copyright (C) 1998 Pyrosoft Inc. (www.pyrosoftgames.com), Matthew Bogue
- 
+
 This program is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version.
- 
+
 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.
- 
+
 You should have received a copy of the GNU General Public License
 along with this program; if not, write to the Free Software
 Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
 
 #include &quot;ViewCamera.hpp&quot;
+#include &quot;Util/Log.hpp&quot;
 
 ViewCamera::ViewCamera()
 {
     loc.x = 0;
     loc.y = 0;
+    move.x = 1;
+    move.y = -1;
 }
 
 void ViewCamera::scrollPlusX( long scroll_increment )
@@ -34,7 +37,8 @@
 
     getMapPointSize( &amp;map_size );
 
-    if ( (view.x &gt;= 0) &amp;&amp; (view.x &lt;= map_size.x) ) {
+    if ( (view.x &gt;= 0) &amp;&amp; (view.x &lt;= map_size.x) )
+    {
         loc.x = view.x;
     }
 }
@@ -49,7 +53,8 @@
 
     getMapPointSize( &amp;map_size );
 
-    if ( (view.x &gt;= 0) &amp;&amp; (view.x &lt;= map_size.x) ) {
+    if ( (view.x &gt;= 0) &amp;&amp; (view.x &lt;= map_size.x) )
+    {
         loc.x = view.x;
     }
 }
@@ -64,7 +69,8 @@
 
     getMapPointSize( &amp;map_size );
 
-    if ( (view.y &gt;= 0) &amp;&amp; (view.y &lt;= map_size.y) ) {
+    if ( (view.y &gt;= 0) &amp;&amp; (view.y &lt;= map_size.y) )
+    {
         loc.y = view.y;
     }
 }
@@ -78,14 +84,43 @@
     view.y = view.y - (view.y % 4);
 
     getMapPointSize( &amp;map_size );
+    
+    if ( (view.y &gt;= 0) &amp;&amp; (view.y &lt;= map_size.y) )
+    {
+        loc.y = view.y;
+    }
+}
 
-    if ( (view.y &gt;= 0) &amp;&amp; (view.y &lt;= map_size.y) ) {
+void ViewCamera::MoveCamera()
+{
+    iXY view;
+    iXY map_size;
+
+    view.y = loc.y + move.y;
+    view.x = loc.x + move.x;
+
+    getMapPointSize( &amp;map_size );
+    if ( (view.y-(view_size.y/2) &gt;= 0) &amp;&amp; (view.y+(view_size.y/2) &lt;= map_size.y) )
+    {
         loc.y = view.y;
     }
+    else
+    {
+        move.y = -move.y;
+    }
+
+    if ( (view.x-(view_size.x/2) &gt;= 0) &amp;&amp; (view.x+(view_size.x/2) &lt;= map_size.x) )
+    {
+        loc.x = view.x;
+    }
+    else
+    {
+        move.x = -move.x;
+    }
 }
 
 void ViewCamera::getViewStart(unsigned long view_size_x,
-			      unsigned long view_size_y,
+                              unsigned long view_size_y,
                               int *view_start_x,
                               int *view_start_y)
 {

Modified: trunk/netpanzer/src/NetPanzer/Classes/ViewCamera.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Classes/ViewCamera.hpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Classes/ViewCamera.hpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -25,6 +25,7 @@
 {
 protected:
     iXY loc;
+    iXY move;
     iXY view_size;
 
 public:
@@ -33,6 +34,7 @@
     void scrollMinusX( long scroll_increment );
     void scrollMinusY( long scroll_increment );
     void scrollPlusY( long scroll_increment );
+    void MoveCamera();
 
     inline void setCamera( const iXY &amp;new_loc )
     {

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/DedicatedGameManager.cpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -287,6 +287,8 @@
     console-&gt;startThread();
 
     GameManager::startGameTimer();
+    if (GameConfig::game_teammode)
+        GameControlRulesDaemon::setStateServerprepareteam();
     return true;
 }
 

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.cpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -26,13 +26,14 @@
 #include &quot;Interfaces/ConsoleInterface.hpp&quot;
 #include &quot;Interfaces/ChatInterface.hpp&quot;
 #include &quot;Interfaces/TeamManager.hpp&quot;
+#include &quot;Interfaces/WorldViewInterface.hpp&quot;
 
 #include &quot;Classes/Network/NetworkState.hpp&quot;
 #include &quot;Classes/Network/SystemNetMessage.hpp&quot;
 #include &quot;Classes/Network/GameControlNetMessage.hpp&quot;
 #include &quot;Classes/Network/NetworkServer.hpp&quot;
 #include &quot;Classes/Network/ServerConnectDaemon.hpp&quot;
- 
+
 #include &quot;Units/UnitProfileInterface.hpp&quot;
  
 #include &quot;Views/Components/Desktop.hpp&quot;
@@ -47,22 +48,21 @@
        _map_cycle_server_state_wait_for_client_map_load,
        _map_cycle_server_state_load_unit_profiles,
        _map_cycle_server_state_sync_profiles,
-       _map_cycle_server_state_respawn_players
+       _map_cycle_server_state_respawn_players,
+       _map_cycle_server_prepare_team
      };
  
 enum { _map_cycle_client_idle,
        _map_cycle_client_start_map_load,
        _map_cycle_client_load_map,
-       _map_cycle_client_wait_for_respawn_ack
+       _map_cycle_client_wait_for_respawn_ack,
+       _map_cycle_client_prepare_team,
+       _map_cycle_client_team_start
      };
  
 enum { _execution_mode_loop_back_server,
        _execution_mode_dedicated_server
      };
-enum { _game_state_idle,
-       _game_state_in_progress,
-       _game_state_completed
-     };
  
 int GameControlRulesDaemon::execution_mode = _execution_mode_loop_back_server;
 unsigned char GameControlRulesDaemon::game_state  = _game_state_idle;
@@ -74,6 +74,7 @@
 int GameControlRulesDaemon::map_cycle_fsm_server_state = _map_cycle_server_state_idle;
 Timer GameControlRulesDaemon::map_cycle_fsm_server_endgame_timer;
 Timer GameControlRulesDaemon::map_cycle_fsm_server_map_load_timer;
+Timer GameControlRulesDaemon::cooldown;
  
 int GameControlRulesDaemon::map_cycle_fsm_client_state = _map_cycle_client_idle;
 bool GameControlRulesDaemon::map_cycle_fsm_client_respawn_ack_flag = false;
@@ -91,6 +92,14 @@
 {
     GameControlRulesDaemon::game_state = _game_state_idle;
 }
+
+void GameControlRulesDaemon::setStateServerprepareteam()
+{
+    GameControlRulesDaemon::game_state = _game_state_prepare_team;
+    map_cycle_fsm_server_state = _map_cycle_server_prepare_team;
+    cooldown.changePeriod(300);
+    cooldown.reset();
+}
 //-----------------------------------------------------------------
 void GameControlRulesDaemon::setDedicatedServer()
 {
@@ -173,7 +182,27 @@
         return;
     }
     break;
+
+    case _map_cycle_client_prepare_team :
+    {
+        if (!Desktop::getVisible(&quot;PrepareTeam&quot;)&amp;&amp; !Desktop::getVisible(&quot;GFlagSelectionView&quot;))
+        {
+            Desktop::setVisibility(&quot;PrepareTeam&quot;, true);
+        }
+        if (Desktop::getVisible(&quot;PrepareTeam&quot;))
+            WorldViewInterface::MoveCamera();
+        LOGGER.warning(&quot;rest %i&quot;, 300-(int)cooldown.getTime());
+        return;
+    }
+    break;
  
+    case _map_cycle_client_team_start :
+    {
+            Desktop::setVisibility(&quot;PrepareTeam&quot;, false);
+        return;
+    }
+    break;
+    
     } // ** switch
 }
  
@@ -349,11 +378,31 @@
         GameControlCycleRespawnAck respawn_ack_mesg;
         SERVER-&gt;broadcastMessage( &amp;respawn_ack_mesg, sizeof(GameControlCycleRespawnAck));
  
-        map_cycle_fsm_server_state = _map_cycle_server_state_idle;
+        if (GameConfig::game_teammode)
+        {
+            map_cycle_fsm_server_state = _map_cycle_server_prepare_team;
+            GameControlCyclePrepareTeam prepare_team_mesg;
+            SERVER-&gt;broadcastMessage(&amp;prepare_team_mesg, sizeof(GameControlCyclePrepareTeam));
+
+        }
+        else
+        {
+            map_cycle_fsm_server_state = _map_cycle_server_state_idle;
+        }
  
         ServerConnectDaemon::unlockConnectProcess();
     }
     break;
+
+    case _map_cycle_server_prepare_team :
+    {
+        if (cooldown.count())
+        {
+            GameControlCycleTeamStart team_start_mesg;
+            SERVER-&gt;broadcastMessage(&amp;team_start_mesg, sizeof(GameControlCycleTeamStart));
+        }
+    }
+    break;
  
     } // ** switch
 }
@@ -480,6 +529,22 @@
 {
     map_cycle_fsm_client_respawn_ack_flag = true;
 }
+
+void GameControlRulesDaemon::netMessageCyclePrepareTeam(const NetMessage* message)
+{
+    GameControlCyclePrepareTeam *prepare_team_mesg;
+    prepare_team_mesg = (GameControlCyclePrepareTeam *) message;
+    
+    map_cycle_fsm_client_state = _map_cycle_client_prepare_team;
+    GameControlRulesDaemon::game_state = _game_state_prepare_team;
+    cooldown.changePeriod(prepare_team_mesg-&gt;Cooldown);
+}
+
+void GameControlRulesDaemon::netMessageCycleTeamStart(const NetMessage* )
+{
+    map_cycle_fsm_client_state = _map_cycle_client_team_start;
+    GameControlRulesDaemon::game_state = _game_state_idle;
+}
  
 void GameControlRulesDaemon::processNetMessage(const NetMessage* message)
 {
@@ -492,6 +557,14 @@
     case _net_message_id_game_control_cycle_respawn_ack :
         netMessageCycleRespawnAck(message);
         break;
+
+    case _net_message_id_game_control_cycle_prepare_team :
+        netMessageCyclePrepareTeam(message);
+        break;
+
+    case _net_message_id_game_control_cycle_team_start :
+        netMessageCycleTeamStart(message);
+        break;
  
     default:
         LOGGER.warning(

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.hpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/GameControlRulesDaemon.hpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -22,11 +22,18 @@
 #include &quot;Util/Timer.hpp&quot;
 #include &quot;Classes/Network/NetPacket.hpp&quot;
 
+enum { _game_state_idle,
+       _game_state_in_progress,
+       _game_state_completed,
+       _game_state_prepare_team
+     };
+
 class GameControlRulesDaemon
 {
     static int execution_mode;
     static unsigned char game_state;
     static std::string nextmap;
+    static Timer cooldown;
 
 protected:
     static int map_cycle_fsm_server_state;
@@ -49,10 +56,13 @@
 
     static void netMessageCycleMap(const NetMessage* message);
     static void netMessageCycleRespawnAck(const NetMessage* message);
+    static void netMessageCyclePrepareTeam(const NetMessage* message);
+    static void netMessageCycleTeamStart(const NetMessage* );
 
 public:
     static void setStateServerInProgress();
     static void setStateServerIdle();
+    static void setStateServerprepareteam();
     static void setDedicatedServer();
 
     static void forceMapChange(std::string map);
@@ -60,6 +70,7 @@
     static void processNetMessage(const NetMessage* message);
     static void updateGameControlFlow();
     static unsigned char getGameState() { return game_state; }
+    static int getTeamCD() { return (int)cooldown.getTimeLeft(); }
 };
 
 #endif // ** _GAME_CONTROL_RULES_DAEMON_HPP

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/PlayerGameManager.cpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -78,6 +78,7 @@
 #include &quot;Views/Game/EndRoundView.hpp&quot;
 #include &quot;Views/Game/GFlagSelectionView.hpp&quot;
 #include &quot;Views/Game/GTeamView.hpp&quot;
+#include &quot;Views/Game/PrepareTeam.hpp&quot;
 #include &quot;Views/Game/VehicleSelectionView.hpp&quot;
 #include &quot;Views/Game/CodeStatsView.hpp&quot;
 #include &quot;Views/Game/LibView.hpp&quot;
@@ -182,6 +183,7 @@
     Desktop::add(new HelpScrollView());
 
     Desktop::add(new GTeamView());
+    Desktop::add(new PrepareTeam());
 
     LoadingView *lv = new LoadingView();
     Desktop::add(lv);

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/TeamManager.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/TeamManager.cpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/TeamManager.cpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -267,7 +267,8 @@
 {
     Uint8 current_team = PlayerInterface::getPlayer(player_id)-&gt;getTeamID();
 
-    if ( (Teams_lists[newteam].countPlayers() &lt; Teams_lists[current_team].countPlayers()))
+    if ( (Teams_lists[newteam].countPlayers() &lt; Teams_lists[current_team].countPlayers())
+        &amp;&amp; ((PlayerInterface::getMaxPlayers()/2) &gt; Teams_lists[newteam].countPlayers()))
     {
         Teams_lists[current_team].removePlayer(player_id);
         Teams_lists[newteam].addPlayer(player_id);

Modified: trunk/netpanzer/src/NetPanzer/Interfaces/WorldViewInterface.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Interfaces/WorldViewInterface.hpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Interfaces/WorldViewInterface.hpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -54,6 +54,11 @@
         main_camera-&gt;scrollPlusY(scroll_increment);
     }
 
+    static inline void MoveCamera()
+    {
+        main_camera-&gt;MoveCamera();
+    }
+
     static inline void setCameraPosition(const iXY &amp;world_loc)
     {
         main_camera-&gt;setCamera(world_loc);

Modified: trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.cpp	2012-05-04 15:37:09 UTC (rev 1360)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/Desktop.cpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -617,7 +617,7 @@
     setDisplayStatusBar(false);
     setVisible(false);
 
-    resizeClientArea(iXY(320, 400));
+    resizeClientArea(iXY(800, 600));
     moveTo(iXY(0, 0));
 
     add( new Label( 0, 0,   &quot;Name&quot;, Color::white) );

Added: trunk/netpanzer/src/NetPanzer/Views/Components/cssButton.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/cssButton.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/cssButton.cpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -0,0 +1,136 @@
+/*
+Copyright (C) 2012 Netpanzer Team. (www.netpanzer.org), Laurent Jacques
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+
+#include &quot;Views/Components/cssButton.hpp&quot;
+#include &quot;Views/Components/View.hpp&quot;
+#include &quot;Util/Log.hpp&quot;
+
+#include &quot;MouseEvent.hpp&quot;
+
+cssButton::cssButton(const std::string &amp;cname)
+    : Component(&quot;Button.&quot; + cname)
+{
+    setTextColors(Color::white, Color::red, Color::yellow, Color::darkGray);
+    position.zero();
+    label.clear();
+    bstate = NORMAL;
+    dirty = true;
+}
+
+// render
+void
+cssButton::render()
+{
+    surface.fill(0);
+    Surface text;
+    text.renderText( label.c_str(), textColors[bstate], 0);
+    if (bstate == PRESSED)
+    {
+        bimage.bltTrans(surface, 1, 1);
+        text.bltTrans(surface, ((surface.getWidth()/2) - (text.getWidth()/2))+1,
+                      ((surface.getHeight()/2) - (text.getHeight()/2))+1);
+    }
+    else
+    {
+        bimage.bltTrans(surface, 0, 0);
+        text.bltTrans(surface, (surface.getWidth()/2) - (text.getWidth()/2),
+                      (surface.getHeight()/2) - (text.getHeight()/2));
+    }
+
+    dirty = false;
+}
+
+// actionPerformed
+//---------------------------------------------------------------------------
+void
+cssButton::actionPerformed(const mMouseEvent &amp;me)
+{
+    if (enabled == false) return;
+    
+    if (me.getID() == mMouseEvent::MOUSE_EVENT_ENTERED
+            || me.getID() == mMouseEvent::MOUSE_EVENT_RELEASED)
+    {
+        bstate = OVER;
+        dirty = true;
+    }
+    else if (me.getID() == mMouseEvent::MOUSE_EVENT_EXITED)
+    {
+        bstate = NORMAL;
+        dirty = true;
+    }
+    else if (me.getID() == mMouseEvent::MOUSE_EVENT_PRESSED)
+    {
+        bstate = PRESSED;
+        dirty = true;
+    }
+    else if (me.getID() == mMouseEvent::MOUSE_EVENT_CLICKED)
+    {
+        ((View *)parent)-&gt;onComponentClicked(this);
+    }
+} // end Button::actionPerformed
+
+cssButton *
+cssButton::createcssButton( std::string cname,
+                            std::string label,
+                            iXY loc)
+{
+    Surface bstart;
+    bstart.loadBMP(&quot;pics/backgrounds/menus/buttons/default/bs-black.bmp&quot;);
+    Surface bend;
+    bend.loadBMP(&quot;pics/backgrounds/menus/buttons/default/be-black.bmp&quot;);
+
+    Surface spbutton(Surface::getTextLength(label)+20, bstart.getHeight(), 1);
+
+    spbutton.setFrame(0);
+    bstart.blt(spbutton,0,0);
+    bend.blt(spbutton,spbutton.getWidth()-10,0);
+
+    cssButton *b = new cssButton(cname);
+    b-&gt;setImage(spbutton);
+    b-&gt;setLabel(label);
+    b-&gt;setLocation(loc);
+    b-&gt;setTextColors(Color::white, Color::yellow, Color::yellow, Color::darkGray);
+
+    return b;
+}
+
+cssButton *
+cssButton::createcssButton( std::string cname,
+                            std::string label,
+                            iXY loc, int width)
+{
+    Surface bstart;
+    bstart.loadBMP(&quot;pics/backgrounds/menus/buttons/default/bs-black.bmp&quot;);
+    Surface bend;
+    bend.loadBMP(&quot;pics/backgrounds/menus/buttons/default/be-black.bmp&quot;);
+
+    Surface spbutton(width, bstart.getHeight(), 1);
+
+    spbutton.setFrame(0);
+    bstart.blt(spbutton,0,0);
+    bend.blt(spbutton,spbutton.getWidth()-10,0);
+
+    cssButton *b = new cssButton(cname);
+    b-&gt;setImage(spbutton);
+    b-&gt;setLabel(label);
+    b-&gt;setLocation(loc);
+    b-&gt;setTextColors(Color::white, Color::yellow, Color::yellow, Color::darkGray);
+
+    return b;
+}


Property changes on: trunk/netpanzer/src/NetPanzer/Views/Components/cssButton.cpp
___________________________________________________________________
Added: svn:eol-style
   + native

Added: trunk/netpanzer/src/NetPanzer/Views/Components/cssButton.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Components/cssButton.hpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Views/Components/cssButton.hpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -0,0 +1,110 @@
+/*
+Copyright (C) 2012 Netpanzer Team. (www.netpanzer.org), Laurent Jacques
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#ifndef __cssButton_hpp__
+#define __cssButton_hpp__
+
+#include &quot;Component.hpp&quot;
+#include &quot;2D/Color.hpp&quot;
+#include &quot;ViewGlobals.hpp&quot;
+
+typedef enum
+{
+    NORMAL =   0,
+    OVER   =   1,
+    PRESSED=   2,
+    DISABLE=   3
+} BState;
+
+//--------------------------------------------------------------------------
+class cssButton : public Component
+{
+protected:
+    std::string label;
+    PIX textColors[4];
+    Surface bimage;
+    BState bstate;
+    void render();
+    void resetState()
+    {
+        bstate = NORMAL;
+        dirty = true;
+    }
+
+public:
+
+    cssButton(const std::string &amp;cname);
+
+    virtual ~cssButton() {}
+
+    static cssButton * createcssButton(std::string cname,
+                                       std::string label,
+                                       iXY loc);
+    static cssButton * createcssButton(std::string cname,
+                                       std::string label,
+                                       iXY loc, int with);
+
+    void setTextColors( PIX normal, PIX over, PIX pressed, PIX disable)
+    {
+        textColors[NORMAL] = normal;
+        textColors[OVER] = over;
+        textColors[PRESSED] = pressed;
+        textColors[DISABLE] = disable;
+    }
+    void Enable()
+    {
+        enabled = true;
+        bstate = NORMAL;
+        dirty = true;
+    }
+    void Disable()
+    {
+        enabled = false;
+        bstate = DISABLE;
+        dirty = true;
+    }
+    
+    bool isEnable()
+    {
+        return enabled;
+    }
+    
+    void setLabel(const std::string&amp; l)
+    {
+        label = l;
+        dirty = true;
+    }
+
+    void setImage(const Surface &amp;s)
+    {
+        if ( s.getNumFrames() )
+        {
+            bimage.copy(s);
+            setSize(bimage.getWidth(), bimage.getHeight());
+        }
+        dirty = true;
+    }
+    const std::string&amp; getLabel() const
+    {
+        return label;
+    }
+
+    virtual void actionPerformed(const mMouseEvent &amp;me);
+}; // end Button
+
+#endif // end __Button_hpp__


Property changes on: trunk/netpanzer/src/NetPanzer/Views/Components/cssButton.hpp
___________________________________________________________________
Added: svn:eol-style
   + native

Added: trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.cpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.cpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.cpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -0,0 +1,284 @@
+/*
+Copyright (C) 2012 Netpanzer Team. (www.netpanzer.org), Laurent Jacques
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include &quot;PrepareTeam.hpp&quot;
+#include &quot;Classes/ScreenSurface.hpp&quot;
+#include &quot;Classes/WorldInputCmdProcessor.hpp&quot;
+#include &quot;Views/Components/Desktop.hpp&quot;
+#include &quot;2D/Palette.hpp&quot;
+#include &quot;Interfaces/PlayerInterface.hpp&quot;
+#include &quot;Interfaces/TeamManager.hpp&quot;
+#include &quot;Interfaces/GameConfig.hpp&quot;
+#include &quot;Interfaces/GameControlRulesDaemon.hpp&quot;
+#include &quot;Interfaces/MapInterface.hpp&quot;
+#include &quot;Views/Components/cButton.hpp&quot;
+#include &quot;Views/Components/cssButton.hpp&quot;
+#include &quot;Objectives/ObjectiveInterface.hpp&quot;
+#include &quot;Resources/ResourceManager.hpp&quot;
+
+static const char * stats_format = &quot;%-20s&quot;;
+static Uint8 newteam = 0;
+
+//static void bChangeTeam()
+//{
+//    TeamManager::PlayerrequestchangeTeam(PlayerInterface::getLocalPlayerIndex(), newteam);
+//}
+
+PrepareTeam::PrepareTeam() : GameTemplateView()
+{
+    setSearchName(&quot;PrepareTeam&quot;);
+    setTitle(&quot;Prepare Team&quot;);
+    setSubTitle(&quot;&quot;);
+
+    setAllowResize(false);
+    setAllowMove(false);
+    setVisible(false);
+    setBordered(false);
+    menuImage.loadBMP(&quot;pics/backgrounds/menus/menu/canon.bmp&quot;);
+
+    loaded = false;
+}
+
+void PrepareTeam::init()
+{
+    removeComponents();
+    removeAllButtons();
+    iRect viewrect = getClientRect();
+
+    menuImageXY.x = (viewrect.getSizeX()/2) - 382;
+    menuImageXY.y = (viewrect.getSizeY()/2.5) - 190;
+
+    rect.min.x = menuImageXY.x+ ((menuImage.getWidth()-500)/2);
+    rect.min.y = menuImageXY.y+menuImage.getHeight();
+    rect.max.x = rect.min.x+500;
+    rect.max.y = rect.min.y+350;
+
+    firstrect.min.x = rect.min.x+7;
+    firstrect.min.y = rect.min.y+7;
+    firstrect.max.x =  rect.min.x+200;
+    firstrect.max.y = rect.max.y-7;
+
+    secondrect.min.x = rect.max.x-207;
+    secondrect.min.y = firstrect.min.y;
+    secondrect.max.x = rect.max.x-7;
+    secondrect.max.y = firstrect.max.y;
+    
+    changebutton = cssButton::createcssButton( &quot;changeteam&quot;, &quot; &gt;&gt; &quot;, iXY(firstrect.max.x+15, (firstrect.min.y+50)), 70);
+    add(changebutton);
+    readybutton = cssButton::createcssButton( &quot;ready&quot;, &quot;Ready&quot;, iXY(firstrect.max.x+15, (firstrect.min.y+85)), 70);
+    add(readybutton);
+    loaded = true;
+}
+
+void PrepareTeam::doDraw(Surface &amp;viewArea, Surface &amp;clientArea)
+{
+    menuImage.bltTrans(clientArea, menuImageXY.x, menuImageXY.y);
+    clientArea.FillRoundRect(rect, 12, Color::black);
+    clientArea.RoundRect(rect,12, Color::white);
+
+    clientArea.RoundRect(firstrect,10, TeamManager::getTeamColor(0));
+    clientArea.RoundRect(secondrect,10, TeamManager::getTeamColor(1));
+    DrawInfo(clientArea);
+    drawTeams(clientArea);
+    View::doDraw(viewArea, clientArea);
+}
+
+void PrepareTeam::DrawInfo(Surface &amp;dest)
+{
+    iXY start;
+    start.x = menuImageXY.x+245;
+    start.y = menuImageXY.y+115;
+    int nextx = 145;
+    char statBuf[256];
+
+    snprintf(statBuf, sizeof(statBuf), &quot;%d&quot;, GameControlRulesDaemon::getTeamCD());
+    dest.bltString(firstrect.max.x+40 , firstrect.min.y+5, statBuf, Color::white);
+
+    dest.bltString(start.x , start.y, &quot;Game:&quot;, Color::white);
+    dest.bltString(start.x+nextx , start.y, &quot;Map:&quot;, Color::white);
+    start.y+= 10;
+    dest.drawLine(start.x, start.y, start.x+100, start.y, Color::white);
+    dest.drawLine(start.x+nextx, start.y, start.x+nextx+100, start.y, Color::white);
+    start.y+= 7;
+    switch(GameConfig::game_gametype)
+    {
+    case  _gametype_timelimit:
+    {
+        snprintf(statBuf, sizeof(statBuf), &quot;Time limit: %i&quot;, GameConfig::game_timelimit);
+        break;
+    }
+    case _gametype_fraglimit:
+    {
+        snprintf(statBuf, sizeof(statBuf), &quot;Frag limit: %i&quot;, GameConfig::game_fraglimit);
+        break;
+    }
+    case _gametype_objective:
+    {
+        snprintf(statBuf, sizeof(statBuf), &quot;Objective: %i%%&quot;, GameConfig::game_occupationpercentage);
+        break;
+    }
+    }
+    dest.bltString(start.x, start.y, statBuf, Color::white);
+    snprintf(statBuf, sizeof(statBuf), &quot;Name: %-20s&quot;, MapInterface::getMap()-&gt;getName().c_str());
+    dest.bltString(start.x+nextx, start.y, statBuf, Color::white);
+    start.y+= 13;
+    snprintf(statBuf, sizeof(statBuf), &quot;Players: %i/%i&quot;,  
+             PlayerInterface::getActivePlayerCount(), 
+             GameConfig::game_maxplayers);
+    dest.bltString(start.x, start.y, statBuf, Color::white);
+    snprintf(statBuf, sizeof(statBuf), &quot;Objectives: %i&quot;, ObjectiveInterface::getObjectiveCount());
+    dest.bltString(start.x+nextx, start.y, statBuf, Color::white);
+    start.y+= 13;
+    snprintf(statBuf, sizeof(statBuf), &quot;Units: %i&quot;, GameConfig::game_maxunits/GameConfig::game_maxplayers);
+    dest.bltString(start.x, start.y, statBuf, Color::white);
+}
+
+class StatesSortByTeam
+    : public std::binary_function&lt;const PlayerState*, const PlayerState*, bool&gt;
+{
+public:
+    bool operator() (const PlayerState* state1, const PlayerState* state2)
+    {
+        return state1-&gt;getTeamID() &lt; state2-&gt;getTeamID();
+    }
+};
+
+void PrepareTeam::drawTeams(Surface &amp;dest)
+{
+    char statBuf[256];
+
+    states.clear();
+    PlayerID i;
+    for( i = 0; i &lt; PlayerInterface::getMaxPlayers(); ++i)
+    {
+        PlayerState* state = PlayerInterface::getPlayer(i);
+        if( state-&gt;isActive() )
+        {
+            states.push_back(state);
+        }
+    }
+    std::sort(states.begin(), states.end(), StatesSortByTeam());
+
+    int cur_line_pos = firstrect.min.y +10;
+    snprintf(statBuf, sizeof(statBuf), &quot;Team: %-20s&quot;, TeamManager::getTeamName(0).c_str());
+    dest.bltString(firstrect.min.x+40, cur_line_pos, statBuf,TeamManager::getTeamColor(0));
+    TeamManager::drawFlag(0, dest, firstrect.min.x+10, cur_line_pos-2);
+
+    snprintf(statBuf, sizeof(statBuf), &quot;Team: %-20s&quot;, TeamManager::getTeamName(1).c_str());
+    dest.bltString(secondrect.min.x+40, cur_line_pos, statBuf,TeamManager::getTeamColor(1));
+    TeamManager::drawFlag(1, dest, secondrect.min.x+10, cur_line_pos-2);
+
+    cur_line_pos += 25;
+    dest.drawLine(firstrect.min.x+10, cur_line_pos-10, firstrect.max.x-10, cur_line_pos-10, TeamManager::getTeamColor(0));
+    dest.drawLine(secondrect.min.x+10, cur_line_pos-10, secondrect.max.x-10, cur_line_pos-10, TeamManager::getTeamColor(1));
+
+    int Start_x = firstrect.min.x+30;
+    int current_Team = 0;
+    Surface * flag = 0;
+
+    for(std::vector&lt;const PlayerState*&gt;::iterator i = states.begin();
+            i != states.end(); ++i)
+    {
+        const PlayerState* state = *i;
+
+        if (current_Team != state-&gt;getTeamID())
+        {
+            cur_line_pos = firstrect.min.y +35;
+            Start_x = secondrect.min.x+30;
+            current_Team = state-&gt;getTeamID();
+        }
+        flag = ResourceManager::getFlag(state-&gt;getFlag());
+        flag-&gt;blt( dest, Start_x-23, cur_line_pos-5 );
+
+        if ( state-&gt;getID() == PlayerInterface::getLocalPlayerIndex() )
+        {
+            snprintf(statBuf, sizeof(statBuf),
+                     stats_format, state-&gt;getName().substr(0,20).c_str());
+            dest.bltStringShadowed(Start_x, cur_line_pos, statBuf,Color::cyan, Color::gray64);
+            if (current_Team &gt; 0)
+            {
+                newteam=0;
+                changebutton-&gt;setLabel(&quot;&lt;&lt;&quot;);
+            }
+            else
+            {
+                newteam=1;
+                changebutton-&gt;setLabel(&quot;&gt;&gt;&quot;);
+            }
+        }
+        else
+        {
+            snprintf(statBuf, sizeof(statBuf),
+                     stats_format, state-&gt;getName().substr(0,20).c_str());
+            dest.bltStringShadowed(Start_x, cur_line_pos, statBuf,Color::gray224, Color::gray64);
+        }
+        cur_line_pos += 20;
+    }
+}
+void PrepareTeam::doActivate()
+{
+    if ( ! loaded )
+    {
+        init();
+    }
+    Desktop::setActiveView(this);
+}
+
+void PrepareTeam::doDeactivate()
+{
+    if ( ! getVisible() )
+    {
+        removeComponents();
+        removeAllButtons();
+        loaded = false;
+    }
+}
+
+void PrepareTeam::checkResolution(iXY oldResolution, iXY newResolution)
+{
+    resize(iXY(newResolution.x, newResolution.y));
+    moveTo(iXY(0,0));
+}
+
+void PrepareTeam::processEvents()
+{
+    COMMAND_PROCESSOR.process(false);
+}
+
+void PrepareTeam::onComponentClicked(Component* c)
+{
+    if ( c == changebutton )
+    {
+        TeamManager::PlayerrequestchangeTeam(PlayerInterface::getLocalPlayerIndex(), newteam);
+    }
+    else if ( c == readybutton )
+    {
+        readybutton-&gt;Disable();
+        changebutton-&gt;Disable();
+    }
+}
+
+void PrepareTeam::resize(const iXY &amp;size)
+{
+    View::resize(size);
+    init();
+}
+
+
+
+


Property changes on: trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.cpp
___________________________________________________________________
Added: svn:eol-style
   + native

Added: trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.hpp
===================================================================
--- trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.hpp	                        (rev 0)
+++ trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.hpp	2012-05-11 15:30:20 UTC (rev 1361)
@@ -0,0 +1,60 @@
+/*
+Copyright (C) 2012 Netpanzer Team. (www.netpanzer.org), Laurent Jacques
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#ifndef PREPARETEAM_HPP
+#define PREPARETEAM_HPP
+
+#include &lt;vector&gt;
+#include &quot;GameTemplateView.hpp&quot;
+#include &quot;2D/Surface.hpp&quot;
+#include &quot;Views/Components/cssButton.hpp&quot;
+
+class PlayerState;
+
+class PrepareTeam : public GameTemplateView
+{
+private:
+    bool loaded;
+
+    iRect firstrect;
+    iRect secondrect;
+    iRect rect;
+    std::vector&lt;const PlayerState*&gt; states;
+    void drawTeams(Surface &amp;dest);
+    void DrawInfo(Surface &amp;dest);
+    iXY menuImageXY;
+    Surface menuImage;
+    cssButton * changebutton;
+    cssButton * readybutton;
+
+public:
+    PrepareTeam();
+    virtual ~PrepareTeam()
+    {}
+
+    virtual void doActivate();
+    virtual void doDeactivate();
+    virtual void doDraw(Surface &amp;windowArea, Surface &amp;clientArea);
+    virtual void checkResolution(iXY oldResolution, iXY newResolution);
+    virtual void processEvents();
+    virtual void onComponentClicked(Component* c);
+    virtual void resize(const iXY &amp;size);
+    void init();
+};
+
+#endif // PREPARETEAM_HPP


Property changes on: trunk/netpanzer/src/NetPanzer/Views/Game/PrepareTeam.hpp
___________________________________________________________________
Added: svn:eol-style
   + native

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000384.html">[Netpanzer-cvs] r1360 - in trunk/netpanzer/src/NetPanzer: Classes	Interfaces Views/Game
</A></li>
	<LI>Next message: <A HREF="000386.html">[Netpanzer-cvs] r1362 - in trunk/netpanzer/src/NetPanzer:	Classes/Network Interfaces Views/Game
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#385">[ date ]</a>
              <a href="thread.html#385">[ thread ]</a>
              <a href="subject.html#385">[ subject ]</a>
              <a href="author.html#385">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/netpanzer-cvs">More information about the Netpanzer-cvs
mailing list</a><br>
</body></html>
